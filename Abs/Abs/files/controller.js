define("template/home",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<div sn-display="{!showGuide}"> <div class="searchwrap" ref="searchwrap" style="display:none"> <header> <form class="head_search head_disc"> <em class="icon-search icon_cm"></em> <input type="search" placeholder="热门搜索：新月枕" ref="searchText" /> </form> <div class="head_right" sn-tap="this.hideSearch()">取消</div> </header> <div class="main"> <div class="searchhistory"><i class="icon-clear" sn-tap="this.clearSearch()"></i> 历史记录</div> <ul class="searchlist"> <li sn-repeat="item in searchHistory" sn-tap="this.search(item)">{item}</li> </ul> <div class="searchhistory">热门搜索</div> <ul class="searchlist"> <li sn-repeat="item in hotSearch" sn-tap="this.search(item)">{item}</li> </ul> </div> </div> <header sn-display="{!isStart||isLogin}"> <div class="head_left"> <em class="icon-location" sn-if="{bottomTab==0||bottomTab==1}" sn-tap="this.showMap()"> </em> <em class="icon-setting" sn-if="{bottomTab==4}" data-forward="/settings"> </em> </div> <form class="head_search head_disc" sn-if="{bottomTab==2}"> <input type="search" placeholder="搜索专题" ref="search" /> </form> <div class="head_search head_search_holder" sn-click="this.showSearch()" sn-display="{tab==0&&bottomTab==0}"> <em class="icon-search icon_cm"></em> </div> <div class="head_title" sn-display="{bottomTab==3}" style="display:none">我的购物车</div> <div class="head_right"> <button sn-if="bottomTab==3" class="btn_s" sn-tap="cart.isEdit=!cart.isEdit">{cart.isEdit?\'完成\':\'编辑\'}</button> <em class="icon-message head_msg" data-forward="{isLogin?\'/messages\':\'/login\'}"> <i sn-display="{$global.msg_count!=0?\'block\':\'none\'}">{$global.msg_count}</i> </em> </div> </header> <div sn-if="{isStart&&!isLogin}" style="position:absolute;z-index: 1000;right:0;left:0;top:0;bottom:0;"> <div class="home_mask"></div> <div class="home_text" data-forward="/login"> <h1></h1> <h2>让回家的灯，为爱亮起来。</h2> <h3>开启时尚居家之旅</h3> <h4>LIFE STARTS HERE</h4> </div> <div class="launch"> <img src="images/launch0.jpg" /> <img src="images/launch1.jpg" class="launch_hide" /> <img src="images/launch2.jpg" class="launch_hide" /> </div> </div> <div sn-display="{!isStart||isLogin}"> <div class="main js_shop hm_tab_con" sn-style="-webkit-transform:translate({bottomTab==0?\'0px\':\'100%\'},0px)" data-index="0"> <div class="hm_shop"> <div class="sp_all_cates"> <div ref="cates"> <ul style="width:{(navs.length+1)*.73}rem;padding-right:30px;"> <li class="cate0 curr">首页</li> <li sn-repeat="item in navs" class="{!item.LPE_URL?\'cate\'+item.LPE_PCG_ID:\'noicon\'}" data-forward="{!item.LPE_URL?\'/all?id=\'+item.LPE_PCG_ID:item.LPE_URL}">{item.LPE_PCG_NAME}</li> </ul> </div> <div class="dropdown_btn" sn-tap="this.showCategories()"></div> </div> <div class="banner" ref="topbanner"> </div> <ul class="hm_shop__nav"> <li data-forward="/list?type=new&from=%2f"><i class="icon-new icon_cm"></i>新品上市</li> <li data-forward="/news/fastbuy?from=%2f"><i class="icon-flash icon_cm"></i>周一闪购</li> <li data-forward="/group"><i class="icon-group icon_cm"></i>来拼团吧</li> <li data-forward="/news/activity2"><i class="icon-navhot icon_cm"></i>人气必入</li> </ul> <div sn-repeat="item in activity"> <div sn-if="{item.type==1}" class="hm_shop_banner"> <ul> <li><img sn-repeat="img in item.data" data-src="{img.src}" data-forward="{img.url}?from=%2f" /></li> </ul> </div> <div sn-if="{item.type==2&&item.data.length}" class="hm_shop_scroll js_shop_scroll" style="padding-right:10px;"> <ul class="hm_shop_list"> <li class="hm_shop_list_item" sn-repeat="prd in item.data" data-forward="/item/{prd.PRD_ID}?from={encodeURIComponent(\'/\')}"> <img data-src="{prd.WPP_LIST_PIC}" /> <p class="price">￥{prd.PRD_PRICE} <del sn-display="{prd.PRD_SPECIAL_FLAG}">¥{prd.PRD_MEMBER_PRICE}</del> </p> <p class="name">{prd.PRD_NAME}</p> </li> </ul> </div> </div> <ul class="sp_list"> <li sn-repeat="item in newproducts" class="sp_list_item" data-forward="/item/{item.PRD_ID}"> <img data-src="{item.WPP_LIST_PIC1}" /> <p class="price"><b>￥{item.PRD_PRICE}</b> <del sn-display="{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}">￥{item.PRD_MEMBER_PRICE}&nbsp;</del> </p> <p class="name">{item.PRD_NAME}</p> <div class="sold_out" sn-display="{item.PRD_NUM==0}">脱 销 <br>Sold Out</div> </li> </ul> </div> </div> <div class="main" sn-style="-webkit-transform:translate({bottomTab==1?\'0px\':\'100%\'},0px)"> <div class="baiduMap" sn-html="{baiduMap}"> </div> </div> <div ref="discovery" class="main" sn-style="-webkit-transform:translate({bottomTab==2?\'0px\':\'100%\'},0px)"> </div> <div ref="cart" class="main hm_cart" sn-style="-webkit-transform:translate({bottomTab==3?\'0px\':\'100%\'},0px)"> </div> <div ref="messages" class="main hm_msg" style="display:none"> <div style="overflow:hidden"> <div class="hm_msg_list" data-forward="/messages">通知<i sn-display="{msg_count!=0}">{msg_count}</i></div> <div class="hm_msg_service" data-forward="/news/100">联系客服</div> <div class="hm_msg_discovery"> <div class="hd">更多会生活</div> <ul class="disc_list"> <li sn-repeat="item in rec" data-forward="/discovery/{item.DCV_ID}"> <img sn-src="{item.DCV_REC_PIC}" /> <em class="see">点击查看</em> </li> </ul> <div class="ft" data-forward="/discovery/list/0">查看更多会生活>></div> </div> </div> </div> <div class="hm_user" sn-style="-webkit-transform:translate({bottomTab==4?\'0px\':\'100%\'},0px)"> <div class="main" data-index="3"> <div class="hm_user__body"> <div class="hm_user__base"> <div class="avatars" data-forward="/avatars"><img sn-src="{$global.user.Avatars||\'/images/default.jpg\'}" sn-error="this.src=\'/images/default.jpg\'" /></div> <div class="name" data-forward="/member">{user.UserName}</div> <div class="addr" data-forward="/address">收货地址<em class="icon_arrow"></em></div> </div> <div class="hm_user__card"> <div class="icon-abs hd bottom_border"><span class="level">{vipName}</span> <span class="energy">活力值<em>{util.formatMoney(energy)}</em></span> </div> <div class="bottom_border"> <div class="barcode" sn-html="{barcode}"> </div> </div> <div class="rights" data-forward="/news/201">会员权益<em class="icon_arrow"></em></div> </div> <div class="hm_user__order top_bottom_border"> <div class="user-order bottom_border">我的订单<span class="allorder" data-forward="/myorder">查看全部订单</span></div> <ul class="ordercates"> <li class="user-unpay" data-forward="/myorder?state=1"><i sn-if="{order1num}">{order1num}</i><span>待付款</span></li> <li class="user-unsend" data-forward="/myorder?state=2"><i sn-if="{order2num}">{order2num}</i><span>待发货</span></li> <li class="user-send" data-forward="/myorder?state=3"><i sn-if="{order3num}">{order3num}</i><span>配送中</span></li> <li class="user-complete" data-forward="/myorder?state=4"><i sn-if="{order4num}">{order4num}</i><span>已完成</span></li> </ul> </div> <ul class="hm_user__other top_bottom_border"> <li class="user-gift bottom_border" data-forward="/month">我的月礼 <em class="note">{user.FreeMonths}个月</em></li> <li class="user-card bottom_border" data-forward="/coupon">我的卡券 <em class="note">{user.FreeCouponsCount+user.CouponsCount}</em></li> <li class="user-money" data-forward="/mypoint">积分钱包 <em class="note">{user.Points}积分</em></li> </ul> <ul class="hm_user__other top_bottom_border"> <li class="user-group" data-forward="/steward">爱管家记录 <em class="note">{user.StewardNum}条</em></li> </ul> </div> </div> </div> <div class="main js_offline" sn-if="{isOffline}"> <div class="home_offline"> <div class="ico"></div> <div class="txt">您的网络不太顺畅哦</div> <div class="txt_sub">请检查您的手机是否联网</div> <div class="btn">重新加载</div> </div> </div> </div> <ul class="footer top_border" sn-display="{!isStart||isLogin}"> <li class="{bottomTab==0?\'curr\':\'\'}" sn-tap="this.showHome()"><em class="{bottomTab==0?\'icon-home_cur\':\'icon-home\'}"></em>首页</li> <li data-forward="/all?id=1"><em class="icon-menu"></em>分类</li> <li class="{bottomTab==2?\'curr\':\'\'}" sn-tap="this.showDiscovery()"><em class="{bottomTab==2?\'icon-life_cur\':\'icon-life\'}"></em>会生活</li> <li class="{bottomTab==3?\'curr\':\'\'}" sn-tap="this.showCart()"><em class="{bottomTab==3?\'icon-cart_cur\':\'icon-cart\'}"></em>购物车<i sn-display="{$global.cartQty!=0}">{$global.cartQty}</i></li> <li class="{bottomTab==4?\'curr\':\'\'}" sn-tap="this.showMe()"><em class="{bottomTab==4?\'icon-person_cur\':\'icon-person\'}"></em>我</li> </ul> <div class="open_msg" style="display:none"> <div class="msg_bd" sn-html="{message}"></div> </div> <div class="home_tip_mask" sn-if="{(!isStart||isLogin)&&showTipStep==1}"></div> </div> <div class="hm_guide" sn-if="{showGuide}"> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/home",["components","logical","css/style.css","css/append.css","components/confirm","components/cart","./discovery/discovery_index"],function(t,e,i){var n=t("$"),s=t("util"),r=t("activity"),a=t("bridge"),o=t("../widget/loader"),l=t("../widget/slider"),c=t("core/model2"),u=c.Model,d=c.Global,p=(t("../widget/scroll"),t("../utils/barcode")),m=(t("animation"),t("components/confirm")),v=t("models/api"),g=t("models/user"),_=t("models/category"),y=t("components/category"),b=t("components/cart"),x=(t("widget/album"),t("./discovery/discovery_index")),P=t("core/route").formatUrl;d.set({msg_count:0,cartQty:0});var A=new v.CartQtyAPI({checkData:!1,success:function(t){d.set({cartQty:t.data})},error:function(){}}),I=s.store("recordVersionTime");if(!I||Date.now()-I>864e5){s.store("recordVersionTime",Date.now());var S=new v.HistoryRecord({success:function(t){},error:function(){}}),T=g.get();a.system.info(function(t){S.setParam({pspid:T?T.ID:0,appversion:sl.appVersion,device:t.deviceName,deviceversion:(s.ios?"IOS":"Android")+s.osVersion,uuid:t.uuid}).load()})}i.exports=r.extend({events:{"tap .home_tip_mask":function(t){s.store("showTipStep",2),this.model.set({showTipStep:2})},"tap .open_msg":function(t){n(t.target).hasClass("open_msg")&&n(t.target).removeClass("show")},"tap .js_offline .btn":function(){this.requestUser()},"tap .guide1":function(){this.model.set({showGuide:!1})}},className:"home",showDiscovery:function(){return this.model.get("isLogin")?void(2!=this.model.get("bottomTab")&&(this.discovery||(this.discovery=new x,this.discovery.$el.appendTo(this.model.refs.discovery)),this.model.set({bottomTab:2}),this.queryString("tab",2))):void this.forward("/login")},showMap:function(){this.forward("/map")},showCart:function(){var t=this.model.data;if(t.isLogin){if(3!=t.bottomTab){if(this.cart)this.cart.cartApi.load();else{var e=this.cart=new b;this.model.set({cart:e}),e.$el.appendTo(this.model.refs.cart)}this.model.set({bottomTab:3}),this.queryString("tab",3)}}else self.forward("/login")},startMakeLog:function(){var t=this,e=function(){var e=P(location.hash);a.system.info(function(i){var n=new Image,r=(s.ios?"IOS":"Android")+s.osVersion;n.src=v.ShopAPI.prototype.baseUri+"/api/system/addpagests?pspcode="+(t.user?t.user.PSP_CODE:"")+"&pageurl="+encodeURIComponent(e)+"&appversion="+sl.appVersion+"&uuid="+i.uuid+"&deviceversion="+r})};e(),n(window).on("hashchange",e),n(".viewport").on("touchstart",function(e){var i=P(location.hash);a.system.info(function(n){var r=new Image,a=(s.ios?"IOS":"Android")+s.osVersion;r.src=v.ShopAPI.prototype.baseUri+"/api/system/addpagests?pspcode="+(t.user?t.user.PSP_CODE:"")+"&pageurl="+encodeURIComponent(i)+"&appversion="+sl.appVersion+"&uuid="+n.uuid+"&deviceversion="+a+"&coordx="+e.touches[0].pageX+"&coordy="+e.touches[0].pageY})})},getOrderCount:function(){var t=this;new o({url:"/api/order/getCounts",params:{UserID:t.user.ID,Auth:t.user.Auth}}).request().then(function(e){t.model.set({order1num:e.data[0],order2num:e.data[1],order3num:e.data[2]})})},onCreate:function(){var t=this;t.user=g.get(),t.$tabs=t.$(".hm_tab_con"),sl.activity=t,this.startMakeLog();var e=this.model=new u(this.$el,{menu:"head_menu",titleClass:"head_title",isOffline:!1,isLogin:!!t.user,isStart:1==t.query.start,msg:0,tab:0,bottomTab:0,chartType:0,open:function(){a.openInApp(t.user.OpenUrl||"http://m.abs.cn")},openUrl:function(t,e){a.openInApp(e||"http://m.abs.cn")},searchHistory:s.store("searchHistory")});this.model.showHome=function(){0!=this.data.bottomTab&&(this.set({bottomTab:0}),t.queryString("tab",0))},this.model.showDiscovery=this.showDiscovery.bind(this),this.model.showMap=this.showMap.bind(this),this.model.showCart=this.showCart.bind(this),this.model.showMe=function(){this.data.isLogin?(4!=this.get("bottomTab")&&t.getOrderCount(),this.set({bottomTab:4}),t.queryString("tab",4)):t.forward("/login")},e.showSearch=function(t){this.set({isShowSearch:!0}),n(this.refs.searchwrap).show(),this.refs.searchText.focus(),t.preventDefault(),t.stopPropagation()},e.clearSearch=function(){s.store("searchHistory",null),this.set({searchHistory:null})},e.hideSearch=function(){this.set({isShowSearch:!1}),this.refs.searchText.blur(),n(this.refs.searchwrap).hide()},t.hotSearchAPI=new v.HotSearchAPI({checkData:!1,success:function(e){t.model.set({hotSearch:e.data})}}),t.hotSearchAPI.load();var i=new v.UpdateAPI({checkData:!1,params:{version:sl.appVersion,platform:s.ios?1:2},success:function(t){if(t.success&&t.data.AVS_UPDATE_URL){var e=new m({content:t.data.AVS_UPDATE_MSG,alwaysOpen:t.data.AVS_FORCE_FLAG,confirm:function(){a.update(t.data.AVS_UPDATE_URL,t.data.AVS_VERSION)}});e.$el.appendTo(n("body")),e.show()}},error:function(){}});i.request()["catch"](function(){}),this.stewardQtyApi=new v.StewardQtyAPI({checkData:!1,success:function(i){t.user.StewardNum=i.data,g.set(t.user),e.set("user.StewardNum",i.data)}}),this.launchLoading=new o({url:"/api/settings/ad_list?name=launch&type=base64",check:!1,checkData:!1,success:function(t){t&&t.data&&t.data.length&&localStorage.setItem("LAUNCH_IMAGE",t.data[0].Src)}}),this.launchLoading.load(),t.shopApi=new v.ActivityAPI({$el:t.$(".hm_shop"),success:function(i){e.set({activity:i.data,topbanner:i.topbanner}),t.slider?t.slider.set(i.topbanner.data):t.slider=new l({loop:!0,container:e.refs.topbanner,autoLoop:3e3,data:i.topbanner.data||[],dots:!0,itemTemplate:'<img data-src="<%=src%>" data-forward="<%=url%>?from=%2f" />'}),e.one("viewDidUpdate",function(){t.bindScrollTo(t.$(".js_shop_scroll:not(.s_binded)").addClass("s_binded"),{vScroll:!1,hScroll:!0,useScroll:!0}),t.scroll&&t.scroll.get(".js_shop").imageLazyLoad()}),this.showMoreMsg('别拉了，就这些<i class="ico_no_more"></i>')}}),t.shopApi.load(),new v.ShopAPI({url:"/api/prod/newproductlist",checkData:!1,check:!1,success:function(t){t.success&&e.set({newproducts:t.data})},error:function(){}}).load(),this.bindScrollTo(e.refs.cates,{useScroll:!0,vScroll:!1,hScroll:!0}),e.showCategories=function(){t.cpCategory.show()},_.request(function(){_.list(function(i,n){i=s.find(i,function(t){return t.children}),e.set({navs:n,categories:i});var r=new y({data:i,isHome:!0,"goto":function(e,i){r.hide(),t.forward("/all?id="+i)}});r.$el.appendTo("body"),t.cpCategory=r})}),s.store("IS_SHOW_GUIDE")||(s.store("IS_SHOW_GUIDE",1),e.set("showGuide",!0).next(function(){t.guideSlider=new l({container:t.$(".hm_guide"),itemTemplate:'<img class="guide<%=id%>" src="http://appuser.abs.cn/dest1.2.0/images/guide<%=id%>.jpg" />',data:[{id:0},{id:1}],onChange:function(t){}})})),this.bindScrollTo(this.$(".main:not(.js_shop)")),this.scroll=this.bindScrollTo(this.$(".js_shop"),{refresh:function(e,i){t.shopApi.load(function(){e()})}}),t.$open_msg=this.$(".open_msg").on(n.fx.transitionEnd,function(e){t.$open_msg.hasClass("show")||t.$open_msg.hide()}),this.bindScrollTo(t.$open_msg.find(".msg_bd"));var r=this.$(".launch img"),c=this.$(".home_mask").on(n.fx.transitionEnd,function(t){if(c.hasClass("toggle")){c.removeClass("toggle");var e=r.filter(":not(.launch_hide)").addClass("launch_hide");r.eq(e.index()+1==r.length?0:e.index()+1).removeClass("launch_hide")}});setTimeout(function(){c.addClass("toggle"),setTimeout(arguments.callee,3200)},3200),t.onResult("Login",function(){var e=t.user=g.get();t.model.set({isLogin:!0,isOffline:!1,user:e}),t.doWhenLogin(),t.refreshCart()}).onResult("UserChange",function(){t.requestUser()}).onResult("Logout",function(){t.user=null,g.set(null),e.set({isLogin:!1,user:null}),t.$(".footer li:nth-child(1)").trigger("tap")}).onResult("CartChange",function(){t.refreshCart()}),setInterval(function(){t.getUnreadMsg()},3e4),this.listenTo(n(this.model.refs.search),"keydown",function(e){return 13==e.keyCode?(t.forward("/discovery/list?s="+encodeURIComponent(e.target.value)+"&from=/"),e.preventDefault(),!1):void 0}),this.listenTo(n(this.model.refs.searchText),"keydown",function(t){return 13==t.keyCode?(e.search(t.target.value),t.preventDefault(),!1):void 0}),e.search=function(e){var i=s.store("searchHistory")||[],n=i.indexOf(e);-1!=n&&i.splice(n,1),i.unshift(e),t.model.set({searchHistory:i}),s.store("searchHistory",i),t.forward("/list?s="+encodeURIComponent(e)+"&from=/")}},refreshCart:function(){this.user.PSP_CODE&&(this.cart?this.cart.cartApi.load():A.setParam({pspcode:this.user.PSP_CODE}).load(),4==this.model.get("bottomTab")&&this.getOrderCount())},requestUser:function(){var t=this;g.request(s.store("ivcode")||"0000").then(function(e){e.data.ID=e.data.UserID,g.set(e.data);var i=t.user=g.get();t.model.set({barcode:p.code93(i.Mobile).replace(/0/g,"<em></em>").replace(/1/g,"<i></i>"),isLogin:!0,isOffline:!1,user:t.user}),t.refreshCart(),t.showEnergy(),t.stewardQtyApi.setParam({pspcode:t.user.PSP_CODE}).load(),e.vdpMessage&&t.showMessageDialog(e.vdpMessage),s.isInApp&&a.getDeviceToken(function(t){t&&new v.API({params:{UserID:i.ID,Auth:i.Auth,IMEI:t?"string"==typeof t?t:t.token:"CAN_NOT_GET"},url:"/api/user/deviceToken",success:function(){},error:function(){}}).load()})},function(e){return e?(503==e.error_code&&(g.set(null),t.model.set("isLogin",!1)),void t.model.set("isOffline",!0)):void 0})},showMessageDialog:function(t){var e=this;e.model.set("showTipStep",1),e.$open_msg.show(),e.$open_msg[0].clientHeight,e.$open_msg.addClass("show"),e.model.set({message:t})},showEnergy:function(){if(this.user){var n,r,a,o,t=this,e=Math.round(this.user.Amount),i=1,l=["银卡会员","金卡会员","钻石会员","VIP会员","SVIP会员","无敌会员"];t.model.set("vip",e<(o=1e3)?(n=0,a=0,r=1e3,l[1]):e<(o=5e3)?(n=1,a=1e3,r=5e3,l[2]):e<(o=1e4)?(n=2,a=5e3,r=1e4,l[3]):e<(o=5e4)?(n=3,a=1e4,r=5e4,l[4]):(n=4,r="0",l[5])),i=Math.min(1,e/o),t.model.set({nextLevel:r,currentLevel:a,vipName:l[n],levelAmounts:o,energyPercent:100*i+"%",ucCardAmounts:s.formatMoney(e)+(e>5e4?"":"/"+s.formatMoney(o))}),e!=t.model.data.energy&&t.model.set({energy:e})}},getUnreadMsg:function(){var t=this;t.user&&t.user.Auth&&n.post(a.url("/api/user/get_unread_msg_count"),{UserID:t.user.ID,Auth:t.user.Auth},function(t){t.success&&d.set("msg_count",t.count)},"json")},doWhenLogin:function(){var t=this;g.setParam({IMEI:""}),t.requestUser()},onShow:function(){var t=this;this.user&&(this.showEnergy(),this.doWhenLogin()),setTimeout(function(){t.guideSlider&&(t.guideSlider.adjustWidth?t.guideSlider.adjustWidth():t.guideSlider._adjustWidth())},0),0==t.model.data.tab&&(t.slider&&setTimeout(function(){t.slider.adjustWidth?t.slider.adjustWidth():t.slider._adjustWidth()},400),t.scroll&&t.scroll.get(".js_shop").imageLazyLoad())},onPause:function(){},onQueryChange:function(){"0"===this.query.tab&&this.$(".footer li:nth-child(1)").trigger("tap"),this.model.set({isStart:1==this.query.start})},onDestroy:function(){}})});define("template/about",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back=\'{{back}}\'></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="aboutus"> ABS尊重并保护所有使用ABS平台服务用户的个人隐私权。为了给您提供更准确、更有个性化的服务，ABS会按照本隐私权政策的规定使用和披露您的个人信息。但ABS将以高度的勤勉、审慎义务对待这些信息。除本隐私权政策另有规定外，在未征得您事先许可的情况下，ABS不会将这些信息对外披露或向第三方提供。ABS会不时更新本隐私权政策。您在同意ABS服务协议之时，即视为您已经同意本隐私权政策全部内容。本隐私权政策属于ABS服务协议不可分割的一部分。<br><br> <b>1. 适用范围</b><br> a） 在您注册或激活可以登录ABS平台的账户时，您在ABS平台提供的个人注册信息（应法律法规要求需公示的企业名称等相关工商注册信息以及自然人经营者的信息除外）；<br> b） 在您使用ABS平台服务，或访问ABS平台网页时，ABS自动接收并记录的您的浏览器和计算机上的信息，包括但不限于您的IP地址、浏览器的类型、使用的语言、 访问日期和时间、软硬件特征信息及您需求的网页记录等数据；如您下载或使用ABS或其关联公司移动客户端软件，或访问移动网页使用ABS平台服务时，ABS可能会读取与您位置和移动设备相关的信息，包括但不限于设备型号、设备识别码、操作系统、分辨率、电信运营商等。<br> c） ABS通过合法途径从商业伙伴处取得的用户个人数据。<br> 您了解并同意，以下信息不适用本隐私权政策：<br> a）您在使用ABS平台提供的搜索服务时输入的关键字信息；<br> b）ABS收集到的您在ABS进行交易的有关数据，包括但不限于出价、成交信息及评价详情；<br> c）信用评价、违反法律规定或违反ABS规则行为及ABS已对您采取的措施。<br><br> <b>2. 信息使用</b><br> a) ABS不会向任何无关第三方提供、出售、出租、分享或交易您的个人信息，除非事先得到您的许可，或该第三方和ABS单独或共同为您提供服务，且在该服务结束后，其将被禁止访问包括其以前能够访问的所有这些资料。<br > b)ABS亦不允许任何第三方以任何手段收集、编辑、出售或者无偿传播您的个人信息。任何ABS平台用户如从事上述活动，一经发现，ABS有权立即终止与该用户的服务协议。<br> c) 为服务用户的目的，ABS或其关联公司可能通过使用您的个人信息，向您提供您可能感兴趣的信息，包括但不限于向您发出产品和服务信息，或通过系统向您展示个性化的第三方推广信息，或者与ABS合作伙伴共享信息以便他们向您发送有关其产品和服务的信息（后者需要您的事先同意）。<br> d) ABS可以使用您的个人信息以预防、发现、调查欺诈、危害安全、非法或违反与ABS或其关联公司协议、政策或规则的行为，以保护您、其他ABS用户，或ABS或其关联公司合法权益。<br><br> <b>3. 信息存储和交换</b><br> ABS收集的有关您的信息和资料将保存在ABS及（或）其关联公司的服务器上，这些信息和资料可能传送至您所在国家、地区或ABS收集信息和资料所在地的境外并在境外被访问、存储和展示。<br><br> <b>4. Cookie的使用</b><br> a) 在您未拒绝接受cookies的情况下，ABS会在您的计算机上设定或取用cookies，以便您能登录或使用依赖于cookies的ABS平台服务或功能。ABS使用cookies可为您提供更加周到的个性化服务，包括推广服务。<br> b) 您有权选择接受或拒绝接受cookies。您可以通过修改浏览器设置的方式拒绝接受cookies。但如果您选择拒绝接受cookies，则您可能无法登录或使用依赖于cookies的ABS平台服务或功能。<br> c) 通过ABS所设cookies所取得的有关信息，将适用本政策；<br><br> <b>5. 未成年人的特别注意事项</b><br> 如果您不是具备完全民事权利能力和完全民事行为能力的自然人，您无权使用ABS平台服务，因此ABS希望您不要向我们提供任何个人信息。<br><br> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/about",["components","logical","css/style.css","css/append.css"],function(t,e,i){var r=(t("$"),t("util"),t("activity")),a=t("core/model");t("animation");return r.extend({events:{},swipeRightBackAction:"/settings",onCreate:function(){var e=this.$(".main");this.bindScrollTo(e),this.model=new a.ViewModel(this.$el,{back:"/settings",title:"隐私政策"})},onShow:function(){},onDestroy:function(){}})});define("template/member",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> </header> <div class="main uc_member" ref="main"> <ul class="uc_member__info top_bottom_border"> <li class="avatars" data-forward="/avatars"> <em>头像</em> <img sn-src="{user.Avatars}" /> </li> </ul> <ul class="uc_member__info"> <li class="bottom_border" data-forward="/user/update/userName"><em>会员名</em><span>{user.UserName}</span></li> <li class="bottom_border" data-forward="/user/gender"><em>性别</em><span>{user.Gender==1?\'男\':user.Gender==2?\'女\':\'保密\'}</span></li> <li class="bottom_border" sn-tap="this.setBirthDay()"><em>生日</em><span>{util.formatDate(user.BirthDay,\'yyyy/MM/dd\')}</span></li> <li class="bottom_border" sn-tap="this.showCity()"><em>所在地</em><span>{user.CityName}</span></li> <li class="bottom_border" sn-tap="this.setFamily()"><em>家庭人数</em><span sn-if="{user.FamilySize}">{user.FamilySize}人</span></li> <li class="bottom_border" sn-tap="this.setChildren()"><em>是否有小孩</em><span>{user.HasChild==1?\'有\':\'无\'}</span></li> <li sn-tap="this.setChildBirthDay()"><em>小孩生日</em><span>{util.formatDate(user.ChildBirthDay,\'yyyy/MM/dd\')}</span></li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/member",["components","logical","css/style.css","css/append.css","../widget/calendar"],function(t,e,i){var s=(t("$"),t("util")),r=t("activity"),a=t("core/model2"),l=(t("bridge"),t("../models/user")),c=t("../logical/user"),u=t("../widget/loader"),d=t("../widget/selector"),h=t("../widget/calendar"),f=t("widget/toast");i.exports=r.extend({showCity:function(){var t=this.model.data.user.ProvID,e=s.indexOf(this.provinceList,function(e){return e.PRV_ID==t});-1!=e&&(this.city.eq(0).index(e),this.changeCity(t)),this.city.show()},changeCity:function(t){var e=this,i=s.find(e.cityList,function(e){return e.CTY_PRV_ID==t});if(i.unshift({CTY_PRV_ID:t,CTY_ID:0,CTY_DESC:"请选择"}),e.city.eq(1).set(i),e.model.data.user){var n=s.indexOf(i,function(t){return t.CTY_ID==e.model.data.user.CityID});-1!=n&&e.city.eq(1).index(n)}},onCreate:function(){var t=this,e=this.model=new a.Model(this.$el,{title:"个人信息",back:t.swipeRightBackAction});this.bindScrollTo(this.model.refs.main);var i=l.get(),n=new h;e.setBirthDay=function(){n.set(i.BirthDay||"1990-01-01").show(),n.onChange=function(e){c.updateBirthDay(e).then(function(){l.set({BirthDay:Date.parse(e)}),t.model.set("user.BirthDay",Date.parse(e))})["catch"](function(t){f.showToast(t.message)})}},e.setChildBirthDay=function(){n.set(i.ChildBirthDay||"1990-01-01").show(),n.onChange=function(e){c.updateChildBirthDay(e).then(function(){l.set({ChildBirthDay:Date.parse(e)}),t.model.set("user.ChildBirthDay",Date.parse(e))})["catch"](function(t){f.showToast(t.message)})}};for(var s=[],r=1;10>=r;r++)s.push({value:r,text:r+"人"});var o=new d({options:[{template:"<li><%=text%></li>",data:s}],complete:function(e){var i=e[0];c.updateUser("familySize",i.value).then(function(){l.set({FamilySize:i.value}),t.model.set("user.FamilySize",i.value)})["catch"](function(t){f.showToast(t.message)})}});e.setFamily=function(){o.show()};var p=new d({options:[{template:"<li><%=text%></li>",data:[{text:"有小孩",value:1},{text:"无小孩",value:0}]}],complete:function(e){var i=e[0];c.updateUser("hasChild",i.value).then(function(){l.set({HasChild:i.value}),t.model.set("user.HasChild",i.value)})["catch"](function(t){f.showToast(t.message)})}});e.setChildren=function(){p.show().eq(0).val(i.HasChild)},this.model.showCity=this.showCity.bind(this),this.city=new d({options:[{template:"<li><%=PRV_DESC%></li>",data:[],onChange:function(e,i){t.changeCity(i.PRV_ID)}},{template:"<li><%=CTY_DESC%></li>",data:[]}],complete:function(e){var i=e[1].CTY_ID;t.model.set("user.CityName",e[1].CTY_DESC),t.model.set("user.CityID",e[1].CTY_ID),t.model.set("user.ProvID",e[1].CTY_PRV_ID),c.updateCity(i).then(function(){l.set({CityID:i,CityName:e[1].CTY_DESC,ProvID:e[1].CTY_PRV_ID})})["catch"](function(t){f.showToast(t.message)})}}),new u({url:"/api/user/get_city",$el:this.$el,success:function(e){e.province.unshift({PRV_ID:0,PRV_DESC:"请选择"}),t.city.eq(0).set(e.province),t.provinceList=e.province,t.cityList=e.data,t.changeCity(e.province[0].PRV_ID)}}).load()},onShow:function(){this.model.set({user:l.get()})},onDestroy:function(){}})});define("template/settings",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> <div class="head_right" data-forward="/messages"> <em class="icon-message head_msg"> <i sn-display="{$global.msg_count!=0?\'block\':\'none\'}">{$global.msg_count}</i> </em> </div> </header> <div class="main" ref="main"> <div class="uc_setting__about"> <div class="logo l-abs_l"></div> <div class="ver">ABS家居 v{version}</div> </div> <ul class="uc_setting__list top_bottom_border"> <li data-forward="/member" class="bottom_border">个人资料<em></em></li> <li data-forward="/about?from=/settings" class="bottom_border">隐私政策<em></em></li> <li data-forward="/news/200?title=关于我们">关于我们<em></em></li> </ul> <ul class="uc_setting__list top_bottom_border"> <li data-forward="/feedback">意见与反馈<em></em></li> </ul> <ul class="uc_setting__list top_bottom_border"> <li sn-click="this.logout()" class="logout">退出登录</li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/settings",["components","logical","css/style.css","css/append.css"],function(t,e,i){var r=(t("$"),t("util"),t("activity")),o=(t("../widget/loader"),t("core/model2")),c=(t("animation"),t("models/user")),u=t("widget/popup");return r.extend({onCreate:function(){var t=this,e=c.get();this.model=new o.Model(this.$el,{back:t.swipeRightBackAction,title:"设置",user:e,version:sl.appVersion}),this.model.logout=function(e){return setTimeout(function(){u.confirm({title:"温馨提示",content:"你确认要退出登录",cancelText:"取消",cancelAction:function(){},confirmText:"确定退出",confirmAction:function(){this.hide(),c.get()?(c.set(null),t.setResult("Logout"),t.back("/?tab=0")):t.forward("/login")}})},100),!1},this.bindScrollTo(this.model.refs.main)},onShow:function(){},onDestroy:function(){}})});define("template/login",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div html="{{title}}" class="head_title"></div> <div class="head_back" data-back="{{back}}"></div> </header> <div class="main"> <div class="login_form"> <h1 class="login_hd">注册/登录</h1> <ul class="form"> <li class="form_mobile"><input ref="mobile" placeholder="请输入您的手机号码" sn-model="mobile" type="tel" /></li> <li><input placeholder="请输入图形验证码" sn-model="captchaCode" type="text" /><img style="width: 80px;" class="dp_b" sn-src="{{captcha+(rnd||Date.now())}}" sn-tap="rnd=Date.now()" /></li> <li><input placeholder="请输入短信验证码" sn-model="smsCode" type="tel" /><b class="js_valid btn_middle" html="{{valid}}"></b></li> <li><input placeholder="请输入好友的邀请码" sn-model="invitedCode" type="text" /></li> </ul> <div class="login_btn"><b class="btn_large js_login">手机号登录</b> </div> <div class="login_btn"><a href="/" back>随便逛逛&gt;</a> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/login",["components","logical","css/style.css","css/append.css"],function(t,e,i){var n=t("$"),s=t("util"),r=t("activity"),a=t("../widget/loader"),o=t("../core/model"),c=(t("animation"),t("models/user"));i.exports=r.extend({events:{"tap .js_login:not(.disabled)":function(){var t=this.model.get("mobile"),e=this.model.get("smsCode");return t&&s.validateMobile(t)?e?void this.loading.setParam({mobile:t,smsCode:e,invitedCode:this.model.data.invitedCode,platform:navigator.platform,deviceVersion:(s.ios?"IOS ":"Android ")+s.osVersion,version:sl.appVersion}).load():void sl.tip("请输入密码"):void sl.tip("请输入正确的手机")},"tap .js_valid:not(.disabled)":function(t){var e=this.model.get("mobile");return e&&s.validateMobile(e)?this.model.data.captchaCode?(this.$valid.addClass("disabled"),this.valid.setParam({captcha:this.model.data.captchaCode,mobile:e}),void this.valid.load()):void sl.tip("请输入图片验证码"):void sl.tip("请输入正确的手机")}},validTimeout:function(){var t=this,e=localStorage.getItem("valid_time");if(e&&parseInt(e)>60){if(e=Math.round((new Date(parseInt(e)).getTime()-Date.now())/1e3),0>=e)return;t.$valid.addClass("disabled"),setTimeout(function(){0>=e?(t.$valid.removeClass("disabled"),t.model.set("valid","获取验证码"),localStorage.removeItem("valid_time")):(t.model.set("valid",e+"秒后再次获取"),e--,setTimeout(arguments.callee,1e3))},1e3)}},onCreate:function(){var t=this,e=this.$(".main");this.swipeRightBackAction=this.query.from||this.referrer||"/",this.bindScrollTo(e),this.model=new o.ViewModel(this.$el,{title:"快速登录 / 注册",valid:"获取验证码",back:this.swipeRightBackAction,captcha:a.prototype.baseUri+"/captcha/1.jpg?v="}),this.listenTo(n(this.model.refs.mobile),"blur",function(){var t=this.model.get("mobile");t&&11==t.length&&this.model.set({captcha:a.prototype.baseUri+"/captcha/"+t+".jpg?v="})}),this.loading=new a({url:"/api/user/login",method:"POST",check:!1,checkData:!1,$el:this.$el,success:function(e){if(e.success){s.store("ivcode",e.ivcode||null),c.set(e.data);var i=t.route.query.success||t.swipeRightBackAction;t.back("/"==i?i+"?tab=0":i),setTimeout(function(){t.setResult("Login")},0)}else sl.tip(e.msg)},error:function(t){sl.tip(t.msg)}}),this.valid=new a({url:"/api/user/send_sms",method:"POST",params:{mobile:t.model.data.mobile},check:!1,checkData:!1,$el:this.$el,success:function(e){e.success?(localStorage.setItem("valid_time",Date.now()+6e4),t.validTimeout()):(sl.tip(e.msg),t.$valid.removeClass("disabled"),t.model.set({rnd:Date.now()}))},error:function(e){sl.tip(e.msg),t.$valid.removeClass("disabled"),t.model.set({rnd:Date.now()}),this.hideLoading()}}),t.$valid=this.$(".js_valid"),t.validTimeout()},onShow:function(){"/"==this.swipeRightBackAction&&(this.swipeRightBackAction=this.swipeRightBackAction+"?tab=0",this.model.set({back:this.swipeRightBackAction}))},onDestroy:function(){}})});define("template/user/month",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header class="white_header bottom_border"> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> <div class="head_right dark">{currentLevel}</div> </header> <div class="main uc_month" ref="main"> <div class="uc_month__tab" sn-require="widget/tab" sn-data="{ {items:[\'未领取\',\'已领取\',\'已过期\']} }"> <div class="ps_r"> <div class="uc_month__nodata dock bg_app" sn-if="!hasNextMonthGift&&!list.length"> <div class="l-gift_1 ta_c"></div> <div class="ta_c mt_l cl_999">您还没有相关月礼哦</div> <button class="btn_xl" data-back="/?tab=0">去逛逛吧</button> </div> <div class="left">您可领取的礼品 <span>您还可领取<em>{user.FreeMonths}</em>/{user.TotalMonths}</span></div> <div class="uc_month__list"> <div class="item" sn-repeat="item in list"> <p class="img"> <span class="date">{data.Year}年{data.Month}月</span> <img sn-src="{item.WPP_LIST_PIC}"> </p> <p class="con"> <span class="name">{item.PRD_NAME}</span> <em class="price">￥{item.PRD_PRICE}</em> <button class="btn_m" sn-tap="this.getGift(item)">立即领取</button> </p> </div> <div class="next_month l-gift_white-rem"> <p class="note">下月月礼正在适配中...</p> </div> </div> </div> <div class="ps_r"> <div class="uc_month__nodata dock bg_app" sn-if="!got.length"> <div class="l-gift_1 ta_c"></div> <div class="ta_c mt_l cl_999">您还没有相关月礼哦</div> <button class="btn_xl" data-back="/?tab=0">去逛逛吧</button> </div> <div class="uc_month__list"> <div class="item" sn-repeat="item in got"> <p class="img"> <span class="date">{item.Year}年{item.Month}月</span> <img sn-src="{item.WPP_LIST_PIC}"> </p> <p class="con"> <span class="name">{item.PRD_NAME}</span> <em class="price">￥{item.PRD_PRICE}</em> <button class="btn_m bg_ddd">已领取</button> </p> </div> </div> </div> <div class="ps_r"> <div class="uc_month__nodata dock bg_app" sn-if="!overdue.length"> <div class="l-gift_1 ta_c"></div> <div class="ta_c mt_l cl_999">您还没有相关月礼哦</div> <button class="btn_xl" data-back="/?tab=0">去逛逛吧</button> </div> <div class="uc_month__list"> <div class="item" sn-repeat="item in overdue"> <p class="img"> <span class="date">{item.Year}年{item.Month}月</span> <img sn-src="{item.WPP_LIST_PIC}"> </p> <p class="con"> <span class="name">{item.PRD_NAME}</span> <em class="price">￥{item.PRD_PRICE}</em> <button class="btn_m bg_ddd">已过期</button> </p> </div> </div> </div> </div> <div class="my_nodata" sn-display="{!user.FreeMonths}" style="display:none"> <div class="icon"></div> <div class="text">您目前还没有免费领取特权哦！</div> <div class="btn" data-forward="/?tab=0">去逛逛吧</div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/month",["components","logical","css/style.css","css/append.css"],function(t,e,i){var n=t("$"),s=t("util"),r=t("promise"),a=t("activity"),o=t("core/model2").Model,d=(t("widget/toast"),t("widget/tab"),t("components/size")),u=t("logical/user"),h=t("logical/product"),p=t("bridge");i.exports=a.extend({loadUserInfo:function(){var n,r,o,t=this,e=Math.round(this.user.Amount),i=1,l=["银卡会员","金卡会员","钻石会员","VIP会员","SVIP会员","无敌会员"];t.model.set("vip",e<(o=1e3)?(n=0,r=1e3-e,l[1]):e<(o=5e3)?(n=1,r=5e3-e,l[2]):e<(o=1e4)?(n=2,r=1e4-e,l[3]):e<(o=5e4)?(n=3,r=5e4-e,l[4]):(n=4,r="0",l[5])),i=Math.min(1,e/o),t.model.set({energy:e,nextLevel:r,currentLevel:l[n],levelAmounts:o,energyPercent:100*i+"%",ucCardAmounts:s.formatMoney(e)+(e>5e4?"":"/"+s.formatMoney(o))})},getGift:function(t){var e=this,i=t.freId;this.size.set({data:t}).show(),h.getSizeByPrhId(t.PRH_ID,function(t){for(var n=[],r=[],a=0,o=t.data.length;o>a;a++){var l=t.data[a];-1!=s.indexOf(e.model.data.products,function(t){return t.PRD_ID==l.PRD_ID})&&(-1==n.indexOf(l.PRD_COLOR)&&n.push(l.PRD_COLOR),-1==r.indexOf(l.PRD_SPEC)&&r.push(l.PRD_SPEC))}var c=e.size.data.data,l=s.first(t.data,function(t){return t.PRD_ID==c.PRD_ID});e.size.set({freid:i,type:"month",color:n,spec:r,colorSpec:t.data,data:l,qty:1})},n("body"))},onCreate:function(){var t=this;t.user=s.store("user"),this.model=new o(this.$el,{title:"我的月礼",back:this.swipeRightBackAction,user:t.user}),this.model.getGift=this.getGift.bind(this),this.bindScrollTo(this.model.refs.main),this.loadUserInfo(),this.size=new d,this.size.$el.appendTo(n("body"))},filterGifts:function(t){for(var e=[],i=0;i<t.length;i++)-1==s.indexOf(e,function(e){return e.PRH_ID==t[i].PRH_ID})&&e.push(t[i]);return e},onShow:function(){var t=this,e=this.model;p.statusBar("dark"),u.getMonthOverdue().then(function(t){return t.data?r.all(t.data.map(function(t){return new r(function(e){u.getMonthGifts(t.freId,function(i){i.data.forEach(function(e){e.Year=t.Year,e.Month=t.Month}),e(i.data)})})})):null}).then(function(i){var n=[];i.forEach(function(t){n=n.concat(t)}),i=t.filterGifts(n),e.set({overdue:i})}),u.getMonthGot().then(function(t){return t.data?r.all(t.data.map(function(t){return new r(function(e){u.getMonthGifts(t.freId,function(i){i.data.forEach(function(e){e.Year=t.Year,e.Month=t.Month}),e(i.data)})})})):null}).then(function(i){var n=[];i.forEach(function(t){n=n.concat(t)}),i=t.filterGifts(n),e.set({got:i})}),u.getMonth(function(i){if(e.set({data:i.data,hasNextMonthGift:i.hasNextMonthGift}),i.data&&i.data.FRE_ID){var n=i.data.FRE_ID;u.getMonthGifts(i.data.FRE_ID,function(i){i.data.forEach(function(t){t.freId=n}),e.set({list:t.filterGifts(i.data),products:i.data})},t.$el)}},this.$el)},onPause:function(){p.statusBar("light")},onDestroy:function(){}})});define("template/map",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main"> <iframe class="js_baidu_map" src="{mapUrl}" style="width:{width}px;height:{height}px" frameborder="0" ref="map"></iframe> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/map",["components","logical","css/style.css","css/append.css"],function(t,e,i){var s=(t("$"),t("util")),a=t("activity"),r=t("bridge"),o=t("widget/loader"),l=t("core/model2").Model;t("models/api");i.exports=a.extend({onCreate:function(){var t=this,e=this.model=new l(this.$el,{title:"寻找店铺",mapUrl:o.url("/baiduMap.html?v4"),width:window.innerWidth,height:window.innerHeight-44-(s.isInApp&&s.ios?20:0)});e.back=function(){t.back(t.swipeRightBackAction)},this.bindScrollTo(e.refs.main)},onShow:function(){var t=this;r.getLocation(function(e){t.model.set({mapUrl:o.url("/baiduMap.html?v3#longitude="+e.longitude+"&latitude="+e.latitude)})})},onDestroy:function(){}})});define("template/shop/useCoupon",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header class="white_header bottom_border"> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> <div class="head_right" sn-tap="this.useCoupon()">使用</div> </header> <div class="main uc_coupon"> <div class="uc_coupon__get"> <input type="text" sn-if="puttingCoupon" sn-model="code" placeholder="请输入券码" /> <b class="btn" sn-tap="this.receiveCoupon()">{puttingCoupon?\'兑换\':\'我要领券\'}</b> </div> <div class="uc_coupon__tip" sn-display="{isShowToast}" style="display:none"> <div class="{toastType==\'error\'?\'icon-wrong-rem\':\'icon-right-rem\'} icon_cm"></div> <div class="msg">{toastMsg?toastMsg:\'兑换成功\'}</div> </div> <div class="uc_coupon__overdue"> <div data-forward="/news/coupon?from=/shop/useCoupon">使用规则</div> </div> <div class="uc_coupon__tab" sn-require="widget/tab" sn-data="{{items: [\'可使用优惠券\',\'不可使用优惠券\' ]}}"> <div> <ul class="uc_coupon__list"> <li sn-repeat="item in data" class="icon-couponline {(item.VCA_VCT_ID == 4 ? \'free\' : \'\') + (item.IsOverdue ? \' dis\' : \'\')}" sn-tap="this.selectCoupon(item)"> <div class="{coupon.CSV_CODE.split(\',\').indexOf(item.CSV_CODE)!=-1?\'radio checked\':\'radio\'}"></div> <div class="hd {item.VCA_VCT_ID == 4 ? \'l-free\' : \'\'}"> <p class="price" sn-if="item.VCA_VCT_ID!=4">{util.currency(item.VCA_DEDUCT_AMOUNT,\'\')}</p> <p class="type" sn-if="item.VCA_VCT_ID!=4">{item.VCA_VCT_ID==4?\'免邮卡\':item.VCA_VCT_ID==5?\'现金券\':\'优惠券\'}</p> </div> <div class="bd l-abs_card"> <p class="name">{item.VCA_VCT_ID==4?\'免邮卡\':(item.VCA_NAME.split(/\\,|，/)[0]+\'，\')}</p> <p class="prd" sn-if="{item.PRD_NAME&&item.VCA_VCT_ID!=4}">仅限“<span>{item.PRD_NAME}</span>”使用</p> <p class="time">有效期:<br>{item.IsOverdue?\'已过期\':(util.formatDate(item.CSV_START_DT,\'yyyy/MM/dd\')+\'-\'+util.formatDate(item.CSV_END_DT,\'yyyy/MM/dd\'))}</p> </div> </li> </ul> <div class="my_nodata ps_r" sn-if="{!data.length}" style="z-index:200"> <div class="icon"></div> <div class="text">您目前还没有卡券哦</div> </div> </div> <ul class="uc_coupon__list"> <li sn-repeat="item in cannotuse" class="icon-couponline {(item.VCA_VCT_ID == 4 ? \'free\' : \'\') + \' dis\'}"> <div class="hd {item.VCA_VCT_ID == 4 ? \'l-free\' : \'\'}"> <p class="price" sn-if="item.VCA_VCT_ID!=4">{util.currency(item.VCA_DEDUCT_AMOUNT,\'\')}</p> <p class="type" sn-if="item.VCA_VCT_ID!=4">{item.VCA_VCT_ID==4?\'免邮卡\':item.VCA_VCT_ID==5?\'现金券\':\'优惠券\'}</p> </div> <div class="bd l-abs_card"> <p class="name">{item.VCA_VCT_ID==4?\'免邮卡\':(item.VCA_NAME.split(/\\,|，/)[0]+\'，\')}</p> <p class="prd" sn-if="{item.PRD_NAME&&item.VCA_VCT_ID!=4}">仅限“<span>{item.PRD_NAME}</span>”使用</p> <p class="time">有效期:<br>{item.IsOverdue?\'已过期\':(util.formatDate(item.CSV_START_DT,\'yyyy/MM/dd\')+\'-\'+util.formatDate(item.CSV_END_DT,\'yyyy/MM/dd\'))}</p> </div> </li> </ul> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/useCoupon",["components","logical","css/style.css","css/append.css"],function(t,e,i){var s=(t("$"),t("util")),a=t("activity"),r=t("core/model2").Model,d=(t("widget/loader"),t("widget/scroll"),t("widget/loader"),t("widget/toast")),p=(t("widget/tab"),t("animation"),t("bridge")),v=(t("models/api"),t("components/share"),t("models/user")),g=t("logical/user");i.exports=a.extend({onCreate:function(){var t=this;this.loadData();var e=this.$(".main");this.bindScrollTo(e),t.user=v.get();var i=this.route.data||{},n=new r(this.$el,{back:this.swipeRightBackAction,title:"使用优惠券",isFree:i.isFree,bag_amount:i.bag_amount,coupon:i.selected});this.model=n,n.receiveCoupon=this.receiveCoupon.bind(this),n.useCoupon=this.useCoupon.bind(this),n.selectCoupon=this.selectCoupon},onShow:function(){p.statusBar("dark")},onPause:function(){p.statusBar("light")},onDestroy:function(){},receiveCoupon:function(){var t=this;if(!t.model.data.puttingCoupon)return void t.model.set({puttingCoupon:1});var e=t.model.get("code");return e?void g.recieveCoupon(e,this.$el).then(function(e){t.showToast("suc","领取成功"),g.getCart().then(function(e){t.route.data.coupon=e.coupon,t.loadData()})})["catch"](function(e){t.showToast("error",e.message)}):(t.showToast("error","请输入券号"),!1)},showToast:function(t,e){var i=this;i.model.set({isShowToast:!0,toastMsg:e,toastType:t}),setTimeout(function(){i.model.set("isShowToast",!1)},1200)},loadData:function(){var t=this;g.getCouponList(this.$el).then(function(e){var i=[],n=[],a=t.route.data.coupon||[],r=t.route.data.isFree;e.data&&e.data.forEach(function(t){t.isOverdue||(r?4==t.VCA_VCT_ID&&i.push(t):4!=t.VCA_VCT_ID&&(-1==s.indexOf(a,function(e){return e.CSV_ID==t.CSV_ID})?n.push(t):i.push(t)))}),i.sort(function(t,e){return t.CSV_END_DT>e.CSV_END_DT?1:t.CSV_END_DT==e.CSV_END_DT?0:-1});var o=[],l=t.model.get("coupon");if(l&&l.CSV_CODE){var c=l.CSV_CODE.split(",");i.forEach(function(t){-1!=c.indexOf(t.CSV_CODE)&&o.push(t)})}t.model.set({data:i,usedCoupons:o,cannotuse:n})},function(t){d.showToast(t.message)})},useCoupon:function(){var t=this.model;this.back("/buy",t.get("isFree")?{freeCoupon:this.model.data.coupon}:{coupon:this.model.data.coupon})},selectCoupon:function(t){var i=this.data;if(1==t.VCA_VCT_ID&&t.VCA_MIN_AMOUNT>i.bag_amount)return void d.showToast("您的购物金额满"+t.VCA_MIN_AMOUNT+"元才可使用哦");if(4==t.VCA_VCT_ID)this.set({coupon:t});else if(5==t.VCA_VCT_ID){var n=[].concat(this.data.usedCoupons),a=s.indexOf(n,function(e){return e.CSV_CODE==t.CSV_CODE});-1!=a?n.splice(a,1):n.push(t);var r=[],o=0;n.forEach(function(t){r.push(t.CSV_CODE),o+=t.VCA_DEDUCT_AMOUNT}),this.set({usedCoupons:n,coupon:{VCA_VCT_ID:5,VCA_DEDUCT_AMOUNT:o,CSV_CODE:r.join(",")}})}else this.set({usedCoupons:[],coupon:i.coupon&&i.coupon.CSV_CODE==t.CSV_CODE?null:t})}})});define("template/shop/usePoint",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header class="white_header bottom_border"> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> </header> <div class="main"> <div class="sp_usepoint"> <div class="sp_usepoint__tip">您还有<em>{user.Points}</em>积分可使用</div> <form class="sp_usepoint__con"> <input type="tel" sn-model="points" value="{points}" /> <div class="btn_s" sn-tap="this.usePoint()">使用积分</div> </form> <div class="sp_usepoint__ft"> <em>＊</em>您的积分可直接抵扣现金使用<em>（100积分＝1元）</em> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/usePoint",["components","logical","css/style.css","css/append.css"],function(t,e,i){var a=(t("$"),t("util"),t("activity")),r=t("core/model2").Model,c=(t("widget/loader"),t("widget/loader"),t("widget/toast")),h=(t("widget/tab"),t("animation"),t("bridge")),m=(t("models/api"),t("components/share"),t("models/user"));t("logical/user");i.exports=a.extend({usePoint:function(){var t=this.model.data.points;return""==t||/^\d+$/.test(t)?(t=parseFloat(t))?t>this.user.Points?void c.showToast("您输入的数值已超过您的积分最大值，请重新输入"):100>t||t%100!=0?void c.showToast("您输入的数值不是100的倍数，请重新输入"):void this.back("/buy",{points:t}):void this.back("/buy",{points:0}):void c.showToast("请输入正确的积分")},onCreate:function(){var t=this,e=this.$(".main");this.bindScrollTo(e),t.user=m.get();var i=this.route.data,n=new r(this.$el,{back:this.swipeRightBackAction,title:"使用积分兑换",user:t.user,points:i.points});this.model=n,n.usePoint=this.usePoint.bind(this)},onShow:function(){h.statusBar("dark")},onPause:function(){h.statusBar("light")},onDestroy:function(){}})});define("template/shop/useInv",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header class="white_header bottom_border"> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> <div class="head_right" sn-tap="this.useInv()">确定</div> </header> <div class="main"> <div class="sp_useinv"> <div class="sp_useinv__info bottom_border"> 是否需要开票 <div class="cp_switch {requireInv?\'cp_switch_on\':\'\'}" sn-tap="requireInv=!requireInv"></div> </div> <div class="sp_useinv__info top_bottom_border" sn-if="requireInv"> <div class="hd bottom_border">发票类型</div> <div class="bd"> <div class="radio checked"></div>普通发票 </div> </div> <div class="sp_useinv__info top_bottom_border" sn-if="requireInv"> <div class="hd bottom_border">开票方式</div> <div class="bd"> <div class="radio checked"></div>纸质发票 </div> </div> <div class="sp_useinv__info top_bottom_border" sn-if="requireInv"> <div class="hd bottom_border">发票抬头</div> <ul class="bd"> <li sn-tap="isCompany=false" class="bottom_border"> <div class="radio {!isCompany?\'checked\':\'\'}"></div>个人 </li> <li sn-tap="isCompany=true"> <div class="radio {isCompany?\'checked\':\'\'}"></div>公司 </li> <li sn-if="isCompany" class="com"> <input type="text" sn-model="company" value=\'{company}\'> </li> </ul> </div> <div class="sp_useinv__info top_bottom_border" sn-if="requireInv"> <div class="hd bottom_border">发票内容</div> <div class="bd"> <div class="radio checked"></div>家居 </div> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/useInv",["components","logical","css/style.css","css/append.css"],function(t,e,i){var a=(t("$"),t("util"),t("activity")),r=t("core/model2").Model,p=(t("widget/loader"),t("widget/scroll"),t("widget/loader"),t("widget/toast"),t("widget/tab"),t("animation"),t("bridge")),v=(t("models/api"),t("components/share"),t("models/user"));t("logical/user");i.exports=a.extend({useInv:function(){var t=this.model.data;this.back("/buy",{company:t.company,isCompany:t.isCompany,requireInv:t.requireInv})},onCreate:function(){var t=this,e=this.$(".main");this.bindScrollTo(e),t.user=v.get();var i=this.route.data,n=new r(this.$el,{back:this.swipeRightBackAction,title:"发票信息",user:t.user,company:i.company,isCompany:i.isCompany,requireInv:i.requireInv});this.model=n,n.useInv=this.useInv.bind(this)},onShow:function(){p.statusBar("dark")},onPause:function(){p.statusBar("light")},onDestroy:function(){}})});define("template/user/avatars",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main uc_avatars"> <div class="l-abs_x-rem uc_avatars__img"> <img sn-src="{src}"> </div> <div class="uc_avatars_btns"> <button class="btn_light_l btn_camera icon-camera" sn-tap="this.camera()">拍照</button> <button class="btn_l" sn-tap="this.photo()">从相册选择</button> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/avatars",["components","logical","css/style.css","css/append.css"],function(t,e,i){var a=(t("$"),t("util"),t("bridge")),r=t("activity"),o=t("widget/loader"),l=t("core/model2").Model,c=t("widget/toast"),d=t("models/api"),u=t("models/user");i.exports=r.extend({onCreate:function(){var t=this;this.loader=new o({$el:this.$el});var e=this.model=new l(this.$el,{title:"个人信息"});this.bindScrollTo(e.refs.main),e.back=function(){t.back(t.swipeRightBackAction)},e.camera=function(){a.image.camera(function(i){e.set({src:i.src||i.thumbnail}),t.uploadAvatars(i.id)})},e.photo=function(){a.image.photo(function(i){e.set({src:i.src||i.thumbnail}),t.uploadAvatars(i.id)})}},uploadAvatars:function(t){var e=this.loader;if(!e.isLoading){var i=u.get(),n=this;e.showLoading(),a.image.upload(d.ShopAPI.url("/api/user/uploadGravatar"),{pspcode:i.PSP_CODE},{absgravatar:t},function(t){c.showToast(t.msg),t.success&&u.set({Avatars:n.model.data.src}),e.hideLoading()})}},onShow:function(){var e=u.get();e&&this.model.set({src:e.Avatars})},onDestroy:function(){}})});define("template/user/feedback",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button class="btn_xs" sn-tap="this.submit()">提交</button></div> </header> <div ref="main" class="main"> <div class="uc_feedback__con surround_border"> <textarea sn-model="content" placeholder="请输入您的宝贵意见与建议，我们将不断优化。"></textarea> <div class="num">0/250</div> </div> <div class="uc_feedback__tit">图片（选填，提供问题截图）<em>{imgs.length||0}/4</em></div> <ul class="uc_feedback__imgs"> <li class="add icon-plus-rem surround_border" sn-tap="this.selectImage()"></li> <li sn-repeat="img in imgs"><img sn-src="{img.thumbnail}"></li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/feedback",["components","logical","css/style.css","css/append.css","components/imagePicker"],function(t,e,i){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),l=(t("widget/popup"),t("widget/toast")),c=t("core/model2").Model,d=t("models/api"),u=t("components/imagePicker"),h=t("models/user"),p=t("bridge");i.exports=a.extend({onCreate:function(){var t=this,e=this.model=new c(this.$el,{title:"意见与反馈",imgs:[]}),i=h.get(),n=new r(this.$el);e.back=function(){t.back(t.swipeRightBackAction)},e.selectImage=function(){this.get("imgs").length>=4||u.show(!1,function(t){e.getModel("imgs").add({id:t.id,thumbnail:t.thumbnail})})},e.submit=function(){var s=this.data.content;if(!s)return void l.showToast("请输入帖子正文");var a=this.data.imgs,r=null;a&&(r={},a.forEach(function(t,e){r["img"+e]=t.id})),n.isLoading||(n.showLoading(),p.image.upload(d.ShopAPI.url("/api/user/AddSuggestion"),{pspcode:i.PSP_CODE,content:s},r,function(i){l.showToast(i.msg),i.success&&h.set({Avatars:t.model.data.src}),n.hideLoading(),e.back()}))},this.bindScrollTo(e.refs.main)},onShow:function(){},onDestroy:function(){}})});define("template/user/update",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button sn-tap="this.save()" class="btn_xs" disabled=\'{!text||text==origin}\'>保存</button></div> </header> <div ref="main" class="main"> <div class="uc_update__input top_bottom_border"> <input type="text" sn-model="text" value="{text}" ref="text" /> <div class="icon-reset"></div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/update",["components","logical","css/style.css","css/append.css"],function(t,e,i){var r=(t("$"),t("util"),t("bridge"),t("activity")),o=t("widget/loader"),l=t("core/model2").Model,c=t("widget/toast"),u=(t("models/api"),t("models/user")),h=t("logical/user"),p={userName:{key:"UserName",title:"修改会员名"}};i.exports=r.extend({onCreate:function(){var t=this,e=u.get();this.loader=new o({$el:this.$el});var i=p[this.route.params.type],n=this.model=new l(this.$el,Object.assign({text:e[i.key],origin:e[i.key]},i));n.refs.text.focus(),n.back=function(){t.back(t.swipeRightBackAction)},n.save=function(){var e=this.get("text");h.updateUserName(e).then(function(i){u.set({UserName:e}),t.back()})["catch"](function(t){c.showToast(t.message)})}},onShow:function(){},onDestroy:function(){}})});define("template/user/gender",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main pt_m"> <div class="lh_m bg_fff top_bottom_border pl_m" sn-tap="this.save(1)"> 男 <span class="fl_r icon-right2 mr_m" sn-if="gender==1"></span> </div> <div class="lh_m bg_fff top_bottom_border pl_m" sn-tap="this.save(2)"> 女 <span class="fl_r icon-right2 mr_m" sn-if="gender==2"></span> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/gender",["components","logical","css/style.css","css/append.css"],function(t,e,i){var r=(t("$"),t("util"),t("bridge"),t("activity")),o=t("widget/loader"),l=t("core/model2").Model,c=t("widget/toast"),u=(t("models/api"),t("models/user")),h=t("logical/user");i.exports=r.extend({onCreate:function(){var t=this,e=u.get();this.loader=new o({$el:this.$el});var i=this.model=new l(this.$el,{title:"修改性别",gender:e.Gender});i.back=function(){t.back(t.swipeRightBackAction)},i.save=function(i){h.updateGender(i).then(function(n){i!=e.Gender&&(u.set({Gender:i}),c.showToast("修改成功"),t.back())})["catch"](function(t){c.showToast(t.message)})}},onShow:function(){},onDestroy:function(){}})});define("template/user/couponItem",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header class="white_header bottom_border"> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> <div class="head_right" data-forward="/news/coupon">使用规则</div> </header> <div class="main " ref="main"> <div class="uc_couponitem"> <div class="uc_couponitem__hd {data.VCA_VCT_ID == 4 ? \'l-free_white\' : \'\'}"> <p class="price" sn-if="data.VCA_VCT_ID!=4">{util.currency(data.VCA_DEDUCT_AMOUNT,\'\')}</p> <p class="type">{data.VCA_VCT_ID==4?\'免邮卡\':data.VCA_VCT_ID==5?\'现金券\':\'优惠券\'}</p> </div> <div class="uc_couponitem__bd"> <p class="name">{data.VCA_NAME.split(/\\,|，/)[0]}</p> <p class="prd" sn-display="data.Products.length&&data.VCA_VCT_ID!=4" sn-tap="this.goTo(item)" sn-repeat="item in data.Products">仅限“<span>{item.PRD_NAME}</span>”使用</p> <p class="time">有效期:{data.IsOverdue?\'已过期\':(util.formatDate(data.CSV_START_DT,\'yyyy/MM/dd\')+\'-\'+util.formatDate(data.CSV_END_DT,\'yyyy/MM/dd\'))}</p> </div> <div class="uc_couponitem__ft"> <button class="btn_xl" sn-if="{data.VCA_VCT_ID!=4}" sn-tap="this.use(data.Products)">立即使用</button> <button class="btn_light_xl" sn-if="{canShare}" sn-tap="this.share(data)">赠送好友</button> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/couponItem",["components","logical","css/style.css","css/append.css"],function(t,e,i){var s=(t("$"),t("util")),a=t("activity"),r=t("core/model2").Model,c=(t("widget/toast"),t("models/api"),t("components/share")),d=t("models/user"),u=t("logical/user");i.exports=a.extend({shareCoupon:function(t,e){var i=this;return i.share.show(),!1},loadData:function(){var t=this;u.getCoupon(this.route.params.id,function(e){var i=[],n=e.data;e.data.Products&&(e.data.Products.forEach(function(t){-1==s.indexOf(i,function(e){return e.PRD_NAME==t.PRD_NAME})&&i.push(t)}),e.data.Products=i),t.model.set({data:e.data}),u.getCouponStatus(e.data.CSV_ID,function(e){e.overdue||(t.model.set({canShare:!0}),t.share.set({linkURL:e.url,title:"两情相悦就送券！",description:n.VCA_NAME}))})},this.$el)},onCreate:function(){var t=this;t.user=d.get();var e=new r(this.$el,{back:this.swipeRightBackAction,title:"我的卡券"});this.model=e,this.bindScrollTo(e.refs.main),e.goTo=function(e){return e.LVP_PRD_ID?(t.forward("/item/"+e.LVP_PRD_ID+"?from="+encodeURIComponent(t.route.url)),!1):void 0},e.use=function(e){return e&&e[0].LVP_PRD_ID?t.forward("/item/"+e[0].LVP_PRD_ID+"?from="+encodeURIComponent(t.route.url)):t.back("/?tab=0"),!1},e.share=this.shareCoupon.bind(this),t.share=new c({head:"分享这张优惠券"}),t.share.callback=function(e){e.success?(sl.tip("分享成功"),t.share.hide()):sl.tip(e.msg)},t.share.$el.appendTo(t.$el),t.loadData()},onShow:function(){d.get()||this.forward("/login?success="+this.route.url+"&from=/")},onDestroy:function(){}})});define("template/user/coupon",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header class="white_header bottom_border"> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> <div class="head_right" data-forward="/news/coupon?from=/coupon">使用规则</div> </header> <div class="main uc_coupon"> <div class="uc_coupon__get"> <input type="text" sn-if="puttingCoupon" sn-model="code" placeholder="请输入券码" /> <b class="btn" sn-tap="this.receiveCoupon()">{puttingCoupon?\'兑换\':\'我要领券\'}</b> </div> <div class="uc_coupon__tip" sn-display="{isShowToast}" style="display:none"> <div class="{toastType==\'error\'?\'icon-wrong-rem\':\'icon-right-rem\'} icon_cm"></div> <div class="msg">{toastMsg?toastMsg:\'兑换成功\'}</div> </div> <div class="uc_coupon__overdue" sn-if="closeNumber">您有{closeNumber}个优惠券即将到期</div> <ul class="uc_coupon__list"> <li sn-repeat="item in data" class="icon-couponline {(item.VCA_VCT_ID == 4 ? \'free\' : \'\') + (item.IsOverdue ? \' dis\' : \'\')}" sn-tap="this.detail(item)"> <div class="hd {item.VCA_VCT_ID == 4 ? \'l-free\' : \'\'}"> <p class="price" sn-if="item.VCA_VCT_ID!=4">{util.currency(item.VCA_DEDUCT_AMOUNT,\'\')}</p> <p class="type" sn-if="item.VCA_VCT_ID!=4">{item.VCA_VCT_ID==4?\'免邮卡\':item.VCA_VCT_ID==5?\'现金券\':\'优惠券\'}</p> </div> <div class="bd l-abs_card"> <p class="name to_e">{item.VCA_VCT_ID==4?\'免邮卡\':(item.VCA_NAME.split(/\\,|，/)[0]+\'，\')}</p> <p class="prd" sn-if="{item.PRD_NAME&&item.VCA_VCT_ID!=4}" sn-tap="this.goTo(item)">仅限“<span>{item.PRD_NAME}</span>”使用</p> <p class="time">有效期:<br>{item.IsOverdue?\'已过期\':(util.formatDate(item.CSV_START_DT,\'yyyy/MM/dd\')+\'-\'+util.formatDate(item.CSV_END_DT,\'yyyy/MM/dd\'))}</p> </div> </li> </ul> <div class="my_nodata" sn-if="{!data.length}"> <div class="icon"></div> <div class="text">您目前还没有卡券哦</div> <div class="btn" data-forward="/all?from=/coupon">去逛逛吧</div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/coupon",["components","logical","css/style.css","css/append.css"],function(t,e,i){var a=(t("$"),t("util"),t("activity")),r=t("core/model2").Model,u=(t("widget/loader"),t("widget/loader"),t("widget/toast"),t("animation"),t("bridge")),f=(t("models/api"),t("components/share"),t("models/user")),m=t("logical/user");i.exports=a.extend({receiveCoupon:function(){var t=this;if(!t.model.data.puttingCoupon)return void t.model.set({puttingCoupon:1});var e=t.model.get("code");return e?void m.recieveCoupon(e,this.$el).then(function(e){t.showToast("suc","领取成功"),t.loadData()})["catch"](function(e){t.showToast("error",e.message)}):(t.showToast("error","请输入券号"),!1)},showToast:function(t,e){var i=this;i.model.set({isShowToast:!0,toastMsg:e,toastType:t}),setTimeout(function(){i.model.set("isShowToast",!1)},1200)},loadData:function(){var t=this;m.getCouponList(this.$el).then(function(e){e.data.sort(function(t,e){return t.IsOverdue&&!e.IsOverdue?1:!t.IsOverdue&&e.IsOverdue?-1:t.CSV_END_DT>e.CSV_END_DT?1:t.CSV_END_DT==e.CSV_END_DT?0:-1}),t.model.set({closeNumber:e.closeNumber,data:e.data})})},onCreate:function(){var t=this;this.loadData();var e=this.$(".main");this.bindScrollTo(e),t.user=f.get();var i=new r(this.$el,{back:this.swipeRightBackAction,title:"我的卡券"});this.model=i,i.goTo=function(e){return e.LVP_PRD_ID?(t.forward("/item/"+e.LVP_PRD_ID+"?from="+encodeURIComponent(t.route.url)),!1):void 0},i.detail=function(e){t.forward("/coupon/"+e.CSV_ID)},i.receiveCoupon=this.receiveCoupon.bind(this)},onShow:function(){f.get()||this.forward("/login?success="+this.route.url+"&from=/"),u.statusBar("dark")},onPause:function(){u.statusBar("light")},onDestroy:function(){}})});define("template/user/couponshare",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<div class="main co_share" style="top:0"> <div class="co_share_con"> <div class="say"> <p class="img"><img src="" alt=""><em>{{user.PSP_NAME||user.PSP_CODE}}</em></p> <p class="cont">我把在ABS家居领到的优惠券送给你~赶快来领取吧！</p> </div> <div class="letter"> <div class="closed"></div> <i class="logo"></i> </div> <div class="btn get" sn-tap="this.getCoupon()">马上领取</div> <div class="steps"> <p>立即领券</p> <i></i> <p>下单购买</p> <i></i> <p>结算选券</p> <i></i> <p>商品到家</p> </div> </div> <div class="co_share_user"> <div class="hd"></div> <div class="con"> 1.优惠券可在ABS家居官方APP“我的卡券”中查看。（购物-去结算-选择优惠券-点击购买） <br> 2.请在优惠券有效期内及时兑换，逾期作废。 <br> *本活动最终解释权归上海爱彼此家居用品股份有限公司所有。 </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/couponshare",["components","logical","css/style.css","css/append.css"],function(t,e,i){var s=(t("$"),t("util")),a=t("activity"),o=(t("widget/loader"),t("core/model")),c=(t("animation"),t("models/api"));i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var t=this,e=t.$(".main");t.swipeRightBackAction=void 0,this.bindScrollTo(e),t.model=new o.ViewModel(this.$el,{}),t.model.getCoupon=function(e){t.user?i.setParam({UserID:t.user.ID,Auth:t.user.Auth}).load():t.forward("/login?success="+encodeURIComponent(t.route.url)+"&from="+encodeURIComponent(t.route.url))};var i=new c.GetSharedCouponAPI({$el:t.$el,params:{data:t.route.query.code},checkData:!1,success:function(t){sl.tip("恭喜您获得一张优惠券")},error:function(t){sl.tip(t.msg)}}),n=new c.CouponUserAPI({$el:t.$(".co_share_user .list"),params:{data:t.route.query.code},checkData:!1,success:function(e){t.model.set({users:e.data,user:e.user})}});n.load()},onShow:function(){var t=this;t.user=s.store("user")},onDestroy:function(){}})});define("template/user/address",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main uc_address"> <div class="uc_address_new js_add_address">添加新地址</div> <ul class="uc_address_con" ref="addressList"> <li sn-repeat="item in data" class="{{item.MBA_DEFAULT_FLAG?\'default\':\'\'}}{{item.AddressID==addressId?\' curr\':\'\'}}" sn-tap="this.forward(item.AddressID)"> <div class="uc_addresslist__listitem_con js_delete_item"> <p class="hd"><span class="name">{{item.MBA_NAME}}</span><span class="mobi">{{item.MBA_MOBILE}}</span></p> <p class="con">{{item.Province}}{{item.City}}{{item.Area}}{{item.MBA_FULL_ADDRESS}}</p> </div> <i class="js_delete" data-id="{{item.AddressID}}"></i> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/address",["components","logical","css/style.css","css/append.css"],function(t,e,i){var n=t("$"),s=t("util"),a=t("activity"),o=(t("widget/loader"),t("core/model")),c=(t("animation"),t("models/api")),d=t("widget/deletion");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){},"tap .js_add_address":function(){this.forward("/addaddress?from="+encodeURIComponent(this.route.url)+"&buy="+(this.route.query.buy||""))}},onCreate:function(){var t=this,e=t.$(".main");t.user=s.store("user"),t.swipeRightBackAction=t.route.query.from||"/",this.bindScrollTo(e),t.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,title:"收货地址"}),t.model.forward=function(e,i){var n=s.first(t.model.get("data"),function(t){return t.AddressID==i});s.store("address",n),t.forward("/addaddress?edittype=2&from="+encodeURIComponent(t.route.url)+"&id="+i+"&buy="+(t.route.query.buy||""))},t.address=new c.AddressListAPI({$el:this.$el,params:{pspcode:t.user.PSP_CODE},success:function(e){e.data.sort(function(t,e){return t.AddressID>e.AddressID?1:t.AddressID<e.AddressID?-1:0}),t.model.set({data:e.data})}}),t.deleteAddressApi=new c.DeleteAddressAPI({$el:this.$el,params:{pspcode:t.user.PSP_CODE},checkData:!1,success:function(e){var i=this.params.mbaId;t.model.getModel("data").remove(function(t){return i==t.AddressID})},error:function(t){sl.tip(t.msg)}}),new d({el:t.model.refs.addressList,children:".js_delete_item",width:70,events:{".js_delete":function(e){var i=n(e.currentTarget),s=i.data("id");t.deleteAddressApi.setParam({mbaId:s}).load()}}})},onShow:function(){var t=this;t.address.load()},onDestroy:function(){}})});define("template/user/addaddress",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main uc_addaddress"> <ul> <li> <input type="text" placeholder="收货人姓名" sn-model="address.mbaName" value="{{address.mbaName}}" /> </li> <li> <input type="tel" placeholder="手机号码" sn-model="address.mbaMobile" value="{{address.mbaMobile}}" /> </li> <li> <input type="tel" placeholder="邮政编码" sn-model="address.mbaZip" /> </li> <li class="js_area">{{province.PRV_ABBR||\'省\'}}、{{city.CTY_ABBR||\'市\'}}、{{region.REG_DESC||\'区\'}}</li> <li> <input type="text" placeholder="详细地址" sn-model="address.mbaAddress" value="{{address.mbaAddress}}"> </li> <li class="set_default{{address.mbaDefault?\' checked\':\'\'}}" sn-tap="address.mbaDefault=!address.mbaDefault">设为默认地址</li> </ul> </div> <b class="uc_addaddress_btn js_submit">确&nbsp;&nbsp;定</b>';return __},helpers:{}});return T.template=T.html,T});define("views/user/addaddress",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=(e("$"),e("util")),a=e("activity"),o=(e("widget/loader"),e("core/model")),l=e("widget/selector"),d=(e("animation"),e("models/api"));i.exports=a.extend({events:{"tap .js_submit:not(.disabled)":function(){this.editAddressAPI.load()},"tap .js_area":function(){var e=this;this.selector.show(),e.model.data.province&&(e.selector.eq(0).index(s.indexOf(e.provinceData,function(t){return t.PRV_ID==e.model.data.province.PRV_ID})),e.resetCity())}},onCreate:function(){var e=this,t=e.$(".main");e.user=s.store("user"),e.swipeRightBackAction=e.route.query.from||"/address",this.bindScrollTo(t);var i=e.route.query.id;if(e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:i?"设置地址":"添加地址",address:{mbaDefault:!0,mbaMobile:e.user.Mobile},user:e.user}),i){var n=s.store("address");n&&e.model.set({address:{mbaMobile:n.MBA_MOBILE,mbaName:n.MBA_NAME,mbaAddress:n.MBA_ADDRESS,mbaDefault:n.MBA_DEFAULT_FLAG},province:{PRV_ID:n.ProvinceID,PRV_ABBR:n.Province},city:{CTY_ID:n.MBA_CTY_ID,CTY_ABBR:n.City},region:{REG_ID:n.MBA_REG_ID,REG_DESC:n.Area}})}e.selector=new l({options:[{template:"<li><%=PRV_ABBR%></li>",onChange:function(t,i){e.city.setParam({prvId:i.PRV_ID||0}).load()}},{template:"<li><%=CTY_ABBR%></li>",onChange:function(t,i){e.region.setParam({ctyId:i.CTY_ID||0}).load()}},{template:"<li><%=REG_DESC%></li>"}],complete:function(t){e.model.set({province:t[0],city:t[1],region:t[2]})}}),e.selector.eq(0).set([{PRV_ABBR:"省"}]),e.selector.eq(1).set([{CTY_ABBR:"市"}]),e.selector.eq(2).set([{REG_DESC:"区"}]),this.province=new d.ProvinceAPI({$el:e.selector.$el,success:function(t){e.provinceData=t.data,t.data.unshift({PRV_ABBR:"省"}),e.selector.eq(0).set(t.data)}}),this.city=new d.CityAPI({$el:e.selector.$el,checkData:!1,success:function(t){e.cityData=t.data,t.data.unshift({CTY_ABBR:"市"}),e.selector.eq(1).set(e.cityData),e.resetCity()}}),this.region=new d.RegionAPI({$el:e.selector.$el,checkData:!1,success:function(t){e.regionData=t.data,e.regionData.unshift({REG_DESC:"区"}),e.selector.eq(2).set(e.regionData),e.resetRegion()}}),this.province.load(),e.editAddressAPI=new d.EditAddressAPI({$el:e.$el,check:!1,checkData:!1,params:{pspcode:e.user.PSP_CODE},beforeSend:function(){var t=e.model.get("address");if(!t.mbaName)return sl.tip("请填写收货人姓名"),!1;if(!t.mbaMobile)return sl.tip("请填写手机号码"),!1;if(!s.validateMobile(t.mbaMobile))return sl.tip("请填写正确的手机号码"),!1;if(!t.mbaAddress)return sl.tip("请填写详细地址"),!1;var i=e.model.get("region");return i&&i.REG_ID?(t.mbaRegId=i.REG_ID,t.mbaCtyId=e.model.get("city.CTY_ID"),t.edittype=e.route.query.edittype||1,t.mbaId=e.route.query.id||0,void this.setParam(t)):(sl.tip("请选择省市区"),!1)},success:function(t){if(t.success)sl.tip("设置成功！");else if(t.msg)return void sl.tip(t.msg);if(e.route.query.buy){var i=e.model.get("address");e.setResult("useAddress",{AddressID:i.mbaId||t.data,MBA_CTY_ID:i.mbaCtyId,MBA_REG_ID:i.mbaRegId,MBA_NAME:i.mbaName,MBA_FULL_ADDRESS:i.mbaAddress,MBA_MOBILE:i.mbaMobile})}e.back(e.route.query.buy?decodeURIComponent(e.route.query.from.match(/from=([^&]+?)(&|$)/)[1]):e.swipeRightBackAction)}})},resetCity:function(){var e=this;if(e.model.data.city){var t=s.indexOf(this.selector.eq(1).data,function(t){return t.CTY_ID==e.model.data.city.CTY_ID});-1!=t&&this.selector.eq(1).index(t),e.resetRegion()}},resetRegion:function(){var e=this;if(e.model.data.region){var t=s.indexOf(this.selector.eq(2).data,function(t){return t.REG_ID==e.model.data.region.REG_ID});-1!=t&&this.selector.eq(2).index(t)}},onShow:function(){},onDestroy:function(){}})});define("template/user/modifypwd",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="uc_pwd"> <dl class="uc_pwd_con"> <dt>原密码</dt> <dd> <input type="password" placeholder="请输入您的密码"> </dd> <dt>新密码</dt> <dd> <input type="password" placeholder="请输入您的新密码"> </dd> <dt>确认密码</dt> <dd> <input type="password" placeholder="请再次输入您的新密码"> </dd> </dl> <div class="action"><b class="btn">确&nbsp;认</b></div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/modifypwd",["components","logical","css/style.css","css/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loader"),e("core/model"));e("animation");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this,t=e.$(".main");e.swipeRightBackAction=e.route.query.from||"/settings",this.bindScrollTo(t),e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"修改密码"})},onShow:function(){},onDestroy:function(){}})});define("template/messages",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main message_center"> <div class="message_card" sn-repeat="item in data"> <div class="hd"> <h2>{{item.MSG_TITLE}}</h2> <h3>{{util.formatDate(item.LPM_START_DT,\'yyyy.MM.dd\')}}</h3> </div> <div class="{{item.MSG_CONTENT.indexOf(\'<img\')!=-1?\' img\':\'bd\'}}" sn-html="item.MSG_CONTENT"></div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/messages",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=(e("$"),e("util")),a=e("activity"),r=e("../widget/loader"),o=e("../core/model");e("animation");return a.extend({onCreate:function(){var e=this,t=this.$(".main");this.bindScrollTo(t,{refresh:function(t,i){e.loading.isShowLoading=!1,e.loading.reload(function(){e.loading.isShowLoading=!0,t()})}}),this.model=new o.ViewModel(this.$el,{back:"/",title:"消息中心"}),this.loading=new r({url:"/api/user/get_msg",$el:this.$el,checkData:!1,success:function(t){t.data||this.showError("暂无消息"),e.model.set("data",t.data)},append:function(t){e.model.getModel("data").add(t.data)}})},onShow:function(){var e=this;e.user=s.store("user"),e.user?e.loading.setParam({UserID:e.user.ID,Auth:e.user.Auth}).load():e.forward("/login?success="+this.route.url+"&from=/")},onDestroy:function(){}})});define("template/mypoint",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header class="white_header"> <div class="head_back" data-back="{back}"></div> <div html="{title}" class="head_title"></div> </header> <div class="main uc_point" ref="main"> <div sn-display="{points}"> <div class="uc_point__overview"> <dl class="haspoints"> <dt>目前积分</dt> <dd sn-html="{Math.round(points)}"></dd> </dl> <div class="note">您在ABS的每次消费，均可获得会员积分。<br> 会员积分可直接抵扣现金使用。（100积分＝1元） </div> </div> <div class="uc_point__data" sn-require="widget/tab" ref="tab" sn-data="{{items:[\'收入\',\'支出\']}}"> <ul class="uc_point__list"> <li sn-repeat="item,i in data|filter:item.HPT_POINT_AMOUNT>0" class="bottom_border"> <p class="from" sn-html="{item.HPT_PIT_ID==1?item.CNL_DESC:item.POT_DESC}"></p> <p class="date" sn-html="{util.formatDate(item.HPT_DT,\'yyyy-MM-dd\')}"></p> <p class="points" sn-html="{item.HPT_POINT_AMOUNT>0?\'+\'+Math.round(item.HPT_POINT_AMOUNT):Math.round(item.HPT_POINT_AMOUNT)}"></p> </li> </ul> <ul class="uc_point__list"> <li sn-repeat="item in data|filter:item.HPT_POINT_AMOUNT<0" class="bottom_border"> <p class="from" sn-html="{item.HPT_PIT_ID==1?item.CNL_DESC:item.POT_DESC}"></p> <p class="date" sn-html="{util.formatDate(item.HPT_DT,\'yyyy-MM-dd\')}"></p> <p class="points minus" sn-html="{Math.round(item.HPT_POINT_AMOUNT)}"></p> </li> </ul> </div> </div> <div class="uc_point__nodata" sn-if="{points==0}"> <div class="l-money"></div> <div class="text">您目前还没有积分记录哦</div> <button class="btn_l" data-forward="/?tab=0">去逛逛吧</button> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/mypoint",["components","logical","css/style.css","css/append.css"],function(t,e,i){var s=(t("$"),t("util")),a=t("activity"),r=t("../widget/loader"),o=t("../core/model2"),d=(t("../widget/tab"),t("animation"),t("bridge"));i.exports=a.extend({events:{},swipeRightBackAction:"/",onCreate:function(){var t=this;this.model=new o.Model(this.$el,{back:"/",title:"积分钱包",points:.001,open:function(){d.openInApp(t.user.OpenUrl||"http://m.abs.cn")}}),this.bindScrollTo(this.model.refs.main)},onShow:function(){var t=this;d.statusBar("dark");var t=this,e=s.store("user");e?(t.user=e,this.loading=new r({url:"/api/user/get_points",check:!1,params:{UserID:e.ID,Auth:e.Auth},$el:this.$el,success:function(e){t.model.set({points:e.points,data:e.data})}}).load()):this.forward("/login")},onPause:function(){d.statusBar("light")}})});define("template/myorder",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back="{back}"></div> <div sn-html="{title}" class="head_title"></div> </header>  <div class="uc_orderlist fs_m" sn-require="widget/tab" ref="tab" sn-data="{{items:[\'全部\',\'待付款\',\'待发货\',\'配送中\',\'已完成\']}}"> '+this.helpers.orderList(0)+" "+this.helpers.orderList(1)+" "+this.helpers.orderList(2)+" "+this.helpers.orderList(3)+" "+this.helpers.orderList(4)+' </div> <div class="open_msg" style="display:none"> <div class="msg_bd msg_alert"> 这款产品已经售罄喽 <div class="btn_go">随便逛逛</div> </div> </div>';return __},helpers:{orderList:function(t){var e="";return e+=' <div> <ul class="uc_orderlist__item"> <li class="bd_t mb_m bg_fff" sn-repeat="item in data'+(0==t?"":t)+'"> <div class="lh_m flex fs_m ml_m bd_b" sn-tap="this.openOrder(item)"> <p class="icon-list"></p> <p class="ml_m flexitem">{item.CNL_DESC}</p> <p class="ta_r mr_m" sn-html="item.PUS_DESC"></p> </div> <div class="sp_cart__listitem_con bd_b" sn-repeat="prd in item.Children"> <img sn-tap="this.openPrd(prd,item)" sn-src="{prd.WPP_LIST_PIC||\'images/default.jpg\'}" src="images/default.jpg" onerror="this.src=\'images/default.jpg\'" /> <div class="con" sn-tap="this.openOrder(item)"> <b class="name">{ prd.PRD_NAME }</b> <p class="size">尺寸：{ prd.PRD_DISPLAY_SPEC} 颜色：{ prd.PRD_COLOR }</p> <p class="price">{util.currency(prd.LPK_CHANNEL_PRICE,\'￥\')}</p> </div> <p class="ft"> <span class="qty">x{prd.LPK_QTY}</span> </p> </div> <div class="lh_s ta_r mr_m">合计：<span class="cl_app">{util.currency(item.PUR_AMOUNT+item.PUR_EXP_IN_AMOUNT,\'￥\')}</span></div> <div class="flex pb_m"> <p class="flexitem"></p> <button class="btn_s mr_s cl_000 bg_ddd" sn-if="(item.CNL_CLT_ID==3||item.PUS_DESC!=\'待付款\')&&item.PUS_DESC!=\'已取消\'" sn-tap="this.openOrder(item)">查看详情</button> <button class="btn_s mr_s" sn-if="{isShowShare&&item.PUR_PAS_ID==2&&item.isShowShare}" data-forward="/news/order{item.PUR_ID}?from={url}">分享有惊喜</button> <button class="btn_s dp_b mr_s" sn-if="{item.CNL_CLT_ID!=3&&item.PUS_DESC==\'待付款\'}" sn-tap="this.openOrder(item)">立即付款</button> <button class="btn_s dp_b mr_s" sn-if="{item.PUS_DESC==\'待付款\'||(item.PUR_PUS_ID==1&&(item.PUR_AMOUNT+item.PUR_EXP_IN_AMOUNT)==0&&item.PUR_PAS_ID==2)}" sn-tap="false" sn-click="this.cancelOrder(item)">取消订单</button> </div> </li> <li ref="refreshing" class="refreshing"> <p class="loading js_loading"></p> <p class="msg js_msg"></p> </li> </ul> <div class="my_nodata" sn-if="{!isLoading&&!data'+(0==t?"":t)+'.length}"> <div class="icon"></div> <div class="text">您还没有相关的订单</div> <div class="btn" data-back="/?tab=0">去逛逛吧</div> </div> </div> '}}});return T.template=T.html,T});define("views/myorder",["components","logical","css/style.css","css/append.css"],function(e,t,i){var n=e("$"),s=e("util"),a=e("activity"),r=e("../widget/loader"),l=(e("../widget/tab"),e("core/model2")),u=(e("../widget/scroll"),e("animation"),e("bridge")),h=e("models/api"),p=e("widget/popup");return a.extend({events:{"tap .open_msg":function(e){n(e.target).hasClass("open_msg")&&n(e.target).removeClass("show")},"tap .btn_go":function(){this.back("/?tab=0")}},swipeRightBackAction:"/",onCreate:function(){var e=this;e.user=s.store("user");var t=parseInt(e.route.query.state)||0,i={};this.model=new l.ViewModel(this.$el,{back:"/",url:encodeURIComponent(this.route.url),title:"我买到的",currentType:0,isShowShare:!0,isLoading:!0}).next(function(){var s=e.tab=this.refs.tab,a=function(t){if(!i[t]){var a="data"+(t||""),o=i[t]=new r({url:"/api/order/getListByType",$el:e.$el,$refreshing:n(s.refs.items[t]).find(".refreshing"),$scroll:n(s.refs.items[t]),checkData:!1,beforeSend:function(){e.model.set("isLoading",!0)},success:function(t){var i={};i[a]=t.data,e.model.set(i)},append:function(t){e.model.getModel(a).add(t.data)},complete:function(){e.model.set("isLoading",!1)}});o.setParam({UserID:e.user.ID,Auth:e.user.Auth,type:t}).load()}};s.on("tabChange",function(e,t){a(t)}).next(function(){0==t&&a(0),s.tab(t)})}),this.wxPayApi=new h.WxPayAPI({$el:e.$el,success:function(e){u.open(e.url)}});var a=new h.ExpressAPI({$el:e.$el,success:function(e){},error:function(){}}),o=new h.OrderShareAPI({$el:this.$el,checkData:!1,success:function(e){},error:function(t){e.model.set({isShowShare:!1})}});o.load(),n.extend(this.model,{showExpress:function(t,i,n){i.set("showExpress",!t.showExpress),n.stopPropagation(),t.express||(i.set("express",[]),a.setParam({pur_code:t.PUR_CODE,pspcode:e.user.PSP_CODE}).load(function(e){e&&e.success&&i.set("express",e.data)}))},openOrder:function(t,i){n(i.target).hasClass("btn_sml")&&"立即付款"!=n(i.target).html()||(e.forward("/order/"+t.PUR_ID+"?refresh=0"),i.stopPropagation())},cancelOrder:function(t,i){p.confirm({title:"温馨提示",content:"你确定取消订单吗？",cancelText:"不取消",cancelAction:function(){},confirmText:"确定取消",confirmAction:function(){this.hide(),e.cancelOrderApi.setParam({purcode:t.PUR_CODE}).load()}}),i.stopPropagation(),i.preventDefault()},openPrd:function(t,i,n){n.stopPropagation(),"待付款"!=i.PUS_DESC||"IMG"==n.target.tagName?t.PRD_DISCONTINUED_FLAG?(e.$open_msg.show(),e.$open_msg[0].clientHeight,e.$open_msg.addClass("show")):t.Url&&e.forward("/item/"+t.PRD_ID+"?from="+encodeURIComponent(e.route.url)):this.openOrder(i)}}),e.$open_msg=this.$(".open_msg").on(n.fx.transitionEnd,function(t){e.$open_msg.hasClass("show")||e.$open_msg.hide()}),e.onResult("OrderChange",function(){if(e.tab){var t=i[e.tab.get("index")];t&&t.reload()}}),e.cancelOrderApi=new h.CancelOrderAPI({$el:this.$el,checkData:!1,params:{pspcode:e.user.PSP_CODE},success:function(t){t.success&&(sl.tip("订单已成功取消"),i[e.tab.get("index")].reload(),e.setResult("UserChange"))},error:function(e){sl.tip(e.msg)}})},onShow:function(){},onDestroy:function(){var e=this;e.timer&&clearTimeout(e.timer)}})});define("template/order",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> </header> <div class="main"> <div class="sp_buy uc_order__wrap"> <div class="sp_buy__addr"> <div class="icon-loc"></div> <div class="info">收货人：<span class="name">{data.ORA_NAME}</span><span class="mobi">{data.ORA_MOBILE}</span></div> <div class="loc">收货地址：{data.CTY_DESC}{data.REG_DESC}{data.ORA_ADDRESS}</div> </div> <div class="sp_buy__cart uc_order__prodlist" sn-repeat="store in list"> <div class="hd bottom_border"> <div class="icon-shop dp_ib"></div> <span class="va_m">{store.TAG_DESC||\'商品信息\'}</span></div> <div class="sp_cart__listitem_con" sn-repeat="prd in store.Children" data-forward="/item/{prd.PRD_ID}"> <img sn-src="{prd.WPP_LIST_PIC||\'images/default.jpg\'}" src="images/default.jpg" onerror="this.src=\'images/default.jpg\'" /> <div class="con"> <b class="name">{ prd.PRD_NAME }</b> <p class="size">尺寸：{ prd.PRD_DISPLAY_SPEC} 颜色：{ prd.PRD_COLOR }</p> <p class="price">{util.currency(prd.LPK_CHANNEL_PRICE,\'￥\') }</p> </div> <div class="ft"> <p class="qty">x{prd.LPK_QTY}</p> </div> </div> <div class="ft bg_fff pd_m ta_r"> <div class="mb_s"><span class="fs_s cl_999 va_m">共{this.getQty(store.Children)}件商品</span> <b class="va_m fs_m">合计</b><em class="va_m cl_app">{util.currency(store.PUR_AMOUNT+store.PUR_EXP_IN_AMOUNT,\'￥\')}</em></div> <b class="btn_m" sn-if="{store.XPU_EXPRESS_CODE}" data-forward="/user/express/{store.PUR_CODE}">查看物流</b> </div> </div> <ul class="sp_buy__info sp_buy__bill top_bottom_border"> <li class="hd bottom_border">订单信息</li> <li class="bottom_border"><span>购买渠道</span><em>{data.CNL_DESC}</em></li> <li class="bottom_border"><span>订单号</span><em>{data.PUR_CODE}</em></li> <li class="bottom_border"><span>订单状态</span><em>{data.PUS_DESC}</em></li> <li class="bottom_border"><span>下单日期</span><em>{util.formatDate(data.PUR_DT)}</em></li> <li><span>实付款</span><b>{this.getAmount()}</b></li> </ul> <div class="sp_buy__pay" sn-if="{data.PUS_DESC==\'待付款\'}"> <ul class="sp_buy__info top_bottom_border"> <li class="hd bottom_border check">支付方式</li> <li class="check icon-alipay bottom_border" sn-tap="payType=1"><span class="pl_s">支付宝支付</span> <i class="icon-right3" sn-if="payType==1"></i></li> <li class="check icon-weipay{payType==2?\' checked\':\'\'} bottom_border" sn-tap="payType=2"><span class="pl_s">微信支付</span> <i class="icon-right3" sn-if="payType==2"></i></li> <li class="check icon-cmcc{payType==3?\' checked\':\'\'}" sn-tap="payType=3"><span class="pl_s">一网通银行卡支付</span> <i class="icon-right3" sn-if="payType==3"></i></li> </ul> </div> </div> </div> <footer class="sp_buy__action uc_order__footer"> <div class="total"> </div> <div class="btn js_pay" sn-if="{data.PUR_PAS_ID!=2&&data.CNL_CLT_ID!=3&&data.PUS_DESC==\'待付款\'}">立即支付</div> <b class="btn" sn-if="{data.PUR_PAS_ID==2&&data.isShowShare}" data-forward="/news/order{data.PUR_ID}?from={url}">分享有惊喜</b> <b class="btn btn_dark" sn-if="{data.PUS_DESC==\'待付款\'||(data.PUR_PUS_ID==1&&(data.PUR_AMOUNT+data.PUR_EXP_IN_AMOUNT)==0&&data.PUR_PAS_ID==2)}" sn-tap="false" sn-click="this.cancelOrder(data)">取消订单</b> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/order",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=(e("$"),e("util")),a=e("activity"),o=(e("widget/loader"),e("core/model2")),c=(e("animation"),e("models/api")),d=e("models/user"),u=e("bridge"),h=e("widget/popup");i.exports=a.extend({events:{"tap .js_pay:not(.disabled)":function(){var e=this,t=this.model.get("data");switch(e.orderApi.showLoading(),setTimeout(function(){e.orderApi.hideLoading()},3e3),e.checkStatus(),this.model.get("payType")){case 1:u.ali({type:"pay",spUrl:c.API.prototype.baseUri+"/AlipayApp/Pay",orderCode:t.PUR_CODE},function(t){sl.tip(t.msg),e.orderApi.hideLoading()});break;case 2:u.wx({type:"pay",spUrl:c.API.prototype.baseUri+"/api/shop/wxcreateorder",orderCode:t.PUR_CODE,orderName:"ABS商品",orderPrice:t.PUR_AMOUNT},function(t){sl.tip(t.msg),e.orderApi.hideLoading()});break;case 3:u.cmbpay(c.API.prototype.baseUri+"/api/cmbpay/pay?orderCode="+t.PUR_CODE)}}},onCreate:function(){var e=this,t=e.$(".main");e.user=d.get(),e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",this.bindScrollTo(t),e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"订单详情",payType:1}),e.model.getQty=function(e){var t=0;return e.forEach(function(e){t+=e.LPK_QTY}),t},e.model.getAmount=function(){var e=0;return this.data.list&&this.data.list.forEach(function(t){e+=t.PUR_AMOUNT+t.PUR_EXP_IN_AMOUNT}),s.currency(e,"￥")},e.model.cancelOrder=function(t,i){h.confirm({title:"温馨提示",content:"你确定取消订单吗？",cancelText:"不取消",cancelAction:function(){},confirmText:"确定取消",confirmAction:function(){this.hide(),e.cancelOrderApi.setParam({purcode:t.PUR_CODE}).load()}}),i.stopPropagation(),i.preventDefault()},e.orderApi=new c.OrderAPI({$el:e.$el,params:{orderId:e.route.params.id,UserID:e.user.ID,Auth:e.user.Auth},success:function(t){e.model.set({data:t.data,list:t.list}),e.referrer&&0!=e.referrer.indexOf("/myorder")&&2==t.data.PUR_PAS_ID&&e.forward("/news/order"+e.route.params.id)}}),e.orderApi.load(),e.orderStatusAPI=new c.OrderStatusAPI({$el:this.$el,check:!1,checkData:!1,success:function(t){2!=t.status?e.timer=setTimeout(function(){e.checkStatus()},2e3):2==t.status&&(e.forward("/news/order"+e.route.params.id),e.model.set("data.PUR_PAS_ID",2))}}),e.cancelOrderApi=new c.CancelOrderAPI({$el:this.$el,checkData:!1,params:{pspcode:e.user.PSP_CODE},success:function(t){t.success&&(sl.tip("订单已成功取消"),e.orderApi.reload(),e.setResult("UserChange").setResult("OrderChange"))},error:function(e){sl.tip(e.msg)}}),1==e.route.query.refresh&&e.checkStatus()},checkStatus:function(){var e=this;e.timer&&clearTimeout(e.timer),e.orderStatusAPI.setParam({id:e.route.params.id}).load()},onShow:function(){},onDestroy:function(){self.timer&&clearTimeout(self.timer)}})});define("template/news",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header>';return __},helpers:{}});return T.template=T.html,T});define("views/news",["components","logical","css/style.css","css/append.css"],function(e,t,i){var n=e("$"),a=(e("util"),e("activity")),o=(e("widget/loader"),e("core/model")),c=(e("animation"),e("components/shareOrder")),d=e("components/month"),u=e("components/activity"),h=e("components/fastbuy"),p=e("components/package"),f=e("components/banner"),m=e("models/api");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this,t=e.route.params.id,i=/(order|month|activity|package|fastbuy|banner|coupon){0,1}(\d*)/.exec(t),s=i[1];t=i[2],e.model=new o.ViewModel(this.$el,{url:encodeURIComponent(e.route.url),back:e.swipeRightBackAction});var r,a="";switch(s){case"order":a="支付成功",r=new c({id:t}),r.$el.appendTo(e.$el);break;case"month":a="会员礼领取",r=new d({id:t}),r.$el.appendTo(e.$el);break;case"fastbuy":a="周一闪购",r=new h,r.$el.appendTo(e.$el);break;case"activity":a=2==t?"最热商品":"APP专享",r=new u({id:t}),r.$el.appendTo(e.$el);break;case"package":a="套餐",r=new p({id:t}),r.$el.appendTo(e.$el);break;case"banner":a="纳米美容巾免费领",r=new f({id:t}),r.$el.appendTo(e.$el);break;case"coupon":a="优惠券规则",e.$el.append('<div class="main" style="padding:20px;background:#fff;"> Q：如何使用优惠券？<br/> A：您可以在订单结算页面通过“使用优惠券”选项使用一张符合使用条件的优惠券，抵扣相应的金额。<br/> <br/> Q：什么是券码？<br/> A：用户可以通过ABS其他合作渠道获取兑换券码，兑换码可以在"我的优惠券”页兑换优惠券，抵扣相应金额。<br/> <br/> Q：优惠券的使用有什么其他限制吗？<br/> A：优惠券的使用时限、抵用限额及其他限制条件请详见优惠券上的文字描述。<br/><br/> Q：申请退款时优惠券如何结算？<br/> A：使用优惠券订单，如非质量问题，不支持退货退款。<br/> 如因商品质量问题需要退货，所使用优惠券均不予返还。<br/> </div>');break;default:a=this.route.query.title||"ABS家居";var l=n('<div class="main"></div>').appendTo(e.$el),v=new m.NewsAPI({$el:e.$el,params:{id:t},success:function(t){if(t.success)if(1==t.edmtype){var s=Application.createIFrame(l);s.$el.css({width:window.innerWidth,height:l[0].offsetHeight}),s.html("<style>body,html{background:#fff}</style>"+t.data.edm_html)}else{var a=n('<div sn-repeat="list in data"> <div class="banner" sn-if="{{list.type==1}}"> <a sn-repeat="pic in list.data" href="{{pic.EDD_URL||\'javascript:;\'}}"><img sn-src="{{list.type==1?pic.EDD_PIC:\'\'}}"  /></a> </div> <ul class="sp_list" style="overflow:hidden;margin-top:0" sn-if="{{list.type==2}}"> <li sn-repeat="item in list.data" class="sp_list_item" data-forward="/item/{{item.PRD_OBJ.PRD_ID}}?from={{url}}" sn-index="0"> <img src="{{item.PRD_OBJ.WPP_LIST_PIC}}"> <p class="price"><b>￥{{item.PRD_OBJ.PRD_PRICE}}</b><del sn-display="{{item.PRD_OBJ.PRD_PRICE!=0&&item.PRD_OBJ.PRD_PRICE<item.PRD_OBJ.PRD_MEMBER_PRICE}}" style="display: none;">￥{{item.PRD_OBJ.PRD_MEMBER_PRICE}}&nbsp;</del></p> <p class="name">{{item.PRD_OBJ.PRD_NAME}}</p> </li> </ul> </div>');a.appendTo(l),e.model.bind(a).set({data:t.data})}else sl.tip(t.msg)},error:function(e){sl.tip(e)}});v.load()}r&&(r.view=e),this.bindScrollTo(e.$(".main")),e.model.set({type:s,title:a})},onShow:function(){},onDestroy:function(){}})});define("template/register",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div sn-binding="html:title" class="head_title"></div> <div class="head_back" sn-binding="data-back:back"></div> </header> <div class="main"> <div class="login_form"> <ul class="form"> <li><input placeholder="输入手机号" sn-model="mobile" /></li> <li><input placeholder="验证码" sn-model="smsCode" type="text" /> <b class="js_valid btn_middle" sn-binding="html:valid"></b></li> <li><input placeholder="设置密码" sn-model="password" type="password" /></li> <li><input placeholder="再次输入确认密码" sn-model="password1" type="password" /></li> </ul> <div class="login_btn"><b class="btn_large js_bind">确定注册</b> </div> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/register",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=(e("$"),e("util")),a=e("activity"),r=e("../widget/loader"),o=e("../core/model"),c=(e("animation"),e("utils/md5"));return a.extend({events:{"tap .js_bind:not(.disabled)":function(){var e=this.model.data.mobile,t=this.model.data.password,i=this.model.data.password1,n=this.model.data.smsCode;return e&&s.validateMobile(e)?t!=i?void sl.tip("两次密码输入不一致"):n?void this.loading.setParam({mobile:e,password:c.md5(t),smsCode:n}).load():void sl.tip("请输入验证码"):void sl.tip("请输入正确的手机")},"tap .js_valid:not(.disabled)":function(e){var t=this.model.get("mobile");return t&&s.validateMobile(t)?(this.$valid.addClass("disabled"),this.valid.setParam({mobile:this.model.data.mobile}),void this.valid.load()):void sl.tip("请输入正确的手机")}},validTimeout:function(){var e=this,t=localStorage.getItem("valid_time");if(t&&parseInt(t)>60){if(t=Math.round((new Date(parseInt(t)).getTime()-Date.now())/1e3),0>=t)return;e.$valid.addClass("disabled"),setTimeout(function(){0>=t?(e.$valid.removeClass("disabled"),e.model.set("valid","获取验证码"),localStorage.removeItem("valid_time")):(e.model.set("valid",t+"秒"),t--,setTimeout(arguments.callee,1e3))},1e3)}},onCreate:function(){var e=this,t=this.$(".main");this.bindScrollTo(t),this.model=new o.ViewModel(this.$el,{title:"注册",valid:"获取验证码",back:this.route.query.from||"/login"}),this.loading=new r({url:"/api/user/register",method:"POST",check:!1,checkData:!1,$el:this.$el,success:function(t){t.success?(localStorage.setItem("user",JSON.stringify(t.data)),e.back(e.route.query.success||"/")):sl.tip(t.msg)},error:function(e){sl.tip(e.msg)}}),this.valid=new r({url:"/api/user/send_sms",method:"POST",params:{mobile:e.model.data.mobile},check:!1,checkData:!1,$el:this.$el,success:function(t){t.success?(localStorage.setItem("valid_time",Date.now()+6e4),e.validTimeout()):sl.tip(t.msg)}}),e.$valid=this.$(".js_valid"),e.validTimeout()},onShow:function(){},onDestroy:function(){}})});define("template/shop/all",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back="{back}"></div> <form class="head_search"> <input class="js_search" type="search" placeholder="热门搜索：新月枕" /> </form> </header> <div class="main" style="padding-bottom:10px"> <div class="sp_all_cates"> <div ref="cates"> <ul style="width:{navs.length*.73}rem;padding-right:30px;"> <li sn-repeat="item in navs" class="{item.LPE_URL?\'noicon\':(\'cate\'+item.LPE_PCG_ID)} {current.PCG_ID==item.LPE_PCG_ID?\'curr\':\'\'}" sn-tap="this.selectCate(item.LPE_URL||item.LPE_PCG_ID)">{item.LPE_PCG_NAME}</li> </ul> </div> <div class="dropdown_btn" sn-tap="this.showCategories()"></div> </div> <div class="sp_all_catelist_wrap"> <ul class="sp_all_catelist_cate"> <li sn-repeat="item in current.children" sn-tap="this.selectSubCate(item)" class="{currentSub.PCG_ID==item.PCG_ID?\'curr\':\'\'}">{item.PCG_NAME}</li> </ul> <ul class="sp_all_catelist_subcate"> <li class="sp_all_catelist_subcate_item{currentSearchId==cate.PCG_ID?\' curr\':\'\'}" sn-repeat="cate in currentSub.children" sn-tap="this.requestProd(cate.PCG_ID)"> <p><img alt="{cate.PCG_NAME}" sn-src="{cate.PCG_IMG_URL}" /></p> <span>{cate.PCG_NAME}</span> </li> <li class="sp_all_catelist_subcate_item more" sn-tap="this.requestProd(currentSub.PCG_ID)"> <p><i></i></p> <span>查看全部</span> </li> </ul> </div> <ul class="sp_list"> <li sn-repeat="item in data" class="sp_list_item" data-forward="/item/{item.PRD_ID}?from={url}"> <img src="{item.WPP_LIST_PIC1}" /> <p class="price"><b>￥{item.PRD_PRICE}</b> <del sn-display="{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}">￥{item.PRD_MEMBER_PRICE}&nbsp;</del> </p> <p class="name">{item.PRD_NAME}</p> <div class="sold_out" sn-display="{item.PRD_NUM==0}">脱 销<br>Sold Out</div> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/all",["components","logical","css/style.css","css/append.css"],function(e,t,i){var n=e("$"),s=e("util"),a=e("activity"),o=(e("widget/loader"),e("core/model2")),c=(e("animation"),e("models/api")),d=e("models/category"),u=e("components/category");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){},"focus .js_search":function(e){e.currentTarget.setAttribute("placeholder","")},"blur .js_search":function(e){e.currentTarget.setAttribute("placeholder","热门搜索：新月枕")}},onCreate:function(){var e=this;e.swipeRightBackAction=e.route.query.from||"/";var t=this.$(".main");this.bindScrollTo(t),e.productSearchAPI=new c.ProductSearchAPI({$el:e.$el,$scroll:t,$content:t,check:!1,beforeSend:function(){this.setUrl("/Prod/productlist").setParam({orderbyStr:"PRD_ONLINE_DT",orderby:"desc",keycodes:""})},KEY_PAGE:"pages",KEY_PAGESIZE:"length",MSG_NO_MORE:'别拉了，就这些<i class="ico_no_more"></i>',pageSize:"10",success:function(t){10==t.data.length&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.set({data:t.data})},append:function(t){10==t.data.length&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.getModel("data").add(t.data)}}),this.listenTo(this.$(".js_search"),"keydown",function(t){return 13==t.keyCode?(e.forward("/list?s="+t.target.value+"&from=/all"),t.preventDefault(),!1):void 0}),this.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,resource:"http://appuser.abs.cn"}),this.model.selectCate=function(t,i){return"string"!=typeof t||/^\d+$/.test(t)?("object"!=typeof t&&(t=s.first(this.data.categories,function(e){return e.PCG_ID==t})),this.set({current:t,id:t.PCG_ID,currentSub:t.children[0]}),this.refs.cates.scroll.scrollTo((t.PCG_ID-1)*n(this.refs.cates).find(".curr").width(),0,200),e.cpCategory.set({current:t.PCG_ID}),void this.requestProd(t.PCG_ID)):void e.forward(t)},this.model.showCategories=function(){e.cpCategory.show()},this.model.selectSubCate=function(e){this.set("currentSub",e),this.requestProd(e.PCG_ID)},this.model.requestProd=function(t){this.set("currentSearchId",t),e.productSearchAPI.setParam({pcgid:t}).reload()},this.bindScrollTo(this.model.refs.cates,{useScroll:!0,vScroll:!1,hScroll:!0})},setCategories:function(e,t){var i=this,n=i.route.query.id||1,a=s.first(e,function(e){return e.PCG_ID==n}),r=a.children[0];this.model.set({id:n,categories:e,navs:t,current:a,currentSub:r}),i.model.selectCate(a)},onQueryChange:function(e){"id"in e.data&&this.model.selectCate(this.query.id)},onLoad:function(){var e=this;d.list(function(t,i){var n=new u({data:t,"goto":function(t,i){e.model.selectCate(i),n.hide()}});n.$el.appendTo("body"),e.cpCategory=n,e.setCategories(t,i)})},onDestroy:function(){}})});define("template/shop/list",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <ul class="sp_list_sort"> <li class="{{orderBy==\'PRD_ONLINE_DT|desc\'?\'curr\':\'\'}}" sn-tap="this.orderBy(\'PRD_ONLINE_DT|desc\')">新品</li> <li class="{{orderBy==\'PSV_QTY|desc\'?\'curr\':\'\'}}" sn-tap="this.orderBy(\'PSV_QTY|desc\')">销量</li> <li class="{{orderBy==\'PRD_MEMBER_PRICE|asc\'?\'curr asc\':orderBy==\'PRD_MEMBER_PRICE|desc\'?\'curr desc\':\'\'}}" sn-tap="this.orderBy(priceSort?\'PRD_MEMBER_PRICE|desc\':\'PRD_MEMBER_PRICE|asc\'),priceSort=!priceSort">价格</li> </ul> <ul class="sp_list"> <li sn-repeat="item in data" class="sp_list_item" data-forward="/item/{{item.PRD_ID}}?from={{url}}"> <img src="{{item.WPP_LIST_PIC1}}" /> <p class="price"><b>￥{{item.PRD_PRICE}}</b> <del sn-display="{{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}}">￥{{item.PRD_MEMBER_PRICE}}&nbsp;</del> </p> <p class="name">{{item.PRD_NAME}}</p> <div class="sold_out" sn-display="{{item.PRD_NUM==0}}">脱 销<br>Sold Out</div> </li> </ul> <div class="my_nodata" sn-if="{{!isLoading&&!data.length}}"> <div class="icon"></div> <div class="text">您还没有相关的商品</div> <div class="btn" data-back="/?tab=0">去逛逛吧</div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/list",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=(e("$"),e("util")),a=e("activity"),o=(e("widget/loader"),e("core/model")),c=(e("animation"),e("models/api"));return a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this,t=e.$(".main");e.swipeRightBackAction=e.route.query.from||"/all",this.bindScrollTo(t);var i=s.store("categories"),n=i?s.first(i,function(t){return t.PCG_ID==e.route.query.id}):null;e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:n?n.PCG_NAME:"商品列表",orderBy:"PRD_ONLINE_DT|desc",priceSort:!0,url:encodeURIComponent(e.route.url),isLoading:!0}),e.model.orderBy=function(e,t){this.set("orderBy",t),a.abort().reload()};var a=new c.ProductSearchAPI({$el:e.$el,$scroll:t,$content:t,check:!1,beforeSend:function(){var t=e.model.get("orderBy");t=t.split("|"),this.setUrl("new"==e.route.query.type?"/api/prod/newproductlist":"/Prod/productlist").setParam({orderbyStr:"new"==e.route.query.type&&"PRD_MEMBER_PRICE"==t[0]?"PRD_PRICE":t[0],orderby:t[1],pcgid:e.route.query.id,keycodes:e.route.query.s||""})},KEY_PAGE:"pages",KEY_PAGESIZE:"length",MSG_NO_MORE:'别拉了，就这些<i class="ico_no_more"></i>',pageSize:"10",success:function(t){10==t.data.length&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.set({data:t.data,isLoading:!1})},append:function(t){10==t.data.length&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.getModel("data").add(t.data)}});a.load()},onShow:function(){},onDestroy:function(){}})});define("template/shop/item",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header class="{isShowDetail?\'white_header\':\'header_trans\'}"> <div class="head_back" data-back="{back}"></div> <div class="head_title" sn-if="isShowDetail">图文详情</div> <div class="head_right"> <a class="{!isShowDetail?\'icon-tel\':\'icon-tel_dark\'}" href="tel:4008205077"></a> <div class="{!isShowDetail?\'icon-share\':\'icon-share_dark\'} js_share"></div> </div> </header> <div class="main pd_item" ref="main"> <div class="pd_item__scroll" ref="scroll"> <div class="pd_slider{data.PRD_NUM<=0?\' sold_out\':\'\'}" ref="image"> </div> <div class="pd_info_wrap"> <div class="pd_info"> <h1>{data.PRD_NAME}</h1> <p class="price">{data.PRD_PRICE}</p> <del class="ori_price" sn-display="{data.PRD_PRICE<data.PRD_MEMBER_PRICE}">¥{data.PRD_MEMBER_PRICE}</del> <p class="pd_code"> <span class="code">商品编码 {data.PRD_CODE}</span> <span class="sale">销售 {data.PSV_QTY} 件</span> </p> <p class="pd_code" style="padding:5px 0;" sn-html="{data.PRH_DESC}"></p> </div> </div> <ul class="pd_sign top_bottom_border"> <li class="icon-has">满{full_amount||99}包邮</li> <li class="icon-has" sn-if="data.XPR_RTN_DAYS">{data.XPR_RTN_DAYS}天退换货保障</li> </ul> <div class="pd_select_plus" sn-if="{Package.PPG_ID}" data-forward="{isLogin?\'/news/package\'+Package.PPG_ID+\'?from=\'+url:(\'/login?success=\'+url)}"> {Package.PPG_NAME} </div> <div class="pd_select_size js_select_size top_bottom_border"> 选择尺码 颜色分类 </div> <div class="pd_item__detail_tip">{detailTip}，查看图文详情</div> </div> </div> <div class="main pd_item__detail" ref="detail" style="transform:translate(0px,100%)"> <div class="pd_item__scroll" ref="detailScroll"> <div class="pull">{pullTip}，返回宝贝详情</div> <div class="con pd_detail"> <img sn-repeat="item in detailHtml" sn-src="{item.img}" /> </div> </div> </div> <footer class="pd_buy"> <b class="btn_cart icon-cart_dark" data-forward="{isLogin?\'/cart\':(\'/login?success=\'+url)}"><i sn-if="$global.cartQty!=0">{$global.cartQty}</i></b> <b class="btn_buy {data.PRD_NUM==0?\'sold_out\':\'js_buy\'}">{data.PRD_NUM==0?\'商品已售罄\':\'加入购物车\'}</b> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/item",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loader"),e("core/model2").Model),c=(e("widget/scroll"),e("components/share")),d=e("components/size"),h=(e("animation"),e("models/api")),p=e("widget/slider"),f=e("models/user"),m=e("bridge");i.exports=a.extend({events:{"tap .js_buy:not(.disabled)":function(){var e=this;1==e.model.data.colorSpec.length?e.user?this.size.confirm():e.forward("/login"):this.size.show()},"tap .js_share":function(){this.share.show()},"tap .js_select_size":function(){this.size.show()}},className:"pd_item_bg",onCreate:function(){var e=this;e.user=f.get();var t=e.model=new o(e.$el,{title:"床品",id:e.route.params.id,user:e.user,isLogin:!!e.user,url:encodeURIComponent(e.route.url),qty:1,detailTip:"继续拖动",pullTip:"下拉"}),i=s(t.refs.scroll),a=s(t.refs.main),r=s(t.refs.detail),l=s(t.refs.detailScroll);this.bindScrollTo(a),this.bindScrollTo(r);var u=new h.ProductDetailAPI({$el:e.$el,params:{id:e.route.params.id},success:function(t){e.model.set({detailHtml:t.data})}});e.listenTo(a,"touchstart",function(e){var t=e.currentTarget;this.isStart=!1,this.startY=e.touches[0].pageY,this.isStop_iOS=n.ios&&t.scrollTop+t.clientHeight!==t.scrollHeight}).listenTo(a,"touchmove",function(e){var s=e.currentTarget,n=e.touches[0].pageY-this.startY;return 0>n&&s.scrollTop+s.clientHeight>=s.scrollHeight&&(this.isStart||(this.isStart=!0,this.startY=e.touches[0].pageY,n=0),!this.isStop_iOS)?(-70>=n?t.set({detailTip:"释放"}):t.set({detailTip:"继续拖动"}),i.transform({translate:"0px,"+(n>0?0:n/2)+"px"}),!1):void 0}).listenTo(a,"touchend",function(s){if(e.isStart){var n=s.changedTouches[0].pageY-this.startY;-70>=n?(i.transform({translate:"0px,0px"}),a.animate({translate:"0px,-100%"},"ease-out",400),r.animate({translate:"0px,0"},"ease-out",400),t.set({isShowDetail:!0,detailTip:"继续拖动"}),this.loadedDetail||(this.loadedDetail=!0,u.load())):i.animate({translate:"0px,0px"},"ease-out",400)}}),e.listenTo(r,"touchstart",function(e){this.isStart=!1,this.startY=e.touches[0].pageY,this.isStop_iOS=n.ios&&0!=e.currentTarget.scrollTop}).listenTo(r,"touchmove",function(e){var i=e.currentTarget,s=e.touches[0].pageY-this.startY;return s>0&&i.scrollTop<=0&&(this.isStart||(this.isStart=!0,this.startY=e.touches[0].pageY,s=0),!this.isStop_iOS)?(s>=70?t.set({pullTip:"释放"}):t.set({pullTip:"下拉"}),l.transform({translate:"0px,"+(0>s?0:s/2)+"px"}),!1):void 0}).listenTo(r,"touchend",function(i){if(e.isStart){var s=i.changedTouches[0].pageY-this.startY;s>=70?(l.transform({translate:"0px,0px"}),r.animate({translate:"0px,100%"},"ease-out",400),a.animate({translate:"0px,0px"},"ease-out",400),t.set({isShowDetail:!1,pullTip:"下拉"})):l.animate({translate:"0px,0px"},"ease-out",400)}}),e.onResult("Login",function(){e.user=f.get(),e.model.set({isLogin:!0,user:f.get()})}),e.size=new d,e.size.$el.appendTo(e.$el),e.size.on("SizeChange",function(t,i){var s={PRD_NUM:i.PRD_NUM};i.WPP_LIST_PIC&&(s.WPP_LIST_PIC=i.WPP_LIST_PIC),e.model.set({data:s})});var m=new h.ProductAPI({$el:e.$el,params:{id:e.route.params.id},checkData:!1,success:function(t){t.data.PSV_QTY=t.psvqty,e.model.set({full_amount:t.full_amount,data:t.data}),e.size.set({qty:1,data:t.data}),t.prhpic||(t.prhpic=[]),t.prhpic.unshift({PHP_PIC_M:t.data.WPP_M_PIC}),e.slider=new p({container:e.model.refs.image,loop:!0,autoLoop:3e3,data:t.prhpic,dots:t.prhpic.length>=1,itemTemplate:'<img width="100%" height="100%" src="<%=PHP_PIC_M%>" />'}),e.share=new c({head:"分享商品至",title:t.data.PRD_NAME,linkURL:t.data.FLASH_FLAG?t.flpurl:"http://m.abs.cn/single/"+t.data.PRD_ID+".html",description:t.data.PRD_NAME,image:"http://www.absimg.com/media/H5/app/logo.jpg"}),e.share.$el.appendTo(e.$el),v.setParam({id:t.data.PRD_PRH_ID}).load()},error:function(t){sl.tip(t.msg||t.data||t.message),e.back(e.query.from||e.referrer)}}),v=new h.ProductColorAndSpec({$el:e.$el,checkData:!1,success:function(t){for(var i=[],s=[],n=0,a=t.data.length;a>n;n++){var r=t.data[n];-1==i.indexOf(r.PRD_COLOR)&&i.push(r.PRD_COLOR),-1==s.indexOf(r.PRD_SPEC)&&s.push(r.PRD_SPEC)}e.model.set({color:i,spec:s,colorSpec:t.data}),e.size.set({color:i,spec:s,colorSpec:t.data})}}),g=new h.PackageRelativeAPI({$el:e.$el,params:{prdId:this.route.params.id},checkData:!1,success:function(t){e.model.set({Package:t.data})}});this.waitLoad().then(function(){m.load(),g.load()})},onShow:function(){var e=this;e.user=f.get(),e.model.set({back:e.swipeRightBackAction}),m.statusBar("dark")},onPause:function(){m.statusBar("light")}})});define("template/shop/detail",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main pd_detail"> <img sn-repeat="item in data" sn-src="{{item.img}}" /> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/detail",["components","logical","css/style.css","css/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loader"),e("core/model")),c=(e("animation"),e("models/api"));i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this;e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"图文详情",id:e.route.params.id}),this.bindScrollTo(e.$(".main"));var t=new c.ProductDetailAPI({$el:e.$el,params:{id:e.route.params.id},success:function(t){e.model.set({data:t.data})}});t.load()},onShow:function(){},onDestroy:function(){}})});define("template/shop/cart",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> <div class="head_right"><button class="btn_s" sn-tap="cart.isEdit=!cart.isEdit">{cart.isEdit?\'完成\':\'编辑\'}</button></div> </header> <div ref="cart"></div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/cart",["components","logical","css/style.css","css/append.css","components/cart"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loader"),e("core/model2")),u=(e("widget/scroll"),e("animation"),e("models/api"),e("components/cart")),h=e("models/user");return a.extend({onCreate:function(){var e=this;e.user=h.get();var t=new u;e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"我的购物车",user:e.user,cart:t}),t.$el.appendTo(this.model.refs.cart),this.onResult("CartChange",function(){t.cartApi.load()})},onShow:function(){var e=this;e.user=h.get(),e.model.set({user:e.user,back:e.swipeRightBackAction})},onDestroy:function(){}})});define("template/shop/buy",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back="{back}"></div> <div class="head_title">{title}</div> </header> <div class="main"> <div class="sp_buy"> <div class="sp_buy__addr" sn-tap="this.selectAddress()"> <div class="icon-loc"></div> <div class="info">收货人：<span class="name">{address.MBA_NAME}</span><span class="mobi">{address.MBA_MOBILE}</span></div> <div class="loc">收货地址：{address.MBA_FULL_ADDRESS}</div> </div> <ul class="sp_buy__info top_bottom_border"> <li class="bottom_border" sn-tap="this.useCoupon(false)"><span>使用优惠券</span><em>{selectedCoupon.CSV_CODE?selectedCoupon.CSV_CODE.split(\',\').length+"张":((coupon.length||0)+\'张可用\')}</em><b>-¥{selectedCoupon.CSV_CODE?Math.round(selectedCoupon.VCA_DEDUCT_AMOUNT*100)/100:\'0\'}</b></li> <li class="bottom_border" sn-tap="this.usePoint()"><span>积分抵扣</span><em>{Points}积分</em><b>-¥{Points/100||0}</b></li> <li sn-tap="this.useCoupon(true)"><span>运费</span><em ref="freight">{this.getFreight(bag_amount,full_amount_free,selectedCoupon,Points||0,selectedFreeCoupon.CSV_CODE)}</em></li> </ul> <ul class="sp_buy__info top_bottom_border" sn-tap="this.useInv()"> <li><span>发票信息</span><span>{requireInv?isCompany?\'公司\':\'个人\':\'不需要\'}</span></li> </ul> <div class="cl_blue pd_m mt_m fs_m" style="margin-bottom:-10px" sn-if="data.length>=2">此订单为合并支付订单，为了您能尽快收货，订单将分成多个配送</div> <div class="sp_buy__cart" sn-repeat="store in data"> <div class="hd bottom_border"> <div class="icon-shop dp_ib"></div> <span class="va_m">{store.tagname}</span> </div> <ul class="sp_cart__list"> <li sn-repeat="item in store.prodlist" class="sp_cart__listitem" data-id="{item.SPB_ID}"> <div class="sp_cart__listitem_con"> <img sn-src="{item.ProductOBJ.WPP_LIST_PIC}" /> <div class="con"> <b class="name">{ item.PRD_NAME }</b> <p class="size">尺寸：{ item.PRD_DISPLAY_SPEC} 颜色：{ item.PRD_COLOR }</p> <p class="price">￥{ Math.round(item.SPB_AMOUNT * 100) / 100 }</p> </div> <div class="ft"> <p class="qty">x{item.SPB_QTY}</p> </div> </div> </li> </ul> <div sn-repeat="ppg in store.packagelist" class="sp_cart__pkgitem"> <dl> <dt class="sp_cart__pkgitem_hd bottom_border"> { ppg.PPG_NAME } <b class="price">￥{ Math.round(ppg.PPG_PRICE * 100) / 100 }</b> </dt> <dd sn-repeat="item in ppg.PackageList" class="sp_cart__listitem bottom_border"> <div class="sp_cart__listitem_con"> <img sn-src="{item.PRD_PIC}" data-back="/item/{item.PRD_ID}" /> <div class="con"> <b class="name">{ item.PRD_NAME }</b> <p class="size">尺寸：{ item.PRD_DISPLAY_SPEC} 颜色：{ item.PRD_COLOR }</p> <p class="price">￥{ Math.round(item.PRD_MEMBER_PRICE * (item.SPB_QTY || 1) * 100) / 100 }</p> </div> <div class="ft"> <p class="qty">x{item.SPB_QTY}</p> </div> </div> </dd> </dl> </div> </div> <div class="sp_buy__pay"> <ul class="sp_buy__info top_bottom_border"> <li class="hd bottom_border check">支付方式</li> <li class="check icon-alipay bottom_border" sn-tap="payType=1"><span class="pl_s">支付宝支付</span> <i class="icon-right3" sn-if="payType==1"></i></li> <li class="check icon-weipay{payType==2?\' checked\':\'\'} bottom_border" sn-tap="payType=2"><span class="pl_s">微信支付</span> <i class="icon-right3" sn-if="payType==2"></i></li> <li class="check icon-cmcc{payType==3?\' checked\':\'\'}" sn-tap="payType=3"><span class="pl_s">一网通银行卡支付</span> <i class="icon-right3" sn-if="payType==3"></i></li> </ul> </div> </div> </div> <footer class="sp_buy__action"> <div class="total ta_r pr_m">实付款：<b ref="total">{this.getTotal(bag_amount,full_amount_free,selectedCoupon,Points||0,selectedFreeCoupon)}</b></div> <div class="btn_buy" sn-tap="this.createOrder()">立即支付</div> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/buy",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loader"),e("core/model2")),c=(e("animation"),e("models/api")),d=e("bridge"),u=e("models/user");return a.extend({onCreate:function(){var e=this,t=e.$(".main");e.user=u.get(),this.bindScrollTo(t),e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"确认订单",payType:1,couponprice:0}),s.extend(e.model,{selectAddress:function(){e.forward("/address?buy=1&from="+encodeURIComponent(e.route.url))},useCoupon:function(t){t&&"免邮费"==this.refs.freight.innerHTML||e.forward("/shop/useCoupon?from="+encodeURIComponent(e.route.url),{coupon:this.data.coupon,isFree:t,selected:t?this.data.selectedFreeCoupon:this.data.selectedCoupon,bag_amount:this.data.bag_amount})},usePoint:function(){e.forward("/shop/usePoint?from="+encodeURIComponent(e.route.url),{points:this.data.Points})},useInv:function(){e.forward("/shop/useInv?from="+encodeURIComponent(e.route.url),{requireInv:this.data.requireInv,company:this.data.company,isCompany:this.data.isCompany})},getPrice:function(e,t,i){var s=t&&t.VCA_DEDUCT_AMOUNT?t.VCA_DEDUCT_AMOUNT:0;return t&&5==t.VCA_VCT_ID&&(s=0),Math.max(0,e-s-i/100)},getFreight:function(t,i,s,n,a){var r=this.getPrice(t,s,n),o=e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||r>=i||a?0:15;return e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||r>=i?"免邮费":"¥"+Math.round(100*o)/100},getTotal:function(t,i,s,n,a){var o,l,c,r=s&&s.VCA_DEDUCT_AMOUNT?s.VCA_DEDUCT_AMOUNT:0;return s&&5==s.VCA_VCT_ID?(l=Math.max(0,t-r-n/100),c=e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||t-n/100>=i||a?0:15,o=Math.max(0,t+c-r-n/100)):(l=Math.max(0,t-r-n/100),o=l+(e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||l>=i||a?0:15)),"¥"+Math.round(100*o)/100},createOrder:function(){e.orderCreateApi.load()}});var i=new c.AddressListAPI({$el:this.$el,params:{pspcode:e.user.PSP_CODE},checkData:!1,success:function(t){t.data&&t.data[0]&&e.model.set({address:n.first(t.data,function(e){return e.MBA_DEFAULT_FLAG})||t.data[0]})}});i.load();var a=new c.CartAPI({$el:e.$el,checkData:!1,params:{pspcode:e.user.PSP_CODE}}).request().then(function(t){return e.model.set({bag_amount:t.bag_amount,full_amount_free:parseInt(t.full_amount_free),coupon:n.find(t.coupon,function(e){return 4!=e.VCT_ID}),freight:t.freight}),t});e.cart=new c.PreOrderAPI({$el:e.$el,checkData:!1,params:{pspcode:e.user.PSP_CODE},success:function(t){var i=t.data;a.then(function(t){var s=t.data_package;i.forEach(function(e){var t=[],i=e.packagelist;i&&(s.forEach(function(e){var s=!1;e.PackageList.forEach(function(e){var t=n.indexOf(i,function(t){return t.SPB_ID==e.SPB_ID});-1!=t&&(s=!0)}),s&&t.push(e)}),e.packagelist=t)}),e.model.set({data:i,loading:!1})})}}),e.orderCreateApi=new c.OrderCreateAPI({$el:this.$el,beforeSend:function(){var t=e.model.get("address");if(!t)return sl.tip("请填写收货地址信息"),!1;var i=e.model.get("requireInv")?!0:!1,s=e.model.get("isCompany");return i&&s&&!e.model.get("company")?(Toast.showToast("请填写公司抬头"),!1):void this.setParam({mba_id:t.AddressID,pay_type:e.model.get("payType"),inv_flag:i,inv_title:i?s?e.model.get("company"):"个人":""})},checkData:!1,success:function(t){if(t.success)if(sl.tip("生成订单成功！"),e.setResult("OrderChange").setResult("CartChange").setResult("UserChange"),0!=t.pur_amount){switch(e.model.get("payType")){case 1:d.ali({type:"pay",spUrl:c.API.prototype.baseUri+"/AlipayApp/Pay",orderCode:t.code},function(e){sl.tip(e.msg)});break;case 2:d.wx({type:"pay",spUrl:c.API.prototype.baseUri+"/api/shop/wxcreateorder",orderCode:t.code,orderName:"ABS商品",orderPrice:t.pur_amount},function(e){sl.tip(e.msg)});break;case 3:d.cmbpay(c.API.prototype.baseUri+"/api/cmbpay/pay?orderCode="+t.code)}e.forward("/order/"+t.pur_id+"?from=/myorder&refresh=1")}else e.forward("/news/order"+t.pur_id)},error:function(e){sl.tip(e.msg)}}),e.onResult("useAddress",function(t,i){e.model.set({address:i})})},onShow:function(){var e=this,t=e.route.data;e.user=u.get(),e.model.set({selectedCoupon:t.coupon,selectedFreeCoupon:t.freeCoupon,Points:t.points?parseInt(t.points):0,requireInv:t.requireInv,company:t.company,isCompany:t.isCompany}),e.orderCreateApi.setParam({pspcode:e.user.PSP_CODE,pay_type:1,coupon:e.model.get("selectedCoupon.CSV_CODE")||"",points:t.points,freecoupon:e.model.get("selectedFreeCoupon.CSV_CODE")||""}),e.cart.load()},onDestroy:function(){}})});define("template/steward/index",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="stw_title_bar"> <div class="hd">总共<em>{{user.StewardNum}}</em>条爱管家记录</div> <i class="stw_title_bar_thumb ico{{displayType==0?\' curr\':\'\'}}" sn-tap="displayType=0"></i> <i class="stw_title_bar_list ico{{displayType==1?\' curr\':\'\'}}" sn-tap="displayType=1"></i> </div> <ul class="stw_list" sn-if="{{displayType==1}}"> <li class="stw_list_item" sn-repeat="item in data"> <div class="thumb" data-forward="/item/{{item.LPK_PRD_ID}}?from=/steward"> <i>{{item.LPK_QTY}}</i> <img src="{{item.WPP_M_PIC}}"/> <b class="btn">再来一个</b> </div> <div class="con" data-forward="/steward/{{item.PRD_PRH_ID}}"> <h4>{{item.PRH_NAME}}</h4> <div class="date">最新购入时间：{{util.formatDate(item.PUR_DT,\'yyyy/MM/dd\')}}</div> <!--<div class="text"> <p>提醒：文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字</p> </div>--> <a class="link" href="/steward/{{item.PRD_PRH_ID}}">查看详情&gt;&gt;</a> </div> </li> </ul> <div class="stw_category" sn-if="{{displayType==0}}"> <div class="stw_category_item{{cate.currCate?\' curr\':\'\'}}" sn-repeat="cate in cates"> <div class="hd" sn-tap="this.setCate(cate)"> <span>{{cate.name}}</span> </div> <ul class="stw_list"> <li class="stw_list_item" sn-repeat="item in data|filter:item.CAT_ID==cate.id" data-forward="/item/{{item.LPK_PRD_ID}}?from=/steward"> <div class="thumb"> <img src="{{item.WPP_M_PIC}}"/> <b class="btn">再来一个</b> </div> <div class="con" data-forward="/steward/{{item.PRD_PRH_ID}}"> <h4>{{item.PRH_NAME}}</h4> <div class="date">最新购入时间：{{util.formatDate(item.PUR_DT,\'yyyy/MM/dd\')}} </div> <!--<div class="text"> <p>提醒：文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字</p> </div>--> <a class="link" href="/steward/{{item.PRD_PRH_ID}}">查看详情&gt;&gt;</a> </div> </li> </ul> </div> </div> <div class="datanotfound" sn-display="{{!data.length}}"> 您的爱管家还没有记录哦！ </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/steward/index",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loader"),e("core/model")),c=(e("animation"),e("models/api"));i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},swipeRightBackAction:"/",onCreate:function(){var e=this,t=this.$(".main");e.user=n.store("user"),this.bindScrollTo(t);var i=[{id:1,name:"出行"},{id:2,name:"睡眠"},{id:3,name:"美食"},{id:4,name:"沐浴"},{id:5,name:"休闲"},{id:6,name:"家务"},{id:7,name:"空间"},{id:8,name:"儿童"}];this.model=new o.ViewModel(this.$el,{back:"/",title:"爱管家",displayType:1,user:e.user}),e.model.setCate=function(t,i){e.model.getModel("cates").each(function(t){t.data.id==i.id&&(-1!=n.indexOf(e.model.get("data"),function(e){return e.CAT_ID==i.id})?t.set("currCate",!t.data.currCate):sl.tip("没有记录哦"))})};var a=n.store("categories"),r=new c.CategoryAPI({success:function(e){a=e.data,n.store("categories",e.data),d.load()},$el:e.$el}),l=function(t){return t.forEach(function(e){for(var s,t=e.PRH_PCT_ID;t;)s=n.first(a,function(e){return e.PCG_ID==t}),t=s?s.PCG_PARENT_ID:0;e.CAT_ID=s?s.PCG_ID:0,s=n.first(i,function(t){return t.id==e.CAT_ID}),s&&(s.currCate=!0)}),e.model.set({cates:i}),t},d=new c.StewardListAPI({$el:e.$el,params:s.extend({pspcode:e.user.PSP_CODE,pageSize:10,currentpage:1},e.user.token),$scroll:t,$content:t,checkData:!1,success:function(t){t.data.length>=10&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.set({data:l(t.data)})},append:function(t){10==t.data.length?t.total=(this.pageIndex+1)*parseInt(this.pageSize):t.data.length||(t.total=e.model.get("data").length),e.model.getModel("data").add(t.data)}});a?d.load():r.load()},onShow:function(){},onDestroy:function(){}})});define("template/steward/item",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <ul class="stw_items"> <li class="stw_items_item" sn-repeat="item in data"> <a href="/steward/detail/{{item.id}}?from={{url}}"><img src="{{item.pic}}" /></a> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/steward/item",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loader"),e("core/model")),d=(e("widget/scroll"),e("animation"),e("models/api"));return a.extend({events:{"tap .js_buy:not(.disabled)":function(){}},swipeRightBackAction:"/steward",onCreate:function(){var e=this,t=this.$(".main");this.bindScrollTo(t),e.user=n.store("user"),this.model=new o.ViewModel(this.$el,{back:"/steward",title:"爱管家",id:e.route.params.id,url:e.route.url});var i=new d.StewardAPI({$el:e.$el,params:s.extend({prh_id:e.model.get("id")},e.user.token),success:function(t){e.model.set(t)}});i.load()},onShow:function(){},onDestroy:function(){}})});define("template/steward/detail",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main" style="background:#fff;"> <div class="stw_detail" sn-html="{{data.content}}"></div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/steward/detail",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loader"),e("core/model")),d=(e("widget/scroll"),e("animation"),e("models/api"));return a.extend({events:{"tap,click .main a":function(e){var t=this,i=e.currentTarget.href.match(/\#(.+)$/);if(i){var s=t.$('[name="'+i[1]+'"]').offset().top;this.$(".main")[0].scrollTop=s}return!1}},onCreate:function(){var e=this,t=this.$(".main");this.swipeRightBackAction=this.route.from||this.route.referrer||"/steward",e.user=n.store("user"),this.bindScrollTo(t),this.model=new o.ViewModel(this.$el,{back:this.swipeRightBackAction,title:"爱管家",id:this.route.params.id});var i=new d.StewardDetailAPI({$el:e.$el,checkData:!1,params:s.extend({pspcode:e.user.PSP_CODE,detail_id:e.model.get("id")},e.user.token),success:function(t){e.model.set(t)}});i.load()},onShow:function(){},onDestroy:function(){}})});define("template/test",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back="{back}"></div> <div class="head_title">{$global.title}</div> </header> <div class="main" style="bottom:150px"> <div> <input sn-model=\'name\' value=\'{name}\' /> <div>{user.userName}|{user.userId}</div> <dl sn-repeat="item,i in data|filter:contains(item.name,name)"> <dt sn-tap="this.test(1)">{item.name}|{i}</dt> <dd sn-repeat="p,j in item.children">{p.name} <p>{p.id}|{j}</p> <p>{p.content}</p>{item.name} </dd> <p sn-repeat="c in $global.list" style="color:#f90">{c.name}</p> <p sn-repeat="c in list" style="color:#c90">{c.name}</p> </dl> <div sn-repeat="item in colletion">{item.name}</div> </div> </div> <div sn-require="widget/tab" sn-data="{{items:[\'name\',\'name1\']}}" style="top:420px;position:absolute;bottom:0; right: 0; left: 0;"> <div>asdf</div> <div>bbbb</div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/test",["components","logical","css/style.css","css/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),l=(e("widget/loader"),e("core/model"),e("core/model2"));e("widget/scroll"),e("animation"),e("widget/tab");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this,t=e.$(".main");e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",this.bindScrollTo(t),l.Global.set({title:"sssss",list:[{name:"global.test.0"},{name:"global.test.1"}]}),setTimeout(function(){l.Global.set({title:"aaaa"}),i.set({userName:"小白"}),s.get(0).set({name:"colletion.change.0"})},1e3);var i=new l.Model({userId:1,userName:"小红"}),s=new l.Collection([{name:"colletion.0"},{name:"colletion.1"}]),n=new l.Model(this.$el,{colletion:s,user:i,data1:{aa:11},list:[{name:"list.test.0"},{name:"list.test.1"}],data:[{name:"1234",children:[{name:"aaa"}]},{name:"2234",children:[{name:"bbb"}]}]});return void(n.test=function(e,t){})},onShow:function(){},onDestroy:function(){}})});define("template/coupon/activity",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> <div class="head_right"> <div class="icon-share js_share_activity"></div> </div> </header> <div ref="main" class="main" style="padding: 10px;background:#fff;"> <div html="{{data.SCA_CONTNET}}"></div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/coupon/activity",["components","logical","css/style.css","css/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loader"),e("core/model")),c=(e("widget/scroll"),e("widget/popup")),d=e("models/api"),h=(e("components/share"),e("models/user")),p=e("bridge");i.exports=a.extend({events:{"tap .js_share_activity":function(){var e=this;p.wx({type:"shareLinkURL",linkURL:this.model.data.data.SCA_SHARE_URL,tagName:"abs",title:this.model.data.data.SCA_SHARE_TITLE,description:this.model.data.data.SCA_SHARE_DESC,image:this.model.data.data.SCA_SHARE_PIC,scene:1},function(t){t.success?e.addActivityCouponAPI.setParam({pspcode:e.user.PSP_CODE,vca_id:e.model.data.data.SCA_VCA_ID}).load():sl.tip("您已取消分享")})}},defBackUrl:"/",onCreate:function(){var e=this;e.swipeRightBackAction=e.route.query.from||e.route.referrer||e.defBackUrl,e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"ABS家居"}),e.bindScrollTo(e.model.refs.main),e.user=h.get();var t=new d.AppShareActivityAPI({$el:e.$el,params:{id:e.route.params.id},success:function(t){e.model.set({data:t.data})}});t.load(),e.addActivityCouponAPI=new d.AddActivityCouponAPI({$el:e.$el,params:{id:20},success:function(e){e.success&&c.alert({title:"温馨提示",content:e.msg,action:function(){},btn:"确定"})},error:function(){}})},onShow:function(){},onDestroy:function(){}})});define("views/discovery/discovery_index",["components","logical","css/style.css","css/append.css","components/confirm"],function(e,t,i){var s=e("$"),n=e("util"),r=(e("widget/loader"),e("core/model2")),c=(e("widget/scroll"),e("animation"),e("models/api")),d=e("models/discovery"),u=e("models/user"),h=e("components/confirm");i.exports=r.Model.extend({el:'<div class="discovery_index"> <ul class="disc_nav"> <li><p><em>全部ALL</em></p></li> <li sn-repeat="item in typeList"><p data-forward="/discovery/list/{item.DCT_ID}?name={encodeURIComponent(item.DCT_DESC)}"><em>{ item.DCT_DESC }</em><img src="{item.DCT_PIC}" /></p></li> </ul> <ul class="disc_list"> <li sn-repeat="item in rec" data-forward="/discovery/{item.DCV_ID}"> <img src="{item.DCV_REC_PIC}" /> <p class="tit">{ item.DCV_SUBTITLE }</p> <p class="desc" sn-html="{item.DCV_REC_CONTENT}"></p> </li> <li sn-repeat="item in data" data-forward="/discovery/{item.DCV_ID}"> <img src="{item.DCV_SUBTITLE_PIC}" /> <em class="see">{ item.DCV_VIEW_QTY }</em> <em class="fav{item.Like_Flag?\' curr\':\'\'}">{ item.DCV_LIKE_QTY }</em> </li> </ul> </div>',initialize:function(){var e=this;e.user=u.get(),e.set({typeList:n.store("DiscoverType")});var t=new c.DiscoverTypeAPI({showLoading:!1,success:function(t){n.store("DiscoverType",t.data),e.set({typeList:t.data})},error:function(){}});t.load();var i=new c.RecDiscoveryAPI({showLoading:!1,success:function(t){e.set({rec:t.data})},error:function(){}});i.load();var a=new c.DiscoverListAPI({$el:e.$el,params:{pspcode:e.user.PSP_CODE},success:function(t){d.add(t.data),e.set({data:t.data})},append:function(t){10==t.data.length&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.getModel("data").add(t.data)},error:function(){}});a.load(),n.store("discovery_tip")||new c.ShopAPI({url:"/api/discover/standtips",checkData:!1,success:function(e){var t=new h({content:e.data});t.$el.appendTo(s("body")).find("img").on("load",function(){t.set({height:0}).show()}),t.show(),n.store("discovery_tip",sl.appVersion)},error:function(e){}}).load()}})});define("template/discovery/discovery",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{data.DCV_TITLE}}</div> <div class="head_right"> <div class="head_share js_share"></div> </div> </header> <div class="main discovery"> <div class="disc_con" html="{{data.DCV_CONTENT}}"></div> <div sn-if="{{plist}}" class="disc_relative"> <div class="hd">相关商品</div> <div class="hm_shop_scroll" ref="productScroll" style="padding-right:10px;"> <ul class="hm_shop_list" style="width:{{101*plist.length}}px"> <li class="hm_shop_list_item" sn-repeat="prd in plist" data-forward="/item/{{prd.PRD_ID}}?from={{url}}"> <img sn-src="{{prd.WPP_LIST_PIC}}" /> <p class="price">￥{{prd.PRD_PRICE}} <del sn-display="{{prd.PRD_SPECIAL_FLAG}}">¥{{prd.PRD_MEMBER_PRICE}}</del></p> <p class="name">{{prd.PRD_NAME}}</p> </li> </ul> </div> </div> <div class="disc_fav"> <div class="hd"><span>支持有态度的生活</span></div> <ul> <li> <p class="{{data.Like_Flag?\'curr\':\'\'}}" sn-tap="this.fav()">喜欢</p> </li> <li> <p class="js_share">分享</p> </li> </ul> </div> </div> <footer class="disc_bottom"> <ul> <li class="fav {{data.Like_Flag?\'curr\':\'\'}}" sn-tap="this.fav()">{{data.DCV_LIKE_QTY}}</li> <li class="share js_share">{{data.DCV_SHARE_QTY}}</li> <li class="see">{{data.DCV_VIEW_QTY}}</li> </ul> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/discovery/discovery",["components","logical","css/style.css","css/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loader"),e("core/model")),c=(e("animation"),e("models/api")),u=(e("models/discovery"),e("components/share")),p=e("models/user");i.exports=a.extend({events:{"tap .js_share":function(){this.share.show()}},onCreate:function(){var e=this;this.bindScrollTo(e.$(".main")),e.user=p.get(),e.share=new u({head:"分享"}),e.share.callback=function(i){t.setParam({pspcode:e.user.PSP_CODE}).load()},e.share.$el.appendTo(e.$el),e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,url:encodeURIComponent(e.route.url)}),this.bindScrollTo(e.model.refs.productScroll,{hScroll:!0});var t=new c.DiscoveryAddShareAPI({$el:e.$el,params:{dcvid:e.route.params.id}}),i=new c.DiscoveryFavAPI({$el:e.$el,params:{dcvid:e.route.params.id},success:function(){e.model.set("data.Like_Flag",!0).set("data.DCV_LIKE_QTY",(e.model.data.data.DCV_LIKE_QTY||0)+1)},error:function(e){sl.tip(e.msg)}}),s=new c.DiscoveryRemoveFavAPI({$el:e.$el,params:{dcvid:e.route.params.id},success:function(){e.model.set("data.Like_Flag",!1).set("data.DCV_LIKE_QTY",(e.model.data.data.DCV_LIKE_QTY||1)-1)},error:function(e){sl.tip(e.msg)}}),n=new c.DiscoveryAPI({$el:e.$el,params:{id:e.route.params.id,pspcode:e.user.PSP_CODE},checkData:!1,success:function(t){e.model.set({data:t.data,plist:t.plist&&void 0===t.plist.length?[t.plist]:t.plist}),e.share.set({title:t.data?t.data.DCV_TITLE:"",linkURL:t.data?t.data.Share_Url:"",description:""})},error:function(){}});e.model.fav=function(){this.data.data.Like_Flag?s.setParam({pspcode:e.user.PSP_CODE}).load():i.setParam({pspcode:e.user.PSP_CODE}).load()},n.load()},onShow:function(){},onDestroy:function(){}})});define("template/discovery/discovery_list",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <ul class="disc_list_sort"> <li class="curr" sn-tap="this.sortBy(\'VIEW\')">热门</li> <li sn-tap="this.sortBy(\'POST\')">最新</li> </ul> <ul class="disc_list"> <li sn-repeat="item in data" data-forward="/discovery/{{item.DCV_ID}}"> <img src="{{item.DCV_SUBTITLE_PIC}}" /> <em class="see">{{item.DCV_VIEW_QTY}}</em> <em class="fav{{item.Like_Flag?\' curr\':\'\'}}">{{item.DCV_LIKE_QTY}}</em> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/discovery/discovery_list",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=e("$"),a=(e("util"),e("activity")),o=(e("widget/loader"),e("core/model")),c=(e("animation"),e("models/api")),d=e("models/user");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this;this.bindScrollTo(e.$(".main")),e.user=d.get(),e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:e.route.query.name||"会生活"}),e.model.sortBy=function(t,i){e.discoverListAPI.setParam({orderby:"POST"==i?"desc":"asc",order:i}).reload(),s(t.currentTarget).addClass("curr").siblings(".curr").removeClass("curr")},e.discoverListAPI=new c.DiscoverListAPI({$el:e.$el,success:function(t){e.model.set({data:t.data})},error:function(){}})},onLoad:function(){var e=this;e.discoverListAPI.setParam({dctid:this.route.params.id||0,wd:this.route.query.s||"",pspcode:e.user.PSP_CODE,orderby:"asc",order:"VIEW"}).load()},onDestroy:function(){}})});define("views/discovery/discovery_list",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=e("$"),a=(e("util"),e("activity")),o=(e("widget/loader"),e("core/model")),c=(e("animation"),e("models/api")),d=e("models/user");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this;this.bindScrollTo(e.$(".main")),e.user=d.get(),e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:e.route.query.name||"会生活"}),e.model.sortBy=function(t,i){e.discoverListAPI.setParam({orderby:"POST"==i?"desc":"asc",order:i}).reload(),s(t.currentTarget).addClass("curr").siblings(".curr").removeClass("curr")},e.discoverListAPI=new c.DiscoverListAPI({$el:e.$el,success:function(t){e.model.set({data:t.data})},error:function(){}})},onLoad:function(){var e=this;e.discoverListAPI.setParam({dctid:this.route.params.id||0,wd:this.route.query.s||"",pspcode:e.user.PSP_CODE,orderby:"asc",order:"VIEW"}).load()},onDestroy:function(){}})});define("template/group/groupList",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div ref="main" class="main"> <div class="gp_list__wrap"> <ul class="gp_list__list"> <li class="gp_list__listitem" sn-repeat="item in data"> <p class="img" data-forward="{{isLogin?\'/group/\'+item.GPP_ID:\'/login\'}}"> <img sn-src="{{item.GPP_IMG}}"> <span class="name">{{item.GPP_NAME}}</span> </p> <p class="action"> <b class="btn_detail" data-forward="{{isLogin?\'/group/\'+item.GPP_ID:\'/login\'}}"><i>{{item.GPP_QTY}}人团</i><span class="price">¥{{item.GPP_PRICE}}</span><span class="go">去开团</span></b> <b class="btn_single" data-forward="/item/{{item.PRD_ID}}">单独购买</b> </p> </li> </ul> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/group/groupList",["components","logical","css/style.css","css/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loader"),e("core/model")),c=(e("animation"),e("models/api")),d=e("models/user");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},defBackUrl:"/",onCreate:function(){var e=this;e.swipeRightBackAction=e.query.from||e.referrer||e.defBackUrl,e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"去拼团吧"}),this.bindScrollTo(e.model.refs.main),e.groupListAPI=new c.GroupListAPI({$el:e.$el,success:function(t){e.model.set({data:t.data})}}),e.groupListAPI.load()},onShow:function(){var e=this;e.user=d.get(),e.model.set({isLogin:!!e.user})},onDestroy:function(){}})});define("template/group/groupItem",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<div class="pd_item_wrap"> <header class="header_trans"> <div class="head_back" ref="back"></div> <div class="head_right"> <a class="head_call" href="tel:4008205077"></a> <div class="head_share js_share"></div> </div> </header> <div class="main pd_item" ref="main"> <div class="pd_slider{data.PRD_NUM<=0?\' sold_out\':\'\'}" ref="image"> </div> <div class="pd_info_wrap"> <div class="pd_info"> <h1>{data.PRD_NAME}</h1> <p class="price">{data.PRD_PRICE}</p> <del class="ori_price" sn-display="{data.PRD_PRICE<data.PRD_MEMBER_PRICE}">¥{data.PRD_MEMBER_PRICE}</del> <p class="pd_code"> <span class="code">商品编码 {data.PRD_CODE}</span> <span class="sale">销售 {data.PSV_QTY} 件</span> </p> <p class="pd_code" style="padding:5px 0;" sn-html="{data.PRH_DESC}"></p> </div> </div> <ul class="pd_sign"> <li>满99包邮</li> <li>30天退换货保障</li> </ul> <div class="pd_select_plus" sn-display="{Package.PPG_ID}" data-forward="/news/package{Package.PPG_ID}?from={url}"> {Package.PPG_NAME} </div> <div class="pd_select_size js_select_size"> 选择 尺码 颜色分类 </div> <div class="pd_jump_detail pd_select_size flex" style="padding-right: 20px" data-forward="/detail/{data.PRD_ID}"><b class="flexitem">图文详情</b><em class="fs_m cl_999">建议在WIFI情况下查看</em></div> <div class="gp_item__rules" sn-html="{GPP_Obj.GPP_CONTENT}"> </div> <div class="pd_help"> 如果您有任何疑问，欢迎联系我们的客服。 <br> 联系热线：400-820-5077 周一至周日 9:00-19:00 </div> </div> <footer class="pd_buy gp_item__action"> <b class="btn_cart icon-cart_dark" data-forward="{isLogin?\'/cart\':(\'/login?success=\'+url)}"><i sn-if="$global.cartQty!=0">{$global.cartQty}</i></b> <b class="btn_single {data.PRD_NUM==0?\'sold_out\':\'\'}" data-forward="/item/{data.PRD_ID}"><em>¥{data.PRD_PRICE}</em>{data.PRD_NUM==0?\'商品已售罄\':\'单独购买\'}</b> <b class="btn_buy {data.PRD_NUM==0?\'sold_out\':\'js_buy\'}"><em>{\'¥\'+GPP_Obj.GPP_PRICE}</em>{data.PRD_NUM==0?\'商品已售罄\':(LPP_LSP_QTY==0?GPP_Obj.GPP_QTY+\'人团\':LPP_LSP_QTY&lt;GPP_Obj.GPP_QTY?\'还差\'+(GPP_Obj.GPP_QTY-LPP_LSP_QTY)+\'人成团\':\'拼团价购买\')}</b> </footer> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/group/groupItem",["components","logical","css/style.css","css/append.css"],function(e,t,i){var s=e("$"),a=(e("util"),e("activity")),o=(e("widget/loader"),e("core/model2")),c=(e("widget/scroll"),e("components/share")),d=e("components/size"),p=(e("animation"),e("models/api")),h=e("widget/slider"),f=e("models/user");i.exports=a.extend({events:{'tap [ref="back"]':function(){this.back(this.swipeRightBackAction)},"tap .js_buy:not(.disabled)":function(){var e=this;return e.model.data.canBuy?void(1==e.model.data.colorSpec.length?e.user?this.size.confirm():e.forward("/login"):this.size.show()):(sl.tip(e.model.data.tip),void this.share.show())},"tap .js_share":function(){this.share.show()},"tap .js_select_size":function(){this.size.show()}},className:"pd_item_bg",requestData:function(){this.groupApi.setParam({pspcode:this.user.PSP_CODE}).load()},onCreate:function(){var e=this;e.user=f.get(),e.model=new o.ViewModel(e.$el,{id:e.route.params.id,user:e.user,url:encodeURIComponent(e.route.url),qty:1,tip:"分享后才能购买哦"}),this.bindScrollTo(e.model.refs.main),e.onResult("Login",function(){e.user=f.get(),e.model.set({user:e.user}),e.requestData()}),e.size=new d({type:"group",confirm:function(t,i,s){e.model.data.canBuy?e.groupAddToCartAPI.setParam({pspcode:e.user.PSP_CODE,prdid:i,lppid:e.model.data.LPP_ID,qty:s||1}).load():(sl.tip(e.model.data.tip),e.share.show()),e.size.hide()}}),e.size.$el.appendTo(e.$el),e.size.on("SizeChange",function(t,i){var s={PRD_NUM:i.PRD_NUM};i.WPP_LIST_PIC&&(s.WPP_LIST_PIC=i.WPP_LIST_PIC),e.model.set({data:s})}),e.groupShareAPI=new p.GroupShareAPI({$el:e.$el,params:{gppid:e.route.params.id},checkData:!1,success:function(e){}}),e.groupApi=new p.GroupAPI({$el:e.$el,params:{gppid:e.route.params.id},checkData:!1,success:function(i){var s=i.data;e.model.set({GPP_Obj:s.GPP_Obj,LPP_LSP_QTY:s.LPP_LSP_QTY,Share_Flag:s.Share_Flag,PRD_ID_LIST:s.PRD_ID_LIST}),t.setParam({id:i.data.PRD_ID_LIST[0]}).load(),n.setParam({prdId:i.data.PRD_ID_LIST[0]}).load(),e.groupShareAPI.setParam({pspcode:e.user.PSP_CODE,gppid:e.route.params.id}).load(function(t){e.model.set({LPP_ID:t.data.LPP_ID,canBuy:t.isbuy,tip:t.sharemsg||"分享后才能购买哦"}),e.share=new c({head:"分享拼团至",title:e.model.data.GPP_Obj.GPP_NAME,linkURL:t.data.LPP_SHARE_URL,description:e.model.data.GPP_Obj.GPP_NAME,image:t.data.LPP_SHARE_PIC}),e.share.$el.appendTo(e.$el)})}}),e.user&&e.requestData();var t=new p.ProductAPI({$el:e.$el,checkData:!1,success:function(t){t.data.PSV_QTY=t.psvqty,e.model.set({data:t.data}),e.size.set({qty:1,specialPrice:e.model.get("GPP_Obj.GPP_PRICE"),data:s.extend({},t.data)}),t.prhpic||(t.prhpic=[]),t.prhpic.unshift({PHP_PIC_M:t.data.WPP_M_PIC}),e.slider=new h({container:e.model.refs.image,loop:!0,autoLoop:3e3,data:t.prhpic,dots:t.prhpic.length>=1,itemTemplate:'<img width="100%" height="100%" src="<%=PHP_PIC_M%>" />'}),i.setParam({id:t.data.PRD_PRH_ID}).load()}}),i=new p.ProductColorAndSpec({$el:e.$el,checkData:!1,success:function(t){for(var i=[],s=[],n=0,a=t.data.length;a>n;n++){var r=t.data[n];-1!=e.model.data.PRD_ID_LIST.indexOf(r.PRD_ID)&&(-1==i.indexOf(r.PRD_COLOR)&&i.push(r.PRD_COLOR),-1==s.indexOf(r.PRD_DISPLAY_SPEC)&&s.push(r.PRD_DISPLAY_SPEC))}e.model.set({color:i,spec:s,colorSpec:t.data}),e.size.set({color:i,spec:s,colorSpec:t.data})}}),n=new p.PackageRelativeAPI({$el:e.$el,checkData:!1,success:function(t){e.model.set({Package:t.data})}});e.groupAddToCartAPI=new p.GroupAddToCartAPI({$el:e.$el,checkData:!1,success:function(t){t.success?(e.setResult("CartChange"),sl.tip("加入购物车成功！")):sl.tip(t.message)},error:function(e){sl.tip(e.message)}})},onShow:function(){this.model.set({isLogin:!!f.get()})},onDestroy:function(){}})});define("template/user/express",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back js_back"></div> <div class="head_title">{{title}}</div> </header> <div ref="main" class="main"> <div class="uc_express__info"> <div class="info"><span>快递公司：</span>{{data.EXP_NAME}}</div> <div class="info"><span>运单号：</span>{{data.EXP_CODE}}</div> </div> <dl class="express_list"> <dd sn-repeat="express in data.data"> <p>{{util.formatDate(express.EXP_DT)}}</p> <p>{{express.EXP_STATE_DETAIL}}</p> </dd> </dl> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/express",["components","logical","css/style.css","css/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loader"),e("core/model")),l=e("models/api"),c=e("models/user");i.exports=a.extend({events:{"tap .js_back":function(){this.back(this.swipeRightBackAction)}},onCreate:function(){var e=this;e.model=new o.ViewModel(this.$el,{title:"跟踪物流"}),this.bindScrollTo(e.model.refs.main),e.user=c.get();var t=new l.ExpressAPI({$el:e.$el,success:function(t){e.model.set({data:t})},error:function(){}});t.setParam({pur_code:e.route.params.code,pspcode:e.user.PSP_CODE}).load()},onShow:function(){},onDestroy:function(){}})});