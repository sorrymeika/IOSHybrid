define("template/home",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<div sn-display="{{!showGuide}}"> <div class="searchwrap" ref="searchwrap" style="display:none"> <header> <form class="head_search head_disc"> <input type="search" placeholder="热门搜索：新月枕" ref="searchText" /> </form> <div class="head_right" sn-tap="this.hideSearch()">取消</div> </header> <div class="main"> <div class="searchhistory"><i class="icon-clear" sn-tap="this.clearSearch()"></i> 历史记录</div> <ul class="searchlist"> <li sn-repeat="item in searchHistory" sn-tap="this.search(item)">{{item}}</li> </ul> <div class="searchhistory">热门搜索</div> <ul class="searchlist"> <li sn-repeat="item in hotSearch" sn-tap="this.search(item)">{{item}}</li> </ul> </div> </div> <header sn-display="{{!isStart||isLogin}}"> <div class="head_menu" sn-display="{{bottomTab==4}}" data-forward="{{isLogin?\'/settings\':\'/login\'}}"></div> <ul class="head_tab" sn-display="{{bottomTab==0}}"> <li class="{{tab==0?\'curr\':\'\'}}">去购物</li> <li class="{{tab==1?\'curr\':\'\'}}">会员卡</li> <i class="cursor" style="-webkit-transform: translate3d({{tab==1?100:0}}%, 0%, 0);"></i> </ul> <form class="head_search head_disc" sn-if="{{bottomTab==2}}"> <input type="search" placeholder="搜索专题" ref="search" /> </form> <div class="head_title" style="display:{{bottomTab!=0&&bottomTab!=2?\'block\':\'none\'}}">{{bottomTab==1?\'查找店铺\':bottomTab==2?"发现":bottomTab==3?"消息":"我"}}</div> <div class="head_msg" data-forward="{{isLogin?\'/cart\':\'/login\'}}"> <i sn-display="{{$state.cartQty!=0}}">{{$state.cartQty}}</i> </div> <div class="head_all" sn-tap="this.showSearch()" sn-display="{{tab==0&&bottomTab==0}}"> </div> </header> <div sn-display="{{isStart&&!isLogin}}" style="position:absolute;z-index: 1000;right:0;left:0;top:0;bottom:0;"> <div class="home_mask"></div> <div class="home_text" data-forward="/login"> <h1></h1> <h2>让回家的灯，为爱亮起来。</h2> <h3>开启时尚居家之旅</h3> <h4>LIFE STARTS HERE</h4> </div> <div class="launch"> <img src="images/launch0.jpg" /> <img src="images/launch1.jpg" class="launch_hide" /> <img src="images/launch2.jpg" class="launch_hide" /> </div> </div> <div sn-display="{{!isStart||isLogin}}"> <div style="position:absolute;top:0;left:0;right:0;bottom:0;-webkit-transform:translate({{bottomTab==0?\'0px\':\'100%\'}},0px)"> <div class="main js_shop hm_tab_con" style="-webkit-transform:translate3d({{tab==0?0:-100}}%,0%,0);" data-index="0"> <div class="hm_shop"> <div class="sp_all_cates"> <div ref="cates"> <ul style="width:{{(navs.length+1)*.73}}rem;padding-right:30px;"> <li class="cate0 curr">首页</li> <li sn-repeat="item in navs" class="{{!item.LPE_URL?\'cate\'+item.LPE_PCG_ID:\'noicon\'}}" data-forward="{{!item.LPE_URL?\'/all?id=\'+item.LPE_PCG_ID:item.LPE_URL}}">{{item.LPE_PCG_NAME}}</li> </ul> </div> <div class="dropdown_btn" sn-tap="this.showCategories()"></div> </div> <div class="banner" ref="topbanner"> </div> <ul class="hm_shop__nav"> <li data-forward="/all"><i></i>全部分类</li> <li data-forward="/list?type=new&from=%2f"><i></i>新品上市</li> <li data-forward="/news/fastbuy?from=%2f"><i></i>周一闪购</li> <li data-forward="/group"><i></i>来拼团吧</li> </ul> <div sn-repeat="item in activity"> <div sn-if="{{item.type==1}}" class="hm_shop_banner"> <ul> <li><img sn-repeat="img in item.data" data-src="{{img.src}}" data-forward="{{img.url}}?from=%2f" /></li> </ul> </div> <div sn-if="{{item.type==2&&item.data.length}}" class="hm_shop_scroll js_shop_scroll" style="padding-right:10px;"> <ul class="hm_shop_list"> <li class="hm_shop_list_item" sn-repeat="prd in item.data" data-forward="/item/{{prd.PRD_ID}}?from={{encodeURIComponent(\'/\')}}"> <img data-src="{{prd.WPP_LIST_PIC}}" /> <p class="price">￥{{prd.PRD_PRICE}} <del sn-display="{{prd.PRD_SPECIAL_FLAG}}">¥{{prd.PRD_MEMBER_PRICE}}</del> </p> <p class="name">{{prd.PRD_NAME}}</p> </li> </ul> </div> </div> <ul class="sp_list"> <li sn-repeat="item in newproducts" class="sp_list_item" data-forward="/item/{{item.PRD_ID}}"> <img data-src="{{item.WPP_LIST_PIC1}}" /> <p class="price"><b>￥{{item.PRD_PRICE}}</b> <del sn-display="{{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}}">￥{{item.PRD_MEMBER_PRICE}}&nbsp;</del> </p> <p class="name">{{item.PRD_NAME}}</p> <div class="sold_out" sn-display="{{item.PRD_NUM==0}}">脱 销 <br>Sold Out</div> </li> </ul> </div> </div> <div ref="home" class="main hm_tab_con js_usescroll {{isLogin?\'\':\'isnotlogin\'}}" style="-webkit-transform:translate3d({{tab==1?0:100}}%,0%,0);" data-index="1"> <div class="hm_chart_wrap"> <div class="hm_chart"> <div class="hm_chart_con" sn-tap="chartType=1" sn-display="{{chartType==0}}"> <div class="hd">当前活力值</div> <div class="bd">{{util.formatMoney(energyAnimNum)}}</div> <div class="ft">目标 {{util.formatMoney(levelAmounts)}}</div> </div> <div class="hm_chart_con" sn-tap="chartType=2" sn-display="{{chartType==1}}"> <div class="hd">我的月礼</div> <div class="bd">{{user.FreeMonths}}</div> </div> <div class="hm_chart_con" sn-tap="chartType=3" sn-display="{{chartType==2}}"> <div class="hd">我的卡券</div> <div class="bd">{{user.FreeCouponsCount+user.CouponsCount}}</div> </div> <div class="hm_chart_con" sn-tap="chartType=0" sn-display="{{chartType==3}}"> <div class="hd">积分钱包</div> <div class="bd">{{user.Points}}</div> </div> <canvas class="hm_chart_canvas js_canvas"></canvas> </div> <div class="hm_chart_desc">{{vipName}}</div> <div class="hm_steward_link" data-forward="/steward">您现在拥有<em>{{user.StewardNum}}</em>条爱管家记录啦！</div> <ul class="hm_chart_list"> <li data-forward="/month"><i>我的月礼</i><em>{{user.FreeMonths}}</em></li> <li data-forward="/coupon"><i>我的卡券</i><em>{{user.FreeCouponsCount+user.CouponsCount}}</em></li> <li data-forward="/mypoint"><i>积分钱包</i><em>{{user.Points}}</em></li> </ul> </div> <div class="hm_my_barcode"> <div class="barcode" sn-html="{{barcode}}"> </div> <div class="mobile">{{user.Mobile}}</div> </div> <ul class="hm_cards"> <li sn-repeat="item in icons" data-forward="{{item.WAI_URL}}"> <img sn-src="{{item.WAI_PIC}}" /> </li> </ul> </div> </div> <div class="main" style="-webkit-transform:translate({{bottomTab==1?\'0px\':\'100%\'}},0px)"> <div class="baiduMap" sn-html="{{baiduMap}}"> </div> </div> <div ref="discovery" class="main" style="-webkit-transform:translate({{bottomTab==2?\'0px\':\'100%\'}},0px)"> </div> <div ref="messages" class="main hm_msg" style="-webkit-transform:translate({{bottomTab==3?\'0px\':\'100%\'}},0px)"> <div style="overflow:hidden"> <div class="hm_msg_list" data-forward="/messages">通知<i sn-display="{{msg_count!=0}}">{{msg_count}}</i></div> <div class="hm_msg_service" data-forward="/news/100">联系客服</div> <div class="hm_msg_discovery"> <div class="hd">更多态度</div> <ul class="disc_list"> <li sn-repeat="item in rec" data-forward="/discovery/{{item.DCV_ID}}"> <img sn-src="{{item.DCV_REC_PIC}}" /> <em class="see">点击查看</em> </li> </ul> <div class="ft" data-forward="/discovery/list/0">查看更多态度>></div> </div> </div> </div> <div class="main" style="-webkit-transform:translate({{bottomTab==4?\'0px\':\'100%\'}},0px)" data-index="3"> <div class="hm_my_card"> <div class="user_rights" data-forward="/news/201">会员权益</div> <div class="vip_name">{{vipName}}</div> <div class="energy"> 当前活力值<span>{{util.formatMoney(energy)}}</span> </div> <div class="energy_bar"> <span style="width:{{energyPercent}}"></span> </div> <div class="energy_val"> <div class="energy_val_from">{{util.formatMoney(currentLevel)}}</div> <div class="energy_val_to">{{util.formatMoney(nextLevel)}}</div> </div> </div> <div class="hm_my_barcode"> <div class="barcode" sn-html="{{barcode}}"> </div> <div class="mobile">{{user.Mobile}}</div> </div> <ul class="hm_my_list"> <li data-forward="/month"> <b>我的月礼</b> <span><em>{{user.FreeMonths}}</em>个月</span> </li> <li data-forward="/coupon"> <b>我的卡券</b> <span><em>{{user.FreeCouponsCount+user.CouponsCount}}</em>张</span> </li> <li data-forward="/mypoint"> <b>积分钱包</b> <span><em>{{user.Points}}</em>分</span> </li> <li data-forward="/myorder"> <b>购买记录</b> <span><em>{{user.OrderCount}}</em>条</span> </li> <li data-forward="/steward"> <b>爱管家记录</b> <span><em>{{user.StewardNum}}</em>条</span> </li> </ul> </div> <div class="main js_offline" sn-display="{{isOffline}}"> <div class="home_offline"> <div class="ico"></div> <div class="txt">您的网络不太顺畅哦</div> <div class="txt_sub">请检查您的手机是否联网</div> <div class="btn">重新加载</div> </div> </div> </div> <ul class="footer" sn-display="{{!isStart||isLogin}}"> <li class="curr">首页</li> <li>附近门店</li> <li></li> <li>消息<i sn-display="{{msg_count!=0}}">{{msg_count}}</i></li> <li>我</li> </ul> <div class="footer_line"></div> <div class="footer_discovery_ico"></div> <div class="open_msg" style="display:none"> <div class="msg_bd" sn-html="{{message}}"></div> </div> <div class="home_tip_mask" sn-display="{{(!isStart||isLogin)&&showTipStep==1}}"></div> </div> <div class="hm_guide" sn-display="{{showGuide}}"> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/home",["components","images/style.css","images/append.css"],function(t,e,i){var n=t("$"),s=t("util"),r=t("activity"),o=t("bridge"),a=t("../widget/loading"),l=t("../widget/slider"),c=t("core/model"),d=t("../widget/scroll"),u=t("../util/barcode"),h=t("animation"),p=t("components/confirm"),f=t("models/api"),m=t("models/user"),v=t("models/category"),g=t("components/category"),_=c.ViewModel,y=t("./discovery/discovery_index");c.State.set({cartQty:0});var w=new f.CartQtyAPI({checkData:!1,success:function(t){c.State.set({cartQty:t.data})},error:function(){}}),x=s.store("recordVersionTime");if(!x||Date.now()-x>864e5){s.store("recordVersionTime",Date.now());var b=new f.HistoryRecord({success:function(t){console.log(t)},error:function(){}}),P=m.get();o.system.info(function(t){b.setParam({pspid:P?P.ID:0,appversion:sl.appVersion,device:t.deviceName,deviceversion:(s.ios?"IOS":"Android")+s.osVertion,uuid:t.uuid}).load()})}i.exports=r.extend({events:{"tap .head_tab li":function(t){var e=n(t.target).index();return 1!=e||this.model.data.isLogin?void this.model.set("tab",e):void this.forward("/login")},"tap .home_tip_mask":function(t){s.store("showTipStep",2),this.model.set({showTipStep:2})},"tap .open_msg":function(t){n(t.target).hasClass("open_msg")&&n(t.target).removeClass("show")},"tap .js_offline .btn":function(){this.requestUser()},"tap .js_comment_list [data-id]":function(t){},"tap .rainbow_bd":function(t){this.$(".footer li").eq(3).trigger("tap")},"tap .footer li":function(t){var e=this,i=n(t.currentTarget),r=i.index();if(!i.hasClass("curr")){if(1==r)this.model.data.baiduMap||this.model.set("baiduMap",'<iframe class="js_baidu_map" src="'+o.url("/baiduMap.html?v4")+'" frameborder="0" ></iframe>').one("viewDidUpdate",function(){e.$baiduMap=e.$(".js_baidu_map").css({width:window.innerWidth,height:window.innerHeight-47-44-(s.isInApp?20:0)})}),o.getLocation(function(t){e.$baiduMap[0].src=o.url("/baiduMap.html?v3#longitude="+t.longitude+"&latitude="+t.latitude)});else{if(!this.model.data.isLogin)return void this.forward("/login");2==r?e.discovery||(e.discovery=new y,e.discovery.$el.appendTo(e.model.refs.discovery)):3==r&&(e.recDiscovery||(e.recDiscovery=new f.RecDiscoveryAPI({$el:e.model.refs.messages,success:function(t){console.log(t),e.model.set({rec:t.data})},error:function(){}}),e.recDiscovery.load()))}i.addClass("curr").siblings(".curr").removeClass("curr"),this.model.set({bottomTab:r})}},"touchstart .hm_tab_con":function(t){var e=this;this.pointY=this.startY=t.touches[0].pageY,this.pointX=this.startX=t.touches[0].pageX,this.isTouchStop=!this.model.data.isLogin,this.isTouchStart=!1,this.isTouchMoved=!1,this.x=e.model.data.tab?-window.innerWidth:0,this.x1=e.model.data.tab?0:window.innerWidth},"touchmove .hm_tab_con":function(t){var e=this,i=t.touches[0].pageX,n=t.touches[0].pageY,s=e.startX-i,r=e.startY-n;if(!e.isTouchStart){if(e.isTouchStop)return;var o=Math.abs(s)>0&&Math.abs(s)>Math.abs(r);if(!o)return void(e.isTouchStop=!0);e.isTouchStart=!0,e.isDirectionX=o}var a=Math.max(-window.innerWidth,Math.min(0,this.x-s)),l=Math.max(0,Math.min(window.innerWidth,this.x1-s));e.moveX=a,e.$tabs.eq(0).css({"-webkit-transform":"translate("+a+"px,0px)","-webkit-transition":"0ms"}),e.$tabs.eq(1).css({"-webkit-transform":"translate("+l+"px,0px)","-webkit-transition":"0ms"}),this.dir=this.pointX-i>0?"left":"right",this.pointX=i,this.pointY=n,e.isTouchMoved=!0},"touchend .hm_tab_con":function(t){var e=this;if(e.isTouchMoved&&(e.isTouchMoved=!1,!e.isTouchStop))return e.isTouchStop=!0,n(t.target).trigger("touchcancel"),e.$tabs.css({"-webkit-transition":"-webkit-transform 300ms ease-out 0ms"}).each(function(){this.clientHeight}),e.moveX!=this.x&&e.model.set({tab:e.model.data.tab?0:1}),!1},"tap .guide1":function(){this.model.set({showGuide:!1})}},className:"home",onCreate:function(){var t=this;t.user=m.get(),t.$tabs=t.$(".hm_tab_con"),sl.activity=t;var e=this.model=new _(this.$el,{menu:"head_menu",titleClass:"head_title",isOffline:!1,isLogin:!!t.user,isStart:1==t.query.start,msg:0,tab:0,bottomTab:0,chartType:0,open:function(){o.openInApp(t.user.OpenUrl||"http://m.abs.cn")},openUrl:function(t,e){o.openInApp(e||"http://m.abs.cn")},searchHistory:s.store("searchHistory")});e.showSearch=function(t){this.set({isShowSearch:!0}),n(this.refs.searchwrap).show(),this.refs.searchText.focus(),t.preventDefault(),t.stopPropagation()},e.clearSearch=function(){s.store("searchHistory",null),this.set({searchHistory:null})},e.hideSearch=function(){this.set({isShowSearch:!1}),this.refs.searchText.blur(),n(this.refs.searchwrap).hide()},t.appIconAPI=new f.AppIconAPI({checkData:!1,params:{id:2},success:function(e){console.log(e),t.model.set({icons:e.data})}}),t.appIconAPI.load(),t.hotSearchAPI=new f.HotSearchAPI({checkData:!1,success:function(e){t.model.set({hotSearch:e.data})}}),t.hotSearchAPI.load();var i=new f.UpdateAPI({checkData:!1,params:{version:sl.appVersion,platform:s.ios?1:2},success:function(t){if(t.success&&t.data.AVS_UPDATE_URL){var e=new p({content:t.data.AVS_UPDATE_MSG,alwaysOpen:t.data.AVS_FORCE_FLAG,confirm:function(){o.update(t.data.AVS_UPDATE_URL,t.data.AVS_VERSION)}});e.$el.appendTo(n("body")),e.show()}},error:function(){}});i.load(),this.stewardQtyApi=new f.StewardQtyAPI({checkData:!1,success:function(i){t.user.StewardNum=i.data,m.set(t.user),e.set("user.StewardNum",i.data)}}),this.launchLoading=new a({url:"/api/settings/ad_list?name=launch&type=base64",check:!1,checkData:!1,success:function(t){t&&t.data&&t.data.length&&localStorage.setItem("LAUNCH_IMAGE",t.data[0].Src)}}),this.launchLoading.load(),t.shopApi=new f.ActivityAPI({$el:t.$(".hm_shop"),success:function(i){e.set({activity:i.data,topbanner:i.topbanner}),console.log(i.topbanner.data),t.slider?t.slider.set(i.topbanner.data):t.slider=new l({loop:!0,container:e.refs.topbanner,autoLoop:3e3,data:i.topbanner.data||[],dots:!0,itemTemplate:'<img data-src="<%=src%>" data-forward="<%=url%>?from=%2f" />'}),d.bind(t.$(".js_shop_scroll:not(.s_binded)").addClass("s_binded"),{vScroll:!1,hScroll:!0,useScroll:!0}),t.scroll&&t.scroll.get(".js_shop").imageLazyLoad(),this.showMoreMsg('别拉了，就这些<i class="ico_no_more"></i>')}}),t.shopApi.load(),new f.ShopAPI({url:"/api/prod/newproductlist",checkData:!1,check:!1,success:function(t){t.success&&e.set({newproducts:t.data})},error:function(){}}).load(),e.on("change:tab",function(){1==this.data.tab&&t.scroll.get(".js_shop").imageLazyLoad()}),d.bind(e.refs.cates,{useScroll:!0,vScroll:!1,hScroll:!0}),e.showCategories=function(){t.cpCategory.show()},v.request(function(){v.list(function(i,n){i=s.find(i,function(t){return t.children}),console.log("navs",n),e.set({navs:n,categories:i});var r=new g({data:i,isHome:!0,"goto":function(e,i){r.hide(),t.forward("/all?id="+i)}});r.$el.appendTo("body"),t.cpCategory=r,console.log(i)})}),s.store("IS_SHOW_GUIDE")||(s.store("IS_SHOW_GUIDE",1),e.set("showGuide",!0),this.guideSlider=new l({container:t.$(".hm_guide"),itemTemplate:'<img class="guide<%=id%>" src="http://appuser.abs.cn/dest1.2.0/images/guide<%=id%>.jpg" />',data:[{id:0},{id:1}],onChange:function(t){}})),d.bind(this.$(".main:not(.js_shop)")),this.scroll=d.bind(this.$(".js_shop"),{refresh:function(e,i){t.shopApi.load(function(){e()})}}),t.$open_msg=this.$(".open_msg").on(n.fx.transitionEnd,function(e){t.$open_msg.hasClass("show")||t.$open_msg.hide()}),d.bind(t.$open_msg.find(".msg_bd"));var r=this.$(".js_canvas")[0];r.width=170,r.height=170,this.canvas=r,this.context=r.getContext("2d");var c=this.$(".launch img"),u=this.$(".home_mask").on(n.fx.transitionEnd,function(t){if(u.hasClass("toggle")){u.removeClass("toggle");var e=c.filter(":not(.launch_hide)").addClass("launch_hide");c.eq(e.index()+1==c.length?0:e.index()+1).removeClass("launch_hide")}});setTimeout(function(){u.addClass("toggle"),setTimeout(arguments.callee,3200)},3200),t.onResult("Login",function(){t.user=m.get(),e.set({isOffline:!1,user:t.user}),t.doWhenLogin()}).onResult("UserChange",function(){t.requestUser()}).onResult("Logout",function(){t.user=null,e.set({isLogin:!1,user:null})}).onResult("CartChange",function(){t.getCartQty()}),setInterval(function(){t.getUnreadMsg()},3e4),this.listenTo(n(this.model.refs.search),"keydown",function(e){return 13==e.keyCode?(t.forward("/discovery/list?s="+encodeURIComponent(e.target.value)+"&from=/"),e.preventDefault(),!1):void 0}),this.listenTo(n(this.model.refs.searchText),"keydown",function(t){return 13==t.keyCode?(e.search(t,t.target.value),t.preventDefault(),!1):void 0}),e.search=function(e,i){var n=s.store("searchHistory")||[],r=n.indexOf(i);-1!=r&&n.splice(r,1),n.unshift(i),t.model.set({searchHistory:n}),s.store("searchHistory",n),t.forward("/list?s="+encodeURIComponent(i)+"&from=/")}},getCartQty:function(){this.user.PSP_CODE&&w.setParam({pspcode:this.user.PSP_CODE}).load()},requestUser:function(){var t=this;m.request(function(e,i){return e?(503==e.error_code&&(m.set(null),t.model.set("isLogin",!1)),void t.model.set("isOffline",!0)):(m.set(i.data),t.user=m.get(),t.model.set({isOffline:!1,user:t.user}),t.getCartQty(),t.showEnergy(),t.stewardQtyApi.setParam({pspcode:t.user.PSP_CODE}).load(),void(i.vdpMessage&&t.showMessageDialog(i.vdpMessage)))},s.store("ivcode")||"0000")},showMessageDialog:function(t){var e=this;e.model.set("showTipStep",1),e.$open_msg.show(),e.$open_msg[0].clientHeight,e.$open_msg.addClass("show"),e.model.set({message:t})},_angleFrom:0,drawCircle:function(t){this._angleFrom||(this._angleFrom=1.5*Math.PI);var e=Math.floor(1e3*(1.5+2*t))/1e3*Math.PI,i=this.context,n=this.canvas,s=n.width/2,r=n.height/2,o=s-10;i.clearRect(0,0,n.width,n.height),i.beginPath(),i.arc(s,r,o,this._angleFrom,e,!1),i.lineWidth=19,i.strokeStyle="#fff",i.stroke()},showEnergy:function(){if(this.user){var n,r,o,a,t=this,e=Math.round(this.user.Amount),i=1,l=["银卡会员","金卡会员","钻石会员","VIP会员","SVIP会员","无敌会员"];t.model.set("vip",e<(a=1e3)?(n=0,o=0,r=1e3,l[1]):e<(a=5e3)?(n=1,o=1e3,r=5e3,l[2]):e<(a=1e4)?(n=2,o=5e3,r=1e4,l[3]):e<(a=5e4)?(n=3,o=1e4,r=5e4,l[4]):(n=4,r="0",l[5])),i=Math.min(1,e/a),t.model.set({nextLevel:r,currentLevel:o,vipName:l[n],levelAmounts:a,energyPercent:100*i+"%",ucCardAmounts:s.formatMoney(e)+(e>5e4?"":"/"+s.formatMoney(a))}),e!=t.model.data.energy&&(t.model.set({energy:e}),h.animate(function(n){var s=Math.round(h.step(0,e,n));t.model.set("energyAnimNum",s),t.drawCircle(h.step(0,i,n))},800,"ease-out"))}},getUnreadMsg:function(){var t=this;t.user&&t.user.Auth&&n.post(o.url("/api/user/get_unread_msg_count"),{UserID:t.user.ID,Auth:t.user.Auth},function(e){e.success&&t.model.set("msg_count",e.count)},"json")},doWhenLogin:function(){var t=this,e=m.get();t.model.set({barcode:u.code93(e.Mobile).replace(/0/g,"<em></em>").replace(/1/g,"<i></i>"),isLogin:!0});var i=function(e){m.setParam({IMEI:e?"string"==typeof e?e:e.token:"CAN_NOT_GET"}),t.requestUser()};s.isInApp?o.getDeviceToken(i):i()},onLoad:function(){this.user&&(this.showEnergy(),this.doWhenLogin())},onShow:function(){var t=this;this.setResult("ResetCart"),setTimeout(function(){t.guideSlider&&t.guideSlider._adjustWidth()},0)},onEnter:function(){var t=this;0==t.model.data.tab&&(t.slider&&setTimeout(function(){t.slider._adjustWidth()},400),t.scroll&&t.scroll.get(".js_shop").imageLazyLoad())},onPause:function(){},onQueryChange:function(){this.query.tab&&(this.$(".footer li:nth-child(1)").trigger("tap"),this.model.set({tab:0})),this.model.set({isStart:1==this.query.start})},onDestory:function(){}})});define("template/about",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back=\'{{back}}\'></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="aboutus"> ABS尊重并保护所有使用ABS平台服务用户的个人隐私权。为了给您提供更准确、更有个性化的服务，ABS会按照本隐私权政策的规定使用和披露您的个人信息。但ABS将以高度的勤勉、审慎义务对待这些信息。除本隐私权政策另有规定外，在未征得您事先许可的情况下，ABS不会将这些信息对外披露或向第三方提供。ABS会不时更新本隐私权政策。您在同意ABS服务协议之时，即视为您已经同意本隐私权政策全部内容。本隐私权政策属于ABS服务协议不可分割的一部分。<br><br> <b>1. 适用范围</b><br> a） 在您注册或激活可以登录ABS平台的账户时，您在ABS平台提供的个人注册信息（应法律法规要求需公示的企业名称等相关工商注册信息以及自然人经营者的信息除外）；<br> b） 在您使用ABS平台服务，或访问ABS平台网页时，ABS自动接收并记录的您的浏览器和计算机上的信息，包括但不限于您的IP地址、浏览器的类型、使用的语言、 访问日期和时间、软硬件特征信息及您需求的网页记录等数据；如您下载或使用ABS或其关联公司移动客户端软件，或访问移动网页使用ABS平台服务时，ABS可能会读取与您位置和移动设备相关的信息，包括但不限于设备型号、设备识别码、操作系统、分辨率、电信运营商等。<br> c） ABS通过合法途径从商业伙伴处取得的用户个人数据。<br> 您了解并同意，以下信息不适用本隐私权政策：<br> a）您在使用ABS平台提供的搜索服务时输入的关键字信息；<br> b）ABS收集到的您在ABS进行交易的有关数据，包括但不限于出价、成交信息及评价详情；<br> c）信用评价、违反法律规定或违反ABS规则行为及ABS已对您采取的措施。<br><br> <b>2. 信息使用</b><br> a) ABS不会向任何无关第三方提供、出售、出租、分享或交易您的个人信息，除非事先得到您的许可，或该第三方和ABS单独或共同为您提供服务，且在该服务结束后，其将被禁止访问包括其以前能够访问的所有这些资料。<br > b)ABS亦不允许任何第三方以任何手段收集、编辑、出售或者无偿传播您的个人信息。任何ABS平台用户如从事上述活动，一经发现，ABS有权立即终止与该用户的服务协议。<br> c) 为服务用户的目的，ABS或其关联公司可能通过使用您的个人信息，向您提供您可能感兴趣的信息，包括但不限于向您发出产品和服务信息，或通过系统向您展示个性化的第三方推广信息，或者与ABS合作伙伴共享信息以便他们向您发送有关其产品和服务的信息（后者需要您的事先同意）。<br> d) ABS可以使用您的个人信息以预防、发现、调查欺诈、危害安全、非法或违反与ABS或其关联公司协议、政策或规则的行为，以保护您、其他ABS用户，或ABS或其关联公司合法权益。<br><br> <b>3. 信息存储和交换</b><br> ABS收集的有关您的信息和资料将保存在ABS及（或）其关联公司的服务器上，这些信息和资料可能传送至您所在国家、地区或ABS收集信息和资料所在地的境外并在境外被访问、存储和展示。<br><br> <b>4. Cookie的使用</b><br> a) 在您未拒绝接受cookies的情况下，ABS会在您的计算机上设定或取用cookies，以便您能登录或使用依赖于cookies的ABS平台服务或功能。ABS使用cookies可为您提供更加周到的个性化服务，包括推广服务。<br> b) 您有权选择接受或拒绝接受cookies。您可以通过修改浏览器设置的方式拒绝接受cookies。但如果您选择拒绝接受cookies，则您可能无法登录或使用依赖于cookies的ABS平台服务或功能。<br> c) 通过ABS所设cookies所取得的有关信息，将适用本政策；<br><br> <b>5. 未成年人的特别注意事项</b><br> 如果您不是具备完全民事权利能力和完全民事行为能力的自然人，您无权使用ABS平台服务，因此ABS希望您不要向我们提供任何个人信息。<br><br> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/about",["components","images/style.css","images/append.css"],function(t,e,i){var r=(t("$"),t("util"),t("activity")),o=t("core/model"),a=t("../widget/scroll");t("animation");return r.extend({events:{},swipeRightBackAction:"/settings",onCreate:function(){var e=this.$(".main");a.bind(e),this.model=new o.ViewModel(this.$el,{back:"/settings",title:"隐私政策"})},onShow:function(){},onDestory:function(){}})});define("template/member",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main scrollview"> <div class="member"> <dl class="member_info"> <dt>登录名</dt> <dd> <p>{{user.Mobile}}</p> </dd> <dt>姓名</dt> <dd><input value="{{user.UserName}}" sn-model="user.UserName" /></dd> <dt>性别：</dt> <dd> <span sn-tap="user.Gender=1" value="1" class="radio {{user.Gender==1?\' checked\':\'\'}}">男</span> <span sn-tap="user.Gender=2" value="2" class="radio {{user.Gender==2?\' checked\':\'\'}}">女</span> </dd> <dt>生日</dt> <dd><input type="text" value="{{util.formatDate(user.BirthDay,\'yyyy/MM/dd\')}}" sn-model="user.BirthDay" /></dd> <dt>所在地</dt> <dd sn-tap="this.showCity()"> <p>{{user.City}}</p> </dd> <dt>家庭人数</dt> <dd><input value="{{user.FamilySize}}" sn-model="user.FamilySize" /></dd> <dt>是否有小孩：</dt> <dd> <span sn-tap="user.HasChild=1" value="1" class="radio {{user.HasChild?\'checked\':\'\'}}">是</span> <span sn-tap="user.HasChild=0" value="0" class="radio {{!user.HasChild?\'checked\':\'\'}}">否</span> </dd> <dt>小孩生日</dt> <dd><input type="text" value="{{user.ChildBirthDay}}" sn-model="user.ChildBirthDay" /></dd> </dl> <div class="member_bar"> <b class="btn_mid" sn-tap="this.submit()" class="{{submiting?\'disabled\':\'\'}}">修改</b> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/member",["components","images/style.css","images/append.css"],function(t,e,i){var n=t("$"),s=t("util"),r=t("activity"),o=t("core/model"),l=(t("../widget/scroll"),t("bridge")),c=t("../widget/loading"),d=t("../widget/selector");return r.extend({events:{},onCreate:function(){var t=this;t.swipeRightBackAction=this.route.query.from||"/settings",this.model=new o.ViewModel(this.$el,{title:"个人信息",back:t.swipeRightBackAction}),this.model.showCity=function(){var i=s.indexOf(t.provinceList,function(e){return e.PRV_ID==t.model.data.user.ProvID});-1!=i&&(t.city.eq(0).index(i),e(t.model.data.user.ProvID)),t.city.show()},this.model.submit=function(){this.set("submiting",!0);var e=this.data.user;t.update.setParam({ID:e.ID,Auth:e.Auth,UserName:e.UserName,Gender:e.Gender,BirthDay:e.BirthDay&&s.formatDate(e.BirthDay),ChildBirthDay:e.ChildBirthDay&&s.formatDate(e.ChildBirthDay),CityID:e.CityID,FamilySize:e.FamilySize,HasChild:e.HasChild}).load()},this.update=new c({url:"/api/user/update",check:!1,checkData:!1,$el:this.$el,success:function(e){e.success?(s.store("user",t.model.data.user),sl.tip("修改成功")):sl.tip(e.msg),t.model.set("submiting",!1)}}),this.city=new d({options:[{template:"<li><%=PRV_DESC%></li>",data:[],onChange:function(t,i){e(i.PRV_ID)}},{template:"<li><%=CTY_DESC%></li>",data:[]}],complete:function(e){t.model.set("user.City",e[1].CTY_DESC),t.model.set("user.CityID",e[1].CTY_ID),t.model.set("user.ProvID",e[1].CTY_PRV_ID)}});var e=function(e){var i=s.find(t.cityList,function(t){return t.CTY_PRV_ID==e});if(i.unshift({CTY_PRV_ID:e,CTY_ID:0,CTY_DESC:"请选择"}),t.city.eq(1).set(i),t.model.data.user){var n=s.indexOf(i,function(e){return e.CTY_ID==t.model.data.user.CityID});-1!=n&&t.city.eq(1).index(n)}};n.get(l.url("/api/user/get_city"),function(i){i.province.unshift({PRV_ID:0,PRV_DESC:"请选择"}),t.city.eq(0).set(i.province),t.provinceList=i.province,t.cityList=i.data,e(i.province[0].PRV_ID)},"json")},onShow:function(){var t=this,e=s.store("user");e?(t.user=e,this.loading=new c({url:"/api/user/get",check:!1,checkData:!1,params:{UserID:e.ID,Auth:e.Auth},$el:this.$el,success:function(i){t.user=e=n.extend(e,i.data),s.store("user",e),t.model.set({user:e,"NickName.input":e.NickName,"Address.input":e.Address})}}),this.loading.load()):this.forward("/login")},onDestory:function(){}})});define("template/settings",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <ul class="uc_settings"> <li data-forward="/member">账户信息</li> <li data-forward="/modifypwd">修改密码</li> <li data-forward="/address?from=/settings">收货地址</li> <li data-forward="/about?from=/settings">隐私政策</li> <li sn-click="logout">退出登录</li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/settings",["components","images/style.css","images/append.css"],function(t,e,i){var r=(t("$"),t("util"),t("activity")),a=(t("../widget/loading"),t("core/model")),l=t("../widget/scroll"),d=(t("animation"),t("models/user"));return r.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var t=this,e=this.$(".main");l.bind(e),t.swipeRightBackAction=t.route.query.from||"/";var i=d.get();this.model=new a.ViewModel(this.$el,{back:t.swipeRightBackAction,title:"设置",user:i,logout:function(e){t.confirm("你确认要退出登录?",function(){d.get()?(d.set(null),t.setResult("Logout"),t.back("/")):t.forward("/login")})}})},onShow:function(){},onDestory:function(){}})});define("template/login",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div html="{{title}}" class="head_title"></div> <div class="head_back" data-back="{{back}}"></div> </header> <div class="main"> <div class="login_form"> <h1 class="login_hd">注册/登录</h1> <ul class="form"> <li class="form_mobile"><input placeholder="请输入您的手机号码" sn-model="mobile" type="tel" /></li> <li><input placeholder="请输入短信验证码" sn-model="smsCode" type="tel" /><b class="js_valid btn_middle" html="{{valid}}"></b></li> <li><input placeholder="请输入好友的邀请码" sn-model="invitedCode" type="text" /></li> </ul> <div class="login_btn"><b class="btn_large js_login">手机号登录</b> </div> <div class="login_btn"><a href="/" back>随便逛逛&gt;</a> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/login",["components","images/style.css","images/append.css"],function(e,t,i){var s=(e("$"),e("util")),r=e("activity"),o=e("../widget/loading"),a=e("../core/model"),l=e("../widget/scroll"),d=(e("animation"),e("models/user"));i.exports=r.extend({events:{"tap .js_login:not(.disabled)":function(){var e=this.model.get("mobile"),t=this.model.get("smsCode");return e&&s.validateMobile(e)?t?void this.loading.setParam({mobile:e,smsCode:t,invitedCode:this.model.data.invitedCode,platform:navigator.platform,deviceVersion:(s.ios?"IOS ":"Android ")+s.osVersion,version:sl.appVersion}).load():void sl.tip("请输入密码"):void sl.tip("请输入正确的手机")},"tap .js_valid:not(.disabled)":function(e){var t=this.model.get("mobile");return t&&s.validateMobile(t)?(this.$valid.addClass("disabled"),this.valid.setParam({mobile:this.model.data.mobile}),void this.valid.load()):void sl.tip("请输入正确的手机")}},validTimeout:function(){var e=this,t=localStorage.getItem("valid_time");if(t&&parseInt(t)>60){if(t=Math.round((new Date(parseInt(t)).getTime()-Date.now())/1e3),0>=t)return;e.$valid.addClass("disabled"),setTimeout(function(){0>=t?(e.$valid.removeClass("disabled"),e.model.set("valid","获取验证码"),localStorage.removeItem("valid_time")):(e.model.set("valid",t+"秒后再次获取"),t--,setTimeout(arguments.callee,1e3))},1e3)}},onCreate:function(){var e=this,t=this.$(".main");this.swipeRightBackAction=this.query.from||this.referrer||"/",l.bind(t),this.model=new a.ViewModel(this.$el,{title:"快速登录 / 注册",valid:"获取验证码",back:this.swipeRightBackAction}),this.loading=new o({url:"/api/user/login",method:"POST",check:!1,checkData:!1,$el:this.$el,success:function(t){if(t.success){s.store("ivcode",t.ivcode||null);var i=e.route.query.success||e.swipeRightBackAction;d.set(t.data).request(function(){e.back(i),setTimeout(function(){e.setResult("Login")},0)})}else sl.tip(t.msg)},error:function(e){sl.tip(e.msg)}}),this.valid=new o({url:"/api/user/send_sms",method:"POST",params:{mobile:e.model.data.mobile},check:!1,checkData:!1,$el:this.$el,success:function(t){t.success?(localStorage.setItem("valid_time",Date.now()+6e4),e.validTimeout()):sl.tip(t.msg)},error:function(t){sl.tip(t.msg),e.$valid.removeClass("disabled"),this.hideLoading()}}),e.$valid=this.$(".js_valid"),e.validTimeout()},onDestory:function(){}})});define("template/user/month",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main uc_month"> <div sn-display="{{user.FreeMonths}}"> <div class="uc_month_card"> <div class="uc_month_card_user"> <b>{{currentLevel}}</b> <span>({{ucCardAmounts}})</span> <p> 亲，不要忘记啦！<br /> 您还有<em>{{user.FreeMonths}}</em>个月的会员礼可以领取哟！ </p> </div> <div class="uc_month_val"> <b>我的月礼</b> <span>({{user.FreeMonths}}/{{user.TotalMonths}})</span> </div> </div> <div class="uc_months_slider"> <ul class="uc_month_slider_tit"> <li class="{{year-1==current.Year?\'curr\':\'\'}}">{{year-1}}</li> <li class="{{year==current.Year?\'curr\':\'\'}}">{{year}}</li> <li class="{{(year+1)==current.Year?\'curr\':\'\'}}">{{year+1}}</li> </ul> <div class="uc_month_slider"> </div> </div> </div> <div class="my_nodata" sn-display="{{!user.FreeMonths}}" style="display:none"> <div class="icon"></div> <div class="text">您目前还没有免费领取特权哦！</div> <div class="btn" data-forward="/?tab=1">去逛逛吧</div> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/user/month",["components","images/style.css","images/append.css"],function(e,t,i){var n=e("$"),s=e("util"),r=e("activity"),o=e("widget/loading"),a=e("widget/slider"),l=e("core/model"),c=e("widget/scroll"),u=(e("animation"),e("bridge"));return r.extend({events:{"tap .js_canget":function(e){this.forward("/news/month"+n(e.currentTarget).attr("data-id")+"?from="+encodeURIComponent(this.route.url))}},swipeRightBackAction:"/",onCreate:function(){var e=this;e.user=s.store("user"),this.$main=this.$(".main"),c.bind(this.$main),this.model=new l.ViewModel(this.$el,{title:"我的月礼",back:this.route.query.from||"/",user:e.user,openPresent:function(t,i){if(i.data.CanGet){var n="";e.user.OpenUrl&&(n=e.user.OpenUrl.substr(e.user.OpenUrl.lastIndexOf("?"))),u.openInApp("http://m.abs.cn/free/"+i.data.FRE_ID+".html"+n)}}}),e.$slider=this.$(".uc_month_slider"),this.nextLoading=new o({url:"/api/user/get_month_by_date",$el:n(""),checkData:!1,params:{UserID:e.user.ID,Auth:e.user.Auth},success:function(t){if(console.log(t.data.length),!t.data.length)return sl.tip("没有更多月礼了"),e.model.set({nomore:!0,minDate:!1}),e.slider.shift(),void e.slider.index(0);var i=e.slider._data;i.shift(),i=t.data.concat(i),e.model.set({data:i,minDate:t.minDate,current:i&&i[t.data.length]}),e.slider.set(i),e.slider.index(t.data.length-1)}}),this.loading=new o({url:"/api/user/get_month_free",params:{id:this.route.data.id,UserID:e.user.ID,Auth:e.user.Auth},check:!1,checkData:!1,$el:this.$el,$content:this.$main.children(":first-child"),$scroll:this.$main,success:function(t){e.model.set({currentMonth:t.currentMonth,data:t.data,minDate:t.minDate,current:t.data&&t.data[0],year:t.year}),e.slider=new a({container:e.$slider,itemTemplate:'<%if (FRE_TITLE_PIC=="loading") {%><div class="img"><div class="dataloading" style="opacity:1"></div></div><%}else{%><p class="img<%=CanGet?" canget js_canget":""%><%=Overdue?" disabled":""%><%=FRE_ID&&LPF_PUR_ID?" hasget":""%>" data-id="<%=FRE_ID%>">                                    <img src="<%=FRE_TITLE_PIC||(Overdue?"images/overdue.jpg":"images/coming_soon.png")%>" />                                </p>                                <span><%=Month%>月</span><%}%>',data:t.data,onChange:function(t){e.model.set({current:e.slider._data[t]}),"loading"==e.slider._data[t].FRE_TITLE_PIC&&(e.model.data.nomore?setTimeout(function(){e.slider.index(1)},0):e.nextLoading.load())}}),e.slider.touch.on("end",function(t){e.model.data.minDate&&!e.nextLoading.isLoading&&!this.added&&this.x<-30&&(this.added=!0,"loading"!==e.slider._data[0].FRE_TITLE_PIC&&e.slider.prepend({FRE_TITLE_PIC:"loading"}),e.nextLoading.setParam({startMonth:e.model.data.minDate}),this.canLoad=!0)}).on("end",function(){this.added=!1}).on("stop",function(){this.canLoad&&(this.canLoad=!1,0==e.slider.index()&&(e.model.data.nomore?e.slider.index(1):e.nextLoading.load()))})},error:function(e){sl.tip(e.msg)}}),e.doWhenLogin()},doWhenLogin:function(){var n,r,a,e=this,t=Math.round(this.user.Amount),i=1,l=["银卡会员","金卡会员","钻石会员","VIP会员","SVIP会员","无敌会员"];e.model.set("vip",t<(a=1e3)?(n=0,r=1e3-t,l[1]):t<(a=5e3)?(n=1,r=5e3-t,l[2]):t<(a=1e4)?(n=2,r=1e4-t,l[3]):t<(a=5e4)?(n=3,r=5e4-t,l[4]):(n=4,r="0",l[5])),i=Math.min(1,t/a),e.model.set({energy:t,nextLevel:r,currentLevel:l[n],levelAmounts:a,energyPercent:100*i+"%",ucCardAmounts:s.formatMoney(t)+(t>5e4?"":"/"+s.formatMoney(a))}),e.loading.setParam({UserID:e.user.ID,Auth:e.user.Auth}).load()},onShow:function(){},onDestory:function(){}})});define("template/user/coupon",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main uc_coupon"> <div class="uc_coupon_help" style="font-size:15px;margin-top:15px;" data-forward="/news/coupon?from=/coupon">使用规则</div> <div class="uc_coupon_get"> <input type="text" sn-model="code" placeholder="请输入券码" /> <b class="btn" sn-tap="this.couponApi.load()">我要领券</b> </div> <ul class="uc_coupon_hd"> <li class="{{isOverdue?\'\':\'curr\'}}" sn-tap="isOverdue=false">优惠券</li> <li class="{{isOverdue?\'curr\':\'\'}}" sn-tap="isOverdue=true">免邮卡</li> </ul> <ul class="uc_coupon_list js_not_overdue" sn-display="{{!isOverdue}}"> <li sn-repeat="item in data" class="{{(item.VCA_VCT_ID == 4 ? \'free\' : item.VCA_VCT_ID == 2 ? \'vct2\' : item.VCA_VCT_ID == 5 ? \'vct5\' : \'\') + (item.IsOverdue ? \' dis\' : \'\')}}" sn-tap="this.goTo(item)"> <div class="price">{{util.currency(item.VCA_DEDUCT_AMOUNT,\'\')}}</div> <div class="name">{{item.VCA_VCT_ID==4?\'免邮卡\':item.VCA_NAME}}</div> <div class="time">有效期:{{item.IsOverdue?\'已过期\':(util.formatDate(item.CSV_START_DT,\'yyyy/MM/dd\')+\'-\'+util.formatDate(item.CSV_END_DT,\'yyyy/MM/dd\'))}}</div> <div class="share" sn-tap="this.share(item)"> <i>赠送</i> </div> </li> </ul> <ul class="uc_coupon_list js_overdue" sn-display="{{isOverdue}}"> <li sn-repeat="item in data1" class="{{(item.VCA_VCT_ID == 4 ? \'free\' : item.VCA_VCT_ID == 2 ? \'price10\' : item.VCA_VCT_ID == 1 ? \'price50\' : \'\') + (item.IsOverdue ? \' dis\' : \'\')}}"> <div class="price">{{util.currency(item.VCA_DEDUCT_AMOUNT,\'\')}}</div> <div class="name">{{item.VCA_VCT_ID==4?\'免邮卡\':item.VCA_NAME}}</div> <div class="time">有效期:{{util.formatDate(item.CSV_START_DT,\'yyyy/MM/dd\')}}-{{util.formatDate(item.CSV_END_DT,\'yyyy/MM/dd\')}}</div> <div class="share" sn-tap="this.share(item)"> <i>赠送</i> </div> </li> </ul> <div class="my_nodata" sn-display="{{isOverdue&&!data1.length||!isOverdue&&!data.length}}"> <div class="icon"></div> <div class="text">您目前还没有卡券哦</div> <div class="btn" data-forward="/all?from=/coupon">去逛逛吧</div> </div> </div> <div class="coupon_tip" sn-display="{{showTipStep==2}}"></div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/coupon",["components","images/style.css","images/append.css"],function(e,t,i){var s=(e("$"),e("util")),r=e("activity"),o=e("widget/loading"),a=e("core/model"),l=e("widget/scroll"),u=(e("animation"),e("bridge"),e("models/api")),h=e("components/share"),p=function(e){if(e.length){var t=e.length,i=t-1;e.parent().css({height:100*t}),e.each(function(e,t){t.style.zIndex=e}),setTimeout(function(){var s,t=arguments.callee,n=e.eq(i);n.hasClass("show")?s=0:(n[0].clientHeight,n.addClass("show"),s=300),setTimeout(function(e){return function(){n.animate({opacity:1,translate:"0px,"+100*e+"px"},450*e,"ease-out"),i--,i>=0&&t()}}(i),s)},200)}};return r.extend({events:{"tap .coupon_tip":function(){s.store("showTipStep",3),this.model.set({showTipStep:3})}},swipeRightBackAction:"/",onCreate:function(){var e=this,t=this.$(".main");l.bind(t),e.user=s.store("user"),this.model=new a.ViewModel(this.$el,{back:"/",title:"我的卡券",isOverdue:!1,showTipStep:s.store("showTipStep")}),this.model.goTo=function(t,i){i.LVP_PRD_ID&&e.forward("/item/"+i.LVP_PRD_ID+"?from="+encodeURIComponent(e.route.url))},this.model.couponApi=new u.CouponAPI({$el:this.$el,checkData:!1,beforeSend:function(){var t=e.model.get("code");return t?void this.setParam({csvcode:t}):(sl.tip("请输入券号"),!1)},params:{pspcode:e.user.PSP_CODE},success:function(t){t.success?(sl.tip("领取成功"),e.loading.reload()):sl.tip(t.msg)},error:function(e){sl.tip(e.msg)}}),this.couponStatusApi=new u.CouponStatusAPI({$el:this.$el,checkData:!1,params:{pspcode:e.user.PSP_CODE},success:function(e){console.log(e)},error:function(e){console.log(e)}}),e.share=new h({head:"分享这张优惠券"}),e.share.callback=function(t){t.success?(sl.tip("分享成功"),e.share.hide()):sl.tip(t.msg)},e.share.$el.appendTo(e.$el),this.model.share=function(t,i){e.couponStatusApi.setParam({id:i.CSV_ID,UserID:e.user.ID,Auth:e.user.Auth}).load(function(t,n){if(!t&&n.success){if(n.overdue)return;e.share.set({linkURL:n.url,title:"一言不合就送券！",description:i.VCA_NAME}).show()}else sl.tip(t&&t.msg||n.msg)}),t.stopPropagation()},e.loading=new o({url:"/api/user/voucher_list",params:{status:1},$el:this.$el,check:!1,checkData:!1,success:function(t){if(t.closeNumber&&e.confirm("您有"+t.closeNumber+"张优惠券马上就要过期啦，<br>尽快使用哦",function(){}),t&&t.data&&0!=t.data.length){var i=s.find(t.data,function(e){return 4!=e.VCA_VCT_ID});i.sort(function(e,t){return e.IsOverdue&&!t.IsOverdue?1:!e.IsOverdue&&t.IsOverdue?-1:e.CSV_END_DT>t.CSV_END_DT?1:e.CSV_END_DT==t.CSV_END_DT?0:-1}),e.model.set("data",i);var n=s.find(t.data,function(e){return 4==e.VCA_VCT_ID});n.sort(function(e,t){return e.IsOverdue&&!t.IsOverdue?1:!e.IsOverdue&&t.IsOverdue?-1:e.CSV_END_DT>t.CSV_END_DT?1:e.CSV_END_DT==t.CSV_END_DT?0:-1}),e.model.set("data1",n),e.showItemsWithAnim()}else e.model.set("data",[]),e.model.set("data1",[])}}),e.model.on("change:isOverdue",function(){e.model.data.isOverdue&&e.showItemsWithAnim()})},showItemsWithAnim:function(){var e=this,t=e.$(e.model.data.isOverdue?".js_overdue":".js_not_overdue").children("li");p(t)},onShow:function(){var e=this;e.user=s.store("user"),e.user?e.loading.setParam({UserID:e.user.ID,Auth:e.user.Auth}).load():e.forward("/login?success="+this.route.url+"&from=/")},onDestory:function(){}})});define("template/user/couponshare",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<div class="main co_share" style="top:0"> <div class="co_share_con"> <div class="say"> <p class="img"><img src="" alt=""><em>{{user.PSP_NAME||user.PSP_CODE}}</em></p> <p class="cont">我把在ABS家居领到的优惠券送给你~赶快来领取吧！</p> </div> <div class="letter"> <div class="closed"></div> <i class="logo"></i> </div> <div class="btn get" sn-tap="this.getCoupon()">马上领取</div> <div class="steps"> <p>立即领券</p> <i></i> <p>下单购买</p> <i></i> <p>结算选券</p> <i></i> <p>商品到家</p> </div> </div> <div class="co_share_user"> <div class="hd"></div> <div class="con"> 1.优惠券可在ABS家居官方APP“我的卡券”中查看。（购物-去结算-选择优惠券-点击购买） <br> 2.请在优惠券有效期内及时兑换，逾期作废。 <br> *本活动最终解释权归上海爱彼此家居用品股份有限公司所有。 </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/couponshare",["components","images/style.css","images/append.css"],function(e,t,i){var s=(e("$"),e("util")),r=e("activity"),a=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),d=(e("animation"),e("models/api"));i.exports=r.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this,t=e.$(".main");e.swipeRightBackAction=void 0,l.bind(t),e.model=new a.ViewModel(this.$el,{}),e.model.getCoupon=function(t){e.user?i.setParam({UserID:e.user.ID,Auth:e.user.Auth}).load():e.forward("/login?success="+encodeURIComponent(e.route.url)+"&from="+encodeURIComponent(e.route.url))};var i=new d.GetSharedCouponAPI({$el:e.$el,params:{data:e.route.query.code},checkData:!1,success:function(e){sl.tip("恭喜您获得一张优惠券")},error:function(e){sl.tip(e.msg)}}),n=new d.CouponUserAPI({$el:e.$(".co_share_user .list"),params:{data:e.route.query.code},checkData:!1,success:function(t){console.log(t),e.model.set({users:t.data,user:t.user})}});n.load()},onShow:function(){var e=this;e.user=s.store("user")},onDestory:function(){}})});define("template/user/address",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main uc_address"> <div class="uc_address_new js_add_address">添加新地址</div> <ul class="uc_address_con" ref="addressList"> <li sn-repeat="item in data" class="{{item.MBA_DEFAULT_FLAG?\'default\':\'\'}}{{item.AddressID==addressId?\' curr\':\'\'}}" sn-tap="this.forward(item.AddressID)"> <div class="uc_addresslist__listitem_con js_delete_item"> <p class="hd"><span class="name">{{item.MBA_NAME}}</span><span class="mobi">{{item.MBA_MOBILE}}</span></p> <p class="con">{{item.Province}}{{item.City}}{{item.Area}}{{item.MBA_FULL_ADDRESS}}</p> </div> <i class="js_delete" data-id="{{item.AddressID}}"></i> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/address",["components","images/style.css","images/append.css"],function(e,t,i){var n=e("$"),s=e("util"),r=e("activity"),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),d=(e("animation"),e("models/api")),u=e("components/deletion");i.exports=r.extend({events:{"tap .js_bind:not(.disabled)":function(){},"tap .js_add_address":function(){this.forward("/addaddress?from="+encodeURIComponent(this.route.url)+"&buy="+(this.route.query.buy||""))}},onCreate:function(){var e=this,t=e.$(".main");e.user=s.store("user"),e.swipeRightBackAction=e.route.query.from||"/",l.bind(t),e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"收货地址"}),e.model.forward=function(t,i){var n=s.first(e.model.get("data"),function(e){return e.AddressID==i});s.store("address",n),e.forward("/addaddress?edittype=2&from="+encodeURIComponent(e.route.url)+"&id="+i+"&buy="+(e.route.query.buy||""))},e.address=new d.AddressListAPI({$el:this.$el,params:{pspcode:e.user.PSP_CODE},success:function(t){t.data.sort(function(e,t){return e.AddressID>t.AddressID?1:e.AddressID<t.AddressID?-1:0}),console.log(t.data),e.model.set({data:t.data})}}),e.deleteAddressApi=new d.DeleteAddressAPI({$el:this.$el,params:{pspcode:e.user.PSP_CODE},checkData:!1,success:function(t){var i=this.params.mbaId;e.model.getModel("data").remove(function(e){return i==e.AddressID})},error:function(e){sl.tip(e.msg)}}),new u({el:e.model.refs.addressList,children:".js_delete_item",width:70,events:{".js_delete":function(t){var i=n(t.currentTarget),s=i.data("id");console.log(s),e.deleteAddressApi.setParam({mbaId:s}).load()}}})},onShow:function(){var e=this;e.address.load()},onDestory:function(){}})});define("template/user/addaddress",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main uc_addaddress"> <ul> <li> <input type="text" placeholder="收货人姓名" sn-model="address.mbaName" value="{{address.mbaName}}" /> </li> <li> <input type="tel" placeholder="手机号码" sn-model="address.mbaMobile" value="{{address.mbaMobile}}" /> </li> <li> <input type="tel" placeholder="邮政编码" sn-model="address.mbaZip" /> </li> <li class="js_area">{{province.PRV_ABBR||\'省\'}}、{{city.CTY_ABBR||\'市\'}}、{{region.REG_DESC||\'区\'}}</li> <li> <input type="text" placeholder="详细地址" sn-model="address.mbaAddress" value="{{address.mbaAddress}}"> </li> <li class="set_default{{address.mbaDefault?\' checked\':\'\'}}" sn-tap="address.mbaDefault=!address.mbaDefault">设为默认地址</li> </ul> </div> <b class="uc_addaddress_btn js_submit">确&nbsp;&nbsp;定</b>';return __},helpers:{}});return T.template=T.html,T});define("views/user/addaddress",["components","images/style.css","images/append.css"],function(e,t,i){var s=(e("$"),e("util")),r=e("activity"),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),c=e("widget/selector"),u=(e("animation"),e("models/api"));i.exports=r.extend({events:{"tap .js_submit:not(.disabled)":function(){this.editAddressAPI.load()},"tap .js_area":function(){var e=this;this.selector.show(),e.model.data.province&&(e.selector.eq(0).index(s.indexOf(e.provinceData,function(t){return t.PRV_ID==e.model.data.province.PRV_ID})),e.resetCity())}},onCreate:function(){var e=this,t=e.$(".main");e.user=s.store("user"),e.swipeRightBackAction=e.route.query.from||"/address",l.bind(t);var i=e.route.query.id;if(e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:i?"设置地址":"添加地址",address:{mbaDefault:!0,mbaMobile:e.user.Mobile},user:e.user}),i){var n=s.store("address");n&&e.model.set({address:{mbaMobile:n.MBA_MOBILE,mbaName:n.MBA_NAME,mbaAddress:n.MBA_ADDRESS,mbaDefault:n.MBA_DEFAULT_FLAG},province:{PRV_ID:n.ProvinceID,PRV_ABBR:n.Province},city:{CTY_ID:n.MBA_CTY_ID,CTY_ABBR:n.City},region:{REG_ID:n.MBA_REG_ID,REG_DESC:n.Area}})}e.selector=new c({options:[{template:"<li><%=PRV_ABBR%></li>",onChange:function(t,i){e.city.setParam({prvId:i.PRV_ID||0}).load()}},{template:"<li><%=CTY_ABBR%></li>",onChange:function(t,i){e.region.setParam({ctyId:i.CTY_ID||0}).load()}},{template:"<li><%=REG_DESC%></li>"}],complete:function(t){e.model.set({province:t[0],city:t[1],region:t[2]})}}),e.selector.eq(0).set([{PRV_ABBR:"省"}]),e.selector.eq(1).set([{CTY_ABBR:"市"}]),e.selector.eq(2).set([{REG_DESC:"区"}]),this.province=new u.ProvinceAPI({$el:e.selector.$el,success:function(t){e.provinceData=t.data,t.data.unshift({PRV_ABBR:"省"}),e.selector.eq(0).set(t.data)}}),this.city=new u.CityAPI({$el:e.selector.$el,checkData:!1,success:function(t){e.cityData=t.data,t.data.unshift({CTY_ABBR:"市"}),e.selector.eq(1).set(e.cityData),e.resetCity()}}),this.region=new u.RegionAPI({$el:e.selector.$el,checkData:!1,success:function(t){e.regionData=t.data,e.regionData.unshift({REG_DESC:"区"}),e.selector.eq(2).set(e.regionData),e.resetRegion()}}),this.province.load(),e.editAddressAPI=new u.EditAddressAPI({$el:e.$el,check:!1,checkData:!1,params:{pspcode:e.user.PSP_CODE},beforeSend:function(){var t=e.model.get("address");if(!t.mbaName)return sl.tip("请填写收货人姓名"),!1;if(!t.mbaMobile)return sl.tip("请填写手机号码"),!1;if(!s.validateMobile(t.mbaMobile))return sl.tip("请填写正确的手机号码"),!1;if(!t.mbaAddress)return sl.tip("请填写详细地址"),!1;var i=e.model.get("region");return i&&i.REG_ID?(t.mbaRegId=i.REG_ID,t.mbaCtyId=e.model.get("city.CTY_ID"),t.edittype=e.route.query.edittype||1,t.mbaId=e.route.query.id||0,void this.setParam(t)):(sl.tip("请选择省市区"),!1)},success:function(t){if(t.success)sl.tip("设置成功！");else if(t.msg)return void sl.tip(t.msg);if(e.route.query.buy){var i=e.model.get("address");e.setResult("useAddress",{AddressID:i.mbaId||t.data,MBA_CTY_ID:i.mbaCtyId,MBA_REG_ID:i.mbaRegId,MBA_NAME:i.mbaName,MBA_FULL_ADDRESS:i.mbaAddress,MBA_MOBILE:i.mbaMobile})}e.back(e.route.query.buy?decodeURIComponent(e.route.query.from.match(/from=([^&]+?)(&|$)/)[1]):e.swipeRightBackAction)}})},resetCity:function(){var e=this;if(e.model.data.city){var t=s.indexOf(this.selector.eq(1).data,function(t){return t.CTY_ID==e.model.data.city.CTY_ID});-1!=t&&this.selector.eq(1).index(t),e.resetRegion()}},resetRegion:function(){var e=this;if(e.model.data.region){var t=s.indexOf(this.selector.eq(2).data,function(t){return t.REG_ID==e.model.data.region.REG_ID});-1!=t&&this.selector.eq(2).index(t)}},onShow:function(){},onDestory:function(){}})});define("template/user/modifypwd",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="uc_pwd"> <dl class="uc_pwd_con"> <dt>原密码</dt> <dd> <input type="password" placeholder="请输入您的密码"> </dd> <dt>新密码</dt> <dd> <input type="password" placeholder="请输入您的新密码"> </dd> <dt>确认密码</dt> <dd> <input type="password" placeholder="请再次输入您的新密码"> </dd> </dl> <div class="action"><b class="btn">确&nbsp;认</b></div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/modifypwd",["components","images/style.css","images/append.css"],function(e,t,i){var r=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll");e("animation");i.exports=r.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this,t=e.$(".main");e.swipeRightBackAction=e.route.query.from||"/settings",l.bind(t),e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"修改密码"})},onShow:function(){},onDestory:function(){}})});define("template/messages",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main message_center"> <div class="message_card" sn-repeat="item in data"> <div class="hd"> <h2>{{item.MSG_TITLE}}</h2> <h3>{{util.formatDate(item.LPM_START_DT,\'yyyy.MM.dd\')}}</h3> </div> <div class="{{item.MSG_CONTENT.indexOf(\'<img\')!=-1?\' img\':\'bd\'}}" sn-html="item.MSG_CONTENT"></div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/messages",["components","images/style.css","images/append.css"],function(e,t,i){var s=(e("$"),e("util")),r=e("activity"),a=e("../widget/loading"),o=e("../core/model"),l=e("../widget/scroll");e("animation");return r.extend({events:{},onCreate:function(){var e=this,t=this.$(".main");l.bind(t,{refresh:function(t,i){e.loading.isShowLoading=!1,e.loading.reload(function(){e.loading.isShowLoading=!0,t()})}}),this.model=new o.ViewModel(this.$el,{back:"/",title:"消息中心"}),this.loading=new a({url:"/api/user/get_msg",$el:this.$el,checkData:!1,success:function(t){t.data||this.showError("暂无消息"),e.model.set("data",t.data)},append:function(t){e.model.getModel("data").add(t.data)}})},onShow:function(){var e=this;e.user=s.store("user"),e.user?e.loading.setParam({UserID:e.user.ID,Auth:e.user.Auth}).load():e.forward("/login?success="+this.route.url+"&from=/")},onDestory:function(){}})});define("template/mypoint",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div html="{{title}}" class="head_title"></div> </header> <div class="main mypoint"> <div sn-display="{{points}}"> <div class="curr">当前积分：<b sn-html="{{Math.round(points)}}"></b></div> <div class="notice">*您的积分可以直接抵扣现金使用。<span>（100积分＝1元）</span></div> <div class="hd">积分记录</div> <ul class="mypoint_list"> <li sn-repeat="item in data"> <p class="from" sn-html="{{item.HPT_PIT_ID==1?item.CNL_DESC:item.POT_DESC}}"></p> <p class="date" sn-html="{{util.formatDate(item.HPT_DT,\'yyyy.MM.dd\')}}"></p> <p class="points" sn-html="{{item.HPT_POINT_AMOUNT>0?\'+\'+Math.round(item.HPT_POINT_AMOUNT):Math.round(item.HPT_POINT_AMOUNT)}}" class="{{item.HPT_POINT_AMOUNT<0?\'minus\':\'\'}}"></p> </li> </ul> </div> <div class="my_nodata" sn-display="{{points==0}}" style="display:none"> <div class="icon"></div> <div class="text">您目前还没有积分记录哦</div> <div class="btn" data-forward="/?tab=1">去逛逛吧</div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/mypoint",["components","images/style.css","images/append.css"],function(e,t,i){var s=(e("$"),e("util")),r=e("activity"),a=e("../widget/loading"),o=e("../core/model"),l=e("../widget/scroll"),d=(e("animation"),e("bridge"));return r.extend({events:{},swipeRightBackAction:"/",onCreate:function(){var e=this,t=this.$(".main");l.bind(t),this.model=new o.ViewModel(this.$el,{back:"/",title:"我的积分",open:function(){d.openInApp(e.user.OpenUrl||"http://m.abs.cn")}})},onShow:function(){var e=this,e=this,t=s.store("user");t?(e.user=t,this.loading=new a({url:"/api/user/get_points",check:!1,params:{UserID:t.ID,Auth:t.Auth},$el:this.$el,success:function(t){e.model.set(t)}}),this.loading.load()):this.forward("/login")},onDestory:function(){}})});define("template/myorder",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back="{{back}}"></div> <div sn-html="{{title}}" class="head_title"></div> </header> <ul class="myorder_hd" sn-display="{{currentType!=0||data.length}}"> <li class="curr" sn-tap="this.select(0)">全部</li> <li sn-tap="this.select(1)">待付款</li> <li sn-tap="this.select(2)">待发货</li> <li sn-tap="this.select(3)">配送中</li> <li sn-tap="this.select(4)">已完成</li> </ul> <div class="main myorder"> <ul class="con" sn-display="{{data.length}}"> <li sn-repeat="item in data" class="type{{item.CNL_CLT_ID}}" sn-tap="this.openOrder(item)"> <div class="hd" data-id="{{item.PUS_ID}}"><b class="from" sn-html="item.CNL_DESC"></b><span class="status" sn-html="item.PUS_DESC"></span></div> <div class="info" sn-tap="this.openOrder(item)"> <span>订单号：{{item.PUR_CODE}}</span> <span>{{util.formatDate(item.PUR_DT)}}</span> </div> <div class="bd" sn-repeat="prd in item.Children" sn-tap="this.openPrd(prd,item)"> <img sn-src="{{prd.WPP_LIST_PIC||\'images/default.jpg\'}}" src="images/default.jpg" onerror="this.src=\'images/default.jpg\'" /> <div class="con"> <h2>{{prd.PRD_NAME}}</h2> <h3>颜色：<span>{{prd.PRD_COLOR}}</span></h3> <h4>尺寸：<span>{{prd.PRD_SPEC}}</span></h4> </div> <p class="priceinfo"> <span class="price">{{util.currency(prd.LPK_CHANNEL_PRICE,\'￥\')}}</span> <span class="qty">x{{prd.LPK_QTY}}</span> </p> </div> <div class="ft"> 总价：<span>{{util.currency(item.PUR_AMOUNT+item.PUR_EXP_IN_AMOUNT,\'￥\')}}</span> <b class="btn_sml" sn-display="{{item.XPU_EXPRESS_CODE}}" sn-tap="this.showExpress(item,model)">查看物流</b> <b class="btn_sml" sn-display="{{item.PUR_PAS_ID==2&&item.isShowShare}}" data-forward="/news/order{{item.PUR_ID}}?from={{url}}">分享有惊喜</b> <b class="btn_sml" sn-display="{{item.PUS_DESC==\'待付款\'}}">立即付款</b> <b class="btn_sml btn_dark" sn-display="{{item.PUS_DESC==\'待付款\'||(item.PUR_PUS_ID==1&&(item.PUR_AMOUNT+item.PUR_EXP_IN_AMOUNT)==0&&item.PUR_PAS_ID==2)}}" sn-tap="false" sn-click="this.cancelOrder(item)">取消订单</b> </div> <div class="express" sn-display="item.showExpress" style="display:none"> <div class="express_con"> <p>物流公司：<span>{{item.EXP_NAME}}</span></p> <p>运单号码：<span>{{item.XPU_EXPRESS_CODE}}</span></p> </div> <dl class="express_list"> <dd sn-repeat="express in item.express"> <p>{{util.formatDate(express.EXP_DT)}}</p> <p>{{express.EXP_STATE_DETAIL}}</p> </dd> </dl> </div> </li> </ul> <div class="my_nodata" sn-display="{{currentType==0&&!data.length&&!isLoading}}" style="display:none"> <div class="icon"></div> <div class="text">您目前还没有购物记录哦</div> <div class="btn" data-forward="/all">去逛逛吧</div> </div> <div class="my_nodata" sn-display="{{currentType!=0&&!data.length}}" style="display:none"> <div class="icon"></div> <div class="text">您还没有相关的订单</div> <div class="btn" data-forward="/all">去逛逛吧</div> </div> </div> <div class="open_msg" style="display:none"> <div class="msg_bd msg_alert"> 这款产品已经售罄喽 <div class="btn_go">随便逛逛</div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/myorder",["components","images/style.css","images/append.css"],function(e,t,i){var n=e("$"),s=e("util"),r=e("activity"),a=e("../widget/loading"),o=e("core/model"),l=e("../widget/scroll"),d=(e("animation"),e("bridge")),u=e("models/api");return r.extend({events:{"tap .open_msg":function(e){n(e.target).hasClass("open_msg")&&n(e.target).removeClass("show")},"tap .btn_go":function(){self.back("/all")}},swipeRightBackAction:"/",onCreate:function(){var e=this,t=this.$(".main");e.user=s.store("user"),l.bind(t),this.model=new o.ViewModel(this.$el,{back:"/",url:encodeURIComponent(this.route.url),title:"我买到的",currentType:0,isLoading:!0}),this.wxPayApi=new u.WxPayAPI({$el:e.$el,success:function(e){console.log(e),d.open(e.url)}});var i=new u.ExpressAPI({$el:e.$el,success:function(e){},error:function(){}});n.extend(this.model,{select:function(t,i){n(t.currentTarget).hasClass("curr")||(n(t.currentTarget).addClass("curr").siblings(".curr").removeClass("curr"),e.loading.setParam(0==i?{status:0,payStatus:0}:1==i?{status:0,payStatus:3}:2==i?{status:18,payStatus:0}:3==i?{status:19,payStatus:0}:{status:8,payStatus:0}).reload(),this.set("currentType",i))},showExpress:function(t,n,s){s.set("showExpress",!n.showExpress),t.stopPropagation(),n.express||(s.set("express",[]),i.setParam({pur_code:n.PUR_CODE,pspcode:e.user.PSP_CODE}).load(function(e,t){t&&t.success&&s.set("express",t.data)}))},openOrder:function(t,i){n(t.target).hasClass("btn_sml")&&"立即付款"!=n(t.target).html()||(e.forward("/order/"+i.PUR_ID),t.stopPropagation())},cancelOrder:function(t,i){e.confirm("你确定取消订单吗？",function(){e.cancelOrderApi.setParam({purcode:i.PUR_CODE}).load()}),t.stopPropagation(),t.preventDefault()},openPrd:function(t,i,n){t.stopPropagation(),"待付款"!=n.PUS_DESC||"IMG"==t.target.tagName?i.PRD_DISCONTINUED_FLAG?(e.$open_msg.show(),e.$open_msg[0].clientHeight,e.$open_msg.addClass("show")):i.Url&&e.forward("/item/"+i.PRD_ID+"?from="+encodeURIComponent(e.route.url)):this.openOrder(t,n)}}),e.$open_msg=this.$(".open_msg").on(n.fx.transitionEnd,function(t){e.$open_msg.hasClass("show")||e.$open_msg.hide()}),e.loading=new a({url:"/api/order/list",$el:this.$el,checkData:!1,success:function(t){e.model.set({isLoading:!1,data:t.data})},append:function(t){e.model.getModel("data").add(t.data)}}),e.loading.setParam({UserID:e.user.ID,Auth:e.user.Auth}).load(),e.onResult("OrderChange",function(){e.loading.reload()}),e.cancelOrderApi=new u.CancelOrderAPI({$el:this.$el,checkData:!1,params:{pspcode:e.user.PSP_CODE},success:function(t){t.success&&(sl.tip("订单已成功取消"),e.loading.reload(),e.setResult("UserChange"))},error:function(e){sl.tip(e.msg)}})},onShow:function(){},onDestory:function(){var e=this;e.timer&&clearTimeout(e.timer)}})});define("template/order",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="sp_buy uc_order__wrap"> <div class="sp_buy_hd js_address"> <div class="info"><span class="name">{{data.ORA_NAME}}</span><span class="mobi">{{data.ORA_MOBILE}}</span></div> <div class="loc">{{data.CTY_DESC}}{{data.REG_DESC}}{{data.ORA_ADDRESS}}</div> </div> <div class="sp_buy_bd uc_order__prodlist"> <div class="hd">商品信息</div> <div class="uc_order__prod_listitem" sn-repeat="prd in data.Children" data-forward="/item/{{prd.PRD_ID}}"> <img sn-src="{{prd.WPP_LIST_PIC||\'images/default.jpg\'}}" src="images/default.jpg" onerror="this.src=\'images/default.jpg\'" /> <div class="con"> <h2>{{prd.PRD_NAME}}</h2> <h3>颜色：<span>{{prd.PRD_COLOR}}</span></h3> <h4>尺寸：<span>{{prd.PRD_SPEC}}</span></h4> </div> <p class="priceinfo"> <span class="price">{{util.currency(prd.LPK_CHANNEL_PRICE,\'￥\')}}</span> <span class="qty">x{{prd.LPK_QTY}}</span> </p> </div> </div> <div class="sp_buy_bd sp_buy_bill"> <div class="hd">订单信息</div> <ul> <li><span>订单号</span><em>{{data.PUR_CODE}}</em></li> <li><span>订单状态</span><em>{{data.PUS_DESC}}</em></li> <li><span>下单日期</span><em>{{util.formatDate(data.PUR_DT)}}</em></li> <li><span>订单金额</span><em>{{util.currency(data.PUR_AMOUNT,\'￥\')}}</em></li> <li><span>运费</span><em>{{util.currency(data.PUR_EXP_IN_AMOUNT,\'￥\')}}</em></li> <li><span>总计</span><b>{{util.currency(data.PUR_AMOUNT+data.PUR_EXP_IN_AMOUNT,\'￥\')}}</b></li> </ul> </div> <div class="sp_buy_bd sp_buy_pay" sn-display="{{data.PUS_DESC==\'待付款\'}}"> <div class="hd">支付方式</div> <ul> <li class="ico_alipay{{payType==1?\' checked\':\'\'}}" sn-tap="payType=1">支付宝支付</li> <li class="ico_wxpay{{payType==2?\' checked\':\'\'}}" sn-tap="payType=2">微信支付</li> </ul> </div> </div> </div> <footer class="sp_buy_action uc_order__footer"> <div class="total"> <div sn-display="{{data.PUS_DESC==\'待付款\'}}">总计：<b>{{util.currency(data.PUR_AMOUNT+data.PUR_EXP_IN_AMOUNT,\'￥\')}}</b></div> </div> <div class="btn js_pay" sn-display="{{data.PUS_DESC==\'待付款\'}}">立即支付</div> <b class="btn" sn-display="{{data.XPU_EXPRESS_CODE}}" data-forward="/user/express/{{data.PUR_CODE}}">查看物流</b> <b class="btn" sn-display="{{data.PUR_PAS_ID==2&&data.isShowShare}}" data-forward="/news/order{{data.PUR_ID}}?from={{url}}">分享有惊喜</b> <b class="btn btn_dark" sn-display="{{data.PUS_DESC==\'待付款\'||(data.PUR_PUS_ID==1&&(data.PUR_AMOUNT+data.PUR_EXP_IN_AMOUNT)==0&&data.PUR_PAS_ID==2)}}" sn-tap="false" sn-click="this.cancelOrder(data)">取消订单</b> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/order",["components","images/style.css","images/append.css"],function(e,t,i){var r=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),d=(e("animation"),e("models/api")),u=e("models/user"),h=e("bridge");i.exports=r.extend({events:{"tap .js_pay:not(.disabled)":function(){var e=this,t=this.model.get("data");e.orderApi.showLoading(),setTimeout(function(){e.orderApi.hideLoading()},3e3),e.checkStatus(),1==this.model.get("payType")?h.ali({type:"pay",spUrl:d.API.prototype.baseUri+"/AlipayApp/Pay",orderCode:t.PUR_CODE},function(t){sl.tip(t.msg),e.orderApi.hideLoading()}):h.wx({type:"pay",spUrl:d.API.prototype.baseUri+"/api/shop/wxcreateorder",orderCode:t.PUR_CODE,orderName:"ABS商品",orderPrice:t.PUR_AMOUNT},function(t){sl.tip(t.msg),e.orderApi.hideLoading()})}},onCreate:function(){var e=this,t=e.$(".main");e.user=u.get(),e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",l.bind(t),e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"订单详情",payType:1}),e.model.cancelOrder=function(t,i){e.confirm("你确定取消订单吗？",function(){e.cancelOrderApi.setParam({purcode:i.PUR_CODE}).load()}),t.stopPropagation(),t.preventDefault()},console.log(e.referrer),e.orderApi=new d.OrderAPI({$el:e.$el,params:{orderId:e.route.data.id,UserID:e.user.ID,Auth:e.user.Auth},success:function(t){console.log(t),e.model.set({data:t.data}),"/myorder"!=e.referrer&&2==t.data.PUR_PAS_ID&&e.forward("/news/order"+e.route.data.id)}}),e.orderApi.load(),e.orderStatusAPI=new d.OrderStatusAPI({$el:this.$el,check:!1,checkData:!1,success:function(t){2!=t.status?e.timer=setTimeout(function(){e.checkStatus()},2e3):2==t.status&&(e.forward("/news/order"+e.route.data.id),e.model.set("data.PUR_PAS_ID",2))}}),e.cancelOrderApi=new d.CancelOrderAPI({$el:this.$el,checkData:!1,params:{pspcode:e.user.PSP_CODE},success:function(t){t.success&&(sl.tip("订单已成功取消"),e.orderApi.reload(),e.setResult("UserChange"))},error:function(e){sl.tip(e.msg)}}),e.route.query.refresh&&e.checkStatus()},checkStatus:function(){var e=this;e.timer&&clearTimeout(e.timer),e.orderStatusAPI.setParam({id:e.route.data.id}).load()},onShow:function(){},onDestory:function(){self.timer&&clearTimeout(self.timer)}})});define("template/news",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header>';return __},helpers:{}});return T.template=T.html,T});define("views/news",["components","images/style.css","images/append.css"],function(e,t,i){var n=e("$"),a=(e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),d=(e("animation"),e("components/shareOrder")),u=e("components/month"),h=e("components/activity"),p=e("components/fastbuy"),f=e("components/package"),m=e("components/banner"),v=e("models/api");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this;e.swipeRightBackAction=e.route.query.from||"/";var t=e.route.data.id,i=/(order|month|activity|package|fastbuy|banner|coupon){0,1}(\d*)/.exec(t),s=i[1];t=i[2],e.model=new o.ViewModel(this.$el,{url:encodeURIComponent(e.route.url),back:e.swipeRightBackAction});var r,a="";switch(s){case"order":a="支付成功",r=new d({id:t}),r.$el.appendTo(e.$el);break;case"month":a="会员礼领取",r=new u({id:t}),r.$el.appendTo(e.$el);break;case"fastbuy":a="周一闪购",r=new p,r.$el.appendTo(e.$el);break;case"activity":a=2==t?"最热商品":"APP专享",r=new h({id:t}),r.$el.appendTo(e.$el);break;case"package":a="套餐",r=new f({id:t}),r.$el.appendTo(e.$el);break;case"banner":a="纳米美容巾免费领",r=new m({id:t}),r.$el.appendTo(e.$el);break;case"coupon":a="优惠券规则",e.$el.append('<div class="main" style="padding:20px;background:#fff;"> Q：如何使用优惠券？<br/> A：您可以在订单结算页面通过“使用优惠券”选项使用一张符合使用条件的优惠券，抵扣相应的金额。<br/> <br/> Q：什么是券码？<br/> A：用户可以通过ABS其他合作渠道获取兑换券码，兑换码可以在"我的优惠券”页兑换优惠券，抵扣相应金额。<br/> <br/> Q：优惠券的使用有什么其他限制吗？<br/> A：优惠券的使用时限、抵用限额及其他限制条件请详见优惠券上的文字描述。<br/><br/> Q：申请退款时优惠券如何结算？<br/> A：使用优惠券订单，如非质量问题，不支持退货退款。<br/> 如因商品质量问题需要退货，所使用优惠券均不予返还。<br/> </div>');break;default:a="ABS家居";var c=n('<div class="main"></div>').appendTo(e.$el),g=new v.NewsAPI({$el:e.$el,params:{id:t},success:function(t){if(t.success)if(1==t.edmtype){var s=e.createIFrame(c);s.$el.css({width:window.innerWidth,height:c[0].offsetHeight}),s.html("<style>body,html{background:#fff}</style>"+t.data.edm_html)}else{var a=n('<div sn-repeat="list in data"> <div class="banner" sn-if="{{list.type==1}}"> <a sn-repeat="pic in list.data" href="{{pic.EDD_URL||\'javascript:;\'}}"><img sn-src="{{list.type==1?pic.EDD_PIC:\'\'}}"  /></a> </div> <ul class="sp_list" style="overflow:hidden;margin-top:0" sn-if="{{list.type==2}}"> <li sn-repeat="item in list.data" class="sp_list_item" data-forward="/item/{{item.PRD_OBJ.PRD_ID}}?from={{url}}" sn-index="0"> <img src="{{item.PRD_OBJ.WPP_LIST_PIC}}"> <p class="price"><b>￥{{item.PRD_OBJ.PRD_PRICE}}</b><del sn-display="{{item.PRD_OBJ.PRD_PRICE!=0&&item.PRD_OBJ.PRD_PRICE<item.PRD_OBJ.PRD_MEMBER_PRICE}}" style="display: none;">￥{{item.PRD_OBJ.PRD_MEMBER_PRICE}}&nbsp;</del></p> <p class="name">{{item.PRD_OBJ.PRD_NAME}}</p> </li> </ul> </div>');a.appendTo(c),e.model.bind(a).set({data:t.data})}else sl.tip(t.msg)},error:function(e){sl.tip(e)}});g.load()}r&&(r.view=e),l.bind(e.$(".main")),e.model.set({type:s,title:a})},onShow:function(){},onDestory:function(){}})});define("template/register",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div sn-binding="html:title" class="head_title"></div> <div class="head_back" sn-binding="data-back:back"></div> </header> <div class="main"> <div class="login_form"> <ul class="form"> <li><input placeholder="输入手机号" sn-model="mobile" /></li> <li><input placeholder="验证码" sn-model="smsCode" type="text" /> <b class="js_valid btn_middle" sn-binding="html:valid"></b></li> <li><input placeholder="设置密码" sn-model="password" type="password" /></li> <li><input placeholder="再次输入确认密码" sn-model="password1" type="password" /></li> </ul> <div class="login_btn"><b class="btn_large js_bind">确定注册</b> </div> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/register",["components","images/style.css","images/append.css"],function(e,t,i){var s=(e("$"),e("util")),a=e("activity"),r=e("../widget/loading"),o=e("../core/model"),l=e("../widget/scroll"),d=(e("animation"),e("util/md5"));return a.extend({events:{"tap .js_bind:not(.disabled)":function(){var e=this.model.data.mobile,t=this.model.data.password,i=this.model.data.password1,n=this.model.data.smsCode;return e&&s.validateMobile(e)?t!=i?void sl.tip("两次密码输入不一致"):n?void this.loading.setParam({mobile:e,password:d.md5(t),smsCode:n}).load():void sl.tip("请输入验证码"):void sl.tip("请输入正确的手机")},"tap .js_valid:not(.disabled)":function(e){var t=this.model.get("mobile");return t&&s.validateMobile(t)?(this.$valid.addClass("disabled"),this.valid.setParam({mobile:this.model.data.mobile}),void this.valid.load()):void sl.tip("请输入正确的手机")}},validTimeout:function(){var e=this,t=localStorage.getItem("valid_time");if(t&&parseInt(t)>60){if(t=Math.round((new Date(parseInt(t)).getTime()-Date.now())/1e3),0>=t)return;e.$valid.addClass("disabled"),setTimeout(function(){0>=t?(e.$valid.removeClass("disabled"),e.model.set("valid","获取验证码"),localStorage.removeItem("valid_time")):(e.model.set("valid",t+"秒"),t--,setTimeout(arguments.callee,1e3))},1e3)}},onCreate:function(){var e=this,t=this.$(".main");l.bind(t),this.model=new o.ViewModel(this.$el,{title:"注册",valid:"获取验证码",back:this.route.query.from||"/login"}),this.loading=new r({url:"/api/user/register",method:"POST",check:!1,checkData:!1,$el:this.$el,success:function(t){t.success?(localStorage.setItem("user",JSON.stringify(t.data)),e.back(e.route.query.success||"/")):sl.tip(t.msg)},error:function(e){sl.tip(e.msg)}}),this.valid=new r({url:"/api/user/send_sms",method:"POST",params:{mobile:e.model.data.mobile},check:!1,checkData:!1,$el:this.$el,success:function(t){t.success?(localStorage.setItem("valid_time",Date.now()+6e4),e.validTimeout()):sl.tip(t.msg)}}),e.$valid=this.$(".js_valid"),e.validTimeout()},onShow:function(){},onDestory:function(){}})});define("template/shop/all",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back="{{back}}"></div> <form class="head_search"> <input class="js_search" type="search" placeholder="热门搜索：新月枕" /> </form> </header> <div class="main" style="padding-bottom:10px"> <div class="sp_all_cates"> <div ref="cates"> <ul style="width:{{navs.length*.73}}rem;padding-right:30px;"> <li sn-repeat="item in navs" class="{{item.LPE_URL?\'noicon\':(\'cate\'+item.LPE_PCG_ID)}} {{current.PCG_ID==item.LPE_PCG_ID?\'curr\':\'\'}}" sn-tap="this.selectCate(item.LPE_URL||item.LPE_PCG_ID)">{{item.LPE_PCG_NAME}}</li> </ul> </div> <div class="dropdown_btn" sn-tap="this.showCategories()"></div> </div> <div class="sp_all_catelist_wrap"> <ul class="sp_all_catelist_cate"> <li sn-repeat="item in current.children" sn-tap="this.selectSubCate(item)" class="{{currentSub.PCG_ID==item.PCG_ID?\'curr\':\'\'}}">{{item.PCG_NAME}}</li> </ul> <ul class="sp_all_catelist_subcate"> <li class="sp_all_catelist_subcate_item{{currentSearchId==cate.PCG_ID?\' curr\':\'\'}}" sn-repeat="cate in currentSub.children" sn-tap="this.requestProd(cate.PCG_ID)"> <p><img alt="{{cate.PCG_NAME}}" sn-src="{{cate.PCG_IMG_URL}}" /></a> </p> <span>{{cate.PCG_NAME}}</span> </li> <li class="sp_all_catelist_subcate_item more" sn-tap="this.requestProd(currentSub.PCG_ID)"> <p><i></i></p> <span>查看全部</span> </li> </ul> </div> <ul class="sp_list"> <li sn-repeat="item in data" class="sp_list_item" data-forward="/item/{{item.PRD_ID}}?from={{url}}"> <img src="{{item.WPP_LIST_PIC1}}" /> <p class="price"><b>￥{{item.PRD_PRICE}}</b> <del sn-display="{{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}}">￥{{item.PRD_MEMBER_PRICE}}&nbsp;</del> </p> <p class="name">{{item.PRD_NAME}}</p> <div class="sold_out" sn-display="{{item.PRD_NUM==0}}">脱 销<br>Sold Out</div> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/all",["components","images/style.css","images/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),d=(e("animation"),e("models/api")),u=e("models/category"),h=e("components/category");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){},"focus .js_search":function(e){e.currentTarget.setAttribute("placeholder","")},"blur .js_search":function(e){e.currentTarget.setAttribute("placeholder","热门搜索：新月枕")}},onCreate:function(){var e=this;e.swipeRightBackAction=e.route.query.from||"/";var t=this.$(".main");l.bind(t),e.productSearchAPI=new d.ProductSearchAPI({$el:e.$el,$scroll:t,$content:t,check:!1,beforeSend:function(){this.setUrl("/Prod/productlist").setParam({orderbyStr:"PRD_ONLINE_DT",orderby:"desc",keycodes:""})},KEY_PAGE:"pages",KEY_PAGESIZE:"length",MSG_NO_MORE:'别拉了，就这些<i class="ico_no_more"></i>',pageSize:"10",success:function(t){10==t.data.length&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.set({data:t.data})},append:function(t){10==t.data.length&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.getModel("data").add(t.data)}}),this.listenTo(this.$(".js_search"),"keydown",function(t){return 13==t.keyCode?(e.forward("/list?s="+t.target.value+"&from=/all"),t.preventDefault(),!1):void 0}),this.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,resource:"http://appuser.abs.cn"}),this.model.selectCate=function(t,i){return"string"!=typeof i||/^\d+$/.test(i)?("object"!=typeof i&&(i=n.first(this.data.categories,function(e){return e.PCG_ID==i})),this.set({current:i,id:i.PCG_ID,currentSub:i.children[0]}),this.refs.cates.scroll.scrollTo((i.PCG_ID-1)*s(this.refs.cates).find(".curr").width(),0,200),e.cpCategory.set({current:i.PCG_ID}),void this.requestProd(t,i.PCG_ID)):void e.forward(i)},this.model.showCategories=function(){e.cpCategory.show()},this.model.selectSubCate=function(e,t){this.set("currentSub",t),this.requestProd(e,t.PCG_ID)},this.model.requestProd=function(t,i){this.set("currentSearchId",i),e.productSearchAPI.setParam({pcgid:i}).reload()},l.bind(this.model.refs.cates,{useScroll:!0,vScroll:!1,hScroll:!0}),console.profile("cate"),console.time("cate"),u.list(function(t,i){console.log("navs",i),console.log("categories",t);var s=new h({data:t,"goto":function(t,i){e.model.selectCate(null,i),s.hide()}});s.$el.appendTo("body"),e.cpCategory=s,e.setCategories(t,i)}),console.profileEnd(),console.timeEnd("cate")},onStart:function(e){},setCategories:function(e,t){var i=this;this.categories=o.State.data.categories;var s=i.route.query.id||1,a=n.first(e,function(e){return e.PCG_ID==s}),r=a.children[0];this.model.set({id:s,categories:e,navs:t,current:a,currentSub:r}),i.model.selectCate(null,a)},onQueryChange:function(e){"id"in e.data&&this.model.selectCate(null,this.query.id)},onEnter:function(){},onDestory:function(){}})});define("template/shop/list",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <ul class="sp_list_sort"> <li class="{{orderBy==\'PRD_ONLINE_DT|desc\'?\'curr\':\'\'}}" sn-tap="this.orderBy(\'PRD_ONLINE_DT|desc\')">新品</li> <li class="{{orderBy==\'PSV_QTY|desc\'?\'curr\':\'\'}}" sn-tap="this.orderBy(\'PSV_QTY|desc\')">销量</li> <li class="{{orderBy==\'PRD_MEMBER_PRICE|asc\'?\'curr asc\':orderBy==\'PRD_MEMBER_PRICE|desc\'?\'curr desc\':\'\'}}" sn-tap="this.orderBy(priceSort?\'PRD_MEMBER_PRICE|desc\':\'PRD_MEMBER_PRICE|asc\'),priceSort=!priceSort">价格</li> </ul> <ul class="sp_list"> <li sn-repeat="item in data" class="sp_list_item" data-forward="/item/{{item.PRD_ID}}?from={{url}}"> <img src="{{item.WPP_LIST_PIC1}}" /> <p class="price"><b>￥{{item.PRD_PRICE}}</b> <del sn-display="{{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}}">￥{{item.PRD_MEMBER_PRICE}}&nbsp;</del> </p> <p class="name">{{item.PRD_NAME}}</p> <div class="sold_out" sn-display="{{item.PRD_NUM==0}}">脱 销<br>Sold Out</div> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/list",["components","images/style.css","images/append.css"],function(e,t,i){var n=(e("$"),e("util")),a=e("activity"),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),d=(e("animation"),e("models/api"));return a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this,t=e.$(".main");e.swipeRightBackAction=e.route.query.from||"/all",l.bind(t);var i=n.store("categories"),s=i?n.first(i,function(t){return t.PCG_ID==e.route.query.id}):null;e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:s?s.PCG_NAME:"商品列表",orderBy:"PRD_ONLINE_DT|desc",priceSort:!0,url:encodeURIComponent(e.route.url)}),e.model.orderBy=function(e,t){this.set("orderBy",t),a.abort().reload()};var a=new d.ProductSearchAPI({$el:e.$el,$scroll:t,$content:t,check:!1,beforeSend:function(){var t=e.model.get("orderBy");t=t.split("|"),this.setUrl("new"==e.route.query.type?"/api/prod/newproductlist":"/Prod/productlist").setParam({orderbyStr:"new"==e.route.query.type&&"PRD_MEMBER_PRICE"==t[0]?"PRD_PRICE":t[0],orderby:t[1],pcgid:e.route.query.id,keycodes:e.route.query.s||""})},KEY_PAGE:"pages",KEY_PAGESIZE:"length",MSG_NO_MORE:'别拉了，就这些<i class="ico_no_more"></i>',pageSize:"10",success:function(t){10==t.data.length&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.set({data:t.data})},append:function(t){10==t.data.length&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.getModel("data").add(t.data)}});a.load()},onShow:function(){},onDestory:function(){}})});define("template/shop/item",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<div class="pd_item_wrap"> <header class="header_trans"> <div class="head_back" data-back="{{back}}"></div> <div class="head_right"> <a class="head_call" href="tel:4008205077"></a> <div class="head_share js_share"></div> </div> </header> <div class="main pd_item"> <div class="pd_slider{{data.PRD_NUM<=0?\' sold_out\':\'\'}}" ref="image"> </div> <div class="pd_info_wrap"> <div class="pd_info"> <h1>{{data.PRD_NAME}}</h1> <p class="price">{{data.PRD_PRICE}}</p> <del class="ori_price" sn-display="{{data.PRD_PRICE<data.PRD_MEMBER_PRICE}}">¥{{data.PRD_MEMBER_PRICE}}</del> <p class="pd_code"> <span class="code">商品编码 {{data.PRD_CODE}}</span> <span class="sale">销售 {{data.PSV_QTY}} 件</span> </p> <p class="pd_code" style="padding:5px 0;" sn-html="{{data.PRH_DESC}}"></p> </div> </div> <ul class="pd_sign"> <li>满99包邮</li> <li>30天退换货保障</li> </ul> <div class="pd_select_plus" sn-display="{{Package.PPG_ID}}" data-forward="/news/package{{Package.PPG_ID}}?from={{url}}"> {{Package.PPG_NAME}} </div> <div class="pd_select_size js_select_size"> 选择 尺码 颜色分类 </div> <div class="pd_jump_detail" data-forward="/detail/{{data.PRD_ID}}"><b>图文详情</b><em>建议在WIFI情况下查看</em></div> <div class="pd_help"> 如果您有任何疑问，欢迎联系我们的客服。 <br> 联系热线：400-820-5077 周一至周日 9:00-19:00 </div> </div> <footer class="pd_buy"> <b class="btn_cart" data-forward="{{isLogin?\'/cart\':(\'/login?success=\'+url)}}"><i sn-display="$state.cartQty!=0">{{$state.cartQty}}</i></b> <b class="btn_buy {{data.PRD_NUM==0?\'sold_out\':\'js_buy\'}}">{{data.PRD_NUM==0?\'商品已售罄\':\'加入购物车\'}}</b> </footer> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/item",["components","images/style.css","images/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),c=e("components/share"),d=e("components/size"),h=(e("animation"),e("models/api")),p=e("widget/slider"),f=e("models/user");return a.extend({events:{"tap .js_buy:not(.disabled)":function(){var e=this;1==e.model.data.colorSpec.length?e.user?this.size.confirm():e.forward("/login"):this.size.show()},"tap .js_share":function(){this.share.show()},"tap .js_select_size":function(){this.size.show()}},className:"pd_item_bg",onCreate:function(){var e=this,t=e.$(".main");e.swipeRightBackAction=e.route.query.from||e.route.referrer||e.defBackUrl,l.bind(t),e.user=f.get(),e.model=new o.ViewModel(e.$el,{title:"床品",id:e.route.data.id,user:e.user,isLogin:!!e.user,url:encodeURIComponent(e.route.url),qty:1}),e.onResult("Login",function(){e.user=f.get(),e.model.set({isLogin:!0,user:f.get()})}),e.size=new d,e.size.$el.appendTo(e.$el),e.size.on("SizeChange",function(t,i){var s={PRD_NUM:i.PRD_NUM};i.WPP_LIST_PIC&&(s.WPP_LIST_PIC=i.WPP_LIST_PIC),e.model.set({data:s})});var i=new h.ProductAPI({$el:e.$el,params:{id:e.route.data.id},checkData:!1,success:function(t){console.log(t.data),t.data.PSV_QTY=t.psvqty,e.model.set({data:t.data}),e.size.set({qty:1,data:t.data}),t.prhpic||(t.prhpic=[]),t.prhpic.unshift({PHP_PIC_M:t.data.WPP_M_PIC}),e.slider=new p({container:e.model.refs.image,loop:!0,autoLoop:3e3,data:t.prhpic,dots:t.prhpic.length>=1,itemTemplate:'<img width="100%" height="100%" src="<%=PHP_PIC_M%>" />'}),e.share=new c({head:"分享商品至",title:t.data.PRD_NAME,linkURL:t.data.FLASH_FLAG?t.flpurl:"http://m.abs.cn/single/"+t.data.PRD_ID+".html",description:t.data.PRD_NAME,image:"http://www.absimg.com/media/H5/app/logo.jpg"}),e.share.$el.appendTo(e.$el),s.setParam({id:t.data.PRD_PRH_ID}).load()}});i.load();var s=new h.ProductColorAndSpec({$el:e.$el,checkData:!1,success:function(t){for(var i=[],s=[],n=0,a=t.data.length;a>n;n++){var r=t.data[n];-1==i.indexOf(r.PRD_COLOR)&&i.push(r.PRD_COLOR),-1==s.indexOf(r.PRD_SPEC)&&s.push(r.PRD_SPEC)}console.log(t),e.model.set({color:i,spec:s,colorSpec:t.data}),e.size.set({color:i,spec:s,colorSpec:t.data})}}),n=new h.PackageRelativeAPI({$el:e.$el,params:{prdId:this.route.data.id},checkData:!1,success:function(t){console.log(t),e.model.set({Package:t.data})}});n.load()},onShow:function(){var e=this;e.model.set({back:e.swipeRightBackAction})},onDestory:function(){}})});define("template/shop/detail",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main pd_detail"> <img sn-repeat="item in data" src="{{item.img}}" /> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/detail",["components","images/style.css","images/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),d=(e("animation"),e("models/api"));i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this;e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"图文详情",id:e.route.data.id}),l.bind(e.$(".main"));var t=new d.ProductDetailAPI({$el:e.$el,params:{id:e.route.data.id},success:function(t){e.model.set({data:t.data}),console.log(t)}});t.load()},onShow:function(){},onDestory:function(){}})});define("template/shop/cart",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff <header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> '+this.helpers.list()+' </div> <footer class="ct_list_action"> <div class="total">总计：<b>{{this.getTotal(bag_amount,couponcode,Points||0,freecouponcode.CSV_CODE)}}</b></div> <div class="btn_buy js_buy">结 算</div> </footer> <div class="ct_coupon_wrap {{isShowCoupon?\'\':\'out\'}} js_coupon" style="display:none"> <div class="ct_coupon"> <div class="ct_coupon_hd">{{couponType==4?"选择免邮卡":"选择优惠券"}}</div> <div class="ct_coupon_use" sn-display="{{couponType!=4}}"> <input type="text" placeholder="请输入券码" sn-model="code" /> <b class="btn" sn-tap="this.couponGetApi.load()">使用</b> </div> <div class="ct_coupon_list"> <div class="hd">已有优惠券</div> <ul class="bd" sn-style="top: {{couponType==4?\'106px\':\'146px\'}}"> <li sn-repeat="item in coupon|filter:couponType==4?item.VCT_ID==4:(item.VCT_ID!=4)" class="{{(item.VCT_ID == 4 ? \'free\' : item.VCT_ID == 2 ? \'vct2\' : item.VCT_ID == 5 ? \'vct5\' : \'\') + (item.IsOverdue ? \' dis\' : \'\')+((couponType==4&&freecouponcode.CSV_CODE==item.CSV_CODE||couponType!=4&&couponcode.CSV_CODE.indexOf(item.CSV_CODE)!=-1)?\' checked\':\'\')}}" sn-tap="this.useCoupon(item)"> <i class="ico_check"></i> <div class="price">{{util.currency(item.VCA_DEDUCT_AMOUNT,\'\')}}</div> <div class="name">{{item.VCT_ID==4?\'免邮卡\':item.VCA_NAME}}</div> <div class="time">有效期:{{item.IsOverdue?\'已过期\':(util.formatDate(item.CSV_START_DT,\'yyyy/MM/dd\')+\'-\'+util.formatDate(item.CSV_END_DT,\'yyyy/MM/dd\'))}}</div> </li> <div class="nodata">暂无优惠券</div> </ul> </div> </div> </div> <div class="ct_coupon_wrap {{isShowPoint?\'\':\'out\'}} js_points" style="display:none"> <div class="ct_coupon"> <div class="ct_coupon_hd">使用积分</div> <div class="ct_points"> <div class="hd">当前积分</div> <div class="points">{{user.Points}}</div> </div> <div class="ct_coupon_use"> <input type="tel" placeholder="请输入积分" value="{{_points||\'\'}}" sn-model="_points" /> <b class="btn" sn-tap="this.usePoint(_points)">使用</b> </div> <div class="ct_points_tip"> *您的积分可以直接抵扣现金使用。<em>（100积分＝1元）</em> </div> </div> </div>';return __},helpers:{list:function(){var e="";return e+=' <div class="ct_list_wrap" sn-display="{{util.isTrue(data_baglist)||util.isTrue(data_package)}}"> <ul class="ct_list"> <li sn-repeat="item in data_baglist" class="ct_list_item" data-id="{{item.SPB_ID}}"> <div class="ct_list_item_con js_delete_item"> <img sn-src="{{item.PRD_PIC}}" data-forward="{{item.SPB_WAC_ID==10?\'/group/\'+item.SPB_GROUP:(\'/item/\'+item.PRD_ID)}}" /> <div class="con"> <b class="name">{{item.PRD_NAME}}</b> <p class="size">尺寸：{{item.PRD_SPEC.split(\'|\')[0]}}</p> <p class="color">颜色：{{item.PRD_COLOR}}</p> <p class="qty"> <span class="minus" sn-tap="this.changeQty(item,Math.max(!item.SPB_QTY?1:(parseInt(item.SPB_QTY)-1),1))">-</span> <input type="text" value="{{item.SPB_QTY||1}}" sn-model="changedQty" sn-change="this.changeQty(item,changedQty)" /> <span class="plus" sn-tap="this.changeQty(item,(parseInt(item.SPB_QTY)||1)+1)">+</span> </p> </div> <div class="ft"> <b class="price">￥{{Math.round(item.SPB_AMOUNT*100)/100}}</b> <del sn-display="{{item.SPB_AMOUNT>item.PRD_MEMBER_PRICE*(item.SPB_QTY||1)}}">￥{{Math.round(item.PRD_MEMBER_PRICE*(item.SPB_QTY||1)*100)/100}}</del> </div> <div class="icon-clear js_delete_icon" data-id="{{item.SPB_ID}}"></div> </div> <i class="js_delete" data-id="{{item.SPB_ID}}"></i> </li> </ul> <div sn-repeat="ppg in data_package" class="ct_list_pkg"> <dl class="js_delete_item"> <dt class="ct_list_pkg_item">{{ppg.PPG_NAME}} <b class="price">￥{{Math.round(ppg.PPG_PRICE*100)/100}}</b> </dt> <dd sn-repeat="item in ppg.PackageList" class="ct_list_item"> <div class="ct_list_item_con"> <img sn-src="{{item.PRD_PIC}}" data-back="/item/{{item.PRD_ID}}" /> <div class="con"> <b class="name">{{item.PRD_NAME}}</b> <p class="size">尺寸：{{item.PRD_SPEC.split(\'|\')[0]}}</p> <p class="color">颜色：{{item.PRD_COLOR}}</p> </div> <div class="ft"> <del>￥{{Math.round(item.PRD_MEMBER_PRICE*(item.SPB_QTY||1)*100)/100}}</del> </div> </div> </dd> </dl> <i class="js_delete" data-wacid="{{ppg.SPB_WAC_ID}}" data-groupid="{{ppg.SPB_GROUP}}" data-ppgid="{{ppg.PPG_ID}}"></i> </div> <div class="ct_buy_more" data-back="/?tab=1" sn-display="{{this.getPrice(bag_amount,couponcode,Points)<=99}}"> <i>去凑单</i> 满<em>¥99</em>即可免运费，还差<em>¥{{Math.round((99-this.getPrice(bag_amount,couponcode,Points))*100)/100}}</em> </div> <ul class="ct_list_info"> <li><span>商品总价</span><em><b class="price">￥{{prod_amount}}</b></em></li> <li class="link js_use_coupon"><span>使用优惠券</span><em sn-display="{{couponcode.CSV_CODE}}"><b>-¥{{couponcode.VCA_DEDUCT_AMOUNT}}</b></em><em sn-display="{{!couponcode.CSV_CODE}}"><b>{{couponCount||0}}</b>张可用</em></li> <li class="link js_use_point"> <span>积分抵扣</span> <em sn-display="{{Points}}"><b>-¥{{Points/100}}</b></em> <em sn-display="{{!Points}}"><b>{{user.Points}}</b>积分可用</em> </li> <li class="link js_use_freecard" sn-display="{{freeCount&&this.getPrice(bag_amount,couponcode,Points)<99}}"> <span>选择免邮卡</span> <em sn-display="{{freecouponcode.CSV_CODE}}"><b>已选1张</b></em> <em sn-display="{{!freecouponcode.CSV_CODE}}"><b>{{freeCount||0}}</b>张免邮卡可用</em></li> <li><span>运费</span> <em><b>{{this.getFreight(bag_amount,couponcode,Points||0,freecouponcode.CSV_CODE)}}</b></em> </li> <li><span>总计</span><em><b class="price">{{this.getTotal(bag_amount,couponcode,Points||0,freecouponcode.CSV_CODE)}}</b></em></li> </ul> </div> <div class="my_nodata" sn-display="{{!loading&&util.isFalse(data_baglist)&&util.isFalse(data_package)}}" style="display:none"> <div class="icon"></div> <div class="text">您的购物车内还没有商品</div> <div class="btn" data-back="/?tab=1">去逛逛吧</div> </div> '}}});return T.template=T.html,T});define("views/shop/cart",["components","images/style.css","images/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loading"),e("core/model")),c=(e("core/promise"),e("widget/scroll")),u=(e("animation"),e("models/api")),p=e("components/deletion"),h=e("models/user");return a.extend({events:{"tap .js_buy:not(.disabled)":function(){var e=this,t=this.model.get("couponcode"),i=this.model.get("freecouponcode");this.model.setState({selectedCoupon:t,selectedFreeCoupon:i}),this.forward("/buy?points="+this.model.get("Points")+"&from="+encodeURIComponent(e.route.url))},"touchmove .ct_coupon_wrap":function(e){return!1},"tap .js_coupon":function(e){s(e.target).hasClass("js_coupon")&&this.model.set({isShowCoupon:!1})},"tap .js_points":function(e){s(e.target).hasClass("js_points")&&this.model.set({isShowPoint:!1})},"tap .js_use_coupon":function(){this.$coupon.show(),this.model.set({couponType:0,isShowCoupon:!0})},"tap .js_use_point":function(){var e=this;this.$points.show(),e.model.set({isShowPoint:!0})},"tap .js_use_freecard":function(){this.$coupon.show(),this.model.set({couponType:4,isShowCoupon:!0})}},onCreate:function(){var e=this;c.bind(e.$(".main")),c.bind(e.$(".ct_coupon_list .bd")),e.swipeRightBackAction=e.route.query.from||"/",e.user=h.get(),e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"我的购物车",user:e.user,loading:!0,Points:0}),s.extend(e.model,{getPrice:function(e,t,i){var s=t&&t.VCA_DEDUCT_AMOUNT?t.VCA_DEDUCT_AMOUNT:0;return t&&5==t.VCT_ID&&(s=0),Math.max(0,e-s-i/100)},getFreight:function(t,i,s,n){var a=this.getPrice(t,i,s),r=e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||a>=99||n?0:15;return a>=99?"免邮费":"¥"+Math.round(100*r)/100},getTotal:function(t,i,s,a){if(n.isTrue(this.data.data_baglist)||n.isTrue(this.data.data_package)){var o,l,c,r=i&&i.VCA_DEDUCT_AMOUNT?i.VCA_DEDUCT_AMOUNT:0;return i&&5==i.VCT_ID?(l=Math.max(0,t-r-s/100),c=e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||t-s/100>=99||a?0:15,o=Math.max(0,t+c-r-s/100)):(l=Math.max(0,t-r-s/100),o=l+(e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||l>=99||a?0:15)),"¥"+Math.round(100*o)/100}return"¥0"},usePoint:function(t,i){return i?(i=parseFloat(i),i>e.user.Points?void sl.tip("您输入的数值已超过您的积分最大值，请重新输入"):100>i||i%100!=0?void sl.tip("您输入的数值不是100的倍数，请重新输入"):void e.model.set({isShowPoint:!1,Points:i})):void e.model.set({isShowPoint:!1,Points:0})},useCoupon:function(t,i){if(1==i.VCT_ID&&i.VCA_MIN_AMOUNT>e.model.data.bag_amount)return void sl.tip("您的购物金额满"+i.VCA_MIN_AMOUNT+"元才可使用哦");if(4==i.VCT_ID)this.set({freecouponcode:this.data.freecouponcode&&this.data.freecouponcode.CSV_CODE==i.CSV_CODE?null:i});else if(5==i.VCT_ID){var s=this.data.usedCoupons||[],a=n.indexOf(s,function(e){return e.CSV_CODE==i.CSV_CODE});-1!=a?s.splice(a,1):s.push(i);var r=[],o=0;s.forEach(function(e){r.push(e.CSV_CODE),o+=e.VCA_DEDUCT_AMOUNT}),this.set({usedCoupons:s,couponcode:{VCT_ID:5,VCA_DEDUCT_AMOUNT:o,CSV_CODE:r.join(",")}})}else this.set({usedCoupons:[],couponcode:this.data.couponcode&&this.data.couponcode.CSV_CODE==i.CSV_CODE?null:i});this.set({isShowCoupon:!1})}}),e.cart=new u.CartAPI({$el:e.$el,checkData:!1,success:function(t){t.coupon.sort(function(e,t){return e.CSV_END_DT>t.CSV_END_DT?1:e.CSV_END_DT==t.CSV_END_DT?0:-1}),e.model.set(t).set({loading:!1});for(var n,a,i=0,s=0,r=0;r<t.coupon.length;r++)n=t.coupon[r],4==n.VCT_ID?s++:(i++,e.model.data.couponcode&&n.CSV_CODE==e.model.data.couponcode.CSV_CODE&&(a=n));e.model.data.couponcode&&(5!=e.model.data.couponcode.VCT_ID&&!a||1==e.model.data.couponcode.VCT_ID&&e.model.data.couponcode.VCA_MIN_AMOUNT>e.model.data.bag_amount)&&e.model.set({couponcode:null}),e.model.set({freeCount:s,couponCount:i})}}),e.initPoints(),e.initCoupon(),e.initModify(),e.initDeletion(),this.onResult("ResetCart",function(){e.model.set({couponcode:null,freecouponcode:null,Points:0}),e.model.setState({selectedCoupon:"",selectedFreeCoupon:""})})},onShow:function(){var e=this;e.user=h.get(),e.model.set({user:e.user,back:e.swipeRightBackAction}),e.cart.setParam({pspcode:e.user.PSP_CODE}).load()},initDeletion:function(){var e=this,t=function(t){var i=s(t.currentTarget),n=i.data("id");if(n){s.extend(!0,{},e.model.data);e.model.getModel("data_baglist").remove(function(e){return e.SPB_ID==n}),e.cartDeleteApi.setParam({spbId:n}).load()}else e.cartDeletePackageAPI.setParam({wacid:i.data("wacid"),ppgid:i.data("ppgid"),groupid:i.data("groupid")}).load()};this.listen("tap .js_delete_icon",function(e){this.confirm("确认要移除该商品吗？",function(){t(e)})}),new p({el:e.$(".ct_list_wrap"),children:".js_delete_item",width:70,events:{".js_delete":t}}),e.cartDeleteApi=new u.CartDeleteAPI({$el:e.$el,checkData:!1,params:{pspcode:e.user.PSP_CODE},success:function(t){var i=this.getParam("spbId");e.setResult("CartChange"),e.model.getModel("data_baglist").remove(function(e){return e.SPB_ID==i}),e.cart.reload()},error:function(e){sl.tip(e.msg)}}),e.cartDeletePackageAPI=new u.CartDeletePackageAPI({$el:e.$el,checkData:!1,params:{pspcode:e.user.PSP_CODE},success:function(t){e.cart.reload()},error:function(e){sl.tip(e.msg)}})},initModify:function(){var e=this,t=!1;e.cartModifyApi=new u.CartModifyAPI({$el:e.$el,checkData:!1,beforeSend:function(){t=!0},success:function(t){e.cart.reload(),e.setResult("CartChange")},error:function(t){sl.tip(t.msg),e.model.getModel("data_baglist").first(function(t){return t.SPB_ID==e.modifySpbId}).set({SPB_QTY:this.originQty}),this.$input.val(this.originQty)},complete:function(){t=!1}}),e.model.changeQty=function(t,i,n){var a=parseInt(i.SPB_QTY);n=parseInt(n),n&&!isNaN(n)&&n!=a&&(e.modifySpbId=i.SPB_ID,s.extend(e.cartModifyApi,{originQty:a,$input:s(t.currentTarget)}).setParam({pspcode:e.user.PSP_CODE,spbId:i.SPB_ID,qty:n}).load())}},initPoints:function(){var e=this;e.$points=e.$(".js_points"),e.listenTo(e.$points,s.fx.transitionEnd,function(t){e.$points.hasClass("out")&&e.$points.hide()})},initCoupon:function(){var e=this;e.$coupon=e.$(".js_coupon"),e.listenTo(e.$coupon,s.fx.transitionEnd,function(t){e.$coupon.hasClass("out")&&e.$coupon.hide()}),this.model.couponGetApi=new u.CouponAPI({$el:this.$el,checkData:!1,beforeSend:function(){var t=e.model.get("code");return t?void this.setParam({csvcode:t}):(sl.tip("请输入券号"),!1)},params:{pspcode:e.user.PSP_CODE},success:function(t){t.success?(sl.tip("领取成功"),e.cart.reload()):sl.tip(t.msg)},error:function(e){sl.tip(e.msg)}})},onDestory:function(){this.model.setState({selectedCoupon:"",selectedFreeCoupon:""})}})});define("template/shop/buy",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="sp_buy"> <div class="sp_buy_hd js_address"> <div class="info"><span class="name">{{address.MBA_NAME}}</span><span class="mobi">{{address.MBA_MOBILE}}</span></div> <div class="loc">{{address.MBA_FULL_ADDRESS}}</div> </div> <div class="sp_buy_bd sp_buy_bill"> <div class="hd">支付结算</div> <ul> <li><span>商品价</span><em>¥{{prod_amount}}</em></li> <li><span>优惠券</span><em>-¥{{$state.selectedCoupon.VCA_DEDUCT_AMOUNT||0}}</em></li> <li><span>积分</span><em>-¥{{Points/100||0}}</em></li> <li><span>运费</span><em>{{this.getFreight(bag_amount,$state.selectedCoupon,Points||0,$state.selectedFreeCoupon.CSV_CODE)}}</em></li> <li><span>总计</span><b>{{this.getTotal(bag_amount,$state.selectedCoupon,Points||0,$state.selectedFreeCoupon)}}</b></li> </ul> </div> <div class="sp_buy_bd sp_buy_pay"> <div class="hd">支付方式</div> <ul> <li class="ico_alipay{{payType==1?\' checked\':\'\'}}" sn-tap="payType=1">支付宝支付</li> <li class="ico_wxpay{{payType==2?\' checked\':\'\'}}" sn-tap="payType=2">微信支付</li> </ul> </div> <div class="sp_buy_bd"> <div class="hd">是否需要发票</div> <div class="sp_buy__inv_required"> <ol class="checkboxlist"> <li class="{{!requireInv?\'checked\':\'\'}}" sn-tap="requireInv=0">不需要</li> <li class="{{requireInv?\'checked\':\'\'}}" sn-tap="requireInv=1">需要</li> </ol> <div class="inputs" sn-display="requireInv"> <input type="text" sn-model="invTitle" value="{{invTitle}}" /> </div> </div> </div> </div> </div> <footer class="sp_buy_action"> <div class="total">总计：<b ref="total">{{this.getTotal(bag_amount,$state.selectedCoupon,Points||0,$state.selectedFreeCoupon)}}</b></div> <div class="btn_buy js_buy">立即支付</div> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/buy",["components","images/style.css","images/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),c=(e("animation"),e("models/api")),u=e("bridge"),p=e("models/user");return a.extend({events:{"tap .js_buy:not(.disabled)":function(){this.orderCreateApi.load()},"tap .js_address":function(){this.forward("/address?buy=1&from="+encodeURIComponent(this.route.url))}},onCreate:function(){var e=this,t=e.$(".main");e.swipeRightBackAction=e.route.query.from||"/cart",e.user=p.get(),l.bind(t),e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"确认订单",payType:1,couponprice:0}),s.extend(e.model,{getPrice:function(e,t,i){var s=t&&t.VCA_DEDUCT_AMOUNT?t.VCA_DEDUCT_AMOUNT:0;return t&&5==t.VCT_ID&&(s=0),Math.max(0,e-s-i/100)},getFreight:function(t,i,s,n){console.log(t,i,s,n);var a=this.getPrice(t,i,s),r=e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||a>=99||n?0:15;return e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||a>=99?"免邮费":"¥"+Math.round(100*r)/100},getTotal:function(t,i,s,n){var r,o,l,a=i&&i.VCA_DEDUCT_AMOUNT?i.VCA_DEDUCT_AMOUNT:0;return i&&5==i.VCT_ID?(o=Math.max(0,t-a-s/100),l=e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||t-s/100>=99||n?0:15,r=Math.max(0,t+l-a-s/100)):(o=Math.max(0,t-a-s/100),r=o+(e.user.XPS_CTG_ID&&e.user.XPS_CTG_ID>=4||o>=99||n?0:15)),"¥"+Math.round(100*r)/100}});var i=new c.AddressListAPI({$el:this.$el,params:{pspcode:e.user.PSP_CODE},checkData:!1,success:function(t){t.data&&t.data[0]&&e.model.set({address:n.first(t.data,function(e){return e.MBA_DEFAULT_FLAG})||t.data[0]})}});i.load(),e.cart=new c.CartAPI({$el:e.$el,checkData:!1,success:function(t){console.log(t),e.model.set(t).set({loading:!1})}}),e.cart.setParam({pspcode:e.user.PSP_CODE}),e.orderCreateApi=new c.OrderCreateAPI({$el:this.$el,beforeSend:function(){var t=e.model.get("address");return t?void this.setParam({mba_id:t.AddressID,pay_type:e.model.get("payType"),inv_flag:e.model.get("requireInv")?!0:!1,inv_title:e.model.get("invTitle")}):(sl.tip("请填写收货地址信息"),!1)},checkData:!1,success:function(t){t.success&&(sl.tip("生成订单成功！"),e.setResult("OrderChange").setResult("ResetCart").setResult("UserChange"),0!=t.pur_amount&&(1==e.model.get("payType")?u.ali({type:"pay",spUrl:c.API.prototype.baseUri+"/AlipayApp/Pay",orderCode:t.code},function(e){sl.tip(e.msg)}):u.wx({type:"pay",spUrl:c.API.prototype.baseUri+"/api/shop/wxcreateorder",orderCode:t.code,orderName:"ABS商品",orderPrice:t.pur_amount},function(e){sl.tip(e.msg)})),e.forward("/order/"+t.pur_id+"?from=/myorder&refresh=1"))},error:function(e){sl.tip(e.msg)}}),e.onResult("useAddress",function(t,i){e.model.set({address:i})})},onShow:function(){var e=this;e.user=p.get(),e.orderCreateApi.setParam({pspcode:e.user.PSP_CODE,pay_type:1,coupon:this.model.getState("selectedCoupon.CSV_CODE")||"",points:e.route.query.points,freecoupon:this.model.getState("selectedFreeCoupon.CSV_CODE")||""}),e.model.set({Points:e.route.query.points?parseInt(e.route.query.points):0}),e.cart.load()},onDestory:function(){}})});define("template/steward/index",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="stw_title_bar"> <div class="hd">总共<em>{{user.StewardNum}}</em>条爱管家记录</div> <i class="stw_title_bar_thumb ico{{displayType==0?\' curr\':\'\'}}" sn-tap="displayType=0"></i> <i class="stw_title_bar_list ico{{displayType==1?\' curr\':\'\'}}" sn-tap="displayType=1"></i> </div> <ul class="stw_list" sn-if="{{displayType==1}}"> <li class="stw_list_item" sn-repeat="item in data"> <div class="thumb" data-forward="/item/{{item.LPK_PRD_ID}}?from=/steward"> <i>{{item.LPK_QTY}}</i> <img src="{{item.WPP_M_PIC}}"/> <b class="btn">再来一个</b> </div> <div class="con" data-forward="/steward/{{item.PRD_PRH_ID}}"> <h4>{{item.PRH_NAME}}</h4> <div class="date">最新购入时间：{{util.formatDate(item.PUR_DT,\'yyyy/MM/dd\')}}</div> <!--<div class="text"> <p>提醒：文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字</p> </div>--> <a class="link" href="/steward/{{item.PRD_PRH_ID}}">查看详情&gt;&gt;</a> </div> </li> </ul> <div class="stw_category" sn-if="{{displayType==0}}"> <div class="stw_category_item{{cate.currCate?\' curr\':\'\'}}" sn-repeat="cate in cates"> <div class="hd" sn-tap="this.setCate(cate)"> <span>{{cate.name}}</span> </div> <ul class="stw_list"> <li class="stw_list_item" sn-repeat="item in data|filter:item.CAT_ID==cate.id" data-forward="/item/{{item.LPK_PRD_ID}}?from=/steward"> <div class="thumb"> <img src="{{item.WPP_M_PIC}}"/> <b class="btn">再来一个</b> </div> <div class="con" data-forward="/steward/{{item.PRD_PRH_ID}}"> <h4>{{item.PRH_NAME}}</h4> <div class="date">最新购入时间：{{util.formatDate(item.PUR_DT,\'yyyy/MM/dd\')}} </div> <!--<div class="text"> <p>提醒：文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字</p> </div>--> <a class="link" href="/steward/{{item.PRD_PRH_ID}}">查看详情&gt;&gt;</a> </div> </li> </ul> </div> </div> <div class="datanotfound" sn-display="{{!data.length}}"> 您的爱管家还没有记录哦！ </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/steward/index",["components","images/style.css","images/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),c=(e("animation"),e("models/api"));i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},swipeRightBackAction:"/",onCreate:function(){var e=this,t=this.$(".main");e.user=n.store("user"),l.bind(t);var i=[{id:1,name:"出行"},{id:2,name:"睡眠"},{id:3,name:"美食"},{id:4,name:"沐浴"},{id:5,name:"休闲"},{id:6,name:"家务"},{id:7,name:"空间"},{id:8,name:"儿童"}];this.model=new o.ViewModel(this.$el,{back:"/",title:"爱管家",displayType:1,user:e.user}),e.model.setCate=function(t,i){e.model.getModel("cates").each(function(t){t.data.id==i.id&&(-1!=n.indexOf(e.model.get("data"),function(e){return e.CAT_ID==i.id})?t.set("currCate",!t.data.currCate):sl.tip("没有记录哦"))})};var a=n.store("categories"),r=new c.CategoryAPI({success:function(e){a=e.data,n.store("categories",e.data),u.load()},$el:e.$el}),d=function(t){return t.forEach(function(e){for(var s,t=e.PRH_PCT_ID;t;)s=n.first(a,function(e){return e.PCG_ID==t}),t=s?s.PCG_PARENT_ID:0;e.CAT_ID=s?s.PCG_ID:0,s=n.first(i,function(t){return t.id==e.CAT_ID}),s&&(s.currCate=!0)}),e.model.set({cates:i}),t},u=new c.StewardListAPI({$el:e.$el,params:s.extend({pspcode:e.user.PSP_CODE,pageSize:10,currentpage:1},e.user.token),$scroll:t,$content:t,checkData:!1,success:function(t){t.data.length>=10&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.set({data:d(t.data)})},append:function(t){10==t.data.length?t.total=(this.pageIndex+1)*parseInt(this.pageSize):t.data.length||(t.total=e.model.get("data").length),e.model.getModel("data").add(t.data)}});a?u.load():r.load()},onShow:function(){},onDestory:function(){}})});define("template/steward/item",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <ul class="stw_items"> <li class="stw_items_item" sn-repeat="item in data"> <a href="/steward/detail/{{item.id}}?from={{url}}"><img src="{{item.pic}}" /></a> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/steward/item",["components","images/style.css","images/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),c=(e("animation"),e("models/api"));return a.extend({events:{"tap .js_buy:not(.disabled)":function(){}},swipeRightBackAction:"/steward",onCreate:function(){var e=this,t=this.$(".main");l.bind(t),e.user=n.store("user"),this.model=new o.ViewModel(this.$el,{back:"/steward",title:"爱管家",id:e.route.data.id,url:e.route.url});var i=new c.StewardAPI({$el:e.$el,params:s.extend({prh_id:e.model.get("id")},e.user.token),success:function(t){console.log(t),e.model.set(t)}});i.load()},onShow:function(){},onDestory:function(){}})});define("template/steward/detail",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main" style="background:#fff;"> <div class="stw_detail" sn-html="{{data.content}}"></div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/steward/detail",["components","images/style.css","images/append.css"],function(e,t,i){var s=e("$"),n=e("util"),a=e("activity"),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),c=(e("animation"),e("models/api"));return a.extend({events:{"tap,click .main a":function(e){var t=this,i=e.currentTarget.href.match(/\#(.+)$/);if(i){var s=t.$('[name="'+i[1]+'"]').offset().top;this.$(".main")[0].scrollTop=s}return!1}},onCreate:function(){var e=this,t=this.$(".main");this.swipeRightBackAction=this.route.from||this.route.referrer||"/steward",e.user=n.store("user"),this.scroll=l.bind(t),this.model=new o.ViewModel(this.$el,{back:this.swipeRightBackAction,title:"爱管家",id:this.route.data.id});var i=new c.StewardDetailAPI({$el:e.$el,checkData:!1,params:s.extend({pspcode:e.user.PSP_CODE,detail_id:e.model.get("id")},e.user.token),success:function(t){console.log(t),e.model.set(t)}});i.load()},onShow:function(){},onDestory:function(){}})});define("template/test",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div> <input sn-model=\'name\' /> <dl sn-repeat="item in data|filter:contains(item.name,name)"> <dt>{{item.name}}</dt> <dd sn-repeat="p,j in children">{{p.name}} <p>{{p.id}}|{{j}}</p> <p>{{p.content}}</p>{{item.name}} <p sn-repeat="c in p.children" style="color:#f90">{{c.name}}</p> </dd> </dl> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/test",["components","images/style.css","images/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll");e("animation");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this,t=e.$(".main");e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",l.bind(t),seajs.use("views/test3",function(e){e.css_beautify('   .bd    \n { padding-top: 4px/$p; ul { display: -webkit-box;\n margin-top: 5px; }\n        li { -webkit-box-flex: 1; width: 0px; height: 80px; text-align: center; font-size: 14px; &:before { @include icon(0px, 0px, 104px/$p, 104px/$p, "icon_share.png", block); background-size: 416px/$p auto; margin: 0 auto 4px auto; }            }\n//asdfsf\n/*爱管家\nasdf*/\n        @for $i from 1 to 4 { li:nth-child(#{$i+1}):before { background-position: -104px/$p*$i 0px; }            }\n\n        }\n                        ss\n\n\n            .ft { .btn { display: block; line-height: 30px; height: 60px/$p; width: (550/640)*100%; font-size: 16px; background: #ccc; margin: 5px auto 0 auto; border-radius: 0;   }        }            }')}),console.time("test"),console.profile("test");for(var i={back:e.swipeRightBackAction,title:"标题",data:[{name:"1234",children:[{name:"aaa"}]}],children:[]},s=0;10>s;s++)i.data.push({name:"nn"+s,children:[{name:"tt"+s}]}),i.children.push({name:"cc"+s,content:"asdf",children:[{name:"bb"+s},{name:"oo"+s}]});e.model=new o.ViewModel(this.$el,{}),e.model.set(i);for(var s=0;100>s;s++)i.data.push({name:"nn"+s,children:[{name:"tt"+s}]}),i.children.push({name:"cc"+s,content:"asdf",children:[{name:"bb"+s},{name:"oo"+s}]});e.model.set(i),console.timeEnd("test"),console.profileEnd("test")},onShow:function(){},onDestory:function(){}})});define("template/coupon/activity",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> <div class="head_right"> <div class="head_share js_share_activity"></div> </div> </header> <div ref="main" class="main" style="padding: 10px;background:#fff;"> <div html="{{data.SCA_CONTNET}}"></div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/coupon/activity",["components","images/style.css","images/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),d=e("models/api"),u=(e("components/share"),e("models/user")),p=e("bridge");i.exports=a.extend({events:{"tap .js_share_activity":function(){var e=this;p.wx({type:"shareLinkURL",linkURL:this.model.data.data.SCA_SHARE_URL,tagName:"abs",title:this.model.data.data.SCA_SHARE_TITLE,description:this.model.data.data.SCA_SHARE_DESC,image:this.model.data.data.SCA_SHARE_PIC,scene:1},function(t){t.success?e.addActivityCouponAPI.setParam({pspcode:e.user.PSP_CODE,vca_id:e.model.data.data.SCA_VCA_ID}).load():sl.tip("您已取消分享")})}},defBackUrl:"/",onCreate:function(){var e=this;e.swipeRightBackAction=e.route.query.from||e.route.referrer||e.defBackUrl,e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"ABS家居"}),l.bind(e.model.refs.main),e.user=u.get();var t=new d.AppShareActivityAPI({$el:e.$el,params:{id:e.route.data.id},success:function(t){e.model.set({data:t.data})}});t.load(),e.addActivityCouponAPI=new d.AddActivityCouponAPI({$el:e.$el,params:{id:20},success:function(t){t.success&&e.confirm(t.msg,function(){})},error:function(){}})},onShow:function(){},onDestory:function(){}})});define("views/discovery/discovery_index",["components","images/style.css","images/append.css"],function(e,t,i){var s=e("$"),n=e("util"),r=(e("widget/loading"),e("core/model")),d=(e("widget/scroll"),e("animation"),e("models/api")),c=e("models/discovery"),u=e("models/user"),p=e("components/confirm");i.exports=r.ViewModel.extend({el:'<div class="discovery_index"> <ul class="disc_nav"> <li><p><em>全部ALL</em></p></li> <li sn-repeat="item in typeList"><p data-forward="/discovery/list/{{item.DCT_ID}}?name={{encodeURIComponent(item.DCT_DESC)}}"><em>{{ item.DCT_DESC }}</em><img src="{{item.DCT_PIC}}" /></p></li> </ul> <ul class="disc_list"> <li sn-repeat="item in rec" data-forward="/discovery/{{item.DCV_ID}}"> <img src="{{item.DCV_REC_PIC}}" /> <p class="tit">{{ item.DCV_SUBTITLE }}</p> <p class="desc" sn-html="{{item.DCV_REC_CONTENT}}"></p> </li> <li sn-repeat="item in data" data-forward="/discovery/{{item.DCV_ID}}"> <img src="{{item.DCV_SUBTITLE_PIC}}" /> <em class="see">{{ item.DCV_VIEW_QTY }}</em> <em class="fav{{item.Like_Flag?\' curr\':\'\'}}">{{ item.DCV_LIKE_QTY }}</em> </li> </ul> </div>',initialize:function(){var e=this;e.user=u.get(),e.set({typeList:n.store("DiscoverType")});var t=new d.DiscoverTypeAPI({showLoading:!1,success:function(t){n.store("DiscoverType",t.data),e.set({typeList:t.data})},error:function(){}});t.load();var i=new d.RecDiscoveryAPI({showLoading:!1,success:function(t){console.log(t),e.set({rec:t.data})},error:function(){}});i.load();var a=new d.DiscoverListAPI({$el:e.$el,params:{pspcode:e.user.PSP_CODE},success:function(t){c.add(t.data),e.set({data:t.data})},append:function(t){10==t.data.length&&(t.total=(this.pageIndex+1)*parseInt(this.pageSize)),e.model.getModel("data").add(t.data)},error:function(){}});a.load(),n.store("discovery_tip")||new d.ShopAPI({url:"/api/discover/standtips",checkData:!1,success:function(e){var t=new p({content:e.data});t.$el.appendTo(s("body")).find("img").on("load",function(){t.set({height:0}).show()}),t.show(),n.store("discovery_tip",sl.appVersion)},error:function(e){}}).load()}})});define("template/discovery/discovery",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{data.DCV_TITLE}}</div> <div class="head_right"> <div class="head_share js_share"></div> </div> </header> <div class="main discovery"> <div class="disc_con" html="{{data.DCV_CONTENT}}"></div> <div sn-if="{{plist}}" class="disc_relative"> <div class="hd">相关商品</div> <div class="hm_shop_scroll" ref="productScroll" style="padding-right:10px;"> <ul class="hm_shop_list" style="width:{{101*plist.length}}px"> <li class="hm_shop_list_item" sn-repeat="prd in plist" data-forward="/item/{{prd.PRD_ID}}?from={{url}}"> <img sn-src="{{prd.WPP_LIST_PIC}}" /> <p class="price">￥{{prd.PRD_PRICE}} <del sn-display="{{prd.PRD_SPECIAL_FLAG}}">¥{{prd.PRD_MEMBER_PRICE}}</del></p> <p class="name">{{prd.PRD_NAME}}</p> </li> </ul> </div> </div> <div class="disc_fav"> <div class="hd"><span>支持有态度的生活</span></div> <ul> <li> <p class="{{data.Like_Flag?\'curr\':\'\'}}" sn-tap="this.fav()">喜欢</p> </li> <li> <p class="js_share">分享</p> </li> </ul> </div> </div> <footer class="disc_bottom"> <ul> <li class="fav {{data.Like_Flag?\'curr\':\'\'}}" sn-tap="this.fav()">{{data.DCV_LIKE_QTY}}</li> <li class="share js_share">{{data.DCV_SHARE_QTY}}</li> <li class="see">{{data.DCV_VIEW_QTY}}</li> </ul> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/discovery/discovery",["components","images/style.css","images/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),c=(e("animation"),e("models/api")),p=(e("models/discovery"),e("components/share")),h=e("models/user");i.exports=a.extend({events:{"tap .js_share":function(){this.share.show()}},onCreate:function(){var e=this;l.bind(e.$(".main")),e.user=h.get(),e.share=new p({head:"分享"}),e.share.callback=function(i){t.setParam({pspcode:e.user.PSP_CODE}).load()},e.share.$el.appendTo(e.$el),e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,url:encodeURIComponent(e.route.url)}),l.bind(e.model.refs.productScroll,{hScroll:!0});var t=new c.DiscoveryAddShareAPI({$el:e.$el,params:{dcvid:e.route.data.id}}),i=new c.DiscoveryFavAPI({$el:e.$el,params:{dcvid:e.route.data.id},success:function(){e.model.set("data.Like_Flag",!0).set("data.DCV_LIKE_QTY",(e.model.data.data.DCV_LIKE_QTY||0)+1)},error:function(e){sl.tip(e.msg)}}),s=new c.DiscoveryRemoveFavAPI({$el:e.$el,params:{dcvid:e.route.data.id},success:function(){e.model.set("data.Like_Flag",!1).set("data.DCV_LIKE_QTY",(e.model.data.data.DCV_LIKE_QTY||1)-1)},error:function(e){sl.tip(e.msg)}}),n=new c.DiscoveryAPI({$el:e.$el,params:{id:e.route.data.id,pspcode:e.user.PSP_CODE},checkData:!1,success:function(t){e.model.set({data:t.data,plist:t.plist&&void 0===t.plist.length?[t.plist]:t.plist}),e.share.set({title:t.data?t.data.DCV_TITLE:"",linkURL:t.data?t.data.Share_Url:"",description:""})},error:function(){}});e.model.fav=function(){this.data.data.Like_Flag?s.setParam({pspcode:e.user.PSP_CODE}).load():i.setParam({pspcode:e.user.PSP_CODE}).load()},n.load()},onShow:function(){},onDestory:function(){}})});define("template/discovery/discovery_list",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <ul class="disc_list_sort"> <li class="curr" sn-tap="this.sortBy(\'VIEW\')">热门</li> <li sn-tap="this.sortBy(\'POST\')">最新</li> </ul> <ul class="disc_list"> <li sn-repeat="item in data" data-forward="/discovery/{{item.DCV_ID}}"> <img src="{{item.DCV_SUBTITLE_PIC}}" /> <em class="see">{{item.DCV_VIEW_QTY}}</em> <em class="fav{{item.Like_Flag?\' curr\':\'\'}}">{{item.DCV_LIKE_QTY}}</em> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/discovery/discovery_list",["components","images/style.css","images/append.css"],function(e,t,i){var s=e("$"),a=(e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),c=(e("animation"),e("models/api")),u=e("models/user");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this;l.bind(e.$(".main")),e.user=u.get(),e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:e.route.query.name||"态度"}),e.model.sortBy=function(t,i){e.discoverListAPI.setParam({orderby:"POST"==i?"desc":"asc",order:i}).reload(),s(t.currentTarget).addClass("curr").siblings(".curr").removeClass("curr")},e.discoverListAPI=new c.DiscoverListAPI({$el:e.$el,success:function(t){console.log(t),e.model.set({data:t.data})},error:function(){}})},onEnter:function(){var e=this;e.discoverListAPI.setParam({dctid:this.route.data.id||0,wd:this.route.query.s||"",pspcode:e.user.PSP_CODE,orderby:"asc",order:"VIEW"}).load()},onDestory:function(){}})});define("views/discovery/discovery_list",["components","images/style.css","images/append.css"],function(e,t,i){var s=e("$"),a=(e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),c=(e("animation"),e("models/api")),u=e("models/user");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this;l.bind(e.$(".main")),e.user=u.get(),e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:e.route.query.name||"态度"}),e.model.sortBy=function(t,i){e.discoverListAPI.setParam({orderby:"POST"==i?"desc":"asc",order:i}).reload(),s(t.currentTarget).addClass("curr").siblings(".curr").removeClass("curr")},e.discoverListAPI=new c.DiscoverListAPI({$el:e.$el,success:function(t){console.log(t),e.model.set({data:t.data})},error:function(){}})},onEnter:function(){var e=this;e.discoverListAPI.setParam({dctid:this.route.data.id||0,wd:this.route.query.s||"",pspcode:e.user.PSP_CODE,orderby:"asc",order:"VIEW"}).load()},onDestory:function(){}})});define("template/group/groupList",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div ref="main" class="main"> <div class="gp_list__wrap"> <ul class="gp_list__list"> <li class="gp_list__listitem" sn-repeat="item in data"> <p class="img" data-forward="{{isLogin?\'/group/\'+item.GPP_ID:\'/login\'}}"> <img sn-src="{{item.GPP_IMG}}"> <span class="name">{{item.GPP_NAME}}</span> </p> <p class="action"> <b class="btn_detail" data-forward="{{isLogin?\'/group/\'+item.GPP_ID:\'/login\'}}"><i>{{item.GPP_QTY}}人团</i><span class="price">¥{{item.GPP_PRICE}}</span><span class="go">去开团</span></b> <b class="btn_single" data-forward="/item/{{item.PRD_ID}}">单独购买</b> </p> </li> </ul> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/group/groupList",["components","images/style.css","images/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),c=(e("animation"),e("models/api")),u=e("models/user");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},defBackUrl:"/",onCreate:function(){var e=this;e.swipeRightBackAction=e.query.from||e.referrer||e.defBackUrl,e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"去拼团吧"}),l.bind(e.model.refs.main),e.groupListAPI=new c.GroupListAPI({$el:e.$el,success:function(t){e.model.set({data:t.data})}}),e.groupListAPI.load()},onShow:function(){var e=this;e.user=u.get(),e.model.set({isLogin:!!e.user})},onDestory:function(){}})});define("template/group/groupItem",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<div class="pd_item_wrap"> <header class="header_trans"> <div class="head_back" ref="back"></div> <div class="head_right"> <a class="head_call" href="tel:4008205077"></a> <div class="head_share js_share"></div> </div> </header> <div class="main pd_item" ref="main"> <div class="pd_slider{{data.PRD_NUM<=0?\' sold_out\':\'\'}}" ref="image"> </div> <div class="pd_info_wrap"> <div class="pd_info"> <h1>{{data.PRD_NAME}}</h1> <p class="price">{{data.PRD_PRICE}}</p> <del class="ori_price" sn-display="{{data.PRD_PRICE<data.PRD_MEMBER_PRICE}}">¥{{data.PRD_MEMBER_PRICE}}</del> <p class="pd_code"> <span class="code">商品编码 {{data.PRD_CODE}}</span> <span class="sale">销售 {{data.PSV_QTY}} 件</span> </p> <p class="pd_code" style="padding:5px 0;" sn-html="{{data.PRH_DESC}}"></p> </div> </div> <ul class="pd_sign"> <li>满99包邮</li> <li>30天退换货保障</li> </ul> <div class="pd_select_plus" sn-display="{{Package.PPG_ID}}" data-forward="/news/package{{Package.PPG_ID}}?from={{url}}"> {{Package.PPG_NAME}} </div> <div class="pd_select_size js_select_size"> 选择 尺码 颜色分类 </div> <div class="pd_jump_detail" data-forward="/detail/{{data.PRD_ID}}"><b>图文详情</b><em>建议在WIFI情况下查看</em></div> <div class="gp_item__rules" sn-html="{{GPP_Obj.GPP_CONTENT}}"> </div> <div class="pd_help"> 如果您有任何疑问，欢迎联系我们的客服。 <br> 联系热线：400-820-5077 周一至周日 9:00-19:00 </div> </div> <footer class="pd_buy gp_item__action"> <b class="btn_cart" data-forward="/cart"><i sn-display="$state.cartQty!=0">{{$state.cartQty}}</i></b> <b class="btn_single {{data.PRD_NUM==0?\'sold_out\':\'\'}}" data-forward="/item/{{data.PRD_ID}}"><em>¥{{data.PRD_PRICE}}</em>{{data.PRD_NUM==0?\'商品已售罄\':\'单独购买\'}}</b> <b class="btn_buy {{data.PRD_NUM==0?\'sold_out\':\'js_buy\'}}"><em>{{\'¥\'+GPP_Obj.GPP_PRICE}}</em>{{data.PRD_NUM==0?\'商品已售罄\':(LPP_LSP_QTY==0?GPP_Obj.GPP_QTY+\'人团\':LPP_LSP_QTY&lt;GPP_Obj.GPP_QTY?\'还差\'+(GPP_Obj.GPP_QTY-LPP_LSP_QTY)+\'人成团\':\'拼团价购买\')}}</b> </footer> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/group/groupItem",["components","images/style.css","images/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),d=e("components/share"),c=e("components/size"),p=(e("animation"),e("models/api")),h=e("widget/slider"),m=e("models/user");i.exports=a.extend({events:{'tap [ref="back"]':function(){console.log(this.swipeRightBackAction),this.back(this.swipeRightBackAction)},"tap .js_buy:not(.disabled)":function(){var e=this;return e.model.data.canBuy?void(1==e.model.data.colorSpec.length?e.user?this.size.confirm():e.forward("/login"):this.size.show()):(sl.tip(e.model.data.tip),void this.share.show())},"tap .js_share":function(){this.share.show()},"tap .js_select_size":function(){this.size.show()}},className:"pd_item_bg",requestData:function(){this.groupApi.setParam({pspcode:this.user.PSP_CODE}).load()},onCreate:function(){var e=this;e.swipeRightBackAction=e.route.query.from||e.route.referrer||e.defBackUrl,e.user=m.get(),e.model=new o.ViewModel(e.$el,{id:e.route.data.id,user:e.user,url:encodeURIComponent(e.route.url),qty:1,tip:"分享后才能购买哦"}),l.bind(e.model.refs.main),e.onResult("Login",function(){e.user=m.get(),e.model.set({user:e.user}),e.requestData()}),e.size=new c({type:"group",confirm:function(t,i,s){e.model.data.canBuy?e.groupAddToCartAPI.setParam({pspcode:e.user.PSP_CODE,prdid:i,lppid:e.model.data.LPP_ID,qty:s||1}).load():(sl.tip(e.model.data.tip),e.share.show()),e.size.hide()}}),e.size.$el.appendTo(e.$el),e.size.on("SizeChange",function(t,i){var s={PRD_NUM:i.PRD_NUM};i.WPP_LIST_PIC&&(s.WPP_LIST_PIC=i.WPP_LIST_PIC),e.model.set({data:s})}),e.groupShareAPI=new p.GroupShareAPI({$el:e.$el,params:{gppid:e.route.data.id},checkData:!1,success:function(e){}}),e.groupApi=new p.GroupAPI({$el:e.$el,params:{gppid:e.route.data.id},checkData:!1,success:function(i){var n=i.data;e.model.set({GPP_Obj:n.GPP_Obj,LPP_LSP_QTY:n.LPP_LSP_QTY,Share_Flag:n.Share_Flag,PRD_ID_LIST:n.PRD_ID_LIST}),t.setParam({id:i.data.PRD_ID_LIST[0]}).load(),s.setParam({prdId:i.data.PRD_ID_LIST[0]}).load(),e.groupShareAPI.setParam({pspcode:e.user.PSP_CODE,gppid:e.route.data.id}).load(function(t,i){console.log(i),e.model.set({LPP_ID:i.data.LPP_ID,canBuy:i.isbuy,tip:i.sharemsg}),e.share=new d({head:"分享拼团至",title:e.model.data.GPP_Obj.GPP_NAME,linkURL:i.data.LPP_SHARE_URL,description:e.model.data.GPP_Obj.GPP_NAME,image:i.data.LPP_SHARE_PIC}),e.share.$el.appendTo(e.$el)})}}),e.user&&e.requestData();var t=new p.ProductAPI({$el:e.$el,checkData:!1,success:function(t){t.data.PSV_QTY=t.psvqty,e.model.set({data:t.data}),e.size.set({qty:1,data:t.data}),t.prhpic||(t.prhpic=[]),t.prhpic.unshift({PHP_PIC_M:t.data.WPP_M_PIC}),e.slider=new h({container:e.model.refs.image,loop:!0,autoLoop:3e3,data:t.prhpic,dots:t.prhpic.length>=1,itemTemplate:'<img width="100%" height="100%" src="<%=PHP_PIC_M%>" />'}),i.setParam({id:t.data.PRD_PRH_ID}).load()}}),i=new p.ProductColorAndSpec({$el:e.$el,checkData:!1,success:function(t){for(var i=[],s=[],n=0,a=t.data.length;a>n;n++){var r=t.data[n];-1!=e.model.data.PRD_ID_LIST.indexOf(r.PRD_ID)&&(-1==i.indexOf(r.PRD_COLOR)&&i.push(r.PRD_COLOR),-1==s.indexOf(r.PRD_SPEC)&&s.push(r.PRD_SPEC))}e.model.set({color:i,spec:s,colorSpec:t.data}),e.size.set({color:i,spec:s,colorSpec:t.data})}}),s=new p.PackageRelativeAPI({$el:e.$el,checkData:!1,success:function(t){e.model.set({Package:t.data})}});e.groupAddToCartAPI=new p.GroupAddToCartAPI({$el:e.$el,checkData:!1,success:function(t){t.success?(e.setResult("CartChange"),sl.tip("加入购物车成功！")):sl.tip(t.msg)},error:function(e){sl.tip(e.msg)}})},onShow:function(){},onDestory:function(){}})});define("template/user/express",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back js_back"></div> <div class="head_title">{{title}}</div> </header> <div ref="main" class="main"> <div class="uc_express__info"> <div class="info"><span>快递公司：</span>{{data.EXP_NAME}}</div> <div class="info"><span>运单号：</span>{{data.EXP_CODE}}</div> </div> <dl class="express_list"> <dd sn-repeat="express in data.data"> <p>{{util.formatDate(express.EXP_DT)}}</p> <p>{{express.EXP_STATE_DETAIL}}</p> </dd> </dl> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/express",["components","images/style.css","images/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model")),l=e("widget/scroll"),d=e("models/api"),c=e("models/user");i.exports=a.extend({events:{"tap .js_back":function(){this.back(this.swipeRightBackAction)}},onCreate:function(){var e=this;e.model=new o.ViewModel(this.$el,{title:"跟踪物流"}),l.bind(e.model.refs.main),e.user=c.get();var t=new d.ExpressAPI({$el:e.$el,success:function(t){e.model.set({data:t})},error:function(){}});t.setParam({pur_code:e.route.data.code,pspcode:e.user.PSP_CODE}).load()},onShow:function(){},onDestory:function(){}})});