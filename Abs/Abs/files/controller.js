define("template/index",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<div sn-display="{{!showGuide}}"> <header sn-display="{{isLogin}}"> <div class="head_menu" sn-display="{{bottomTab==3}}" data-forward="/settings"></div> <ul class="head_tab" sn-display="{{bottomTab==0}}"> <li class="{{tab==0?\'curr\':\'\'}}">会员卡</li> <li class="{{tab==1?\'curr\':\'\'}}">去购物</li> <i class="cursor" style="-webkit-transform: translate3d({{tab==1?100:0}}%, 0%, 0);"></i> </ul> <div class="head_title" style="display:{{bottomTab!=0?\'block\':\'none\'}}">{{bottomTab==1?\'查找店铺\':bottomTab==2?"购物车":"我"}}</div> <div class="head_msg" data-forward="/messages"> <i sn-display="{{msg_count!=0}}">{{msg_count}}</i> </div> <div class="head_all" data-forward="/all" sn-display="{{tab==1&&bottomTab==0}}"> <i sn-display="{{msg_count!=0}}">{{msg_count}}</i> </div> </header> <div sn-display="{{!isLogin}}"> <div class="home_mask"></div> <div class="home_text" data-forward="/login"> <h1></h1> <h2>让回家的灯，为爱亮起来。</h2> <h3>开启时尚居家之旅</h3> <h4>LIFE STARTS HERE</h4> </div> <div class="launch"> <img src="images/launch0.jpg" /> <img src="images/launch1.jpg" class="launch_hide" /> <img src="images/launch2.jpg" class="launch_hide" /> </div> </div> <div sn-display="{{isLogin}}"> <div class="main hm_tab_con js_usescroll {{isLogin?\'\':\'isnotlogin\'}}" style="-webkit-transform:translate3d({{tab==0?0:-100}}%,0%,0);display:{{bottomTab==0?\'block\':\'none\'}}" data-index="0"> <div class="hm_chart_wrap"> <div class="hm_chart"> <div class="hm_chart_con" sn-tap="chartType=1" sn-display="{{chartType==0}}"> <div class="hd">当前活力值</div> <div class="bd">{{util.formatMoney(energyAnimNum)}}</div> <div class="ft">目标 {{util.formatMoney(levelAmounts)}}</div> </div> <div class="hm_chart_con" sn-tap="chartType=2" sn-display="{{chartType==1}}"> <div class="hd">我的月礼</div> <div class="bd">{{user.FreeMonths}}</div> </div> <div class="hm_chart_con" sn-tap="chartType=3" sn-display="{{chartType==2}}"> <div class="hd">我的卡券</div> <div class="bd">{{user.FreeCouponsCount+user.CouponsCount}}</div> </div> <div class="hm_chart_con" sn-tap="chartType=0" sn-display="{{chartType==3}}"> <div class="hd">积分钱包</div> <div class="bd">{{user.Points}}</div> </div> <canvas class="hm_chart_canvas js_canvas"></canvas> </div> <div class="hm_chart_desc">{{vipName}}</div> <div class="hm_steward_link" data-forward="/steward">您现在拥有<em>{{user.StewardNum}}</em>条爱管家记录啦！</div> <ul class="hm_chart_list"> <li data-forward="/month"><i>我的月礼</i><em>{{user.FreeMonths}}</em></li> <li data-forward="/coupon"><i>我的卡券</i><em>{{user.FreeCouponsCount+user.CouponsCount}}</em></li> <li data-forward="/mypoint"><i>积分钱包</i><em>{{user.Points}}</em></li> </ul> </div> <div class="hm_my_barcode"> <div class="barcode" sn-html="{{barcode}}"> </div> <div class="mobile">{{user.Mobile}}</div> </div> <ul class="hm_cards"> <li data-forward="/list?type=new&from=%2f"><i></i> <p>NEW ARRIVAL</p> <p>新品上市</p> </li> <li data-forward="/news/activity2"><i></i> <p>BEST BUYS</p> <p>最热商品</p> </li> <li data-forward="/news/fastbuy?from=%2f"><i></i> <p>FLASH SALE</p> <p>周一闪购</p> </li> <li data-forward="/news/activity3"><i></i> <p>APP ONLY</p> <p>APP专享</p> </li> </ul> </div> <div class="main js_shop hm_tab_con" style="-webkit-transform:translate3d({{tab==1?0:100}}%,0%,0);display:{{bottomTab==0?\'block\':\'none\'}}" data-index="1"> <div class="hm_shop"> <div class="hm_cate"> <div class="hd" data-forward="/all">所有<br>商品</div> <div class="bd"> <ul> <li data-forward="/all?id=1">出行</li> <li data-forward="/all?id=2">睡眠</li> <li data-forward="/all?id=3">美食</li> <li data-forward="/all?id=4">沐浴</li> </ul> <ul> <li data-forward="/all?id=5">休闲</li> <li data-forward="/all?id=6">家务</li> <li data-forward="/all?id=7">空间</li> <li data-forward="/all?id=8">儿童</li> </ul> </div> </div> <div class="banner"> <img src="{{item.src}}" sn-repeat="item in topbanner.data" data-forward="{{item.url}}?from=%2f" /> </div> <ul class="hm_shop_cate"> <li data-forward="/list?type=new&from=%2f"><i></i>新品<br>上市</li> <li data-forward="/news/activity2"><i></i>最热<br>商品</li> <li data-forward="/news/fastbuy?from=%2f"><i></i>周一<br>闪购</li> <li data-forward="/news/activity3"><i></i>APP<br>专享</li> </ul> <div sn-repeat="item in activity"> <div sn-if="{{item.type==1}}" class="hm_shop_banner js_shop_scroll"> <ul style="width:{{item.data.length*100}}%"> <li><img sn-repeat="img in item.data" data-src="{{img.src}}" data-forward="{{img.url}}?from=%2f" /></li> </ul> </div> <div sn-if="{{item.type==2&&item.data.length}}" class="hm_shop_scroll js_shop_scroll" style="padding-right:10px;"> <ul class="hm_shop_list"> <li class="hm_shop_list_item" sn-repeat="prd in item.data" data-forward="/item/{{prd.PRD_ID}}?from={{encodeURIComponent(\'/\')}}"> <img data-src="{{prd.WPP_LIST_PIC}}" /> <p class="price">￥{{prd.PRD_PRICE}} <del sn-display="{{prd.PRD_SPECIAL_FLAG}}">¥{{prd.PRD_MEMBER_PRICE}}</del></p> <p class="name">{{prd.PRD_NAME}}</p> </li> </ul> </div> </div> </div> </div> <div class="main" style="display:{{bottomTab==1?\'block\':\'none\'}}"> <div class="baiduMap" sn-html="{{baiduMap}}"> </div> </div> <div class="main js_cart" style="display:{{bottomTab==2?\'block\':\'none\'}}"> </div> <div class="main" style="display:{{bottomTab==3?\'block\':\'none\'}}" data-index="3"> <div class="hm_my_card"> <div class="vip_name">{{vipName}}</div> <div class="energy"> 当前活力值<span>{{util.formatMoney(energy)}}</span> </div> <div class="energy_bar"> <span style="width:{{energyPercent}}"></span> </div> <div class="energy_val"> <div class="energy_val_from">{{util.formatMoney(currentLevel)}}</div> <div class="energy_val_to">{{util.formatMoney(nextLevel)}}</div> </div> </div> <div class="hm_my_barcode"> <div class="barcode" sn-html="{{barcode}}"> </div> <div class="mobile">{{user.Mobile}}</div> </div> <ul class="hm_my_list"> <li data-forward="/month"> <b>我的月礼</b> <span><em>{{user.FreeMonths}}</em>个月</span> </li> <li data-forward="/coupon"> <b>我的卡券</b> <span><em>{{user.FreeCouponsCount+user.CouponsCount}}</em>张</span> </li> <li data-forward="/mypoint"> <b>积分钱包</b> <span><em>{{user.Points}}</em>分</span> </li> <li data-forward="/myorder"> <b>购买记录</b> <span><em>{{user.OrderCount}}</em>条</span> </li> <li data-forward="/steward"> <b>爱管家记录</b> <span><em>{{user.StewardNum}}</em>条</span> </li> </ul> </div> <div class="main js_offline" sn-display="{{isOffline}}"> <div class="home_offline"> <div class="ico"></div> <div class="txt">您的网络不太顺畅哦</div> <div class="txt_sub">请检查您的手机是否联网</div> <div class="btn">重新加载</div> </div> </div> </div> <ul class="footer" sn-display="{{isLogin}}"> <li class="curr">首页</li> <li>附近门店</li> <li>购物车<i sn-display="$state.cartQty!=0">{{$state.cartQty}}</i></li> <li>我</li> </ul> <div class="open_msg" style="display:none"> <div class="msg_bd" sn-html="{{message}}"></div> </div> <div class="home_tip_mask" sn-display="{{isLogin&&showTipStep==1}}"></div> </div> <div class="hm_guide" sn-display="{{showGuide}}"> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/index",["components","images/style.css","images/append.css"],function(t,e,i){var n=t("$"),s=t("util"),r=t("activity"),o=t("bridge"),a=t("../widget/loading"),l=t("../widget/slider"),c=t("core/model2"),u=t("../widget/scroll"),h=t("../util/barcode"),d=t("animation"),p=t("components/confirm"),f=t("models/base"),m=t("models/user");c.State.set({cartQty:0});var v=new f.CartQtyAPI({$el:n(""),checkData:!1,success:function(t){c.State.set({cartQty:t.data})},error:function(){}});i.exports=r.extend({events:{"tap .head_tab li":function(t){this.model.set("tab",n(t.target).index())},"tap .home_tip_mask":function(t){s.store("showTipStep",2),this.model.set({showTipStep:2})},"tap .open_msg":function(t){n(t.target).hasClass("open_msg")&&n(t.target).removeClass("show")},"tap .js_offline .btn":function(){m.request()},"tap .js_comment_list [data-id]":function(t){},"tap .rainbow_bd":function(t){this.$(".footer li").eq(3).trigger("tap")},"tap .footer li":function(t){var e=this,i=n(t.currentTarget),r=i.index();return 2==r?void e.forward("/cart"):void(i.hasClass("curr")||(i.addClass("curr").siblings(".curr").removeClass("curr"),this.model.set({bottomTab:r}),1==r&&(this.model.data.baiduMap||(this.model.set("baiduMap",'<iframe class="js_baidu_map" src="'+o.url("/baiduMap.html?v3")+'" frameborder="0" ></iframe>'),this.$baiduMap=this.$(".js_baidu_map").css({width:window.innerWidth,height:window.innerHeight-47-44-(s.isInApp?20:0)})),o.getLocation(function(t){e.$baiduMap[0].src=o.url("/baiduMap.html?v3#longitude="+t.longitude+"&latitude="+t.latitude)}))))},"touchstart .hm_tab_con":function(t){var e=this;this.pointY=this.startY=t.touches[0].pageY,this.pointX=this.startX=t.touches[0].pageX,this.isTouchStop=!1,this.isTouchStart=!1,this.isTouchMoved=!1,this.x=e.model.data.tab?-window.innerWidth:0,this.x1=e.model.data.tab?0:window.innerWidth},"touchmove .hm_tab_con":function(t){var e=this,i=t.touches[0].pageX,n=t.touches[0].pageY,s=e.startX-i,r=e.startY-n;if(!e.isTouchStart){var o=Math.abs(s)>0&&Math.abs(s)>Math.abs(r);if(!o)return void(e.isTouchStop=!0);e.isTouchStart=!0,e.isDirectionX=o}var a=Math.max(-window.innerWidth,Math.min(0,this.x-s)),l=Math.max(0,Math.min(window.innerWidth,this.x1-s));e.moveX=a,e.$tabs.eq(0).css({"-webkit-transform":"translate("+a+"px,0px)","-webkit-transition":"0ms"}),e.$tabs.eq(1).css({"-webkit-transform":"translate("+l+"px,0px)","-webkit-transition":"0ms"}),this.dir=this.pointX-i>0?"left":"right",this.pointX=i,this.pointY=n,e.isTouchMoved=!0},"touchend .hm_tab_con":function(t){var e=this;if(e.isTouchMoved&&(e.isTouchMoved=!1,!e.isTouchStop))return e.isTouchStop=!0,n(t.target).trigger("touchcancel"),e.$tabs.css({"-webkit-transition":"-webkit-transform 300ms ease-out 0ms"}).each(function(){this.clientHeight}),e.moveX!=this.x&&e.model.set({tab:e.model.data.tab?0:1}),!1},"tap .guide3":function(){this.model.set({showGuide:!1})}},className:"home",onCreate:function(){var t=this;t.user=m.get(),t.$tabs=t.$(".hm_tab_con"),sl.activity=t;var e=new f.UpdateAPI({$el:n(""),checkData:!1,params:{version:sl.appVersion,platform:s.ios?1:2},success:function(t){if(t.success&&t.data.AVS_UPDATE_URL){var e=new p({content:t.data.AVS_UPDATE_MSG,alwaysOpen:t.data.AVS_FORCE_FLAG,confirm:function(){o.update(t.data.AVS_UPDATE_URL,t.data.AVS_VERSION)}});e.$el.appendTo(n("body")),e.show()}},error:function(){}});e.load(),this.model=new c.ViewModel(this.$el,{menu:"head_menu",titleClass:"head_title",isOffline:!1,isLogin:!!t.user,isFirstOpen:null===s.store("isFirstOpen"),msg:0,tab:0,bottomTab:0,chartType:0,open:function(){o.openInApp(t.user.OpenUrl||"http://m.abs.cn")},openUrl:function(t,e){o.openInApp(e||"http://m.abs.cn")}}),this.model.on("change:tab",function(){1==this.data.tab&&t.scroll.get(".js_shop").imageLazyLoad()}),s.store("IS_SHOW_GUIDE")||(s.store("IS_SHOW_GUIDE",1),this.model.set("showGuide",!0),this.guideSlider=new l(t.$(".hm_guide"),{itemTemplate:'<img class="guide<%=id%>" src="http://appuser.abs.cn/dest/images/guide<%=id%>.jpg" />',data:[{id:0},{id:1},{id:2},{id:3}],onChange:function(t){}}));var i=this.$main=this.$(".main");this.scroll=u.bind(i),t.$open_msg=this.$(".open_msg").on(n.fx.transitionEnd,function(e){t.$open_msg.hasClass("show")||t.$open_msg.hide()}),u.bind(t.$open_msg.find(".msg_bd"));var r=this.$(".js_canvas")[0];r.width=170,r.height=170,this.canvas=r,this.context=r.getContext("2d"),this.stewardQtyApi=new f.StewardQtyAPI({$el:this.$el,checkData:!1,success:function(e){t.user.StewardNum=e.data,m.set(t.user),t.model.set("user.StewardNum",e.data)}}),this.launchLoading=new a({url:"/api/settings/ad_list?name=launch&type=base64",check:!1,checkData:!1,$el:n(""),success:function(t){t&&t.data&&t.data.length&&localStorage.setItem("LAUNCH_IMAGE",t.data[0].Src)}}),this.launchLoading.load();var h=this.$(".launch img"),d=this.$(".home_mask").on(n.fx.transitionEnd,function(t){if(d.hasClass("toggle")){d.removeClass("toggle");var e=h.filter(":not(.launch_hide)").addClass("launch_hide");h.eq(e.index()+1==h.length?0:e.index()+1).removeClass("launch_hide")}});setTimeout(function(){d.addClass("toggle"),setTimeout(arguments.callee,3200)},3200),t.onResult("Login",function(){t.user=m.get(),t.model.set({isOffline:!1,user:t.user}),t.doWhenLogin()}).onResult("UserChange",function(){t.requestUser()}).onResult("Logout",function(){t.model.set({isLogin:!1,user:null})}).onResult("CartChange",function(){t.getCartQty()}),t.shopApi=new f.ActivityAPI({$el:t.$(".hm_shop"),success:function(e){t.model.set({activity:e.data,topbanner:e.topbanner}),u.bind(t.$(".js_shop_scroll:not(.s_binded)").addClass("s_binded"),{vScroll:!1,hScroll:!0,useScroll:!0}),1==t.model.data.tab&&t.scroll.get(".js_shop").imageLazyLoad(),this.showMoreMsg('别拉了，就这些<i class="ico_no_more"></i>')}}),t.shopApi.load(),setInterval(function(){t.getUnreadMsg()},1e4)},getCartQty:function(){this.user.PSP_CODE&&v.setParam({pspcode:this.user.PSP_CODE}).load()},requestUser:function(){var t=this;m.request(function(e,i){return e?(503==e.error_code&&(m.set(null),t.model.set("isLogin",!1)),void t.model.set("isOffline",!0)):(m.set(i.data),t.user=m.get(),t.model.set({isOffline:!1,user:t.user}),t.getCartQty(),t.showEnergy(),t.stewardQtyApi.setParam({pspcode:t.user.PSP_CODE}).load(),void(i.vdpMessage&&(t.model.set("showTipStep",1),t.$open_msg.show(),t.$open_msg[0].clientHeight,t.$open_msg.addClass("show"),t.model.set({message:i.vdpMessage}),s.store("ivcode",null))))},s.store("ivcode")||"0000")},_angleFrom:0,drawCircle:function(t){this._angleFrom||(this._angleFrom=1.5*Math.PI);var e=Math.floor(1e3*(1.5+2*t))/1e3*Math.PI,i=this.context,n=this.canvas,s=n.width/2,r=n.height/2,o=s-10;i.clearRect(0,0,n.width,n.height),i.beginPath(),i.arc(s,r,o,this._angleFrom,e,!1),i.lineWidth=19,i.strokeStyle="#fff",i.stroke()},showEnergy:function(){if(this.user){var n,r,o,a,t=this,e=Math.round(this.user.Amount),i=1,l=["银卡会员","金卡会员","钻石会员","VIP会员","SVIP会员","无敌会员"];t.model.set("vip",e<(a=1e3)?(n=0,o=0,r=1e3,l[1]):e<(a=5e3)?(n=1,o=1e3,r=5e3,l[2]):e<(a=1e4)?(n=2,o=5e3,r=1e4,l[3]):e<(a=5e4)?(n=3,o=1e4,r=5e4,l[4]):(n=4,r="0",l[5])),i=Math.min(1,e/a),t.model.set({nextLevel:r,currentLevel:o,vipName:l[n],levelAmounts:a,energyPercent:100*i+"%",ucCardAmounts:s.formatMoney(e)+(e>5e4?"":"/"+s.formatMoney(a))}),e!=t.model.data.energy&&(t.model.set({energy:e}),d.animate(function(n){var s=Math.round(d.step(0,e,n));t.model.set("energyAnimNum",s),t.drawCircle(d.step(0,i,n))},800,"ease-out"))}},getUnreadMsg:function(){var t=this;t.user&&t.user.Auth&&n.post(o.url("/api/user/get_unread_msg_count"),{UserID:t.user.ID,Auth:t.user.Auth},function(e){e.success&&t.model.set("msg_count",e.count)},"json")},doWhenLogin:function(){var t=this,e=m.get();t.model.set({barcode:h.code93(e.Mobile).replace(/0/g,"<em></em>").replace(/1/g,"<i></i>"),isLogin:!0});var i=function(e){m.setParam({IMEI:e?"string"==typeof e?e:e.imei:"CAN_NOT_GET"}),t.requestUser()};s.isInApp?o.getDeviceToken(i):i()},onLoad:function(){this.user&&(this.showEnergy(),this.doWhenLogin())},onShow:function(){this.setResult("ResetCart"),this.guideSlider&&this.guideSlider._adjustWidth()},onPause:function(){},onDestory:function(){}})});define("template/about",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back=\'{{back}}\'></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="aboutus"> ABS尊重并保护所有使用ABS平台服务用户的个人隐私权。为了给您提供更准确、更有个性化的服务，ABS会按照本隐私权政策的规定使用和披露您的个人信息。但ABS将以高度的勤勉、审慎义务对待这些信息。除本隐私权政策另有规定外，在未征得您事先许可的情况下，ABS不会将这些信息对外披露或向第三方提供。ABS会不时更新本隐私权政策。您在同意ABS服务协议之时，即视为您已经同意本隐私权政策全部内容。本隐私权政策属于ABS服务协议不可分割的一部分。<br><br> <b>1. 适用范围</b><br> a） 在您注册或激活可以登录ABS平台的账户时，您在ABS平台提供的个人注册信息（应法律法规要求需公示的企业名称等相关工商注册信息以及自然人经营者的信息除外）；<br> b） 在您使用ABS平台服务，或访问ABS平台网页时，ABS自动接收并记录的您的浏览器和计算机上的信息，包括但不限于您的IP地址、浏览器的类型、使用的语言、 访问日期和时间、软硬件特征信息及您需求的网页记录等数据；如您下载或使用ABS或其关联公司移动客户端软件，或访问移动网页使用ABS平台服务时，ABS可能会读取与您位置和移动设备相关的信息，包括但不限于设备型号、设备识别码、操作系统、分辨率、电信运营商等。<br> c） ABS通过合法途径从商业伙伴处取得的用户个人数据。<br> 您了解并同意，以下信息不适用本隐私权政策：<br> a）您在使用ABS平台提供的搜索服务时输入的关键字信息；<br> b）ABS收集到的您在ABS进行交易的有关数据，包括但不限于出价、成交信息及评价详情；<br> c）信用评价、违反法律规定或违反ABS规则行为及ABS已对您采取的措施。<br><br> <b>2. 信息使用</b><br> a) ABS不会向任何无关第三方提供、出售、出租、分享或交易您的个人信息，除非事先得到您的许可，或该第三方和ABS单独或共同为您提供服务，且在该服务结束后，其将被禁止访问包括其以前能够访问的所有这些资料。<br > b)ABS亦不允许任何第三方以任何手段收集、编辑、出售或者无偿传播您的个人信息。任何ABS平台用户如从事上述活动，一经发现，ABS有权立即终止与该用户的服务协议。<br> c) 为服务用户的目的，ABS或其关联公司可能通过使用您的个人信息，向您提供您可能感兴趣的信息，包括但不限于向您发出产品和服务信息，或通过系统向您展示个性化的第三方推广信息，或者与ABS合作伙伴共享信息以便他们向您发送有关其产品和服务的信息（后者需要您的事先同意）。<br> d) ABS可以使用您的个人信息以预防、发现、调查欺诈、危害安全、非法或违反与ABS或其关联公司协议、政策或规则的行为，以保护您、其他ABS用户，或ABS或其关联公司合法权益。<br><br> <b>3. 信息存储和交换</b><br> ABS收集的有关您的信息和资料将保存在ABS及（或）其关联公司的服务器上，这些信息和资料可能传送至您所在国家、地区或ABS收集信息和资料所在地的境外并在境外被访问、存储和展示。<br><br> <b>4. Cookie的使用</b><br> a) 在您未拒绝接受cookies的情况下，ABS会在您的计算机上设定或取用cookies，以便您能登录或使用依赖于cookies的ABS平台服务或功能。ABS使用cookies可为您提供更加周到的个性化服务，包括推广服务。<br> b) 您有权选择接受或拒绝接受cookies。您可以通过修改浏览器设置的方式拒绝接受cookies。但如果您选择拒绝接受cookies，则您可能无法登录或使用依赖于cookies的ABS平台服务或功能。<br> c) 通过ABS所设cookies所取得的有关信息，将适用本政策；<br><br> <b>5. 未成年人的特别注意事项</b><br> 如果您不是具备完全民事权利能力和完全民事行为能力的自然人，您无权使用ABS平台服务，因此ABS希望您不要向我们提供任何个人信息。<br><br> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/about",["components","images/style.css","images/append.css"],function(t,e,i){var r=(t("$"),t("util"),t("activity")),o=t("core/model2"),a=t("../widget/scroll");t("animation");return r.extend({events:{},swipeRightBackAction:"/settings",onCreate:function(){var e=this.$(".main");a.bind(e),this.model=new o.ViewModel(this.$el,{back:"/settings",title:"隐私政策"})},onShow:function(){},onDestory:function(){}})});define("template/member",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main scrollview"> <div class="member"> <dl class="member_info"> <dt>登录名</dt> <dd><p sn-binding="html:user.Mobile"></p></dd> <dt>姓名</dt> <dd><input sn-binding="value:user.UserName" sn-model="user.UserName" /></dd> <dt>性别：</dt> <dd> <span class="radio" sn-model="user.Gender" value="1" sn-binding="class:user.Gender|case:\'1\':\'checked\':\'\'">男</span> <span class="radio" sn-model="user.Gender" value="2" sn-binding="class:user.Gender|case:\'2\':\'checked\':\'\'">女</span> </dd> <dt>生日</dt> <dd><input type="text" sn-binding="value:user.BirthDay|date:\'yyyy/MM/dd\'" sn-model="user.BirthDay" /></dd> <dt>所在地</dt> <dd sn-on="tap:showCity"><p sn-binding="html:user.City"></p></dd> <dt>家庭人数</dt> <dd><input sn-binding="value:user.FamilySize" sn-model="user.FamilySize" /></dd> <dt>是否有小孩：</dt> <dd> <span class="radio" sn-model="user.HasChild" value="1" sn-binding="class:user.HasChild|equal:true:\'checked\':\'\'">是</span> <span class="radio" sn-model="user.HasChild" value="0" sn-binding="class:user.HasChild|equal:false:\'checked\':\'\'">否</span> </dd> <dt>小孩生日</dt> <dd><input type="text" sn-binding="value:user.ChildBirthDay" sn-model="user.ChildBirthDay" /></dd> </dl> <div class="member_bar"> <b class="btn_mid" sn-on="tap:submit" sn-binding="class:submiting|equal:true:\'disabled\':\'\'">修改</b> </div> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/member",["components","images/style.css","images/append.css"],function(t,e,i){var n=t("$"),s=t("util"),r=t("activity"),a=t("core/model"),l=(t("../widget/scroll"),t("bridge")),c=t("../widget/loading"),u=t("../widget/selector");return r.extend({events:{"tap .radio":function(t){var e=n(t.currentTarget),i=t.currentTarget.getAttribute("value");this.model.set(e.attr("sn-model"),i)}},onCreate:function(){var t=this;t.swipeRightBackAction=this.route.query.from||"/settings",this.model=new a.ViewModel(this.$el,{title:"个人信息",back:t.swipeRightBackAction,showCity:function(){var i=s.indexOf(t.provinceList,function(e){return e.PRV_ID==t.model.data.user.ProvID});-1!=i&&(t.city.eq(0).index(i),e(t.model.data.user.ProvID)),t.city.show()},submit:function(){this.set("submiting",!0);var e=this.data.user;t.update.setParam({ID:e.ID,Auth:e.Auth,UserName:e.UserName,Gender:e.Gender,BirthDay:e.BirthDay&&s.formatDate(e.BirthDay),ChildBirthDay:e.ChildBirthDay&&s.formatDate(e.ChildBirthDay),CityID:e.CityID,FamilySize:e.FamilySize,HasChild:e.HasChild}).load()}}),this.update=new c({url:"/api/user/update",check:!1,checkData:!1,$el:this.$el,success:function(e){e.success?(s.store("user",t.model.data.user),sl.tip("修改成功")):sl.tip(e.msg),t.model.set("submiting",!1)}}),this.city=new u({options:[{template:"<li><%=PRV_DESC%></li>",data:[],onChange:function(t,i,n){e(n.PRV_ID)}},{template:"<li><%=CTY_DESC%></li>",data:[]}],complete:function(e){t.model.set("user.City",e[1].CTY_DESC),t.model.set("user.CityID",e[1].CTY_ID),t.model.set("user.ProvID",e[1].CTY_PRV_ID)}});var e=function(e){var i=s.find(t.cityList,function(t){return t.CTY_PRV_ID==e});if(i.unshift({CTY_PRV_ID:e,CTY_ID:0,CTY_DESC:"请选择"}),t.city.eq(1).set(i),t.model.data.user){var n=s.indexOf(i,function(e){return e.CTY_ID==t.model.data.user.CityID});-1!=n&&t.city.eq(1).index(n)}};n.get(l.url("/api/user/get_city"),function(i){i.province.unshift({PRV_ID:0,PRV_DESC:"请选择"}),t.city.eq(0).set(i.province),t.provinceList=i.province,t.cityList=i.data,e(i.province[0].PRV_ID)},"json")},onShow:function(){var t=this,e=s.store("user");e?(t.user=e,this.loading=new c({url:"/api/user/get",check:!1,checkData:!1,params:{UserID:e.ID,Auth:e.Auth},$el:this.$el,success:function(i){t.user=e=n.extend(e,i.data),s.store("user",e),t.model.set({user:e,"NickName.input":e.NickName,"Address.input":e.Address})}}),this.loading.load()):this.forward("/login")},onDestory:function(){}})});define("template/settings",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <ul class="uc_settings"> <li data-forward="/member">账户信息</li> <li data-forward="/modifypwd">修改密码</li> <li data-forward="/address?from=/settings">收货地址</li> <li data-forward="/about?from=/settings">隐私政策</li> <li sn-click="logout">退出登录</li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/settings",["components","images/style.css","images/append.css"],function(t,e,i){var r=(t("$"),t("util"),t("activity")),o=(t("../widget/loading"),t("core/model2")),l=t("../widget/scroll"),u=(t("animation"),t("models/user"));return r.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var t=this,e=this.$(".main");l.bind(e),t.swipeRightBackAction=t.route.query.from||"/";var i=u.get();this.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,title:"设置",user:i,logout:function(e){t.confirm("你确认要退出登录?",function(){u.get()?(u.set(null),t.setResult("Logout"),t.back("/")):t.forward("/login")})}})},onShow:function(){},onDestory:function(){}})});define("template/login",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div sn-binding="html:title" class="head_title"></div> <div class="head_back" sn-binding="data-back:back"></div> </header> <div class="main"> <div class="login_form"> <h1 class="login_hd">注册/登录</h1> <ul class="form"> <li class="form_mobile"><input placeholder="请输入您的手机号码" sn-model="mobile" type="tel" /></li> <li><input placeholder="请输入短信验证码" sn-model="smsCode" type="tel" /><b class="js_valid btn_middle" sn-binding="html:valid"></b></li> <li><input placeholder="请输入好友的邀请码" sn-model="invitedCode" type="tel" /></li> </ul> <div class="login_btn"><b class="btn_large js_login">手机号登录</b> </div> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/login",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),r=t("activity"),a=t("../widget/loading"),o=t("../core/model"),l=t("../widget/scroll"),u=(t("animation"),t("models/user"));return r.extend({events:{"tap .js_login:not(.disabled)":function(){var t=this.model.get("mobile"),e=this.model.get("smsCode");return t&&s.validateMobile(t)?e?void this.loading.setParam({mobile:t,smsCode:e,invitedCode:this.model.data.invitedCode,platform:navigator.platform,deviceVersion:(s.ios?"IOS ":"Android ")+s.osVersion,version:sl.appVersion}).load():void sl.tip("请输入密码"):void sl.tip("请输入正确的手机")},"tap .js_valid:not(.disabled)":function(t){var e=this.model.get("mobile");return e&&s.validateMobile(e)?(this.$valid.addClass("disabled"),this.valid.setParam({mobile:this.model.data.mobile}),void this.valid.load()):void sl.tip("请输入正确的手机")}},validTimeout:function(){var t=this,e=localStorage.getItem("valid_time");if(e&&parseInt(e)>60){if(e=Math.round((new Date(parseInt(e)).getTime()-Date.now())/1e3),0>=e)return;t.$valid.addClass("disabled"),setTimeout(function(){0>=e?(t.$valid.removeClass("disabled"),t.model.set("valid","获取验证码"),localStorage.removeItem("valid_time")):(t.model.set("valid",e+"秒后再次获取"),e--,setTimeout(arguments.callee,1e3))},1e3)}},onCreate:function(){var t=this,e=this.$(".main");this.swipeRightBackAction=this.route.query.from||"/",l.bind(e),this.model=new o.ViewModel(this.$el,{title:"快速登录 / 注册",valid:"获取验证码",back:this.swipeRightBackAction}),this.loading=new a({url:"/api/user/login",method:"POST",check:!1,checkData:!1,$el:this.$el,success:function(e){if(e.success){s.store("ivcode",e.ivcode||null);var i=t.route.query.success||t.swipeRightBackAction;u.set(e.data).request(function(){t.back(i),setTimeout(function(){t.setResult("Login")},0)})}else sl.tip(e.msg)},error:function(t){sl.tip(t.msg)}}),this.valid=new a({url:"/api/user/send_sms",method:"POST",params:{mobile:t.model.data.mobile},check:!1,checkData:!1,$el:this.$el,success:function(e){e.success?(localStorage.setItem("valid_time",Date.now()+6e4),t.validTimeout()):sl.tip(e.msg)},error:function(e){sl.tip(e.msg),t.$valid.removeClass("disabled"),this.hideLoading()}}),t.$valid=this.$(".js_valid"),t.validTimeout()},onShow:function(){},onDestory:function(){}})});define("template/user/month",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main uc_month"> <div sn-display="{{user.FreeMonths}}"> <div class="uc_month_card"> <div class="uc_month_card_user"> <b>{{currentLevel}}</b> <span>({{ucCardAmounts}})</span> <p> 亲，不要忘记啦！<br /> 您还有<em>{{user.FreeMonths}}</em>个月的会员礼可以领取哟！ </p> </div> <div class="uc_month_val"> <b>我的月礼</b> <span>({{user.FreeMonths}}/{{user.TotalMonths}})</span> </div> </div> <div class="uc_months_slider"> <ul class="uc_month_slider_tit"> <li class="{{year-1==current.Year?\'curr\':\'\'}}">{{year-1}}</li> <li class="{{year==current.Year?\'curr\':\'\'}}">{{year}}</li> <li class="{{(year+1)==current.Year?\'curr\':\'\'}}">{{year+1}}</li> </ul> <div class="uc_month_slider"> </div> </div> </div> <div class="my_nodata" sn-display="{{!user.FreeMonths}}" style="display:none"> <div class="icon"></div> <div class="text">您目前还没有免费领取特权哦！</div> <div class="btn" data-forward="/all?from=/month">去逛逛吧</div> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/user/month",["components","images/style.css","images/append.css"],function(t,e,i){var n=t("$"),s=t("util"),r=t("activity"),a=t("widget/loading"),o=t("widget/slider"),l=t("core/model2"),c=t("widget/scroll"),u=(t("animation"),t("bridge"));return r.extend({events:{"tap .js_canget":function(t){this.forward("/news/month"+n(t.currentTarget).attr("data-id")+"?from="+encodeURIComponent(this.route.url))}},swipeRightBackAction:"/",onCreate:function(){var t=this;t.user=s.store("user"),this.$main=this.$(".main"),c.bind(this.$main),this.model=new l.ViewModel(this.$el,{title:"我的月礼",back:this.route.query.from||"/",user:t.user,openPresent:function(e,i){if(i.data.CanGet){var n="";t.user.OpenUrl&&(n=t.user.OpenUrl.substr(t.user.OpenUrl.lastIndexOf("?"))),u.openInApp("http://m.abs.cn/free/"+i.data.FRE_ID+".html"+n)}}}),t.$slider=this.$(".uc_month_slider"),this.nextLoading=new a({url:"/api/user/get_month_by_date",$el:n(""),checkData:!1,params:{UserID:t.user.ID,Auth:t.user.Auth},success:function(e){if(console.log(e.data.length),!e.data.length)return sl.tip("没有更多月礼了"),t.model.set({nomore:!0}),void t.slider.index(1);var i=t.slider._data;i.shift(),i=e.data.concat(i),t.model.set({data:i,minDate:e.minDate,current:i&&i[e.data.length]}),t.slider.set(i),t.slider.index(e.data.length-1)}}),this.loading=new a({url:"/api/user/get_month_free",params:{id:this.route.data.id,UserID:t.user.ID,Auth:t.user.Auth},check:!1,checkData:!1,$el:this.$el,$content:this.$main.children(":first-child"),$scroll:this.$main,success:function(e){t.model.set({currentMonth:e.currentMonth,data:e.data,minDate:e.minDate,current:e.data&&e.data[0],year:e.year}),t.slider=new o(t.$slider,{itemTemplate:'<%if (FRE_TITLE_PIC=="loading") {%><div class="img"><div class="dataloading" style="opacity:1"></div></div><%}else{%><p class="img<%=CanGet?" canget js_canget":""%><%=Overdue?" disabled":""%><%=FRE_ID&&LPF_PUR_ID?" hasget":""%>" data-id="<%=FRE_ID%>">                                    <img src="<%=FRE_TITLE_PIC||(Overdue?"images/overdue.jpg":"images/coming_soon.png")%>" />                                </p>                                <span><%=Month%>月</span><%}%>',data:e.data,onChange:function(e){t.model.set({current:t.slider._data[e]}),"loading"==t.slider._data[e].FRE_TITLE_PIC&&(t.model.data.nomore?setTimeout(function(){t.slider.index(1)},0):t.nextLoading.load())}}),t.slider.on("move",function(){t.model.data.minDate&&!t.nextLoading.isLoading&&!this.added&&this.x<-30&&(this.added=!0,"loading"!==t.slider._data[0].FRE_TITLE_PIC&&t.slider.prepend({FRE_TITLE_PIC:"loading"}),t.nextLoading.setParam({startMonth:t.model.data.minDate}),this.canLoad=!0)}).on("end",function(){this.added=!1}).on("stop",function(){this.canLoad&&(this.canLoad=!1,0==this.index()&&(t.model.data.nomore?t.slider.index(1):t.nextLoading.load()))})},error:function(t){sl.tip(t.msg)}}),t.doWhenLogin()},doWhenLogin:function(){var n,r,o,t=this,e=Math.round(this.user.Amount),i=1,l=["银卡会员","金卡会员","钻石会员","VIP会员","SVIP会员","无敌会员"];t.model.set("vip",e<(o=1e3)?(n=0,r=1e3-e,l[1]):e<(o=5e3)?(n=1,r=5e3-e,l[2]):e<(o=1e4)?(n=2,r=1e4-e,l[3]):e<(o=5e4)?(n=3,r=5e4-e,l[4]):(n=4,r="0",l[5])),i=Math.min(1,e/o),t.model.set({energy:e,nextLevel:r,currentLevel:l[n],levelAmounts:o,energyPercent:100*i+"%",ucCardAmounts:s.formatMoney(e)+(e>5e4?"":"/"+s.formatMoney(o))}),t.loading.setParam({UserID:t.user.ID,Auth:t.user.Auth}).load()},onShow:function(){},onDestory:function(){}})});define("template/user/coupon",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main uc_coupon"> <div class="uc_coupon_help" style="font-size:3rem;margin-top:15px;" data-forward="/news/coupon?from=/coupon">使用规则</div> <div class="uc_coupon_get"> <input type="text" sn-model="code" placeholder="请输入券码" /> <b class="btn" sn-tap="this.couponApi.load()">我要领券</b> </div> <ul class="uc_coupon_hd"> <li class="{{isOverdue?\'\':\'curr\'}}" sn-tap="isOverdue=false">优惠券</li> <li class="{{isOverdue?\'curr\':\'\'}}" sn-tap="isOverdue=true">免邮卡</li> </ul> <ul class="uc_coupon_list js_not_overdue" sn-display="{{!isOverdue}}"> <li sn-repeat="item in data" class="{{(item.VCA_VCT_ID == 4 ? \'free\' : item.VCA_VCT_ID == 2 ? \'vct2\' : item.VCA_VCT_ID == 5 ? \'vct5\' : \'\') + (item.IsOverdue ? \' dis\' : \'\')}}" sn-tap="this.goTo(item)"> <div class="price">{{util.currency(item.VCA_DEDUCT_AMOUNT,\'\')}}</div> <div class="name">{{item.VCA_VCT_ID==4?\'免邮卡\':item.VCA_NAME}}</div> <div class="time">有效期:{{item.IsOverdue?\'已过期\':(util.formatDate(item.CSV_START_DT,\'yyyy/MM/dd\')+\'-\'+util.formatDate(item.CSV_END_DT,\'yyyy/MM/dd\'))}}</div> <div class="share" sn-tap="this.share(item)"> <i>分享</i> </div> </li> </ul> <ul class="uc_coupon_list js_overdue" sn-display="{{isOverdue}}"> <li sn-repeat="item in data1" class="{{(item.VCA_VCT_ID == 4 ? \'free\' : item.VCA_VCT_ID == 2 ? \'price10\' : item.VCA_VCT_ID == 1 ? \'price50\' : \'\') + (item.IsOverdue ? \' dis\' : \'\')}}"> <div class="price">{{util.currency(item.VCA_DEDUCT_AMOUNT,\'\')}}</div> <div class="name">{{item.VCA_VCT_ID==4?\'免邮卡\':item.VCA_NAME}}</div> <div class="time">有效期:{{util.formatDate(item.CSV_START_DT,\'yyyy/MM/dd\')}}-{{util.formatDate(item.CSV_END_DT,\'yyyy/MM/dd\')}}</div> <div class="share" sn-tap="this.share(item)"> <i>分享</i> </div> </li> </ul> <div class="my_nodata" sn-display="{{isOverdue&&!data1.length||!isOverdue&&!data.length}}"> <div class="icon"></div> <div class="text">您目前还没有卡券哦</div> <div class="btn" data-forward="/all?from=/coupon">去逛逛吧</div> </div> </div> <div class="coupon_tip" sn-display="{{showTipStep==2}}"></div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/coupon",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),r=t("activity"),a=t("widget/loading"),o=t("core/model2"),l=t("widget/scroll"),u=(t("animation"),t("bridge"),t("models/base")),h=t("components/share"),p=function(t){if(!t.eq(0).hasClass("show")&&t.length){var e=t.length,i=e-1;t.parent().css({height:100*e}),t.each(function(t,e){e.style.zIndex=t}),setTimeout(function(){var e=arguments.callee,n=t.eq(i);n[0].clientHeight,n.addClass("show"),setTimeout(function(t){return function(){n.animate({opacity:1,translate:"0px,"+100*t+"px"},450*t,"ease-out"),i--,i>=0&&e()}}(i),300)},200)}};return r.extend({events:{"tap .coupon_tip":function(){s.store("showTipStep",3),this.model.set({showTipStep:3})}},swipeRightBackAction:"/",onCreate:function(){var t=this,e=this.$(".main");l.bind(e),t.user=s.store("user"),this.model=new o.ViewModel(this.$el,{back:"/",title:"我的卡券",isOverdue:!1,showTipStep:s.store("showTipStep")}),this.model.goTo=function(e,i){i.LVP_PRD_ID&&t.forward("/item/"+i.LVP_PRD_ID+"?from="+encodeURIComponent(t.route.url))},this.model.couponApi=new u.CouponAPI({$el:this.$el,checkData:!1,beforeSend:function(){var e=t.model.get("code");return e?void this.setParam({csvcode:e}):(sl.tip("请输入券号"),!1)},params:{pspcode:t.user.PSP_CODE},success:function(e){e.success?(sl.tip("领取成功"),t.loading.reload()):sl.tip(e.msg)},error:function(t){sl.tip(t.msg)}}),this.couponStatusApi=new u.CouponStatusAPI({$el:this.$el,checkData:!1,params:{pspcode:t.user.PSP_CODE},success:function(t){console.log(t)},error:function(t){console.log(t)}}),t.share=new h({head:"分享这张优惠券"}),t.share.callback=function(e){e.success?(sl.tip("分享成功"),t.share.hide()):sl.tip(e.msg)},t.share.$el.appendTo(t.$el),this.model.share=function(e,i){t.couponStatusApi.setParam({id:i.CSV_ID,UserID:t.user.ID,Auth:t.user.Auth}).load(function(e,i){if(!e&&i.success){if(i.overdue)return;t.share.set({linkURL:i.url,title:"ABS优惠券分享",description:"ABS优惠券分享"}).show()}else sl.tip(e&&e.msg||i.msg)}),e.stopPropagation()},t.loading=new a({url:"/api/user/voucher_list",params:{status:1},$el:this.$el,check:!1,checkData:!1,success:function(e){if(e.closeNumber&&t.confirm("您有"+e.closeNumber+"张优惠券马上就要过期啦，<br>尽快使用哦",function(){}),e&&e.data&&0!=e.data.length){var i=s.find(e.data,function(t){return 4!=t.VCA_VCT_ID});i.sort(function(t,e){return t.IsOverdue&&!e.IsOverdue?1:!t.IsOverdue&&e.IsOverdue?-1:t.CSV_END_DT>e.CSV_END_DT?1:t.CSV_END_DT==e.CSV_END_DT?0:-1}),t.model.set("data",i);var n=s.find(e.data,function(t){return 4==t.VCA_VCT_ID});n.sort(function(t,e){return t.IsOverdue&&!e.IsOverdue?1:!t.IsOverdue&&e.IsOverdue?-1:t.CSV_END_DT>e.CSV_END_DT?1:t.CSV_END_DT==e.CSV_END_DT?0:-1}),t.model.set("data1",n),t.showItemsWithAnim()}else t.model.set("data",[]),t.model.set("data1",[])}}),t.model.on("change:isOverdue",function(){t.model.data.isOverdue&&t.showItemsWithAnim()})},showItemsWithAnim:function(){var t=this,e=t.$(t.model.data.isOverdue?".js_overdue":".js_not_overdue").children("li");p(e)},onShow:function(){var t=this;t.user=s.store("user"),t.user?!t.isLoad&&(t.isLoad=!0)&&t.loading.setParam({UserID:t.user.ID,Auth:t.user.Auth}).load():t.forward("/login?success="+this.route.url+"&from=/")},onDestory:function(){}})});define("template/user/couponshare",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<div class="main co_share" style="top:0"> <div class="co_share_con"> <div class="say"> <p class="img"><img src="" alt=""><em>{{user.PSP_NAME||user.PSP_CODE}}</em></p> <p class="cont">我把在ABS家居领到的优惠券送给你~赶快来领取吧！</p> </div> <div class="letter"> <div class="closed"></div> <i class="logo"></i> </div> <div class="btn get" sn-tap="this.getCoupon()">马上领取</div> <div class="steps"> <p>立即<br>领券</p> <i></i> <p>下单<br>购买</p> <i></i> <p>结算<br>选券</p> <i></i> <p>商品<br>到家</p> </div> </div> <div class="co_share_user"> <div class="hd">看看还有谁领到了</div> <ul class="list"> <li sn-repeat="item in users"> <img alt="" sn-src=""> <p class="con"> <span class="name">{{item.PSP_NAME||item.PSP_CODE}} <i class="date">{{util.formatDate(item.VSR_START_SHARE_TIME,\'yyyy/MM/dd HH:mm\')}}</i></span> <em class="text">土豪带我飞</em> </p> </li> </ul> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/couponshare",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),r=t("activity"),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),d=(t("animation"),t("models/base"));i.exports=r.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var t=this,e=t.$(".main");t.swipeRightBackAction=void 0,l.bind(e),t.model=new o.ViewModel(this.$el,{}),t.model.getCoupon=function(e){t.user?i.setParam({UserID:t.user.ID,Auth:t.user.Auth}).load():t.forward("/login?success="+encodeURIComponent(t.route.url)+"&from="+encodeURIComponent(t.route.url))};var i=new d.GetSharedCouponAPI({$el:t.$el,params:{data:t.route.query.code},checkData:!1,success:function(t){sl.tip("恭喜您获得一张优惠券")},error:function(t){sl.tip(t.msg)}}),n=new d.CouponUserAPI({$el:t.$(".co_share_user .list"),params:{data:t.route.query.code},checkData:!1,success:function(e){console.log(e),t.model.set({users:e.data,user:e.user})}});n.load()},onShow:function(){var t=this;t.user=s.store("user")},onDestory:function(){}})});define("template/user/address",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main uc_address"> <div class="uc_address_new js_add_address">添加新地址</div> <ul class="uc_address_con"> <li sn-repeat="item in data" class="{{item.MBA_DEFAULT_FLAG?\'default\':\'\'}}{{item.AddressID==addressId?\' curr\':\'\'}}" sn-tap="this.forward(item.AddressID)"> <p class="hd"><span class="name">{{item.MBA_NAME}}</span><span class="mobi">{{item.MBA_MOBILE}}</span></p> <p class="con">{{item.Province}}{{item.City}}{{item.Area}}{{item.MBA_FULL_ADDRESS}}</p> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/address",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),r=t("activity"),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),d=(t("animation"),t("models/base"));i.exports=r.extend({events:{"tap .js_bind:not(.disabled)":function(){},"tap .js_add_address":function(){this.forward("/addaddress?from="+encodeURIComponent(this.route.url)+"&buy="+(this.route.query.buy||""))}},onCreate:function(){var t=this,e=t.$(".main");t.user=s.store("user"),t.swipeRightBackAction=t.route.query.from||"/",l.bind(e),t.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,title:"收货地址"}),t.model.forward=function(e,i){var n=s.first(t.model.get("data"),function(t){return t.AddressID==i});s.store("address",n),t.forward("/addaddress?edittype=2&from="+encodeURIComponent(t.route.url)+"&id="+i+"&buy="+(t.route.query.buy||""))},t.address=new d.AddressListAPI({$el:this.$el,params:{pspcode:t.user.PSP_CODE},success:function(e){e.data.sort(function(t,e){return t.AddressID>e.AddressID?1:t.AddressID<e.AddressID?-1:0}),console.log(e.data),t.model.set({data:e.data})}})},onShow:function(){var t=this;t.address.load()},onDestory:function(){}})});define("template/user/addaddress",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main uc_addaddress"> <ul> <li> <input type="text" placeholder="收货人姓名" sn-model="address.mbaName" value="{{address.mbaName}}" /> </li> <li> <input type="tel" placeholder="手机号码" sn-model="address.mbaMobile" value="{{address.mbaMobile}}" /> </li> <li> <input type="tel" placeholder="邮政编码" sn-model="address.mbaZip" /> </li> <li class="js_area">{{province.PRV_ABBR||\'省\'}}、{{city.CTY_ABBR||\'市\'}}、{{region.REG_DESC||\'区\'}}</li> <li> <input type="text" placeholder="详细地址" sn-model="address.mbaAddress" value="{{address.mbaAddress}}"> </li> <li class="set_default{{address.mbaDefault?\' checked\':\'\'}}" sn-tap="address.mbaDefault=!address.mbaDefault">设为默认地址</li> </ul> </div> <b class="uc_addaddress_btn js_submit">确&nbsp;&nbsp;定</b>';return __},helpers:{}});return T.template=T.html,T});define("views/user/addaddress",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),r=t("activity"),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),c=t("widget/selector"),u=(t("animation"),t("models/base"));i.exports=r.extend({events:{"tap .js_submit:not(.disabled)":function(){this.editAddressAPI.load()},"tap .js_area":function(){var t=this;this.selector.show(),t.model.data.province&&(t.selector.eq(0).index(s.indexOf(t.provinceData,function(e){return e.PRV_ID==t.model.data.province.PRV_ID})),t.resetCity())}},onCreate:function(){var t=this,e=t.$(".main");t.user=s.store("user"),t.swipeRightBackAction=t.route.query.from||"/address",l.bind(e);var i=t.route.query.id;if(t.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,title:i?"设置地址":"添加地址",address:{mbaDefault:!0,mbaMobile:t.user.Mobile},user:t.user}),i){var n=s.store("address");n&&t.model.set({address:{mbaMobile:n.MBA_MOBILE,mbaName:n.MBA_NAME,mbaAddress:n.MBA_ADDRESS,mbaDefault:n.MBA_DEFAULT_FLAG},province:{PRV_ID:n.ProvinceID,PRV_ABBR:n.Province},city:{CTY_ID:n.MBA_CTY_ID,CTY_ABBR:n.City},region:{REG_ID:n.MBA_REG_ID,REG_DESC:n.Area}})}t.selector=new c({options:[{template:"<li><%=PRV_ABBR%></li>",onChange:function(e,i,n){t.city.setParam({prvId:n.PRV_ID||0}).load()}},{template:"<li><%=CTY_ABBR%></li>",onChange:function(e,i,n){t.region.setParam({ctyId:n.CTY_ID||0}).load()}},{template:"<li><%=REG_DESC%></li>"}],complete:function(e){t.model.set({province:e[0],city:e[1],region:e[2]})}}),t.selector.eq(0).set([{PRV_ABBR:"省"}]),t.selector.eq(1).set([{CTY_ABBR:"市"}]),t.selector.eq(2).set([{REG_DESC:"区"}]),this.province=new u.ProvinceAPI({$el:t.selector.$el,success:function(e){t.provinceData=e.data,e.data.unshift({PRV_ABBR:"省"}),t.selector.eq(0).set(e.data)}}),this.city=new u.CityAPI({$el:t.selector.$el,checkData:!1,success:function(e){t.cityData=e.data,e.data.unshift({CTY_ABBR:"市"}),t.selector.eq(1).set(t.cityData),t.resetCity()}}),this.region=new u.RegionAPI({$el:t.selector.$el,checkData:!1,success:function(e){t.regionData=e.data,t.regionData.unshift({REG_DESC:"区"}),t.selector.eq(2).set(t.regionData),t.resetRegion()}}),this.province.load(),t.editAddressAPI=new u.EditAddressAPI({$el:t.$el,check:!1,checkData:!1,params:{pspcode:t.user.PSP_CODE},beforeSend:function(){var e=t.model.get("address");if(!e.mbaName)return sl.tip("请填写收货人姓名"),!1;if(!e.mbaMobile)return sl.tip("请填写手机号码"),!1;if(!s.validateMobile(e.mbaMobile))return sl.tip("请填写正确的手机号码"),!1;if(!e.mbaAddress)return sl.tip("请填写详细地址"),!1;var i=t.model.get("region");return i&&i.REG_ID?(e.mbaRegId=i.REG_ID,e.mbaCtyId=t.model.get("city.CTY_ID"),e.edittype=t.route.query.edittype||1,e.mbaId=t.route.query.id||0,void this.setParam(e)):(sl.tip("请选择省市区"),!1)},success:function(e){if(e.success)sl.tip("设置成功！");else if(e.msg)return void sl.tip(e.msg);if(t.route.query.buy){var i=t.model.get("address");t.setResult("useAddress",{AddressID:i.mbaId,MBA_CTY_ID:i.mbaCtyId,MBA_REG_ID:i.mbaRegId,MBA_NAME:i.mbaName,MBA_FULL_ADDRESS:i.mbaAddress,MBA_MOBILE:i.mbaMobile})}t.back(t.route.query.buy?decodeURIComponent(t.route.query.from.match(/from=([^&]+?)(&|$)/)[1]):t.swipeRightBackAction)}})},resetCity:function(){var t=this;if(t.model.data.city){var e=s.indexOf(this.selector.eq(1).data,function(e){return e.CTY_ID==t.model.data.city.CTY_ID});-1!=e&&this.selector.eq(1).index(e),t.resetRegion()}},resetRegion:function(){var t=this;if(t.model.data.region){var e=s.indexOf(this.selector.eq(2).data,function(e){return e.REG_ID==t.model.data.region.REG_ID});-1!=e&&this.selector.eq(2).index(e)}},onShow:function(){},onDestory:function(){}})});define("template/user/modifypwd",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="uc_pwd"> <dl class="uc_pwd_con"> <dt>原密码</dt> <dd> <input type="password" placeholder="请输入您的密码"> </dd> <dt>新密码</dt> <dd> <input type="password" placeholder="请输入您的新密码"> </dd> <dt>确认密码</dt> <dd> <input type="password" placeholder="请再次输入您的新密码"> </dd> </dl> <div class="action"><b class="btn">确&nbsp;认</b></div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/modifypwd",["components","images/style.css","images/append.css"],function(t,e,i){var r=(t("$"),t("util"),t("activity")),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll");t("animation");i.exports=r.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var t=this,e=t.$(".main");t.swipeRightBackAction=t.route.query.from||"/settings",l.bind(e),t.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,title:"修改密码"})},onShow:function(){},onDestory:function(){}})});define("template/messages",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main message_center"> <div class="message_card" sn-repeat="item in data"> <div class="hd"> <h2 sn-binding="html:item.MSG_TITLE"></h2> <h3 sn-binding="html:item.MSG_DT|date:\'yyyy.MM.dd\'"></h3> </div> <div class="bd" sn-binding="html:item.MSG_CONTENT"></div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/messages",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),r=t("activity"),a=t("../widget/loading"),o=t("../core/model"),l=t("../widget/scroll");t("animation");return r.extend({events:{},onCreate:function(){var t=this,e=this.$(".main");l.bind(e),this.model=new o.ViewModel(this.$el,{back:"/",title:"消息中心"}),this.loading=new a({url:"/api/user/get_msg",$el:this.$el,checkData:!1,success:function(e){e.data||this.showError("暂无消息"),t.model.set("data",e.data)},append:function(e){t.model.get("data").append(e.data)}})},onShow:function(){var t=this;t.user=s.store("user"),t.user?t.loading.setParam({UserID:t.user.ID,Auth:t.user.Auth}).load():t.forward("/login?success="+this.route.url+"&from=/")},onDestory:function(){}})});define("template/mypoint",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main mypoint"> <div sn-binding="display:points|equal:0|not"> <div class="curr">当前积分：<b sn-binding="html:points"></b></div> <div class="notice">*您的积分可以直接抵扣现金使用。<span>（100积分＝1元）</span></div> <div class="hd">积分记录</div> <ul class="mypoint_list"> <li sn-repeat="item in data"> <p class="from" sn-binding="html:item.HPT_PIT_ID|equal:1:item.CNL_DESC:item.POT_DESC"></p> <p class="date" sn-binding="html:item.HPT_DT|date:\'yyyy.MM.dd\'"></p> <p class="points" sn-binding="html:item.HPT_POINT_AMOUNT|round|eval:\'$0>0?\\\'+\\\'+$0:$0\',class:item.HPT_POINT_AMOUNT|lt:0|equal:true:\'minus\':\'\'"></p> </li> </ul> </div> <div class="my_nodata" sn-binding="display:points|equal:0" style="display:none"> <div class="icon"></div> <div class="text">您目前还没有积分记录哦</div> <div class="btn" data-forward="/all">去逛逛吧</div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/mypoint",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),a=t("activity"),r=t("../widget/loading"),o=t("../core/model"),l=t("../widget/scroll"),d=(t("animation"),t("bridge"));return a.extend({events:{},swipeRightBackAction:"/",onCreate:function(){var t=this,e=this.$(".main");l.bind(e),this.model=new o.ViewModel(this.$el,{back:"/",title:"我的积分",open:function(){d.openInApp(t.user.OpenUrl||"http://m.abs.cn")}})},onShow:function(){var t=this,t=this,e=s.store("user");e?(t.user=e,this.loading=new r({url:"/api/user/get_points",check:!1,params:{UserID:e.ID,Auth:e.Auth},$el:this.$el,success:function(e){t.model.set(e)}}),this.loading.load()):this.forward("/login")},onDestory:function(){}})});define("template/myorder",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div sn-html="{{title}}" class="head_title"></div> </header> <ul class="myorder_hd" sn-display="{{currentType!=0||data.length}}"> <li class="curr" sn-tap="this.select(0)">全部</li> <li sn-tap="this.select(1)">待付款</li> <li sn-tap="this.select(2)">待发货</li> <li sn-tap="this.select(3)">配送中</li> <li sn-tap="this.select(4)">已完成</li> </ul> <div class="main myorder"> <ul class="con" sn-display="{{data.length}}"> <li sn-repeat="item in data" class="type{{item.CNL_CLT_ID}}" sn-tap="this.openOrder(item)"> <div class="hd" data-id="{{item.PUS_ID}}"><b class="from" sn-html="item.CNL_DESC"></b><span class="status" sn-html="item.PUS_DESC"></span></div> <div class="info" sn-tap="this.openOrder(item)"> <span>订单号：{{item.PUR_CODE}}</span> <span>{{util.formatDate(item.PUR_DT)}}</span> </div> <div class="bd" sn-repeat="prd in item.Children" sn-tap="this.openPrd(prd,item)"> <img sn-src="{{prd.WPP_LIST_PIC||\'images/default.jpg\'}}" src="images/default.jpg" onerror="this.src=\'images/default.jpg\'" /> <div class="con"> <h2>{{prd.PRD_NAME}}</h2> <h3>颜色：<span>{{prd.PRD_COLOR}}</span></h3> <h4>尺寸：<span>{{prd.PRD_SPEC}}</span></h4> </div> <p class="priceinfo"> <span class="price">{{util.currency(prd.LPK_CHANNEL_PRICE,\'￥\')}}</span> <span class="qty">x{{prd.LPK_QTY}}</span> </p> </div> <div class="ft"> 总价：<span>{{util.currency(item.PUR_AMOUNT+item.PUR_EXP_IN_AMOUNT,\'￥\')}}</span> <b class="btn_sml" sn-display="{{item.PUR_PAS_ID==2}}" data-forward="/news/order{{item.PUR_ID}}">分享有惊喜</b> <b class="btn_sml" sn-display="{{item.XPU_EXPRESS_CODE}}" sn-tap="item.showExpress=!item.showExpress">查看物流</b> <b class="btn_sml" sn-display="{{item.PUS_DESC==\'待付款\'}}">立即付款</b> <b class="btn_sml btn_dark" sn-display="{{item.PUS_DESC==\'待付款\'}}" sn-tap="false" sn-click="this.cancelOrder(item)">取消订单</b> </div> <div class="express" sn-display="item.showExpress" style="display:none"> <div class="express_con"> <p>物流公司：<span>{{item.EXP_NAME}}</span></p> <p>运单号码：<span>{{item.XPU_EXPRESS_CODE}}</span></p> <p>如需跟踪物流详情 请复制运单号前往<span>{{item.EXP_NAME}}</span>官方网站查询</p> </div> </div> </li> </ul> <div class="my_nodata" sn-display="{{currentType==0&&!data.length&&!isLoading}}" style="display:none"> <div class="icon"></div> <div class="text">您目前还没有购物记录哦</div> <div class="btn" data-forward="/all">去逛逛吧</div> </div> <div class="my_nodata" sn-display="{{currentType!=0&&!data.length}}" style="display:none"> <div class="icon"></div> <div class="text">您还没有相关的订单</div> <div class="btn" data-forward="/all">去逛逛吧</div> </div> </div> <div class="open_msg" style="display:none"> <div class="msg_bd msg_alert"> 这款产品已经售罄喽 <div class="btn_go">随便逛逛</div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/myorder",["components","images/style.css","images/append.css"],function(t,e,i){var n=t("$"),s=t("util"),a=t("activity"),r=t("../widget/loading"),o=t("core/model2"),l=t("../widget/scroll"),d=(t("animation"),t("bridge")),u=t("models/base");return a.extend({events:{"tap .open_msg":function(t){n(t.target).hasClass("open_msg")&&n(t.target).removeClass("show")},"tap .btn_go":function(){self.back("/all")}},swipeRightBackAction:"/",onCreate:function(){var t=this,e=this.$(".main");t.user=s.store("user"),l.bind(e),this.model=new o.ViewModel(this.$el,{back:"/",title:"我买到的",currentType:0,isLoading:!0}),this.wxPayApi=new u.WxPayAPI({$el:t.$el,success:function(t){console.log(t),d.open(t.url)}}),n.extend(this.model,{select:function(e,i){n(e.currentTarget).hasClass("curr")||(n(e.currentTarget).addClass("curr").siblings(".curr").removeClass("curr"),t.loading.setParam(0==i?{status:0,payStatus:0}:1==i?{status:0,payStatus:3}:2==i?{status:18,payStatus:0}:3==i?{status:19,payStatus:0}:{status:8,payStatus:0}).reload(),this.set("currentType",i))},showExpress:function(t,e){e.set("showExpress",!e.showExpress),t.stopPropagation()},openOrder:function(e,i){n(e.target).hasClass("btn_sml")&&"立即付款"!=n(e.target).html()||("待付款"==i.PUS_DESC&&t.forward("/order/"+i.PUR_ID),e.stopPropagation())},cancelOrder:function(e,i){t.confirm("你确定取消订单吗？",function(){t.cancelOrderApi.setParam({purcode:i.PUR_CODE}).load()}),e.stopPropagation(),e.preventDefault()},openPrd:function(e,i,n){e.stopPropagation(),"待付款"!=n.PUS_DESC||"IMG"==e.target.tagName?i.PRD_DISCONTINUED_FLAG?(t.$open_msg.show(),t.$open_msg[0].clientHeight,t.$open_msg.addClass("show")):i.Url&&t.forward("/item/"+i.PRD_ID+"?from="+encodeURIComponent(t.route.url)):this.openOrder(e,n)}}),t.$open_msg=this.$(".open_msg").on(n.fx.transitionEnd,function(e){t.$open_msg.hasClass("show")||t.$open_msg.hide()}),t.loading=new r({url:"/api/order/list",$el:this.$el,checkData:!1,success:function(e){t.model.set({isLoading:!1,data:e.data})},append:function(e){t.model.getModel("data").add(e.data)}}),t.loading.setParam({UserID:t.user.ID,Auth:t.user.Auth}).load(),t.onResult("OrderChange",function(){t.loading.reload()}),t.cancelOrderApi=new u.CancelOrderAPI({$el:this.$el,checkData:!1,params:{pspcode:t.user.PSP_CODE},success:function(e){e.success&&(sl.tip("订单已成功取消"),t.loading.reload(),t.setResult("UserChange"))},error:function(t){sl.tip(t.msg)}})},onShow:function(){},onDestory:function(){var t=this;t.timer&&clearTimeout(t.timer)}})});define("template/order",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="sp_buy"> <div class="sp_buy_hd js_address"> <div class="info"><span class="name">{{data.ORA_NAME}}</span><span class="mobi">{{data.ORA_MOBILE}}</span></div> <div class="loc">{{data.CTY_DESC}}{{data.REG_DESC}}{{data.ORA_ADDRESS}}</div> </div> <div class="sp_buy_bd sp_buy_bill"> <div class="hd">订单信息</div> <ul> <li><span>订单号</span><em>{{data.PUR_CODE}}</em></li> <li><span>下单日期</span><em>{{util.formatDate(data.PUR_DT)}}</em></li> <li><span>订单金额</span><em>{{util.currency(data.PUR_AMOUNT,\'￥\')}}</em></li> <li><span>运费</span><em>{{util.currency(data.PUR_EXP_IN_AMOUNT,\'￥\')}}</em></li> <li><span>总计</span><b>{{util.currency(data.PUR_AMOUNT+data.PUR_EXP_IN_AMOUNT,\'￥\')}}</b></li> </ul> </div> <div class="sp_buy_bd sp_buy_pay"> <div class="hd">支付方式</div> <ul> <li class="ico_alipay{{payType==1?\' checked\':\'\'}}" sn-tap="payType=1">支付宝支付</li> <li class="ico_wxpay{{payType==2?\' checked\':\'\'}}" sn-tap="payType=2">微信支付</li> </ul> </div> </div> </div> <footer class="sp_buy_action" sn-display="{{data.PUS_DESC==\'待付款\'}}"> <div class="total">总计：<b>{{util.currency(data.PUR_AMOUNT+data.PUR_EXP_IN_AMOUNT,\'￥\')}}</b></div> <div class="btn_buy js_pay">立即支付</div> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/order",["components","images/style.css","images/append.css"],function(t,e,i){var a=(t("$"),t("util"),t("activity")),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),d=(t("animation"),t("models/base")),u=t("models/user"),h=t("bridge");i.exports=a.extend({events:{"tap .js_pay:not(.disabled)":function(){var t=this,e=this.model.get("data");t.orderApi.showLoading(),setTimeout(function(){t.orderApi.hideLoading()},3e3),t.checkStatus(),1==this.model.get("payType")?h.ali({type:"pay",spUrl:d.API.prototype.baseUri+"/AlipayApp/Pay",orderCode:e.PUR_CODE},function(e){sl.tip(e.msg),t.orderApi.hideLoading()}):h.wx({type:"pay",spUrl:d.API.prototype.baseUri+"/api/shop/wxcreateorder",orderCode:e.PUR_CODE,orderName:"ABS商品",orderPrice:e.PUR_AMOUNT},function(e){sl.tip(e.msg),t.orderApi.hideLoading()})}},onCreate:function(){var t=this,e=t.$(".main");t.user=u.get(),t.swipeRightBackAction=t.route.query.from||t.route.referrer||"/",l.bind(e),t.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,title:"订单详情",payType:1}),t.orderApi=new d.OrderAPI({$el:t.$el,params:{orderId:t.route.data.id,UserID:t.user.ID,Auth:t.user.Auth},success:function(e){console.log(e),t.model.set({data:e.data})}}),t.orderApi.load(),t.orderStatusAPI=new d.OrderStatusAPI({$el:this.$el,check:!1,checkData:!1,success:function(e){2!=e.status?t.timer=setTimeout(function(){t.checkStatus()},2e3):2==e.status&&(t.forward("/news/order"+t.route.query.id),t.orderApi.reload())}})},checkStatus:function(){var t=this;t.timer&&clearTimeout(t.timer),t.orderStatusAPI.setParam({id:t.route.data.id}).load()},onShow:function(){},onDestory:function(){self.timer&&clearTimeout(self.timer)}})});define("template/news",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header>';return __},helpers:{}});return T.template=T.html,T});define("views/news",["components","images/style.css","images/append.css"],function(t,e,i){var n=t("$"),a=(t("util"),t("activity")),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),d=(t("animation"),t("components/shareOrder")),u=t("components/month"),h=t("components/activity"),p=t("components/fastbuy"),f=t("components/package"),m=t("components/banner"),v=t("models/base");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var t=this;t.swipeRightBackAction=t.route.query.from||"/";var e=t.route.data.id,i=/(order|month|activity|package|fastbuy|banner|coupon){0,1}(\d*)/.exec(e),s=i[1];e=i[2],t.model=new o.ViewModel(this.$el,{url:encodeURIComponent(t.route.url),back:t.swipeRightBackAction});var r,a="";switch(s){case"order":a="支付成功",r=new d,r.$el.appendTo(t.$el);break;case"month":a="会员礼领取",r=new u({id:e}),r.$el.appendTo(t.$el);break;case"fastbuy":a="周一闪购",r=new p,r.$el.appendTo(t.$el);break;case"activity":a=2==e?"最热商品":"APP专享",r=new h({id:e}),r.$el.appendTo(t.$el);break;case"package":a="套餐",r=new f({id:e}),r.$el.appendTo(t.$el);break;case"banner":a="纳米美容巾免费领",r=new m({id:e}),r.$el.appendTo(t.$el);break;case"coupon":a="优惠券规则",t.$el.append('<div class="main" style="padding:20px;background:#fff;"> Q：如何使用优惠券？<br/> A：您可以在订单结算页面通过“使用优惠券”选项使用一张符合使用条件的优惠券，抵扣相应的金额。<br/> <br/> Q：什么是券码？<br/> A：用户可以通过ABS其他合作渠道获取兑换券码，兑换码可以在"我的优惠券”页兑换优惠券，抵扣相应金额。<br/> <br/> Q：优惠券的使用有什么其他限制吗？<br/> A：优惠券的使用时限、抵用限额及其他限制条件请详见优惠券上的文字描述。<br/> </div>');break;default:a="ABS家居";var c=n('<div class="main"></div>').appendTo(t.$el),g=new v.NewsAPI({$el:t.$el,params:{id:e},success:function(e){if(e.success)if(1==e.edmtype){var s=t.createIFrame(c);s.$el.css({width:window.innerWidth-20,height:c[0].offsetHeight-20}),s.html(e.data.edm_html)}else{var a=n('<div sn-repeat="list in data"> <div class="banner" sn-if="{{list.type==1}}"> <a sn-repeat="pic in list.data" href="{{pic.EDD_URL||\'javascript:;\'}}"><img sn-src="{{list.type==1?pic.EDD_PIC:\'\'}}"  /></a> </div> <ul class="sp_list" style="overflow:hidden;margin-top:0" sn-if="{{list.type==2}}"> <li sn-repeat="item in list.data" class="sp_list_item" data-forward="/item/{{item.PRD_OBJ.PRD_ID}}?from={{url}}" sn-index="0"> <img src="{{item.PRD_OBJ.WPP_LIST_PIC}}"> <p class="price"><b>￥{{item.PRD_OBJ.PRD_PRICE}}</b><del sn-display="{{item.PRD_OBJ.PRD_PRICE!=0&&item.PRD_OBJ.PRD_PRICE<item.PRD_OBJ.PRD_MEMBER_PRICE}}" style="display: none;">￥{{item.PRD_OBJ.PRD_MEMBER_PRICE}}&nbsp;</del></p> <p class="name">{{item.PRD_OBJ.PRD_NAME}}</p> </li> </ul> </div>');a.appendTo(c),t.model.bind(a).set({data:e.data})}else sl.tip(e.msg)},error:function(t){sl.tip(t)}});g.load()}r&&(r.view=t),l.bind(t.$(".main")),t.model.set({type:s,title:a})},onShow:function(){},onDestory:function(){}})});define("template/register",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div sn-binding="html:title" class="head_title"></div> <div class="head_back" sn-binding="data-back:back"></div> </header> <div class="main"> <div class="login_form"> <ul class="form"> <li><input placeholder="输入手机号" sn-model="mobile" /></li> <li><input placeholder="验证码" sn-model="smsCode" type="text" /> <b class="js_valid btn_middle" sn-binding="html:valid"></b></li> <li><input placeholder="设置密码" sn-model="password" type="password" /></li> <li><input placeholder="再次输入确认密码" sn-model="password1" type="password" /></li> </ul> <div class="login_btn"><b class="btn_large js_bind">确定注册</b> </div> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/register",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),a=t("activity"),r=t("../widget/loading"),o=t("../core/model"),l=t("../widget/scroll"),d=(t("animation"),t("util/md5"));return a.extend({events:{"tap .js_bind:not(.disabled)":function(){var t=this.model.data.mobile,e=this.model.data.password,i=this.model.data.password1,n=this.model.data.smsCode;return t&&s.validateMobile(t)?e!=i?void sl.tip("两次密码输入不一致"):n?void this.loading.setParam({mobile:t,password:d.md5(e),smsCode:n}).load():void sl.tip("请输入验证码"):void sl.tip("请输入正确的手机")},"tap .js_valid:not(.disabled)":function(t){var e=this.model.get("mobile");return e&&s.validateMobile(e)?(this.$valid.addClass("disabled"),this.valid.setParam({mobile:this.model.data.mobile}),void this.valid.load()):void sl.tip("请输入正确的手机")}},validTimeout:function(){var t=this,e=localStorage.getItem("valid_time");if(e&&parseInt(e)>60){if(e=Math.round((new Date(parseInt(e)).getTime()-Date.now())/1e3),0>=e)return;t.$valid.addClass("disabled"),setTimeout(function(){0>=e?(t.$valid.removeClass("disabled"),t.model.set("valid","获取验证码"),localStorage.removeItem("valid_time")):(t.model.set("valid",e+"秒"),e--,setTimeout(arguments.callee,1e3))},1e3)}},onCreate:function(){var t=this,e=this.$(".main");l.bind(e),this.model=new o.ViewModel(this.$el,{title:"注册",valid:"获取验证码",back:this.route.query.from||"/login"}),this.loading=new r({url:"/api/user/register",method:"POST",check:!1,checkData:!1,$el:this.$el,success:function(e){e.success?(localStorage.setItem("user",JSON.stringify(e.data)),t.back(t.route.query.success||"/")):sl.tip(e.msg)},error:function(t){sl.tip(t.msg)}}),this.valid=new r({url:"/api/user/send_sms",method:"POST",params:{mobile:t.model.data.mobile},check:!1,checkData:!1,$el:this.$el,success:function(e){e.success?(localStorage.setItem("valid_time",Date.now()+6e4),t.validTimeout()):sl.tip(e.msg)}}),t.$valid=this.$(".js_valid"),t.validTimeout()},onShow:function(){},onDestory:function(){}})});define("template/guide",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main guide"> <div class="guide_hd"> 恭喜您成为ABS爱彼此家居会员！<br> 我们为您准备了以下惊喜： </div> <div class="guide_bd"> <ul class="hd"> <li></li> <li>免费礼</li> <li>免费定制</li> <li>免邮费</li> </ul> <ul class="row"> <li> <span>SVIP会员</span> <p>累计金额<br>≥￥50000</p> </li> <li><p>600个月<br>免费礼</p></li> <li></li> <li></li> </ul> <ul class="row"> <li> <span>VIP会员</span> <p>￥10000≦<br>累计金额<br>＜￥50000</p> </li> <li><p>12个月<br>免费礼</p></li> <li></li> <li></li> </ul> <ul class="row"> <li> <span>钻石会员</span> <p>￥5000≦<br>累计金额<br>＜￥10000</p> </li> <li><p>12个月<br>免费礼</p></li> <li></li> <li class="none"></li> </ul> <ul class="row"> <li> <span>金卡会员</span> <p>￥1000≦<br>累计金额<br>＜￥5000</p> </li> <li><p>12个月<br>免费礼</p></li> <li></li> <li class="none"></li> </ul> <ul class="row"> <li> <span>银卡会员</span> <p>￥0＜<br>累计金额<br>＜￥1000</p> </li> <li class="none"><p></p></li> <li></li> <li class="none"></li> </ul> <div class="more"><p>ABS会员专享权益，最终解释权归上海爱彼此家居用品股份有限公司所有。</p> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/guide",["components","images/style.css","images/append.css"],function(t,e,i){var a=(t("$"),t("util"),t("activity")),o=(t("widget/loading"),t("core/model")),l=t("widget/scroll");t("animation");return a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},swipeRightBackAction:"/settings",onCreate:function(){var e=this.$(".main");l.bind(e),this.model=new o.ViewModel(this.$el,{back:"/settings",title:"新手指南"})},onShow:function(){},onDestory:function(){}})});define("template/shop/index",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <form class="head_search"> <input class="js_search" type="search" placeholder="热门搜索：新月枕" /> </form> </header> <div class="main" style="padding-bottom:10px"> <ul class="sp_all_cates"> <li sn-repeat="item in categories" class="{{item.PCG_ID==id?\'curr\':\'\'}}" sn-tap="current=item,id=item.PCG_ID,this.bindScroll()">{{item.PCG_DESC}}</li> </ul> <div sn-repeat="item in current.children"> <div class="sp_all_banner" data-forward="/list?id={{item.PCG_ID}}"><img sn-src="{{item.PCG_IMG_URL}}" /></div> <div class="sp_all_list_wrap"> <ul class="sp_all_list"> <li class="sp_all_list_item" sn-repeat="cate in item.children" data-forward="/list?id={{cate.PCG_ID}}"> <img alt="{{cate.PCG_NAME}}" sn-src="{{cate.PCG_IMG_URL}}" /></a> <span>{{cate.PCG_NAME}}</span> </li> <li class="sp_all_list_item see_all" data-forward="/list?id={{item.PCG_ID}}"> </li> </ul> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/index",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),a=t("activity"),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),d=(t("animation"),t("models/base"));return a.extend({events:{"tap .js_bind:not(.disabled)":function(){},"focus .js_search":function(t){t.currentTarget.setAttribute("placeholder","")},"blur .js_search":function(t){t.currentTarget.setAttribute("placeholder","热门搜索：新月枕")}},onCreate:function(){var t=this;t.swipeRightBackAction=t.route.query.from||"/";var e=this.$(".main");l.bind(e),this.listenTo(this.$(".js_search"),"keydown",function(e){return 13==e.keyCode?(t.forward("/list?s="+e.target.value+"&from=/all"),e.preventDefault(),!1):void 0}),this.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,id:this.route.query.id||1,resource:"http://appuser.abs.cn"}),this.model.subcates=function(e){return s.find(t.categories,function(t){return t.PCG_PARENT_ID==e.PCG_ID})},this.model.bindScroll=function(){l.bind(t.$(".sp_all_list_wrap:not(.s_binded)").addClass("s_binded"),{vScroll:!1,hScroll:!0})};var i=s.store("categories");i&&t.setCategories(i);var n=new d.CategoryAPI({success:function(e){s.store("categories",e.data),t.setCategories(e.data)},$el:t.$el});n.load()},setCategories:function(t){var e=this;this.categories=t;var i=s.find(t,function(e){return e.children=s.find(t,function(t){return t.PCG_PARENT_ID==e.PCG_ID}),1==e.PCG_DEPTH}),n=e.route.query.id||1;this.model.set({id:n,categories:i}).set({current:s.first(i,function(t){return t.PCG_ID==n})}),console.log(i.length,e.model.data.categories.length),this.model.bindScroll()},onShow:function(){},onDestory:function(){}})});define("template/shop/list",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <ul class="sp_list_sort"> <li class="{{orderBy==\'PRD_ONLINE_DT|desc\'?\'curr\':\'\'}}" sn-tap="this.orderBy(\'PRD_ONLINE_DT|desc\')">新品</li> <li class="{{orderBy==\'PSV_QTY|desc\'?\'curr\':\'\'}}" sn-tap="this.orderBy(\'PSV_QTY|desc\')">销量</li> <li class="{{orderBy==\'PRD_MEMBER_PRICE|asc\'?\'curr asc\':orderBy==\'PRD_MEMBER_PRICE|desc\'?\'curr desc\':\'\'}}" sn-tap="this.orderBy(priceSort?\'PRD_MEMBER_PRICE|desc\':\'PRD_MEMBER_PRICE|asc\'),priceSort=!priceSort">价格</li> </ul> <ul class="sp_list"> <li sn-repeat="item in data" class="sp_list_item" data-forward="/item/{{item.PRD_ID}}?from={{url}}"> <img src="{{item.WPP_LIST_PIC1}}"/> <p class="price"><b>￥{{item.PRD_PRICE}}</b><del sn-display="{{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}}">￥{{item.PRD_MEMBER_PRICE}}&nbsp;</del></p> <p class="name">{{item.PRD_NAME}}</p> <div class="sold_out" sn-display="{{item.PRD_NUM==0}}">脱 销<br>Sold Out</div> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/list",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),a=t("activity"),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),d=(t("animation"),t("models/base"));return a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var t=this,e=t.$(".main");t.swipeRightBackAction=t.route.query.from||"/all",l.bind(e);var i=s.store("categories"),n=i?s.first(i,function(e){return e.PCG_ID==t.route.query.id}):null;t.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,title:n?n.PCG_NAME:"商品列表",orderBy:"PRD_ONLINE_DT|desc",priceSort:!0,url:encodeURIComponent(t.route.url)}),t.model.orderBy=function(t,e){this.set("orderBy",e),a.abort().reload()};var a=new d.ProductSearchAPI({$el:t.$el,$scroll:e,$content:e,check:!1,beforeSend:function(){var e=t.model.get("orderBy");e=e.split("|"),this.setUrl("new"==t.route.query.type?"/api/prod/newproductlist":"/Prod/productlist").setParam({orderbyStr:"new"==t.route.query.type&&"PRD_MEMBER_PRICE"==e[0]?"PRD_PRICE":e[0],orderby:e[1],pcgid:t.route.query.id,keycodes:t.route.query.s||""})},KEY_PAGE:"pages",KEY_PAGESIZE:"length",MSG_NO_MORE:'别拉了，就这些<i class="ico_no_more"></i>',pageSize:"10",success:function(e){10==e.data.length&&(e.total=(this.pageIndex+1)*parseInt(this.pageSize)),t.model.set({data:e.data})},append:function(e){10==e.data.length&&(e.total=(this.pageIndex+1)*parseInt(this.pageSize)),t.model.getModel("data").add(e.data)}});a.load()},onShow:function(){},onDestory:function(){}})});define("template/shop/item",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<div class="pd_item_wrap"> <header class="header_trans"> <div class="head_back" data-back="{{back}}"></div> <div class="head_right"> <a class="head_call" href="tel:4008205077"></a> <div class="head_share js_share"></div> </div> </header> <div class="main pd_item"> <div class="pd_slider{{data.PRD_NUM<=0?\' sold_out\':\'\'}}"> <img width="100%" height="100%" src="{{data.WPP_M_PIC}}" /> </div> <div class="pd_info_wrap"> <div class="pd_info"> <h1>{{data.PRD_NAME}}</h1> <p class="price">{{data.PRD_PRICE}}</p> <del class="ori_price" sn-display="{{data.PRD_PRICE<data.PRD_MEMBER_PRICE}}">¥{{data.PRD_MEMBER_PRICE}}</del> <p class="pd_code"> <span class="code">商品编码 {{data.PRD_CODE}}</span> <span class="sale">销售 {{data.PSV_QTY}} 件</span> </p> </div> </div> <ul class="pd_sign"> <li>满99包邮</li> <li>30天退换货保障</li> </ul> <div class="pd_select_plus" sn-display="{{Package.PPG_ID}}" data-forward="/news/package{{Package.PPG_ID}}?from={{url}}"> {{Package.PPG_NAME}} </div> <div class="pd_select_size js_select_size"> 选择 尺码 颜色分类 </div> <div class="pd_item_con"> <h2>商品特点：</h2> <div class="con" sn-html="{{data.PRH_FEATURE}}"></div> </div> <div class="pd_jump_detail" data-forward="/detail/{{data.PRD_ID}}"><b>图文详情</b><em>建议在WIFI情况下查看</em></div> <div class="pd_help"> 如果您有任何疑问，欢迎联系我们的客服。 <br> 联系热线：400-820-5077 周一至周日 9:00-19:00 </div> </div> <footer class="pd_buy"> <b class="btn_cart" data-forward="/cart?from={{url}}"><i sn-display="$state.cartQty!=0">{{$state.cartQty}}</i></b> <b class="btn_buy {{data.PRD_NUM==0?\'sold_out\':\'js_buy\'}}">{{data.PRD_NUM==0?\'商品已售罄\':\'加入购物车\'}}</b> </footer> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/item",["components","images/style.css","images/append.css"],function(t,e,i){var s=(t("$"),t("util")),a=t("activity"),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),c=t("components/share"),d=t("components/size"),h=(t("animation"),t("models/base"));return a.extend({events:{"tap .js_buy:not(.disabled)":function(){this.size.show()},"tap .js_share":function(){this.share.show()},"tap .js_select_size":function(){this.size.show()}},className:"pd_item_bg",onCreate:function(){var t=this,e=t.$(".main");t.swipeRightBackAction=t.route.query.from||"/list",l.bind(e),t.user=s.store("user"),t.model=new o.ViewModel(t.$el,{back:t.swipeRightBackAction,title:"床品",id:t.route.data.id,user:t.user,url:encodeURIComponent(t.route.url),qty:1}),t.size=new d,t.size.$el.appendTo(t.$el),t.size.on("SizeChange",function(e,i){var n={PRD_NUM:i.PRD_NUM};i.WPP_LIST_PIC&&(n.WPP_LIST_PIC=i.WPP_LIST_PIC),t.model.set({data:n})});var i=new h.ProductAPI({$el:t.$el,params:{id:t.route.data.id},checkData:!1,success:function(e){console.log(e.data),e.data.PSV_QTY=e.psvqty,t.model.set({data:e.data}),t.size.set({qty:1,data:e.data}),t.share=new c({head:"分享商品至",title:e.data.PRD_NAME,linkURL:"http://m.abs.cn/single/"+e.data.PRD_ID+".html",description:e.data.PRD_NAME}),t.share.$el.appendTo(t.$el),n.setParam({id:e.data.PRD_PRH_ID}).load()}});i.load();var n=new h.ProductColorAndSpec({$el:t.$el,checkData:!1,success:function(e){for(var i=[],n=[],s=0,a=e.data.length;a>s;s++){var r=e.data[s];-1==i.indexOf(r.PRD_COLOR)&&i.push(r.PRD_COLOR),-1==n.indexOf(r.PRD_SPEC)&&n.push(r.PRD_SPEC)}console.log(e),t.model.set({color:i,spec:n,colorSpec:e.data}),t.size.set({color:i,spec:n,colorSpec:e.data})}}),a=new h.PackageRelativeAPI({$el:t.$el,params:{prdId:this.route.data.id},checkData:!1,success:function(e){console.log(e),t.model.set({Package:e.data})}});a.load()},onShow:function(){},onDestory:function(){}})});define("template/shop/detail",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main pd_detail"> <img sn-repeat="item in data" src="{{item.img}}" /> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/detail",["components","images/style.css","images/append.css"],function(t,e,i){var a=(t("$"),t("util"),t("activity")),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),d=(t("animation"),t("models/base"));i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var t=this;t.swipeRightBackAction=t.route.query.from||"/item/"+t.route.data.id,t.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,title:"图文详情",id:t.route.data.id}),l.bind(t.$(".main"));var e=new d.ProductDetailAPI({$el:t.$el,params:{id:t.route.data.id},success:function(e){t.model.set({data:e.data}),console.log(e)}});e.load()},onShow:function(){},onDestory:function(){}})});define("template/shop/cart",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff <header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> '+this.helpers.list()+' </div> <footer class="ct_list_action"> <div class="total">总计：<b>{{this.getTotal(bag_amount,couponcode,Points||0,freecouponcode.CSV_CODE)}}</b></div> <div class="btn_buy js_buy">结 算</div> </footer> <div class="ct_coupon_wrap {{isShowCoupon?\'\':\'out\'}} js_coupon" style="display:none"> <div class="ct_coupon"> <div class="ct_coupon_hd">{{couponType==4?"选择免邮卡":"选择优惠券"}}</div> <div class="ct_coupon_use" sn-display="{{couponType!=4}}"> <input type="text" placeholder="请输入券码" sn-model="code" /> <b class="btn" sn-tap="this.couponGetApi.load()">使用</b> </div> <div class="ct_coupon_list"> <div class="hd">已有优惠券</div> <ul class="bd" sn-style="top: {{couponType==4?\'106px\':\'146px\'}}"> <li sn-repeat="item in coupon|filter:couponType==4?item.VCT_ID==4:(item.VCT_ID!=4)" class="{{(item.VCT_ID == 4 ? \'free\' : item.VCT_ID == 2 ? \'vct2\' : item.VCT_ID == 5 ? \'vct5\' : \'\') + (item.IsOverdue ? \' dis\' : \'\')+((couponType==4&&freecouponcode.CSV_CODE==item.CSV_CODE||couponType!=4&&couponcode.CSV_CODE.indexOf(item.CSV_CODE)!=-1)?\' checked\':\'\')}}" sn-tap="this.useCoupon(item)"> <i class="ico_check"></i> <div class="price">{{util.currency(item.VCA_DEDUCT_AMOUNT,\'\')}}</div> <div class="name">{{item.VCT_ID==4?\'免邮卡\':item.VCA_NAME}}</div> <div class="time">有效期:{{item.IsOverdue?\'已过期\':(util.formatDate(item.CSV_START_DT,\'yyyy/MM/dd\')+\'-\'+util.formatDate(item.CSV_END_DT,\'yyyy/MM/dd\'))}}</div> </li> <div class="nodata">暂无优惠券</div> </ul> </div> </div> </div> <div class="ct_coupon_wrap {{isShowPoint?\'\':\'out\'}} js_points" style="display:none"> <div class="ct_coupon"> <div class="ct_coupon_hd">使用积分</div> <div class="ct_points"> <div class="hd">当前积分</div> <div class="points">{{user.Points}}</div> </div> <div class="ct_coupon_use"> <input type="tel" placeholder="请输入积分" value="{{_points||\'\'}}" sn-model="_points" /> <b class="btn" sn-tap="this.usePoint(_points)">使用</b> </div> <div class="ct_points_tip"> *您的积分可以直接抵扣现金使用。<em>（100积分＝1元）</em> </div> </div> </div>';return __},helpers:{list:function(){var t="";return t+=' <div class="ct_list_wrap" sn-display="{{util.isTrue(data_baglist)||util.isTrue(data_package)}}"> <ul class="ct_list"> <li sn-repeat="item in data_baglist" class="ct_list_item" data-id="{{item.SPB_ID}}"> <div class="ct_list_item_con js_delete_item"> <img sn-src="{{item.PRD_PIC}}" data-back="/item/{{item.PRD_ID}}" /> <div class="con"> <b class="name">{{item.PRD_NAME}}</b> <p class="size">尺寸：{{item.PRD_SPEC.split(\'|\')[0]}}</p> <p class="color">颜色：{{item.PRD_COLOR}}</p> <p class="qty"> <span class="minus" sn-tap="this.changeQty(item,Math.max(!item.SPB_QTY?1:(parseInt(item.SPB_QTY)-1),1))">-</span> <input type="text" value="{{item.SPB_QTY||1}}" sn-model="changedQty" sn-change="this.changeQty(item,changedQty)" /> <span class="plus" sn-tap="this.changeQty(item,(parseInt(item.SPB_QTY)||1)+1)">+</span> </p> </div> <div class="ft"> <b class="price">￥{{Math.round(item.SPB_AMOUNT*100)/100}}</b> <del sn-display="{{item.SPB_AMOUNT>item.PRD_MEMBER_PRICE*(item.SPB_QTY||1)}}">￥{{Math.round(item.PRD_MEMBER_PRICE*(item.SPB_QTY||1)*100)/100}}</del> </div> </div> <i class="js_delete" data-id="{{item.SPB_ID}}"></i> </li> </ul> <div sn-repeat="ppg in data_package" class="ct_list_pkg"> <dl class="js_delete_item"> <dt class="ct_list_pkg_item">{{ppg.PPG_NAME}} <b class="price">￥{{Math.round(ppg.PPG_PRICE*100)/100}}</b> </dt> <dd sn-repeat="item in ppg.PackageList" class="ct_list_item"> <div class="ct_list_item_con"> <img sn-src="{{item.PRD_PIC}}" data-back="/item/{{item.PRD_ID}}" /> <div class="con"> <b class="name">{{item.PRD_NAME}}</b> <p class="size">尺寸：{{item.PRD_SPEC.split(\'|\')[0]}}</p> <p class="color">颜色：{{item.PRD_COLOR}}</p> </div> <div class="ft"> <del>￥{{Math.round(item.PRD_MEMBER_PRICE*(item.SPB_QTY||1)*100)/100}}</del> </div> </div> </dd> </dl> <i class="js_delete" data-wacid="{{ppg.SPB_WAC_ID}}" data-groupid="{{ppg.SPB_GROUP}}" data-ppgid="{{ppg.PPG_ID}}"></i> </div> <div class="ct_buy_more" data-forward="/all?from=/cart" sn-display="{{this.getPrice(bag_amount,couponcode,Points)<=99}}"> <i>去凑单</i> 满<em>¥99</em>即可免运费，还差<em>¥{{Math.round((99-this.getPrice(bag_amount,couponcode,Points))*100)/100}}</em> </div> <ul class="ct_list_info"> <li><span>商品总价</span><em><b class="price">￥{{prod_amount}}</b></em></li> <li class="link js_use_coupon"><span>使用优惠券</span><em sn-display="{{couponcode.CSV_CODE}}"><b>-¥{{couponcode.VCA_DEDUCT_AMOUNT}}</b></em><em sn-display="{{!couponcode.CSV_CODE}}"><b>{{couponCount||0}}</b>张可用</em></li> <li class="link js_use_point"> <span>积分抵扣</span> <em sn-display="{{Points}}"><b>-¥{{Points/100}}</b></em> <em sn-display="{{!Points}}"><b>{{user.Points}}</b>积分可用</em> </li> <li class="link js_use_freecard" sn-display="{{freeCount&&this.getPrice(bag_amount,couponcode,Points)<99}}"> <span>选择免邮卡</span> <em sn-display="{{freecouponcode.CSV_CODE}}"><b>已选1张</b></em> <em sn-display="{{!freecouponcode.CSV_CODE}}"><b>{{freeCount||0}}</b>张免邮卡可用</em></li> <li><span>运费</span> <em><b>{{this.getFreight(bag_amount,couponcode,Points||0,freecouponcode.CSV_CODE)}}</b></em> </li> <li><span>总计</span><em><b class="price">{{this.getTotal(bag_amount,couponcode,Points||0,freecouponcode.CSV_CODE)}}</b></em></li> </ul> </div> <div class="my_nodata" sn-display="{{!loading&&util.isFalse(data_baglist)&&util.isFalse(data_package)}}" style="display:none"> <div class="icon"></div> <div class="text">您的购物车内还没有商品</div> <div class="btn" data-forward="/all?from=/cart">去逛逛吧</div> </div> '}}});return T.template=T.html,T});define("views/shop/cart",["components","images/style.css","images/append.css"],function(t,e,i){var n=t("$"),s=t("util"),a=t("activity"),o=(t("widget/loading"),t("core/model2")),c=(t("core/promise"),t("widget/scroll")),u=(t("animation"),t("models/base")),h=t("components/deletion"),p=t("models/user");return a.extend({events:{"tap .js_buy:not(.disabled)":function(){var t=this,e=this.model.get("couponcode"),i=this.model.get("freecouponcode");this.model.setState({selectedCoupon:e,selectedFreeCoupon:i}),this.forward("/buy?points="+this.model.get("Points")+"&from="+encodeURIComponent(t.route.url))},"touchmove .ct_coupon_wrap":function(t){return!1},"tap .js_coupon":function(t){n(t.target).hasClass("js_coupon")&&this.model.set({isShowCoupon:!1})},"tap .js_points":function(t){n(t.target).hasClass("js_points")&&this.model.set({isShowPoint:!1})},"tap .js_use_coupon":function(){this.$coupon.show(),this.model.set({couponType:0,isShowCoupon:!0})},"tap .js_use_point":function(){var t=this;this.$points.show(),t.model.set({isShowPoint:!0})},"tap .js_use_freecard":function(){this.$coupon.show(),this.model.set({couponType:4,isShowCoupon:!0})}},onCreate:function(){var t=this;c.bind(t.$(".main")),c.bind(t.$(".ct_coupon_list .bd")),t.swipeRightBackAction=t.route.query.from||"/",t.user=p.get(),t.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,title:"我的购物车",user:t.user,loading:!0,Points:0}),n.extend(t.model,{getPrice:function(t,e,i){var n=e&&e.VCA_DEDUCT_AMOUNT?e.VCA_DEDUCT_AMOUNT:0;return e&&5==e.VCT_ID&&(n=0),Math.max(0,t-n-i/100)},getFreight:function(t,e,i,n){var s=this.getPrice(t,e,i),a=s>=99||n?0:15;return s>=99?"免邮费":"¥"+Math.round(100*a)/100},getTotal:function(t,e,i,n){var a,r,o,s=e&&e.VCA_DEDUCT_AMOUNT?e.VCA_DEDUCT_AMOUNT:0;return e&&5==e.VCT_ID?(r=Math.max(0,t-s-i/100),o=t-i/100>=99||n?0:15,a=Math.max(0,t+o-s-i/100)):(r=Math.max(0,t-s-i/100),a=r+(r>=99||n?0:15)),"¥"+Math.round(100*a)/100},usePoint:function(e,i){return i?(i=parseFloat(i),i>t.user.Points?void sl.tip("您输入的数值已超过您的积分最大值，请重新输入"):100>i||i%100!=0?void sl.tip("您输入的数值不是100的倍数，请重新输入"):void t.model.set({isShowPoint:!1,Points:i})):void t.model.set({isShowPoint:!1,Points:0})},useCoupon:function(e,i){if(1==i.VCT_ID&&i.VCA_MIN_AMOUNT>t.model.data.bag_amount)return void sl.tip("您的购物金额满"+i.VCA_MIN_AMOUNT+"元才可使用哦");if(4==i.VCT_ID)this.set({freecouponcode:this.data.freecouponcode&&this.data.freecouponcode.CSV_CODE==i.CSV_CODE?null:i});else if(5==i.VCT_ID){var n=this.data.usedCoupons||[],a=s.indexOf(n,function(t){return t.CSV_CODE==i.CSV_CODE});-1!=a?n.splice(a,1):n.push(i);var r=[],o=0;n.forEach(function(t){r.push(t.CSV_CODE),o+=t.VCA_DEDUCT_AMOUNT}),this.set({usedCoupons:n,couponcode:{VCT_ID:5,VCA_DEDUCT_AMOUNT:o,CSV_CODE:r.join(",")}})}else this.set({usedCoupons:[],couponcode:this.data.couponcode&&this.data.couponcode.CSV_CODE==i.CSV_CODE?null:i});this.set({isShowCoupon:!1})}}),t.cart=new u.CartAPI({$el:t.$el,checkData:!1,success:function(e){e.coupon.sort(function(t,e){return t.CSV_END_DT>e.CSV_END_DT?1:t.CSV_END_DT==e.CSV_END_DT?0:-1}),t.model.set(e).set({loading:!1});for(var i=0,n=0,s=0;s<e.coupon.length;s++)4==e.coupon[s].VCT_ID?n++:i++;t.model.set({freeCount:n,couponCount:i})}}),t.initPoints(),t.initCoupon(),t.initModify(),t.initDeletion(),this.onResult("ResetCart",function(){t.model.set({couponcode:null,freecouponcode:null,Points:0}),t.model.setState({selectedCoupon:"",selectedFreeCoupon:""})})},onShow:function(){var t=this;t.user=p.get(),t.model.set({user:t.user}),t.cart.setParam({pspcode:t.user.PSP_CODE}).load()},initDeletion:function(){var t=this;new h({el:t.$(".ct_list_wrap"),children:".js_delete_item",width:45,events:{".js_delete":function(e){var i=n(e.currentTarget),s=i.data("id");if(s){n.extend(!0,{},t.model.data);t.model.getModel("data_baglist").remove(function(t){return t.get("SPB_ID")==s}),t.cartDeleteApi.setParam({spbId:s}).load()}else t.cartDeletePackageAPI.setParam({wacid:i.data("wacid"),ppgid:i.data("ppgid"),groupid:i.data("groupid")}).load()}}}),t.cartDeleteApi=new u.CartDeleteAPI({$el:t.$el,checkData:!1,params:{pspcode:t.user.PSP_CODE},success:function(e){var i=this.getParam("spbId");t.setResult("CartChange"),t.model.getModel("data_baglist").remove(function(t){return t.get("SPB_ID")==i}),t.cart.reload()},error:function(t){sl.tip(t.msg)}}),t.cartDeletePackageAPI=new u.CartDeletePackageAPI({$el:t.$el,checkData:!1,params:{pspcode:t.user.PSP_CODE},success:function(e){t.cart.reload()},error:function(t){sl.tip(t.msg)}})},initModify:function(){var t=this,e=!1;t.cartModifyApi=new u.CartModifyAPI({$el:t.$el,checkData:!1,beforeSend:function(){e=!0},success:function(e){t.cart.reload(),t.setResult("CartChange")},error:function(e){sl.tip(e.msg),t.model.getModel("data_baglist").find(function(e){return e.SPB_ID==t.modifySpbId}).set({SPB_QTY:this.originQty})},complete:function(){e=!1}}),t.model.changeQty=function(e,i,s){var a=parseInt(i.SPB_QTY);s=parseInt(s),s&&!isNaN(s)&&s!=a&&(t.modifySpbId=i.SPB_ID,n.extend(t.cartModifyApi,{originQty:a}).setParam({pspcode:t.user.PSP_CODE,spbId:i.SPB_ID,qty:s}).load())}},initPoints:function(){var t=this;t.$points=t.$(".js_points"),t.listenTo(t.$points,n.fx.transitionEnd,function(e){t.$points.hasClass("out")&&t.$points.hide()})},initCoupon:function(){var t=this;t.$coupon=t.$(".js_coupon"),t.listenTo(t.$coupon,n.fx.transitionEnd,function(e){t.$coupon.hasClass("out")&&t.$coupon.hide()}),this.model.couponGetApi=new u.CouponAPI({$el:this.$el,checkData:!1,beforeSend:function(){var e=t.model.get("code");return e?void this.setParam({csvcode:e}):(sl.tip("请输入券号"),!1)},params:{pspcode:t.user.PSP_CODE},success:function(e){e.success?(sl.tip("领取成功"),t.cart.reload()):sl.tip(e.msg)},error:function(t){sl.tip(t.msg)}})},onDestory:function(){this.model.setState({selectedCoupon:"",selectedFreeCoupon:""})}})});define("template/shop/buy",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="sp_buy"> <div class="sp_buy_hd js_address"> <div class="info"><span class="name">{{address.MBA_NAME}}</span><span class="mobi">{{address.MBA_MOBILE}}</span></div> <div class="loc">{{address.MBA_FULL_ADDRESS}}</div> </div> <div class="sp_buy_bd sp_buy_bill"> <div class="hd">支付结算</div> <ul> <li><span>商品价</span><em>¥{{prod_amount}}</em></li> <li><span>优惠券</span><em>-¥{{$state.selectedCoupon.VCA_DEDUCT_AMOUNT||0}}</em></li> <li><span>积分</span><em>-¥{{Points/100||0}}</em></li> <li><span>运费</span><em>{{this.getFreight(bag_amount,$state.selectedCoupon,Points||0,$state.selectedFreeCoupon.CSV_CODE)}}</em></li> <li><span>总计</span><b>{{this.getTotal(bag_amount,$state.selectedCoupon,Points||0,$state.selectedFreeCoupon)}}</b></li> </ul> </div> <div class="sp_buy_bd sp_buy_pay"> <div class="hd">支付方式</div> <ul> <li class="ico_alipay{{payType==1?\' checked\':\'\'}}" sn-tap="payType=1">支付宝支付</li> <li class="ico_wxpay{{payType==2?\' checked\':\'\'}}" sn-tap="payType=2">微信支付</li> </ul> </div> </div> </div> <footer class="sp_buy_action"> <div class="total">总计：<b>{{this.getTotal(bag_amount,$state.selectedCoupon,Points||0,$state.selectedFreeCoupon)}}</b></div> <div class="btn_buy js_buy">立即支付</div> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/shop/buy",["components","images/style.css","images/append.css"],function(t,e,i){var n=t("$"),s=t("util"),a=t("activity"),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),d=(t("animation"),t("models/base")),u=t("bridge"),p=t("models/user");return a.extend({events:{"tap .js_buy:not(.disabled)":function(){this.orderCreateApi.load()},"tap .js_address":function(){this.forward("/address?buy=1&from="+encodeURIComponent(this.route.url))}},onCreate:function(){var t=this,e=t.$(".main");t.swipeRightBackAction=t.route.query.from||"/cart",t.user=p.get(),l.bind(e),t.model=new o.ViewModel(this.$el,{back:t.swipeRightBackAction,title:"确认订单",payType:1,couponprice:0}),n.extend(t.model,{getPrice:function(t,e,i){var n=e&&e.VCA_DEDUCT_AMOUNT?e.VCA_DEDUCT_AMOUNT:0;return e&&5==e.VCT_ID&&(n=0),Math.max(0,t-n-i/100)},getFreight:function(t,e,i,n){console.log(t,e,i,n);var s=this.getPrice(t,e,i),a=s>=99||n?0:15;return s>=99?"免邮费":"¥"+Math.round(100*a)/100},getTotal:function(t,e,i,n){var a,r,o,s=e&&e.VCA_DEDUCT_AMOUNT?e.VCA_DEDUCT_AMOUNT:0;return e&&5==e.VCT_ID?(r=Math.max(0,t-s-i/100),o=t-i/100>=99||n?0:15,a=Math.max(0,t+o-s-i/100)):(r=Math.max(0,t-s-i/100),a=r+(r>=99||n?0:15)),"¥"+Math.round(100*a)/100}});var i=new d.AddressListAPI({$el:this.$el,params:{pspcode:t.user.PSP_CODE},checkData:!1,success:function(e){e.data&&e.data[0]&&t.model.set({address:s.first(e.data,function(t){return t.MBA_DEFAULT_FLAG})||e.data[0]})}});i.load(),t.cart=new d.CartAPI({$el:t.$el,checkData:!1,success:function(e){console.log(e),t.model.set(e).set({loading:!1})}}),t.cart.setParam({pspcode:t.user.PSP_CODE}),t.orderCreateApi=new d.OrderCreateAPI({$el:this.$el,beforeSend:function(){var e=t.model.get("address");return e?void this.setParam({mba_id:e.AddressID,pay_type:t.model.get("payType")}):(sl.tip("请填写收货地址信息"),!1)},checkData:!1,success:function(e){e.success&&(sl.tip("生成订单成功！"),t.setResult("OrderChange").setResult("ResetCart").setResult("UserChange"),1==t.model.get("payType")?u.ali({type:"pay",spUrl:d.API.prototype.baseUri+"/AlipayApp/Pay",orderCode:e.code},function(t){sl.tip(t.msg)}):u.wx({type:"pay",spUrl:d.API.prototype.baseUri+"/api/shop/wxcreateorder",orderCode:e.code,orderName:"ABS商品",orderPrice:e.pur_amount},function(t){sl.tip(t.msg)}),t.forward("/order/"+e.pur_id+"?from=/myorder"))},error:function(t){sl.tip(t.msg)}}),t.onResult("useAddress",function(e,i){t.model.set({address:i})})},onShow:function(){var t=this;t.user=p.get(),t.orderCreateApi.setParam({pspcode:t.user.PSP_CODE,pay_type:1,coupon:this.model.getState("selectedCoupon.CSV_CODE")||"",points:t.route.query.points,freecoupon:this.model.getState("selectedFreeCoupon.CSV_CODE")||""}),t.model.set({Points:t.route.query.points?parseInt(t.route.query.points):0}),t.cart.load()},onDestory:function(){}})});define("template/steward/index",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div class="stw_title_bar"> <div class="hd">总共<em>{{user.StewardNum}}</em>条爱管家记录</div> <!--<i class="stw_title_bar_thumb ico{{displayType==0?\' curr\':\'\'}}" sn-tap="displayType=0"></i>--> <i class="stw_title_bar_list ico{{displayType==1?\' curr\':\'\'}}" sn-tap="displayType=1"></i> </div> <ul class="stw_list" sn-display="{{displayType==1}}"> <li class="stw_list_item" sn-repeat="item in data"> <div class="thumb" data-forward="/item/{{item.LPK_PRD_ID}}?from=/steward"> <i>{{item.LPK_QTY}}</i> <img src="{{item.WPP_M_PIC}}"/> <b class="btn">再来一个</b> </div> <div class="con" data-forward="/steward/{{item.PRD_PRH_ID}}"> <h4>{{item.PRH_NAME}}</h4> <div class="date">最新购入时间：{{util.formatDate(item.PUR_DT,\'yyyy/MM/dd\')}}</div> <!--<div class="text"> <p>提醒：文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字</p> </div>--> <a class="link" href="/steward/{{item.PRD_PRH_ID}}">查看详情&gt;&gt;</a> </div> </li> </ul> <div class="stw_category" sn-display="{{displayType==0}}"> <div class="stw_category_item"> <div class="hd"> <span>出行</span> </div> <ul class="stw_list"> <li class="stw_list_item"> <div class="thumb"> <img /> <b class="btn">再来一个</b> </div> <div class="con" data-forward="/steward/1"> <h4>Tagine摩洛哥酷彩系列耐高温陶瓷塔吉锅（8寸）</h4> <div class="date">最新购入时间：2015/10/10 </div> <!--<div class="text"> <p>提醒：文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字文字</p> </div>--> <a class="link" href="/">查看详情&gt;&gt;</a> </div> </li> <li class="stw_list_item"> <div class="thumb"> <img /> <b class="btn">再来一个</b> </div> <div class="con" data-forward="/steward/1"> <h4>Tagine摩洛哥酷彩系列耐高温陶瓷塔吉锅（8寸）</h4> <div class="date">最新购入时间：2015/10/10 </div> <div class="text"> </div> <a class="link" href="/">查看详情&gt;&gt;</a> </div> </li> </ul> </div> <div class="stw_category_item curr"> <div class="hd"> <span>睡眠</span> </div> <ul class="stw_list"> <li class="stw_list_item"> <div class="thumb"> <img /> <b class="btn">再来一个</b> </div> <div class="con" data-forward="/steward/1"> <h4>Tagine摩洛哥酷彩系列耐高温陶瓷塔吉锅（8寸）</h4> <div class="date">最新购入时间：2015/10/10 </div> <div class="text"> </div> <a class="link" href="/">查看详情&gt;&gt;</a> </div> </li> <li class="stw_list_item"> <div class="thumb"> <img /> <b class="btn">再来一个</b> </div> <div class="con" data-forward="/steward/1"> <h4>Tagine摩洛哥酷彩系列耐高温陶瓷塔吉锅（8寸）</h4> <div class="date">最新购入时间：2015/10/10 </div> <div class="text"> </div> <a class="link" href="/">查看详情&gt;&gt;</a> </div> </li> </ul> </div> </div> <div class="datanotfound" sn-display="{{!data.length}}"> 您的爱管家还没有记录哦！ </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/steward/index",["components","images/style.css","images/append.css"],function(t,e,i){var s=t("$"),n=t("util"),a=t("activity"),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),d=(t("animation"),t("models/base"));i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},swipeRightBackAction:"/",onCreate:function(){var t=this,e=this.$(".main");t.user=n.store("user"),l.bind(e),this.model=new o.ViewModel(this.$el,{back:"/",title:"爱管家",displayType:1,user:t.user});var i=new d.StewardListAPI({$el:t.$el,params:s.extend({pspcode:t.user.PSP_CODE,pageSize:10,currentpage:1},t.user.token),$scroll:e,$content:e,checkData:!1,success:function(e){e.data.length>=10&&(e.total=(this.pageIndex+1)*parseInt(this.pageSize)),t.model.set(e)},append:function(e){10==e.data.length?e.total=(this.pageIndex+1)*parseInt(this.pageSize):e.data.length||(e.total=t.model.get("data").length),t.model.getModel("data").add(e.data)}});i.load()},onShow:function(){},onDestory:function(){}})});define("template/steward/item",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <ul class="stw_items"> <li class="stw_items_item" sn-repeat="item in data"> <a href="/steward/detail/{{item.id}}?from={{url}}"><img src="{{item.pic}}" /></a> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/steward/item",["components","images/style.css","images/append.css"],function(t,e,i){var s=t("$"),n=t("util"),a=t("activity"),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),d=(t("animation"),t("models/base"));return a.extend({events:{"tap .js_buy:not(.disabled)":function(){}},swipeRightBackAction:"/steward",onCreate:function(){var t=this,e=this.$(".main");l.bind(e),t.user=n.store("user"),this.model=new o.ViewModel(this.$el,{back:"/steward",title:"爱管家",id:t.route.data.id,url:t.route.url});var i=new d.StewardAPI({$el:t.$el,params:s.extend({prh_id:t.model.get("id")},t.user.token),success:function(e){console.log(e),t.model.set(e)}});i.load()},onShow:function(){},onDestory:function(){}})});define("template/steward/detail",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main" style="background:#fff;"> <div class="stw_detail" sn-html="{{data.content}}"></div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/steward/detail",["components","images/style.css","images/append.css"],function(t,e,i){var s=t("$"),n=t("util"),a=t("activity"),o=(t("widget/loading"),t("core/model2")),l=t("widget/scroll"),c=(t("animation"),t("models/base"));return a.extend({events:{"tap,click .main a":function(t){var e=this,i=t.currentTarget.href.match(/\#(.+)$/);if(i){var s=e.$('[name="'+i[1]+'"]').offset().top;this.$(".main")[0].scrollTop=s}return!1}},onCreate:function(){var t=this,e=this.$(".main");this.swipeRightBackAction=this.route.from||this.route.referrer||"/steward",t.user=n.store("user"),this.scroll=l.bind(e),this.model=new o.ViewModel(this.$el,{back:this.swipeRightBackAction,title:"爱管家",id:this.route.data.id});var i=new c.StewardDetailAPI({$el:t.$el,checkData:!1,params:s.extend({pspcode:t.user.PSP_CODE,detail_id:t.model.get("id")},t.user.token),success:function(e){console.log(e),t.model.set(e)}});i.load()},onShow:function(){},onDestory:function(){}})});define("template/test",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='\ufeff<header> <div class="head_back" data-back="{{back}}"></div> <div class="head_title">{{title}}</div> </header> <div class="main"> <div> <input sn-model=\'name\' /> <dl sn-repeat="item in data|filter:contains(item.name,name)"> <dt>{{item.name}}</dt> <dd sn-repeat="p in children">{{p.name}} <p>{{p.id}}</p> <p>{{p.content}}</p>{{item.name}} <p sn-repeat="c in p.children" style="color:#f90">{{c.name}}</p> </dd> </dl> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/test",["components","images/style.css","images/append.css"],function(e,t,i){var a=(e("$"),e("util"),e("activity")),o=(e("widget/loading"),e("core/model2")),l=e("widget/scroll");e("animation");i.exports=a.extend({events:{"tap .js_bind:not(.disabled)":function(){}},onCreate:function(){var e=this,t=e.$(".main");e.swipeRightBackAction=e.route.query.from||e.route.referrer||"/",l.bind(t);var i=Date.now();console.log(i);for(var s={data:[{name:"1234",children:[{name:"aaa"}]}],children:[]},n=0;100>n;n++)s.data.push({name:"nn"+n,children:[{name:"tt"+n}]}),s.children.push({name:"cc"+n,content:"asdf",children:[{name:"bb"+n},{name:"oo"+n}]});e.model=new o.ViewModel(this.$el,{back:e.swipeRightBackAction,title:"标题",data:[{name:""}]}),e.model.set(s),console.log(Date.now()-i)},onShow:function(){},onDestory:function(){}})});