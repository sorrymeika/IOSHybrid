define("core/http",["$","util","promise"],function(t,e,n){var i=t("$"),r=t("util"),s=t("promise"),o=["url","check","method","contentType","headers","dataType","xhrFields","beforeSend","success","error","complete"],a=function(t){i.extend(this,r.pick(t,o)),this.params=i.extend({},this.params,t.params),this.setUrl(this.url)};a.url=function(t){return/^http\:\/\//.test(t)?t:this.prototype.baseUri.replace(/\/$/,"")+"/"+t.replace(/^\//,"")},a.post=function(t,e){return new a({url:t,params:e}).request()},a.get=function(t,e){return new a({url:t,method:"GET",params:e}).request()},a.prototype={baseUri:i('meta[name="api-base-url"]').attr("content"),method:"POST",dataType:"json",complete:r.noop,error:r.noop,success:r.noop,check:function(t){var e=!(!t||!t.success);return e},createError:function(t,e){return{success:!1,code:t,message:e}},setHeaders:function(t,e){var n;e?(n={})[t]=e:n=t,void 0===this.headers&&(this.headers={});for(var i in n)this.headers[i]=n[i];return this},setParam:function(t,e){var n;e?(n={})[t]=e:n=t;for(var i in n)e=n[i],this.params[i]=e;return this},getParam:function(t){return t?this.params[t]:this.params},clearParams:function(){return this.params={},this},setUrl:function(t){return this.url=/^http\:\/\//.test(t)?t:this.baseUri.replace(/\/$/,"")+"/"+t.replace(/^\//,""),this},request:function(t,e){var n=this;return"function"==typeof t?n.request().then(t,e):new s(function(t,e){n._request(t,e)})},_request:function(t,e){var n=this;if(!(n.beforeSend&&n.beforeSend()===!1||n.isLoading)){n.isLoading=!0;var r={};return Object.keys(n.params).forEach(function(t){void 0!==n.params[t]&&(r[t]=n.params[t])}),"json"==this.contentType?(this.setHeaders("Content-Type","application/json"),r=JSON.stringify(r)):this.contentType&&this.setHeaders("Content-Type",this.contentType),n._xhr=i.ajax({url:n.url,headers:n.headers,xhrFields:n.xhrFields,data:r,type:n.method,dataType:n.dataType,cache:!1,error:function(t){var i;try{i=JSON.parse(t.responseText)}catch(r){}!i&&(i=n.createError(10001,"网络错误")),n.complete(i),n.error(i,t),e&&e(i,t)},success:function(i,r,s){n.complete(i),!n.check||n.check(i)?(n.success(i,r,s),t&&t(i,r,s)):(i?!i.message&&i.msg&&(i.message=i.msg):i=n.createError(10001,"网络错误"),n.error(i,s),e&&e(i,s))},complete:function(){n._xhr=null,n.isLoading=!1}}),this}},abort:function(){return this._xhr&&(this._xhr.abort(),this._xhr=null),this}},a.extend=r.extend,n.exports=a});define("components/confirm",["$","core/model"],function(t,e,n){var i=t("$"),r=t("core/model"),s=r.ViewModel.extend({el:'<div class="cp_mask" style="display:none"> <div class="cp_confirm" style="height:{{height||\'auto\'}};margin-top:-{{height/2}}px"> <div class="cp_confirm_bd" sn-html="{{content}}"></div> <div class="cp_confirm_ft"><b sn-if="{{!alwaysOpen}}" class="btn" sn-tap="this.cancel()">取消</b><b class="btn js_confirm"  sn-tap="this.confirm()">确定</b></div> </div> </div>',cancel:function(t){this.hide();var e=this.get("cancel");e&&e.call(this,t)},confirm:function(t){this.hide();var e=this.get("confirm");e&&e.call(this,t)},initialize:function(){this.listenTo(this.$el,i.fx.transitionEnd,this._hide)},show:function(){this.$el.show().addClass("show"),this.set({height:this.$(".cp_confirm")[0].offsetHeight})},_hide:function(){!this.$el.hasClass("show")&&this.$el.hide()},hide:function(){this.data.alwaysOpen||this.$el.removeClass("show")}});n.exports=s});define("components/cart",["$","util","core/model2","models/api","widget/scroll","widget/toast","widget/deletion","widget/popup","models/user"],function(t,e,n){var i=t("$"),r=t("util"),s=t("core/model2"),a=t("models/api"),c=(t("widget/scroll"),t("widget/toast")),l=t("widget/deletion"),u=t("widget/popup"),h=t("models/user"),f=s.Model,d=s.Global,p=f.extend({defaultData:{loading:!0},initialize:function(){var t=this;t.user=h.get(),t.cartApi=new a.CartAPI({$el:t.$el,checkData:!1,beforeSend:function(){this.setParam({pspcode:h.get().PSP_CODE})},success:function(e){e.coupon.sort(function(t,e){return t.CSV_END_DT>e.CSV_END_DT?1:t.CSV_END_DT==e.CSV_END_DT?0:-1});var n=0;if(e.data_package)for(var i=0;i<e.data_package.length;i++)for(var r=e.data_package[i],s=0;s<r.PackageList.length;s++)n+=r.PackageList[s].SPB_QTY;if(e.data_baglist)for(var i=0;i<e.data_baglist.length;i++)n+=e.data_baglist[i].SPB_QTY;e.total=n,e.loading=!1,d.set({cartQty:n}),t.set(e);for(var c,l,a=0,o=0,i=0;i<e.coupon.length;i++)c=e.coupon[i],4==c.VCT_ID?o++:(a++,t.data.couponcode&&c.CSV_CODE==t.data.couponcode.CSV_CODE&&(l=c));t.data.couponcode&&(5!=t.data.couponcode.VCT_ID&&!l||1==t.data.couponcode.VCT_ID&&t.data.couponcode.VCA_MIN_AMOUNT>t.data.bag_amount)&&t.set({couponcode:null}),t.set({freeCount:o,couponCount:a})}}),t.cartApi.load();var e=!1;t.cartModifyApi=new a.CartModifyAPI({$el:t.$el,checkData:!1,beforeSend:function(){e=!0},success:function(e){t.cartApi.reload()},error:function(e){c.showToast(e.msg),t.getModel("data_baglist").find(function(e){return e.SPB_ID==t.modifySpbId}).set({SPB_QTY:this.originQty}),this.$input.val(this.originQty)},complete:function(){e=!1,this.hideLoading()}}),this.initWithDeletion()},checkAll:function(){this.getModel("data_baglist").each(function(t){t.set({checked:!0})}),this.getModel("data_package").each(function(t){t.set({checked:!0})})},viewWillUpdate:function(){if(this.data.isEdit){var t=0;this.data.data_baglist&&this.data.data_baglist.concat(this.data.data_package||[]).forEach(function(e){e.checked&&t++}),this.data.selectedCount!==t&&this.set({selectedCount:t})}},initWithDeletion:function(){var t=this;new l({el:t.$el,children:".js_delete_item",width:70,events:{".js_delete":function(e){t.del(e)}}}),t.cartDeleteApi=new a.CartDeleteAPI({$el:t.$el,checkData:!1,params:{pspcode:t.user.PSP_CODE},success:r.noop,error:function(t){c.showToast(t.msg)}}),t.cartDeletePackageAPI=new a.CartDeletePackageAPI({$el:t.$el,checkData:!1,params:{pspcode:t.user.PSP_CODE},success:function(e){t.cartApi.reload()},error:function(t){c.showToast(t.msg)}})},del:function(t){var e=this;u.confirm({title:"温馨提示",content:"确认要移除该商品吗?",cancelAction:function(){},cancelText:"不删除",confirmAction:function(){this.hide();var n=i(t.currentTarget),r=n.data("id");r?(e.getModel("data_baglist").remove(function(t){return t.SPB_ID==r}),e.cartDeleteApi.setParam({spbId:r}).load(function(){e.cartApi.reload()})):e.cartDeletePackageAPI.setParam({wacid:n.data("wacid"),ppgid:n.data("ppgid"),groupid:n.data("groupid")}).load()},confirmText:"确认删除"})},getPrice:function(t,e,n){var i=e&&e.VCA_DEDUCT_AMOUNT?e.VCA_DEDUCT_AMOUNT:0;return e&&5==e.VCT_ID&&(i=0),Math.max(0,t-i-n/100)},getFreight:function(t,e,n,i){var r=this.getPrice(t,e,n),s=self.user.XPS_CTG_ID&&self.user.XPS_CTG_ID>=4||r>=99||i?0:15;return r>=99?"免邮费":"¥"+Math.round(100*s)/100},getTotal:function(t,e,n,i){if(r.isTrue(this.data.data_baglist)||r.isTrue(this.data.data_package)){var a,o,c,s=e&&e.VCA_DEDUCT_AMOUNT?e.VCA_DEDUCT_AMOUNT:0;return e&&5==e.VCT_ID?(o=Math.max(0,t-s-n/100),c=self.user.XPS_CTG_ID&&self.user.XPS_CTG_ID>=4||t-n/100>=99||i?0:15,a=Math.max(0,t+c-s-n/100)):(o=Math.max(0,t-s-n/100),a=o+(self.user.XPS_CTG_ID&&self.user.XPS_CTG_ID>=4||o>=99||i?0:15)),"¥"+Math.round(100*a)/100}return"¥0"},changeQty:function(t,e,n){var r=parseInt(t.SPB_QTY);e=parseInt(e),e&&!isNaN(e)&&e!=r&&(this.modifySpbId=t.SPB_ID,i.extend(this.cartModifyApi,{originQty:r,$input:i(n.currentTarget)}).setParam({pspcode:this.user.PSP_CODE,spbId:t.SPB_ID,qty:e}).load())},submit:function(){var t=this;if(this.data.isEdit)if(0==this.data.selectedCount)c.showToast("未选择要删除的商品");else{var e=0,n=[];this.data.data_baglist&&this.data.data_baglist.forEach(function(i){i.checked&&(n.push(new a.CartDeleteAPI({checkData:!1,params:{pspcode:t.user.PSP_CODE,spbId:i.SPB_ID},success:r.noop,error:r.noop})),e++)}),this.data.data_package&&this.data.data_package.forEach(function(i){i.checked&&(n.push(new a.CartDeletePackageAPI({checkData:!1,params:{pspcode:t.user.PSP_CODE,wacid:i.SPB_WAC_ID,groupid:i.SPB_GROUP,ppgid:i.PPG_ID},success:r.noop,error:r.noop})),e++)}),0!=e&&n.forEach(function(n){n.load(function(){e--,0==e&&t.cartApi.reload()})})}else Application.forward("/buy")},el:'<div class="sp_cart"> <div class="main"> <ul class="sp_cart__list"> <li sn-repeat="item in data_baglist|filter:!isEdit" class="sp_cart__listitem" data-id="{item.SPB_ID}"> <div class="sp_cart__listitem_con js_delete_item" data-forward="{item.SPB_WAC_ID==10?\'/group/\'+item.SPB_GROUP:(\'/item/\'+item.PRD_ID)}"> <img sn-src="{item.ProductOBJ.WPP_LIST_PIC}" /> <div class="con"> <b class="name">{item.PRD_NAME}</b> <p class="size">尺寸：{item.PRD_DISPLAY_SPEC}颜色：{item.PRD_COLOR}</p> <p class="price">￥{Math.round(item.SPB_AMOUNT * 100) / 100}</p> </div> <div class="ft"> <p class="qty">x{item.SPB_QTY}</p> </div> </div> <i class="js_delete" data-id="{item.SPB_ID}"></i> </li> <li sn-repeat="item in data_baglist|filter:isEdit" class="sp_cart__listitem_mod sp_cart__listitem_con" data-id="{item.SPB_ID}"> <div class="{item.checked?\'radio checked\':\'radio\'}" sn-tap="item.checked=!item.checked"></div> <img sn-src="{item.ProductOBJ.WPP_LIST_PIC}" sn-tap="item.checked=!item.checked" /> <div class="con"> <p class="qty"> <span class="minus" sn-tap="this.changeQty(item,Math.max(!item.SPB_QTY?1:(parseInt(item.SPB_QTY)-1),1))">-</span> <input type="text" value="{item.SPB_QTY||1}" /> <span class="plus" sn-tap="this.changeQty(item,(parseInt(item.SPB_QTY)||1)+1)">+</span> </p> <p class="size">尺寸：{item.PRD_DISPLAY_SPEC}颜色：{item.PRD_COLOR}</p> </div> <div class="ft"> <p class="js_delete sp_cart__delete" data-id="{item.SPB_ID}" sn-tap="this.del()"></p> </div> </li> </ul> <div sn-repeat="ppg in data_package" class="sp_cart__pkgitem"> <dl class="js_delete_item"> <dt class="sp_cart__pkgitem_hd bottom_border"> <div sn-if="{isEdit}" class="{ppg.checked?\'radio checked\':\'radio\'}" sn-tap="ppg.checked=!ppg.checked"></div> {ppg.PPG_NAME} <b class="price">￥{Math.round(ppg.PPG_PRICE * 100) / 100}</b> </dt> <dd sn-repeat="item in ppg.PackageList" class="sp_cart__listitem bottom_border"> <div class="sp_cart__listitem_con" data-forward="/item/{item.PRD_ID}"> <img sn-src="{item.PRD_PIC}" /> <div class="con"> <b class="name">{item.PRD_NAME}</b> <p class="size">尺寸：{item.PRD_DISPLAY_SPEC}颜色：{item.PRD_COLOR}</p> <p class="price">￥{Math.round(item.PRD_MEMBER_PRICE * (item.SPB_QTY || 1) * 100) / 100}</p> </div> <div class="ft"> <p class="qty">x{item.SPB_QTY}</p> </div> </div> </dd> </dl> <i class="js_delete sp_cart__delete" data-wacid="{ppg.SPB_WAC_ID}" data-groupid="{ppg.SPB_GROUP}" data-ppgid="{ppg.PPG_ID}" sn-tap="this.del()"></i> </div> <div class="my_nodata" sn-if="{!loading&&util.isFalse(data_baglist)&&util.isFalse(data_package)}"> <div class="icon"></div> <div class="text">您的购物车内还没有商品</div> <div class="btn" data-back="/?tab=0">去逛逛吧</div> </div> </div> <div class="sp_cart__ft" sn-if="total"> <div sn-if="{isEdit}" class="{selectedCount==data_baglist.length+data_package.length?\'radio checked\':\'radio\'}" sn-tap="this.checkAll()"></div> <div class="left"> <div class="selectall" sn-if="{isEdit}">全选（{selectedCount}）</div> <div sn-if="{!isEdit}" class="num">共{total}件商品</div> </div> <div class="total" sn-if="{!isEdit}"> 合计 <em class="color">¥{bag_amount}</em></div> <button class="btn_l" sn-tap="this.submit()">{isEdit ? \'批量删除\' : \'结算\'}</button> </div> </div>'});n.exports=p});define("components/imagePicker",["$","util","widget/popup","widget/toast","core/model2","bridge"],function(t,e,n){var l,s=(t("$"),t("util"),t("widget/popup")),c=(t("widget/toast"),t("core/model2").Model,t("bridge"));n.exports={show:function(t,e,n){t!==!1&&(n=e,e=t,t=!0);var i=[{text:"从相册选择图片",click:function(){c.image.photo(t,function(t){l.hide(),l=null,n(t)})}},{text:"拍照",click:function(){c.image.camera(t,function(t){l.hide(),l=null,n(t)})}},{text:"取消",click:function(){this.hide()}}];"function"==typeof e?(n=e,e=null):i.unshift({text:e}),l=s.options({options:i})},hide:function(){l&&l.hide()}}});define("utils/barcode",["util"],function(t,e,n){var i=t("util");e.code93=function(t){t=t.toUpperCase();for(var e=[["0","100010100"],["1","101001000"],["2","101000100"],["3","101000010"],["4","100101000"],["5","100100100"],["6","100100010"],["7","101010000"],["8","100010010"],["9","100001010"],["A","110101000"],["B","110100100"],["C","110100010"],["D","110010100"],["E","110010010"],["F","110001010"],["G","101101000"],["H","101100100"],["I","101100010"],["J","100110100"],["K","100011010"],["L","101011000"],["M","101001100"],["N","101000110"],["O","100101100"],["P","100010110"],["Q","110110100"],["R","110110010"],["S","110101100"],["T","110100110"],["U","110010110"],["V","110011010"],["W","101101100"],["X","101100110"],["Y","100110110"],["Z","100111010"],["-","100101110"],[".","111010100"],[" ","111010010"],["$","111001010"],["/","101101110"],["+","101101110"],["%","110101110"],["SHIFT0","100100110"],["SHIFT1","111011010"],["SHIFT2","111010110"],["SHIFT3","100110010"],["START","101011110"]],n=e[e.length-1][1],r=n+"1",s=0,a=0,o=n,c=0;c<t.length;c++){var l=t[c],u=i.indexOf(e,function(t){return t[0]==l}),h=t.length-c%20,f=t.length-c%15;s+=u*h,a+=u*(f+1),o+=e[u][1]}var d=s%47;return s=e[d][1],a+=d,a=e[a%47][1],o+s+a+r}});define("utils/md5",[],function(){function i(t){return x(u(_(t),t.length*n))}function u(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var n=1732584193,i=-271733879,r=-1732584194,s=271733878,a=0;a<t.length;a+=16){var o=n,c=i,l=r,u=s;n=f(n,i,r,s,t[a+0],7,-680876936),s=f(s,n,i,r,t[a+1],12,-389564586),r=f(r,s,n,i,t[a+2],17,606105819),i=f(i,r,s,n,t[a+3],22,-1044525330),n=f(n,i,r,s,t[a+4],7,-176418897),s=f(s,n,i,r,t[a+5],12,1200080426),r=f(r,s,n,i,t[a+6],17,-1473231341),i=f(i,r,s,n,t[a+7],22,-45705983),n=f(n,i,r,s,t[a+8],7,1770035416),s=f(s,n,i,r,t[a+9],12,-1958414417),r=f(r,s,n,i,t[a+10],17,-42063),i=f(i,r,s,n,t[a+11],22,-1990404162),n=f(n,i,r,s,t[a+12],7,1804603682),s=f(s,n,i,r,t[a+13],12,-40341101),r=f(r,s,n,i,t[a+14],17,-1502002290),i=f(i,r,s,n,t[a+15],22,1236535329),n=d(n,i,r,s,t[a+1],5,-165796510),s=d(s,n,i,r,t[a+6],9,-1069501632),r=d(r,s,n,i,t[a+11],14,643717713),i=d(i,r,s,n,t[a+0],20,-373897302),n=d(n,i,r,s,t[a+5],5,-701558691),s=d(s,n,i,r,t[a+10],9,38016083),r=d(r,s,n,i,t[a+15],14,-660478335),i=d(i,r,s,n,t[a+4],20,-405537848),n=d(n,i,r,s,t[a+9],5,568446438),s=d(s,n,i,r,t[a+14],9,-1019803690),r=d(r,s,n,i,t[a+3],14,-187363961),i=d(i,r,s,n,t[a+8],20,1163531501),n=d(n,i,r,s,t[a+13],5,-1444681467),s=d(s,n,i,r,t[a+2],9,-51403784),r=d(r,s,n,i,t[a+7],14,1735328473),i=d(i,r,s,n,t[a+12],20,-1926607734),n=p(n,i,r,s,t[a+5],4,-378558),s=p(s,n,i,r,t[a+8],11,-2022574463),r=p(r,s,n,i,t[a+11],16,1839030562),i=p(i,r,s,n,t[a+14],23,-35309556),n=p(n,i,r,s,t[a+1],4,-1530992060),s=p(s,n,i,r,t[a+4],11,1272893353),r=p(r,s,n,i,t[a+7],16,-155497632),i=p(i,r,s,n,t[a+10],23,-1094730640),n=p(n,i,r,s,t[a+13],4,681279174),s=p(s,n,i,r,t[a+0],11,-358537222),r=p(r,s,n,i,t[a+3],16,-722521979),i=p(i,r,s,n,t[a+6],23,76029189),n=p(n,i,r,s,t[a+9],4,-640364487),s=p(s,n,i,r,t[a+12],11,-421815835),r=p(r,s,n,i,t[a+15],16,530742520),i=p(i,r,s,n,t[a+2],23,-995338651),n=g(n,i,r,s,t[a+0],6,-198630844),s=g(s,n,i,r,t[a+7],10,1126891415),r=g(r,s,n,i,t[a+14],15,-1416354905),i=g(i,r,s,n,t[a+5],21,-57434055),n=g(n,i,r,s,t[a+12],6,1700485571),s=g(s,n,i,r,t[a+3],10,-1894986606),r=g(r,s,n,i,t[a+10],15,-1051523),i=g(i,r,s,n,t[a+1],21,-2054922799),n=g(n,i,r,s,t[a+8],6,1873313359),s=g(s,n,i,r,t[a+15],10,-30611744),r=g(r,s,n,i,t[a+6],15,-1560198380),i=g(i,r,s,n,t[a+13],21,1309151649),n=g(n,i,r,s,t[a+4],6,-145523070),s=g(s,n,i,r,t[a+11],10,-1120210379),r=g(r,s,n,i,t[a+2],15,718787259),i=g(i,r,s,n,t[a+9],21,-343485551),n=m(n,o),i=m(i,c),r=m(r,l),s=m(s,u)}return Array(n,i,r,s)}function h(t,e,n,i,r,s){return m(y(m(m(e,t),m(i,s)),r),n)}function f(t,e,n,i,r,s,a){return h(e&n|~e&i,t,e,r,s,a)}function d(t,e,n,i,r,s,a){return h(e&i|n&~i,t,e,r,s,a)}function p(t,e,n,i,r,s,a){return h(e^n^i,t,e,r,s,a)}function g(t,e,n,i,r,s,a){return h(n^(e|~i),t,e,r,s,a)}function m(t,e){var n=(65535&t)+(65535&e),i=(t>>16)+(e>>16)+(n>>16);return i<<16|65535&n}function y(t,e){return t<<e|t>>>32-e}function _(t){for(var e=Array(),i=(1<<n)-1,r=0;r<t.length*n;r+=n)e[r>>5]|=(t.charCodeAt(r/n)&i)<<r%32;return e}function x(e){for(var n=t?"0123456789ABCDEF":"0123456789abcdef",i="",r=0;r<4*e.length;r++)i+=n.charAt(e[r>>2]>>r%4*8+4&15)+n.charAt(e[r>>2]>>r%4*8&15);return i}var t=0,n=8;return{md5:i}});