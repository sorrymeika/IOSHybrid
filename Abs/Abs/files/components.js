define("components/activity",["$","core/model","models/api","widget/scroll"],function(t,e,i){var r=(t("$"),t("core/model")),s=t("models/api"),o=t("widget/scroll"),a=r.ViewModel.extend({el:'<div class="main"> <div class="hm_shop"> <div sn-repeat="item in activity"> <div sn-if="{{item.type==1}}" class="hm_shop_banner js_scroll"> <ul style="width:{{item.data.length*100}}%"> <li><img sn-src="{{img.src}}" sn-repeat="img in item.data" data-forward="{{img.url}}?from={{encodeURIComponent(\'/news/activity\'+id)}}" /></li> </ul> </div> <div sn-if="{{item.type==2}}" class="hm_shop_scroll js_scroll"> <ul class="{{type==\'H\'?\'hm_shop_list\':\'sp_list\'}}"> <li class="{{type==\'H\'?\'hm_shop_list_item\':\'sp_list_item\'}}" sn-repeat="prd in item.data" data-forward="/item/{{prd.PRD_ID}}?from={{encodeURIComponent(\'/news/activity\'+id)}}"> <img sn-src="{{prd.WPP_LIST_PIC}}" /> <p class="price">￥{{prd.PRD_PRICE}} <del sn-display="{{prd.PRD_SPECIAL_FLAG}}">¥{{prd.PRD_MEMBER_PRICE}}</del></p> <p class="name">{{prd.PRD_NAME}}</p> </li> </ul> </div> </div> </div> </div>',initialize:function(){var t=this;t.shopApi=new s.ActivityAPI({$el:t.$(".hm_shop"),params:{h5name:"api_prod"+this.data.id},success:function(e){t.set({activity:e.data}),o.bind(t.$(".js_scroll:not(.s_binded)").addClass("s_binded"),{vScroll:!1,hScroll:!0})}}),t.shopApi.load()}});i.exports=a});define("components/share",["$","core/view","core/model","bridge"],function(t,e,i){var r=(t("$"),t("core/view")),s=t("core/model"),o=t("bridge"),a=r.extend({events:{"tap .js_weixin_timeline":function(){this.clickToShare(0),o.wx({type:"shareLinkURL",linkURL:this.model.data.linkURL,tagName:"abs",title:this.model.data.title,image:this.model.data.image,description:this.model.data.description,scene:1},function(t){self.callback(t)})},"tap .js_weixin_session":function(){this.clickToShare(1),o.wx({type:"shareLinkURL",linkURL:this.model.data.linkURL,tagName:"abs",title:this.model.data.title,image:this.model.data.image,description:this.model.data.description,scene:0},function(t){self.callback(t)})},"tap .js_qq":function(){this.clickToShare(2),o.qq({type:"shareLinkURL",linkURL:this.model.data.linkURL,title:this.model.data.title,image:this.model.data.image,description:this.model.data.description},function(t){self.callback(t)})},"tap .js_cancel":function(){this.hide()},tap:function(t){t.target==this.el&&this.hide()}},el:'<div class="cp_share_mask" style="display:none"> <div class="cp_share"> <div class="hd">{{ head }}</div> <div class="bd"> <ul> <li class="js_weixin_timeline"><span>朋友圈</span></li> <li class="js_weixin_session"><span>微信</span></li> <li class="js_qq"><span>QQ</span></li> </ul> </div> <div class="ft"><b class="btn js_cancel">取消</b></div> </div> </div>',clickToShare:function(){},callback:function(){},initialize:function(){this.model=new s.ViewModel(this.$el,this.options)},set:function(t){return this.model.set(t),this},show:function(){return this.$el.show(),this},hide:function(){return this.$el.hide(),this}});i.exports=a});define("components/confirm",["$","core/model"],function(t,e,i){var n=t("$"),r=t("core/model"),s=r.ViewModel.extend({el:'<div class="cp_mask" style="display:none"> <div class="cp_confirm" style="height:{{height||\'auto\'}};margin-top:-{{height/2}}px"> <div class="cp_confirm_bd" sn-html="{{content}}"></div> <div class="cp_confirm_ft"><b sn-if="{{!alwaysOpen}}" class="btn" sn-tap="this.cancel()">取消</b><b class="btn js_confirm"  sn-tap="this.confirm()">确定</b></div> </div> </div>',cancel:function(t){this.hide();var e=this.get("cancel");e&&e.call(this,t)},confirm:function(t){this.hide();var e=this.get("confirm");e&&e.call(this,t)},initialize:function(){this.listenTo(this.$el,n.fx.transitionEnd,this._hide)},show:function(){this.$el.show().addClass("show"),this.set({height:this.$(".cp_confirm")[0].offsetHeight})},_hide:function(){!this.$el.hasClass("show")&&this.$el.hide()},hide:function(){this.data.alwaysOpen||this.$el.removeClass("show")}});i.exports=s});define("components/deletion",["$","core/touch","core/event"],function(t,e,n){var i=t("$"),r=t("core/touch"),o=t("core/event"),s=o.extend(function(t){var e=this,n=t.events;!t.width&&(t.width=80),this.$mask=i('<div style="position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0);display:none;z-index:3000"></div>').appendTo("body").on("touchend",function(t){var r=t.changedTouches[0];if(e.$mask.hide(),e.touch.scrollTo(0,0,200),!this._cancel){var s=document.elementFromPoint(r.pageX,r.pageY),a=e.$target[0].parentNode;if(n&&(a==s||i.contains(a,s)))for(var l in n)for(var c=s;c!=a.parentNode;c=c.parentNode)if(i(c).is(l))return n[l].call(e,new o("tap",{currentTarget:c,target:s})),!1}}).on("touchstart",function(){this._cancel=!1}).on("touchmove",function(){this._cancel=!0}),this.touch=new r(t.el,{enableVertical:!1,enableHorizontal:!0,maxDuration:200,divisorX:t.width,children:t.children}),this.touch.on("start",function(n){e.$target=i(n.currentTarget),this.maxX=t.width,this.minX=0}).on("move",function(t){e.$target.css({"-webkit-transform":"translate(-"+this.x+"px,0px)"})}).on("end",function(){console.log("end"),e.$mask.show()}).on("stop",function(){this.x!=t.width&&0!=this.x&&this.scrollTo(t.width,0,50)})});n.exports=s});define("components/month",["$","core/model","models/api","components/size","util"],function(t,e,i){var n=t("$"),r=t("core/model"),s=t("models/api"),o=t("components/size"),a=t("util"),l=r.ViewModel.extend({el:'<div class="main"><div class="uc_month_get" style="margin-bottom:10px"> <ul class="list"> <li sn-repeat="item in month"> <p class="img"><img src="{{item.WPP_LIST_PIC}}"></p> <p class="con"> <span class="name">{{item.PRD_NAME}}</span> <em>￥0</em> <del>￥{{item.PRD_PRICE}}&nbsp;</del> <b class="btn" sn-tap="this.showSize(item)">免费领取</b> </p></li> </ul> <div sn-repeat="list in data"> <img class="banner" sn-src="{{list.type==1?list.data:\'\'}}"  sn-if="{{list.type==1}}" /> <ul class="sp_list" style="overflow:hidden" sn-if="{{list.type==2}}"> <li sn-repeat="item in list.data" class="sp_list_item" data-forward="/item/{{item.PRD_ID}}?from={{url}}" sn-index="0"> <img src="{{item.WPP_LIST_PIC}}"> <p class="price"><b>￥{{item.PRD_PRICE}}</b><del sn-display="{{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}}" style="display: none;">￥{{item.PRD_MEMBER_PRICE}}&nbsp;</del></p> <p class="name">{{item.PRD_NAME}}</p> </li> </ul> </div> </div></div>',showSize:function(t,e){this.colorAndSpec.setParam({id:e.PRH_ID}).load(),this.size.set({data:e}).show()},initialize:function(){var t=this;t.set({url:encodeURIComponent(location.hash)}),t.size=new o,t.size.$el.appendTo(n("body"));var e=new s.MonthAPI({$el:t.$el,checkData:!1,params:{freid:this.data.id},success:function(e){for(var i=[],n=0;n<e.data.length;n++)-1==a.indexOf(i,function(t){return t.PRH_ID==e.data[n].PRH_ID})&&i.push(e.data[n]);t.records=e.data,t.set({month:i})}});e.load();var i=new s.MonthProductAPI({$el:t.$el,success:function(e){t.set(e)}});i.load(),t.colorAndSpec=new s.ProductColorAndSpec({$el:t.size.$el,checkData:!1,success:function(e){for(var i=[],n=[],r=0,s=e.data.length;s>r;r++){var o=e.data[r];-1!=a.indexOf(t.records,function(t){return t.PRD_ID==o.PRD_ID})&&(-1==i.indexOf(o.PRD_COLOR)&&i.push(o.PRD_COLOR),-1==n.indexOf(o.PRD_SPEC)&&n.push(o.PRD_SPEC))}var l=t.size.data.data,o=a.first(e.data,function(t){return t.PRD_ID==l.PRD_ID});console.log(e.data),t.size.set({freid:t.data.id,type:"month",color:i,spec:n,colorSpec:e.data,data:o,qty:1})}})}});i.exports=l});define("components/shareOrder",["$","core/model","components/share","models/api","models/user"],function(t,e,i){var s=(t("$"),t("core/model")),r=t("components/share"),o=t("models/api"),a=t("models/user"),l=s.ViewModel.extend({el:'<div class="main"><div class="od_share"> <h1>支付成功</h1> <h2>感谢在ABS购买商品</h2> <div class="con"> <div html="{{data.SHA_MSG}}"></div> <div class="btn" sn-tap="this.showShare()">{{ data.SHA_BUTTON_TIPS }}</div> </div> </div></div>',showShare:function(){this.addShareAPI.load()},initialize:function(){var t=this,e=new o.OrderShareAPI({$el:this.$el,checkData:!1,success:function(e){console.log(e),t.set({data:e.data}),t.share.set({title:e.data.SHA_NAME})},error:function(t){sl.tip(t.msg)}});t.share=new r({head:"分享"}),e.load(),t.user=a.get(),this.addShareAPI=new o.AddShareAPI({$el:this.$el,params:{pspcode:t.user.PSP_CODE,purid:t.data.id},checkData:!1,success:function(e){t.share.set({linkURL:e.data,description:""}),t.share.show()},error:function(t){sl.tip(t.msg)}}),t.share.callback=function(t){},t.share.$el.appendTo(t.$el)}});i.exports=l});define("components/size",["$","core/model","models/api","util","widget/scroll","models/user"],function(t,e,i){var n=t("$"),s=t("core/model"),r=t("models/api"),o=t("util"),a=t("widget/scroll"),l=t("models/user"),c=s.ViewModel.extend({el:'<div class="pd_size_wrap js_size {{isShowSize?\'\':\'out\'}}" style="display:none" sn-tap="this.tap()"> <div class="pd_size"> <div class="pd_size_close" sn-tap="isShowSize=false"></div> <div class="base_info"> <div class="img"><img src="{{data.WPP_LIST_PIC||data.WPP_M_PIC}}" /></div> <div class="info"> <h2 class="price">¥{{ data.PRD_PRICE }}</h2> <div class="qty">库存{{ data.PRD_NUM }}件</div> <p class="other"> <em>选择</em> <em>尺码</em> <em>颜色分类</em> </p> </div> </div> <div class="pd_size_con"> <div class="pd_size_select"> <div class="hd">尺码</div> <ul> <li sn-repeat="item in spec" class="{{data.PRD_SPEC==item?\'curr\':this.isInList(item,data.PRD_COLOR,colorSpec)?\'\':\'disabled\'}}" sn-tap="this.setSpec(item)">{{ item.split(\'|\')[0] }}</li> </ul> </div> <div class="pd_size_select"> <div class="hd">颜色分类</div> <ul> <li sn-repeat="item in color" class="{{data.PRD_COLOR==item?\'curr\':this.isInList(data.PRD_SPEC,item,colorSpec)?\'\':\'disabled\'}}" sn-tap="this.setColor(item)">{{ item }}</li> </ul> </div> </div> <div class="pd_size_buy"> <p class="hd">购买数量</p> <p class="qty"><em sn-tap="qty=Math.max(1,qty-1)">-</em> <input type="text" class="qty" sn-model="qty" value="{{qty}}" /> <em sn-tap="qty=qty+1">+</em> </p> </div> <b class="btn_large btn_confirm{{data.PRD_NUM===0?\' disabled\':\'\'}}" sn-tap="this.confirm()">{{ data.PRD_NUM === 0 ? \'商品已售罄\' : (btn || \'确认\') }}</b> </div> </div>',isInList:function(t,e,i){return!!o.first(i,function(i){return i.PRD_SPEC==t&&i.PRD_COLOR==e})},setSpec:function(t,e){n(t.currentTarget).hasClass("disabled")||(this.set("data.PRD_SPEC",e),this.onChange())},setColor:function(t,e){n(t.currentTarget).hasClass("disabled")||(this.set("data.PRD_COLOR",e),this.onChange())},onChange:function(){var t=this,e=t.get("colorSpec"),i=t.get("data"),n=o.first(e,function(t){return t.PRD_SPEC==i.PRD_SPEC&&t.PRD_COLOR==i.PRD_COLOR});n&&(void 0!==n.PRD_PRICE&&this.set("data.PRD_PRICE",n.PRD_PRICE),void 0!==n.PRD_NUM&&this.set("data.PRD_NUM",n.PRD_NUM),void 0!==n.WPP_LIST_PIC&&this.set("data.WPP_LIST_PIC",n.WPP_LIST_PIC)),this.trigger("SizeChange",n)},show:function(){this.$el.show(),this.set({isShowSize:!0})},confirm:function(t){var e=this,i=e.get("colorSpec"),n=e.get("data"),s=o.first(i,function(t){return t.PRD_SPEC==n.PRD_SPEC&&t.PRD_COLOR==n.PRD_COLOR}),r=l.get();if(!r)return void Application.forward("/login?success="+encodeURIComponent(Application.getCurrentActivity().url));if("package"==this.data.type)this.data.confirm(s,this.data.PST_ID,e.get("qty"));else if("group"==this.data.type)this.data.confirm(s,s.PRD_ID,e.get("qty"));else{if(e.set({data:s}),0===s.PRD_NUM)return void sl.tip("该商品已售罄");e.cartAddAPI.setParam({pspcode:e.user.PSP_CODE,prd:s.PRD_ID,qty:e.get("qty")}).load()}},hide:function(){this.set({isShowSize:!1})},tap:function(t){n(t.target).hasClass("js_size")&&this.hide()},initialize:function(){var t=this;t.user=o.store("user"),a.bind(t.$(".pd_size_con")),t.listenTo(t.$el,n.fx.transitionEnd,function(e){t.$el.hasClass("out")&&t.$el.hide()}),t.cartAddAPI=new r.CartAddAPI({$el:t.$el,checkData:!1,check:!1,beforeSend:function(){"month"==t.data.type?this.setUrl("/api/prod/addmemberbag").setParam({prdid:t.get("data").PRD_ID,freid:t.get("freid")}):this.setParam({prd:t.get("data").PRD_ID}),t.$(".js_buy").addClass("disabled")},success:function(e){e.success?(Application.getCurrentActivity().setResult("CartChange"),sl.tip("加入购物车成功！"),t.hide()):sl.tip(e.msg)},complete:function(){t.$(".js_buy").removeClass("disabled")}})}});i.exports=c});define("components/fastbuy",["$","core/model","models/api","components/size","util"],function(require,exports,module){var $=require("$"),model=require("core/model"),api=require("models/api"),Size=require("components/size"),util=require("util"),Month=model.ViewModel.extend({el:'<div class="main"><div class="sp_fastbuy" style="margin-bottom:10px"> <dl sn-repeat="item in data" class="repeat"> <dt><b></b><i>{{util.formatDate(item.time,item.timeLeft?\'MM月dd日 HH:mm\':\'MM月dd日 即将开始\')}}</i><span sn-display="{{item.timeLeft}}">{{item.timeLeft.indexOf(\'-\')!=0?\'还剩\':\'\'}}<em>{{item.timeLeft.indexOf(\'-\')==0?\'已结束\':item.timeLeft}}</em></span></dt> <dd sn-repeat="prod in item.data"> <img src="{{prod.WPP_LIST_PIC}}" sn-tap="this.goto(prod)"> <div class="con"> <span class="name">{{prod.PRD_NAME}}</span> <p class="price"> <del sn-display="{{prod.PRD_PRICE!=0&&prod.PRD_PRICE<prod.PRD_MEMBER_PRICE}}" style="display: none;">￥{{prod.PRD_MEMBER_PRICE}}&nbsp;</del> <em>￥{{prod.PRD_PRICE}}</em> </p> <p class="fast_btn"> <span>仅限<em>{{prod.flp_stock}}</em>件</span> <b class="btn{{!prod.qty||(item.timeLeft&&item.timeLeft.indexOf(\'-\')==0)?\' over\':\'\'}}" sn-tap="this.goto(prod)">{{item.timeLeft?(item.timeLeft.indexOf(\'-\')!=0?(!prod.qty?\'已抢完\':\'立即抢购\'):\'已结束\'):\'即将开始\'}}</b> </p> </div> </dd> </dl> </div><div class="datanotfound fastbuy_nodata" sn-display="{{!data.length}}"> <h1>FLASH SALE</h1> 每周一上午10:00准点开抢 </div></div>',"goto":function(t,e){var i=this;i.view.forward("/item/"+e.PRD_ID+"?from="+encodeURIComponent(i.view.route.url)),console.log(e)},timeDiff:function(t,e){if(+t>Date.now()||i)return"";var i=+e-Date.now();if(0>i)return"-";var n=parseInt(i/864e5);i%=864e5;var r=parseInt(i/36e5);i%=36e5;var s=parseInt(i/6e4);i%=6e4;var o=parseInt(i/1e3);return i%=1e3,(n?n+"天 ":"")+util.pad(r)+":"+util.pad(s)+":"+util.pad(o)},initialize:function(){var self=this;self.set({url:encodeURIComponent(location.hash)});var now=new Date,startDt;startDt=1!=now.getDay()?new Date(Date.now()-24*(now.getDay()-1)*60*60*1e3):now;var endDt=new Date(+startDt+6048e5),dataAPI=new api.FastBuyAPI({$el:self.$el,checkData:!1,params:{startdt:util.formatDate(startDt,"yyyy-MM-dd 00:00:00"),enddt:util.formatDate(endDt,"yyyy-MM-dd 23:59:59")},success:function(res){for(var result=[],i=0;i<res.data.length;i++){var item=res.data[i],prod=item.V_PRODUCT1,time=eval("new "+item.flp_start_time.replace(/\//g,"")),endTime=eval("new "+item.flp_end_time.replace(/\//g,"")),strTime=util.formatDate(time),strEndTime=util.formatDate(endTime);if(!(+time>Date.now())){var data=util.first(result,function(t){return t.strTime==strTime&&t.strEndTime==strEndTime}),prodInfo={PRD_ID:prod.PRD_ID,WPP_LIST_PIC:prod.WPP_LIST_PIC,PRD_NAME:prod.PRD_NAME,PRD_PRICE:item.flp_price,PRD_MEMBER_PRICE:prod.PRD_MEMBER_PRICE,flp_stock:item.flp_stock,qty:item.qty};data?data.data.push(prodInfo):result.push({strTime:strTime,strEndTime:strEndTime,timeLeft:self.timeDiff(time,endTime),time:time,endTime:endTime,data:[prodInfo]})}}setInterval(function(){self.getModel("data").each(function(t,e){t.set({timeLeft:self.timeDiff(t.data.time,t.data.endTime)})})},1e3),self.set({data:result})}});dataAPI.load()}});module.exports=Month});define("components/package",["$","core/model","models/api","components/size","util"],function(t,e,i){var n=t("$"),r=t("core/model"),s=t("models/api"),o=t("components/size"),a=t("util"),l=r.ViewModel.extend({el:'<div class="main sp_package"> <div class="sp_package_hd" style="display:none"> <div class="con"> <h1>{{PPG_NAME}}</h1> <div class="text">{{PPG_MEMO}}</div> </div> </div> <div class="sp_package_bd" sn-repeat="item in data"> <div class="hd">{{item.PPS_Model.PST_NAME}} <em>下方商品任选{{item.PPS_Model.PST_OPTIONAL_QTY}}件</em></div> <ul> <li sn-repeat="prod in item.PRD_List"> <img sn-src="{{prod.WPP_LIST_PIC}}" data-forward="/item/{{prod.PRD_ID}}?from={{url}}" /> <div class="name" sn-tap="this.selectSize(item,prod)"> <span>{{prod.PRD_NAME}}</span> <b>选择 尺寸 颜色 ></b> <p class="qty"> <span class="minus">-</span> <input type="text" value="{{prod.qty||1}}" sn-model="changedQty"> <span class="plus">+</span> </p> </div> <p class="price"> <em>￥{{prod.PRD_PRICE}}</em> <del sn-display="{{prod.PRD_PRICE!=0&&prod.PRD_PRICE<prod.PRD_MEMBER_PRICE}}" style="display: none;">￥{{prod.PRD_MEMBER_PRICE}}&nbsp;</del> </p> </li> </ul> </div> </div><div class="sp_package_ft"> <div class="price"> <em>总计：</em><b>¥{{PPG_PRICE}}</b> </div> <div class="buy" sn-tap="this.showList()">查看套餐商品（{{qty||0}}）</div> </div><div class="sp_package_list" sn-tap="this.hideList()" style="display:none"> <div class="sp_package_hd"> 确认套餐清单 </div> <div class="main"> <div class="sp_package_bd" sn-repeat="item in data"> <div class="hd">{{item.PPS_Model.PST_NAME}} <em>任选{{item.PPS_Model.PST_OPTIONAL_QTY}}件</em></div> <ul> <li sn-repeat="prod in item.list"> <img sn-src="{{prod.WPP_LIST_PIC}}" /> <div class="name"> <span>{{prod.PRD_NAME}}</span> </div> <p class="price"> <em>￥{{prod.PRD_PRICE}}</em> <del sn-display="{{prod.PRD_PRICE!=0&&prod.PRD_PRICE<prod.PRD_MEMBER_PRICE}}" style="display: none;">￥{{prod.PRD_MEMBER_PRICE}}&nbsp;</del> </p> <b>尺寸:{{prod.PRD_DISPLAY_SPEC}} 颜色:{{prod.PRD_COLOR}}  x{{prod.qty}}</b> <div class="btn" sn-tap="this.deleteItem(prod,item.PPS_Model.PST_ID)">删除</div> </li> </ul> </div> </div> <div class="sp_package_ft"> <div class="buy" sn-tap="this.buy()">加入购物车</div> </div> </div>',deleteItem:function(t,e,i){this.getModel("data").each(function(t,n){var r=t.get("PPS_Model");return r.PST_ID==i?(t.getModel("list").remove(a.indexOf(t.data.list,function(t){return t.PRD_ID==e.PRD_ID})),!1):void 0}),this.refreshQty()},refreshQty:function(){for(var t=this,e=0,i=0;i<t.data.data.length;i++)for(var n=t.data.data[i],r=0;n.list&&r<n.list.length;r++)e+=n.list[r].qty;t.set({qty:e})},_hideList:function(){this.$(".sp_package_list").hide()},showList:function(){this.$(".sp_package_list").show()},hideList:function(t){n(t.target).hasClass("sp_package_list")&&this._hideList()},selectSize:function(t,e,i){for(var n=this,r=[],s=[],a=(this.data.data,0),l=e.PRD_Lis.length;l>a;a++){var c=e.PRD_Lis[a];c.PRD_SPEC=c.PRD_DISPLAY_SPEC,-1==r.indexOf(c.PRD_COLOR)&&r.push(c.PRD_COLOR),-1==s.indexOf(c.PRD_DISPLAY_SPEC)&&s.push(c.PRD_DISPLAY_SPEC)}i.PRD_SPEC=i.PRD_DISPLAY_SPEC,n.size.set({PST_ID:e.PPS_Model.PST_ID,type:"package",color:r,spec:s,colorSpec:e.PRD_Lis,data:i,qty:1}).show()},buy:function(t,e){var i=this;if(!this.data.qty)return void sl.tip("请选择套餐商品");for(var r,n="",s=0;s<i.data.data.length;s++){var o=i.data.data[s];if(r=o.PPG_ID,n+=o.PPS_Model.PST_ID+"-",!o.list)return void sl.tip("请选择分组商品");for(var a=0;a<o.list.length;a++)for(var l=0;l<o.list[a].qty;l++)n+=o.list[a].PRD_ID+",";n+="|"}i.cartAddAPI.setParam({ppgId:r,prdIds:n}).load()},initialize:function(){var t=this;t.user=a.store("user"),t.set({url:encodeURIComponent(location.hash)}),t.size=new o({btn:"选择商品",confirm:function(e,i,r){t.getModel("data").each(function(t,s){var o=t.get("PPS_Model");if(o.PST_ID==i){var a=o.PST_OPTIONAL_QTY,l=t.get("list");l=l?[].concat(l):[];for(var c=0,u=0;u<l.length;u++)c+=l[u].qty;return c+r>a?(sl.tip("您选择的商品数量超过该组指定数量"),!1):(l.push(n.extend({},e,{qty:r})),t.set({list:l}),!1)}}),t.refreshQty(),t.size.hide()}}),t.size.$el.appendTo(n("body"));var e=new s.PackageAPI({$el:t.$(".sp_package"),params:{id:this.data.id},success:function(e){console.log(e.data);var i=e.data[0];t.set({PPG_MEMO:i.PPG_MEMO,PPG_NAME:i.PPG_NAME,PPG_PRICE:i.PPG_PRICE,data:e.data})}});e.load(),t.cartAddAPI=new s.PackageCartAPI({$el:t.$el,checkData:!1,check:!1,params:{pspcode:t.user.PSP_CODE},success:function(t){t.success?sl.tip("加入购物车成功！"):sl.tip(t.msg)},complete:function(){t._hideList()}})}});i.exports=l});define("components/banner",["$","core/model","models/api","components/size","util"],function(t,e,i){var r=(t("$"),t("core/model")),a=(t("models/api"),t("components/size"),t("util")),l=r.ViewModel.extend({el:'<div class="main banner2"> <img src="http://appuser.abs.cn/dest/images/banner.jpg" data-forward="/news/activity2" /> <div class="banner2_text"> 1.本次活动仅限APP新用户参与，每手机账号限领取一次礼物兑换券。<br/> 2.礼物兑换券可在“我的卡券”中查看，您可以在ABS官方APP及ABS家居体验店凭券兑换纳米净颜美容巾1条。<br/> a）在ABS家居体验店领取：<br/> 凭券到店－向家居顾问出示优惠券－即可兑换礼物。<br/> b）在ABS官方APP领取：<br/> 商品加入购物车－选择优惠券－去结算－购买支付－礼物到家。<br/> ​3.请在礼物兑换券有效期内及时兑换，逾期作废。<br/> 4.本活动不与其他特惠活动共享本次活动商品数量有限，领完即止。<br/> *本活动最终解释权归上海爱彼此家居用品股份有限公司所有。<br/> </div> </div>',initialize:function(){var t=this;t.user=a.store("user"),t.set({url:encodeURIComponent(location.hash)})}});i.exports=l});define("components/category",["$","core/model","models/api","widget/scroll"],function(t,e,i){var n=t("$"),s=t("core/model"),a=(t("models/api"),t("widget/scroll"),s.ViewModel.extend({el:'<div class="cp_category_mask" style="display:none"> <div class="cate_popup_hd">全部分类</div> <div class="cate_popup_bd"> <ul class="cate_popup_list"> <li sn-repeat="item in data" class="{{item.PCG_ID==current?\'curr \':\'\'}} cate{{item.PCG_ID}}" sn-tap="goto(item.PCG_ID)">{{ item.PCG_NAME }}</li> </ul> </div> </div>',initialize:function(){var t=this;t.listen("tap",function(e){(n(e.target).hasClass("cate_popup_bd")||n(e.target).hasClass("cate_popup_hd"))&&t.hide()})},aboutUs:function(t){this.$el.hide(),Application.forward("/news/200")},home:function(){this.$el.hide(),Application.back("/")},show:function(){this.$el.show()},hide:function(){this.$el.hide()}}));i.exports=a});define("models/api",["widget/loading"],function(t,e,n){var i=t("widget/loading"),r=i.extend({url:"/app/getversion",baseUri:$('meta[name="update-api-base-url"]').attr("content")});e.UpdateAPI=r;var o=i.extend({baseUri:$('meta[name="api-base-url"]').attr("content")});e.API=o,e.OrderStatusAPI=o.extend({url:"/api/user/get_order_status",checkData:!1,check:!1,params:{id:0}}),e.OrderAPI=o.extend({url:"/api/order/get",checkData:!1,check:!1,params:{orderId:0}}),e.CouponStatusAPI=o.extend({url:"/api/user/get_coupon_status",checkData:!1,check:!1,params:{id:0}});var s=i.extend({baseUri:$('meta[name="shop-api-base-url"]').attr("content"),KEY_PAGE:"currentpage"});e.ShopAPI=s,e.NewsAPI=s.extend({url:"/api/prod/getedm",checkData:!1,params:{id:0}}),e.AddressListAPI=s.extend({url:"/api/user/addresslist",params:{pspcode:0}}),e.EditAddressAPI=s.extend({url:"/api/user/editaddress",params:{pspcode:0,edittype:2,mbaId:0,mbaName:"",mbaMobile:0,mbaCtyId:0,mbaDefault:!1,mbaRegId:0,mbaAddress:""}}),e.DeleteAddressAPI=s.extend({url:"/api/user/deladdress",params:{pspcode:0,mbaId:0}}),e.ProvinceAPI=s.extend({url:"/api/user/prvlist"}),e.CityAPI=s.extend({url:"/api/user/ctylist",params:{prvId:0}}),e.RegionAPI=s.extend({url:"/api/user/reglist",params:{ctyId:0}}),e.CouponAPI=s.extend({url:"/api/user/GetCoupon",params:{pspcode:"",csvcode:""}}),e.AvailableCouponAPI=s.extend({url:"/api/prod/availablecoupon",params:{pspcode:""}}),e.GetSharedCouponAPI=o.extend({url:"/api/user/get_shared_coupon",params:{UserID:0,Auth:"",data:""}}),e.CouponUserAPI=o.extend({url:"/api/user/get_coupon_user",params:{data:""}}),e.CreateOrderAPI=s.extend({url:"/api/shop/CreateMOrder",params:{pspcode:"",mba_id:1,pay_type:1,coupon:"",points:0,freecoupon:""}}),e.CategoryAPI=s.extend({url:"/api/prod/pcglist"}),e.SubCategoryAPI=s.extend({url:"/api/prod/pcgitem",params:{id:0}}),e.ProductSearchAPI=s.extend({url:"/Prod/productlist",params:{keycodes:"",orderbyStr:2,orderby:"desc",length:2,pages:0}}),e.ProductHeadAPI=s.extend({url:"/api/prod/prhitem",params:{id:0}}),e.ExpressAPI=s.extend({url:"/api/shop/getexpress",params:{pur_code:"86342016010103750166"}}),e.ProductAPI=s.extend({url:"/api/prod/prditem",params:{id:0}}),e.ProductColorAndSpec=s.extend({url:"/api/prod/getsizebyprh",params:{id:0}}),e.ProductDetailAPI=s.extend({url:"/api/prod/prddetail",params:{id:0}}),e.ProductListAPI=s.extend({url:"/api/prod/pcgprd",params:{pcgid:0}}),e.NewProductAPI=s.extend({url:"/api/prod/newproductlist",params:{length:100,pages:0}}),e.ActivityAPI=s.extend({url:"/Prod/GetApiBannerPrd",params:{h5name:"api_prod1"}}),e.CartAPI=s.extend({url:"/api/shop/bag",params:{pspcode:0}}),e.CartQtyAPI=s.extend({url:"/api/shop/bagqty",params:{pspcode:0}}),e.CartAddAPI=s.extend({url:"/api/shop/addbag",params:{pspcode:0,prd:0,qty:1}}),e.CartModifyAPI=s.extend({url:"/api/shop/SaveProductChangeRow",params:{pspcode:0,spbId:0,qty:1}}),e.CartDeleteAPI=s.extend({url:"/api/shop/deletebag",params:{pspcode:0,spbId:0}}),e.CartDeletePackageAPI=s.extend({url:"/api/shop/deletepackagebag",params:{pspcode:0,wacid:0,ppgid:0,groupid:0}}),e.CancelOrderAPI=s.extend({url:"/shop/cancelOrder",params:{pspcode:"",purcode:""}}),e.OrderCreateAPI=s.extend({url:"/api/shop/CreateMOrder",params:{pspcode:"",mba_id:0,pay_type:1,coupon:"",points:0,freecoupon:""}}),e.OrderShareAPI=s.extend({url:"/api/prod/shareactivity"}),e.AddShareAPI=s.extend({url:"/api/prod/addshare",params:{pspcode:""}}),e.WxPayAPI=o.extend({url:"/api/shop/wxpayqrcode",checkData:!1,params:{order_no:""}}),e.StewardListAPI=s.extend({url:"/api/steward/list",params:{pspid:0}}),e.StewardQtyAPI=s.extend({url:"/api/steward/stewardqty",params:{pspcode:""}}),e.StewardAPI=s.extend({url:"/api/steward/item",params:{prh_id:0}}),e.StewardDetailAPI=s.extend({url:"/api/steward/detail",params:{detail_id:0}}),e.MonthAPI=s.extend({url:"/api/prod/freeskulist",params:{freid:2}}),e.MonthProductAPI=s.extend({url:"/api/prod/ajaxactprdlist",params:{pages:1,len:6}}),e.FastBuyAPI=s.extend({url:"/api/prod/flashprodlist",params:{startdt:"2015-01-01",enddt:"2016-01-01"}}),e.PackageAPI=s.extend({url:"/api/prod/getpackage",params:{id:0}}),e.PackageCartAPI=s.extend({url:"/api/prod/addpackagebag",params:{pspcode:"",prdIds:"",ppgId:""}}),e.PackageRelativeAPI=s.extend({url:"/api/prod/getppginfo",params:{prdId:""}}),e.DiscoverTypeAPI=s.extend({url:"/api/discover/discovertype"}),e.DiscoverListAPI=s.extend({url:"/api/discover/discoverlist",params:{currentpage:1,pageSize:10,dctid:0}}),e.RecDiscoveryAPI=s.extend({url:"/api/discover/recdiscovery"}),e.DiscoveryAPI=s.extend({url:"/api/discover/discover",params:{id:0}}),e.DiscoveryAddShareAPI=s.extend({url:"/api/discover/addshare",checkData:!1,params:{pspcode:"",dcvid:0}}),e.DiscoveryFavAPI=s.extend({url:"/api/discover/addlikes",checkData:!1,params:{pspcode:"",dcvid:0}}),e.DiscoveryRemoveFavAPI=s.extend({url:"/api/discover/removelikes",checkData:!1,params:{pspcode:"",dcvid:0}}),e.AppShareActivityAPI=s.extend({url:"/api/discover/appshareactivity",checkData:!1,params:{id:0}}),e.AddActivityCouponAPI=s.extend({url:"/api/discover/addcashvoucher",checkData:!1,params:{pspcode:"",vca_id:20}}),e.AppIconAPI=s.extend({url:"/system/getappicon",checkData:!1,params:{id:2}}),e.HotSearchAPI=s.extend({url:"/api/system/gethotkey",checkData:!1}),e.GroupListAPI=s.extend({url:"/api/prod/grouppurchaselist"}),e.GroupAPI=s.extend({url:"/api/prod/grouppurchasebyid",params:{pspcode:"",gppid:0}}),e.GroupShareAPI=s.extend({url:"/api/prod/getlppid",params:{pspcode:"",gppid:0}}),e.GroupAddToCartAPI=s.extend({url:"/api/shop/addgppbag",params:{pspcode:"",prdid:0,lppid:0}}),e.HistoryRecord=s.extend({checkData:!1,check:!1,url:"/api/user/versionhis",params:{pspid:0,appversion:"",device:"",deviceversion:""}})});define("models/user",["models/api","core/model","core/event","util","$"],function(t,e,n){var i=t("models/api"),r=t("core/model"),s=(t("core/event"),t("util")),a=t("$"),l=r.State,c={get:function(){var t=l.get("user");return t||(t=s.store("user"),t&&l.set("user",t)),t},set:function(t){return null!=t&&(t=a.extend({},c.get(),t)),s.store("user",t),l.set("user",t),this},setParam:function(t){return u.setParam(t),this},request:function(t,e){var i=this.get();return u.setParam({UserID:i.ID,Auth:i.Auth,ivcode:e?e:""}).load(t),this}},u=new i.API({url:"/api/user/get",checkData:!1,success:function(t){t.success&&c.set(t.data)},error:function(){}});n.exports=c});define("models/discovery",["models/api","core/model","util","$"],function(t,e,n){var o=(t("models/api"),t("core/model"),t("util")),s=t("$"),a={get:function(t){var e=o.store("DiscoveryList")||[];return void 0===t?e:o.first(e,function(e){return e.DCV_ID==t})},clear:function(){o.store("DiscoveryList",null)},add:function(t){var e=this.get();s.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){for(var i=!0,r=t[n],a=0;a<e.length;a++)if(e[a].DCV_ID==r.DCV_ID){i=!1,e[a]=r;break}i&&e.push(r)}return o.store("DiscoveryList",e),this}};n.exports=a});define("models/category",["models/api","core/model","util","$"],function(t,e,n){var i=t("models/api"),r=t("core/model"),o=t("util"),a=(t("$"),r.State),l=new i.CategoryAPI({success:function(t){o.store("categories",t.data),o.store("navs",t.data2)},error:function(){}});console.log(l);var c={get:function(t){var e=a.data.categories,n=function(e,n){a.set({categories:e,navs:n}),t(e,n)};e||(e=o.store("categories"))?n(e,o.store("navs")):l.load(function(t,e){n(e.data,e.data2)})},list:function(t){this.get(function(e,n){var i=o.find(e,function(t){return t.children=o.find(e,function(n){return n.PCG_PARENT_ID==t.PCG_ID?(n.children=o.find(e,function(t){return t.PCG_PARENT_ID==n.PCG_ID}),!0):!1}),1==t.PCG_DEPTH});t(i,n)})},request:function(t){return l.load(t),this}};n.exports=c});