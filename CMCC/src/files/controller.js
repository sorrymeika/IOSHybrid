define("template/home",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='  <div class="hm_home dock" ref="home"> <header sn-if="tab==1" class="flex {headBg?\'header_app\':\'header_trans\'} g_anim"> <!--<a href="javascript:;" sn-tap="delegate.menu()" class="hm-icons-person h_bar pl_m pr_m"></a>--> <div class="flex_0"></div> <div class="hm-icons-shop h_bar pl_m pr_m" data-forward="/business/service"></div> </header> <header sn-if="tab==2" class="flex header_app"> <div class="head_title cl_fff">娱 乐</div> </header> <header sn-if="tab==3" class="flex header_app"> <!--<a href="javascript:;" sn-tap="delegate.menu()"><img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(user.avatars)}" class="cir ml_m" /></a>--> <div class="head_title cl_fff">圈 子</div> <div class="head_right"> <div class="icon-search3 h_bar pl_m pr_s" data-forward="{quanTab.index==0?\'/pubquan/search\':\'/contact/search\'}"></div> <div class="icon-plus h_bar pl_m pr_l" sn-tap="this.showQuanMenu()"></div> </div> </header> <header sn-if="tab==4" class="flex header_app"> <div class="head_title cl_fff">我 的</div> <div class="head_right"> <div class="user-setting2 h_bar pl_m pr_l" data-forward="/user/settings"></div> </div> </header> <div sn-if="tab==1" class="hm_idx main" ref="life"> <div class="hm_idx__head"> <div class="hm-yunmi-rem mg_a ta_c ps_r" sn-tap="this.receiveYunmi()"> <i class="num" sn-if="currentYunmi.amount">+{currentYunmi.amount}</i> </div> <div class="hm-to_yunmi-rem ta_c" data-forward="/yunmi"> </div> <a href="javascript:;" sn-tap="this.showYunMi()" class="hm_idx__ym_rule dock_bl cl_fff fs_s pd_s pl_m">云米规则</a> </div> <div class="hm_idx__banner" ref="banner"> </div> <div class="hm_idx__life"> '+this.helpers.notify(2,"生活提醒")+" "+this.helpers.notify(1,"通信提醒")+" "+this.helpers.notify(3,"娱乐提醒")+" "+this.helpers.business(4,"社交提醒")+' <ul class="pr_m hm_idx__notifi_bg" sn-if="showNotify==4"> <li class="flex subitem bd_b ml_m" sn-repeat="item in messagesList.list|filter:item.push_to_home|orderBy:date desc" data-forward="{item.type==7?\'/contact/person/\'+item.user_id:(\'/contact/chat/\'+item.user_id)}"> <i class="unread" sn-if="item.unread">+{item.unread}</i> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.thumbnail(item.avatars)}" /> <div class="flexitem pl_m"> <div class="name fs_m">{item.user_name}</div> <div class="fs_s cl_999 to_e con">{item.msg}</div> </div> <div class="pl_m"> <p class="date fs_s cl_999">{item.date?util.formatDate(item.date,\'yyyy/MM/dd\'):\'\'}</p> </div> </li> </ul> </div> </div> <div sn-if="tab==2" class="hm_video main bg_fff {video.isFullscreen?\'hm_video__fullscreen\':\'\'}" ref="ent"> <div class="hm_video__videowrap" sn-tap="delegate.tapVideo()" sn-style="{video.isFullscreen?\'width:\'+window.innerHeight+\'px;height:\'+window.innerWidth+\'px;margin:\'+(window.innerHeight-window.innerWidth)/2+\'px 0 0 -\'+(window.innerHeight-window.innerWidth)/2+\'px;\':\'\'}"> <video ref="video" webkit-playsinline playsinline></video> <div class="hm_video__control flex" sn-if={video.isShowControl}> <button class="hm_video__control_play {video.isPlaying?\'playing\':\'\'}" sn-tap="delegate.playOrStop()"></button> <div class="flexitem"></div> <button class="hm_video__control_fullscreen" sn-tap="delegate.toggleVideoFullscreen()">[{video.isFullscreen?\'缩小\':\'全屏\'}]</button> </div> </div> <div class="hm_video__bar flex h_bar"> <div class="flex jc_c" style="width:80px"> 分类 </div> <div class="ml_l"> <Text>频道</Text> </div> <div class="flexitem"> </div> <button class="{video.autoplay?\'icon-checked\':\'icon-check\'} bg_0000 mr_s" sn-tap="delegate.toggleAutoplay()"></button> <div class="mr_m" sn-tap="delegate.toggleAutoplay()">自动播放</div> </div> <div class="flex ai_s bd_t hm_video__chl" sn-if="video.isShowChannel" sn-style="{video.isFullscreen?\'width:\'+window.innerHeight/2+\'px;height:\'+window.innerWidth+\'px;top:\'+(window.innerHeight/2-window.innerWidth)/2+\'px;left:\'+(window.innerHeight/2-window.innerWidth)/-2+\'px;margin-top:0px\':\'\'}"> <ul class="hm_video__cat bd_r h_1x" sn-css="height:{video.isFullscreen?window.innerWidth+\'px\':\'100%\'}"> <li sn-repeat="item in video.list" sn-tap="delegate.changeChannelCat(item)" class="{video.selectedCat.id==item.id?\'curr\':\'\'} {video.isFullscreen?\'\':\'bd_b\'} ai_c jc_c flex"> {item.name} </li> </ul> <ul class="flexitem hm_video__list h_1x" ref="videoList"> <li sn-repeat="item in video.selectedCat.children" class="flex {video.selectedChannel.id==item.id?\'curr\':\'\'}" sn-tap="delegate.changeChannel(item)"> <img sn-if="!video.isFullscreen" src="{sl.resource(item.image)}" /> <p class="flexitem ml_m">{item.name}</p> </li> </ul> </div> </div> <div sn-if="tab==3" class="hm_quan__main" ref="quanTab" sn-require="widget/tab" sn-data="{{items:[\'公众圈\',\'朋友圈\',\'通讯录\']}}"> <div class="hm_pubquan"> <div class="hm_pubquan__banner mb_l" ref="quanBanner"> </div> <div class="bd_t mb_l bg_fff"> <div class="bd_b lh_m ml_m ta_c mr_m">我关注的</div> <div class="ta_c bd_b lh_m fs_s cl_ccc" sn-if="!myfollowPublicQuan.length">暂未关注公众圈</div> <div class="hm_pubquan__myfollow bd_b" sn-repeat="item in myfollowPublicQuan"> <div class="bd" data-forward="/pubquan/article/{item.pub_quan_msg.msg_id}"> <div class="pb_s pl_m pt_m fs_l flex"> <div class="to_e flexitem">{item.pub_quan_msg.title}</div> <p class="date fs_s mr_m cl_999">{util.formatDate(item.pub_quan_msg.add_date,"short")}</p> </div> <ul class="imgs clearfix"> <li class="img fl_l pl_m" sn-repeat="img in item.pub_quan_msg.imgs"><img sn-src="{sl.thumbnail(img)}" /></li> </ul> </div> <div sn-if="item.pub_quan_msg" class="ft flex lh_s pl_m pb_m"> <div class="flex flexitem" data-forward="/pubquan/{item.quan_id}"> <p class="img cir_s mr_m"> <img class="cir_s" sn-src="{sl.resource(item.quan_pic)}" /> </p> <p class="name flexitem"><span class="br_2 bg_ccc cl_fff pr_s pl_s fs_m">{item.quan_name}</span></p> </div> <p class="icon-see mr_m"><span class="ml_s va_m fs_s">{util.cnNum(item.pub_quan_msg.see)}</span></p> <p class="icon-good mr_m"><span class="ml_s va_m fs_s">{util.cnNum(item.pub_quan_msg.likes)}</span></p> <p class="icon-comment mr_m"><span class="ml_s va_m fs_s">{util.cnNum(item.pub_quan_msg.comments)}</span></p> </div> </div> </div> <div class="bd_tb mb_l bg_fff"> <div class="bd_b lh_m ml_m ta_c mr_m">我推荐的</div> <div class="ta_c lh_m fs_s cl_ccc" sn-if="!recommendPubQuan.length">暂未推荐公众圈</div> <div class="hm_pubquan__myfollow bd_b" sn-repeat="item in recommendPubQuan"> <div sn-if="item.pub_quan_msg" class="bd" data-forward="/pubquan/article/{item.pub_quan_msg.msg_id}"> <div class="pb_s pl_m pt_m fs_l flex"> <div class="to_e flexitem">{item.pub_quan_msg.title}</div> <p class="date fs_s mr_m cl_999">{util.formatDate(item.pub_quan_msg.add_date,"short")}</p> </div> <ul class="imgs clearfix"> <li class="img fl_l pl_m" sn-repeat="img in item.pub_quan_msg.imgs"><img sn-src="{sl.thumbnail(img)}" /></li> </ul> </div> <div sn-if="item.pub_quan_msg" class="ft flex lh_s pl_m pb_m"> <div class="flex flexitem" data-forward="/pubquan/{item.quan_id}"> <p class="img cir_s mr_m"> <img class="cir_s" sn-src="{sl.resource(item.quan_pic)}" /> </p> <p class="name flexitem"><span class="br_2 bg_ccc cl_fff pr_s pl_s fs_m">{item.quan_name}</span></p> </div> <p class="icon-see mr_m"><span class="ml_s va_m fs_s">{util.cnNum(item.pub_quan_msg.see)}</span></p> <p class="icon-good mr_m"><span class="ml_s va_m fs_s">{util.cnNum(item.pub_quan_msg.likes)}</span></p> <p class="icon-comment mr_m"><span class="ml_s va_m fs_s">{util.cnNum(item.pub_quan_msg.comments)}</span></p> </div> </div> </div> </div> <div class="hm_quan"> <div class="hm_quan__item bd_b" sn-repeat="quan in quanData"> <div class="flex_t pt_m pb_m"> <p class="avatars ml_m mr_m" data-forward="/contact/friend/{quan.user_id}"><img onerror="this.src=\'images/default.jpg\'" src="{sl.thumbnail(quan.avatars)}" /></p> <div class="bd flexitem lh_xxs"> <p class="name cl_dark fs_m" data-forward="/contact/friend/{quan.user_id}">{this.getUserShowName(quan)}</p> <p class="con fs_m" sn-html="{quan.content}" sn-long-tap="delegate.showQuanControl(quan,e)"></p> <ul class="imgs clearfix mt_s"> <li class="img fl_l mr_m" sn-repeat="img,i in quan.imgs" sn-long-tap="delegate.showQuanControl(quan,e)" sn-tap="this.showImages(quan.imgs,i)"><img sn-src="{sl.thumbnail(img)}" /></li> </ul> <div class="bar flex fs_s mt_s"> <p class="date flexitem">{util.formatDate(quan.add_date,"short")}</p> <p class="icon-del2 pr_m" sn-if="quan.user_id!=user.user_id" sn-tap="this.blackQuanMsg(quan.msg_id)"><span class="va_m ml_s">删除</span></p> <p class="icon-good pr_m" sn-tap="this.likeQuanMsg(quan.msg_id)"><span class="va_m ml_s">赞</span></p> <p class="icon-comment2 pr_m" sn-tap="this.commentQuanMsg(quan.msg_id)"><span class="va_m ml_s">评论</span></p> </div> <ul class="comment fs_s" sn-if="quan.quan_likes.length || quan.quan_comments.length"> <li sn-if="quan.quan_likes.length" class="quan-like"><span class="va_m mr_m cl_dark" sn-repeat="item in quan.quan_likes">{this.getUserShowName(item)}</span></li> <li sn-repeat="item in quan.quan_comments"><a sn-tap="this.commentQuanMsg(quan.msg_id,item.user_id,this.getUserShowName(item))" href="javascript:;"><i class="cl_dark">{this.getUserShowName(item)}</i>：<span>{item.content}</span></a></li> </ul> </div> </div> </div> </div> <div class="hm_contacts"> <ul class="bd_tb pt_1 hm_contacts__business_list"> <li class="flex pl_m h_bar bg_fff bd_b ps_r" data-forward="/contact/new"> <p class="icon-newfriend "><i sn-if=\'friends.newFriendsCount\' class="unread">{friends.newFriendsCount}</i></p> <p class="ml_l">新的朋友</p> </li> <li class="flex pl_m h_bar bg_fff bd_b" data-forward="/contact/contactlist"> <p class="icon-person2"></p> <p class="ml_l flexitem">手机联系人</p> <p class="hm_contacts__backup" sn-tap="this.backup()">备份</p> </li> <li class="flex pl_m h_bar bg_fff bd_b" data-forward="/contact/friends"> <p class="icon-person3"></p> <p class="ml_l">我的好友</p> </li> </ul> <div class="bd_tb mt_l pt_1 h_bar bg_fff flex pl_m" sn-tap="isShowMessageList=!isShowMessageList"> <p class="icon-contact2"></p> <p class="flexitem ml_l fs_m">我的消息</p> <p class="hm-icons-drop ta_r {isShowMessageList?\'show\':\'\'} mr_m"></p> </div> <ul class="hm_contacts__messages" sn-if="isShowMessageList&&messagesList.list.length"> <li class="flex h_bar bd_b bg_fff fs_m ps_r" sn-repeat="item in messagesList.list|filter:item.enable_leave_msg|orderBy:date desc" data-forward="/contact/chat/{item.user_id}"> <i class="unread" sn-if="item.unread">+{item.unread}</i> <p class="img ml_m"><img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(item.avatars)}" /></p> <p class="flexitem h_bar ml_l pt_s"><span class="name dp_b">{this.getUserShowName(item)}</span> <span class="cl_light fs_s msg dp_b lh_1 to_e" style="width:1.9rem">{item.msg}</span> </p> <p class="date h_bar mr_m pt_s fs_s">{util.formatDate(item.date,"short")}</p> </li> </ul> </div> </div> <!--<button class="quan-publish" sn-if="tab==3&&quanTab.index==0" data-forward="/pubquan/publish"></button>--> <button class="quan-call" sn-if="tab==3&&quanTab.index==2" sn-tap="this.phoneCall()"></button> <div sn-if="tab==4" class="hm_uc main pt_m" ref="uc"> <div class="bd_tb flex mb_m pd_m bg_fff"> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(user.avatars)}" class="g_avatars dp_b ml_m" data-forward="/user/person" /> <p class="fs_m ml_m flexitem" data-forward="/user/person"> <span class="name dp_b">{user.user_name}</span> <span class="msg dp_b cl_999">ID：{user.user_id}</span> </p> <p class="user-qrcode2 mr_m" data-forward="/user/qrcode"></p> </div> <div class="flex bd_t bg_fff h_bar pl_m pr_m" data-forward="/user/business/space"> <div class="user-space"></div> <div class="pl_m">我的空间</div> </div> <div class="flex mb_m bd_tb bg_fff pl_m h_bar" data-forward="/user/business/family"> <div class="user-family"></div> <div class="pl_m">我的家庭</div> </div> <div class="flex bd_t bg_fff h_bar pl_m pr_m" data-forward="/user/business/life"> <div class="user-life"></div> <div class="pl_m">我的生活</div> </div> <div class="flex mb_m bd_tb bg_fff pl_m h_bar" data-forward="/user/business/wallet"> <div class="user-card"></div> <div class="pl_m">我的钱包</div> </div> <div class="flex bd_t bg_fff h_bar pl_m pr_m" sn-tap="delegate.businessNotReady()"> <div class="user-car"></div> <div class="pl_m cl_999">我的出行</div> </div> <div class="flex mb_m bd_tb bg_fff pl_m h_bar" sn-tap="delegate.businessNotReady()"> <div class="user-job"></div> <div class="pl_m cl_999">我的工作</div> </div> </div> <footer class="footer bd_t"> <div> <button class="icon-home{tab==1?\'_curr curr\':\'\'}" sn-tap="delegate.toggleTabToHome()"> <span>生活</span> </button> <button class="icon-ent{tab==2?\'_curr curr\':\'\'}" sn-tap="delegate.toggleTabToEnt()"> <span>娱乐</span> </button> <button class="icon-quan{tab==3?\'_curr curr\':\'\'}" sn-tap="delegate.toggleTabToQuan()"> <span>圈子</span> </button> <button class="icon-uc{tab==4?\'_curr curr\':\'\'}" sn-tap="delegate.toggleTabToUC()"> <span>我的</span> </button> </div> </footer> </div> <div class="hm_quan__menu_mask" style="display:none" ref="quanMenuMask" sn-tap="this.hideQuanMenu()"> </div> <div class="hm_quan__menu" ref="quanMenu" style="display:none;right: 5px;"> <ul> <!--<li class="pl_m icon-edit2" sn-tap="this.hideQuanMenu(\'/pubquan/publish\')"> <span class="va_m ml_s">发帖子</span> </li> <li class="pl_m icon-bill2" sn-tap="this.hideQuanMenu(\'/pubquan/myarticles\')"> <span class="va_m ml_s">我的帖子</span> </li>--> <li class="pl_m icon-quansend" sn-tap="this.hideQuanMenu(\'/quan/publish\')"> <span class="va_m ml_s">发朋友圈</span> </li> <li class="pl_m icon-gallery" sn-tap="this.hideQuanMenu(\'/quan/history\')"> <span class="va_m ml_s">我的历史</span> </li> <li class="pl_m icon-scan2" sn-tap="delegate.scan()"> <span class="va_m ml_s">扫一扫</span> </li> </ul> </div> <div class="hm_idx__to_mask dock" style="display:none" ref="timeoutMask"> </div> <div class="hm-timeout g_center" ref="timeout" style="display:none"> <div class="close" sn-tap="this.hideTimeout()"></div> <div class="ft">还有{next.timeLeft}秒后才能收获</div> </div>';return __},helpers:{business:function(t,e){var n="";return n+=' <div class="flex hm-icons-notify'+t+' item bd_b" sn-tap="showNotify=(showNotify=='+t+"?-1:"+t+')"> <i class="unread" sn-if="business.type'+t+'data.unread">+{business.type'+t+'data.unread}</i> <div class="flexitem pl_m"> <div class="name fs_m">'+e+'</div> <div class="fs_s cl_999 to_e con">{business.type'+t+'data.title||\'暂无提醒\'}</div> </div> <div class="pl_m"> <p class="date fs_s cl_999">{business.type'+t+'data.send_date}</p> <p class="hm-icons-drop ta_r {showNotify=='+t+"?'show':''}\"></p> </div> </div> "},notify:function(t,e){var n="";return n+=" "+this.business(t,e)+' <ul class="pr_m hm_idx__notifi_bg" sn-if="showNotify=='+t+'"> <li class="flex subitem ml_m {(i!=business.type'+t+"data.list.length-1)&&'hm_idx__notifi_item'}\" sn-repeat=\"item,i in business.type"+t+'data.list|filter:!item.switcher||item.switcher.charAt(0)==1&&item.switcher.charAt(1)==1" data-forward="/business/{item.business_id}"> <i class="unread" sn-if="item.unread">+{item.unread}</i> <img sn-src="{sl.thumbnail(item.business_pic)}" /> <div class="flexitem pl_m"> <div class="name fs_m">{item.business_name}</div> <div class="fs_s cl_999 to_e con">{item.title}</div> </div> <div class="pl_m"> <p class="date fs_s cl_999">{item.send_date?util.formatDate(item.send_date,\'yyyy/MM/dd\'):\'\'}</p> </div> </li> </ul> '}}});return T.template=T.html,T});define("views/home",["css/app.css","css/append.css","widget/photoViewer","../components/yunMiRules","../logical/publicquan","../logical/quan","../models/messagesList","../models/user","models/friends","models/appconfig","../logical/user","logical/yunmi","../logical/auth","../logical/contact","../logical/business","../logical/chat","../logical/news","models/business"],function(t,e,n){var i=t("$"),r=t("util"),s=t("activity"),o=t("bridge"),a=t("../widget/loader"),c=t("core/model2").Model,h=(t("core/http"),t("../widget/scroll"),t("../widget/slider")),d=(t("../widget/tab"),t("../widget/toast")),p=t("../widget/popup"),m=t("widget/photoViewer"),v=(t("animation"),t("promise")),Y=t("../components/yunMiRules"),S=t("../logical/publicquan"),Z=t("../logical/quan"),L=t("../models/messagesList"),_=t("../models/user"),T=t("models/friends"),C=t("models/appconfig"),y=t("../logical/user"),X=t("logical/yunmi"),b=t("../logical/auth"),J=t("../logical/contact"),D=t("../logical/business"),M=t("../logical/chat"),w=t("../logical/news"),Q=D.redirect,H=t("models/business"),B=H.getGroups();n.exports=s.extend({events:{"tap [data-url]":function(t){var e=i(t.currentTarget).attr("data-url");Q.jump(e)}},onCreate:function(){var t=this,e=this.loader=new a(this.$el),n=t.model=new c(this.$el,{title:"",messagesList:L,user:_,tab:1,recommendIndex:0,business:B,friends:T,showNotify:-1,isShowMessageList:!0});n.delegate=this,n.getUserShowName=T.getUserShowName,i(window).on("ent_to_home",function(){hideTab(1)}).on("ent_to_quan",function(){hideTab(3)}).on("tabchange_to_2",function(){t.toggleTabToEnt()}).on("tabchange_to_3",function(){t.openShop()}),n.showQuanMenu=function(){i(this.refs.quanMenuMask).show(),i(this.refs.quanMenu).show()},n.hideQuanMenu=function(e,n){i(this.refs.quanMenuMask).hide(),i(this.refs.quanMenu).hide(),"string"==typeof e&&t.forward(e)},n.backup=function(){return t.forward("/contact/backup"),!1},n.phoneCall=function(){t.forward("/hdh/call")},n.showYunMi=function(){p.alert({className:"ym_rules__popup",title:"云米规则",content:Y.rule2,btn:"关闭",action:function(){}})},n.toContact=function(){this.set({tab:3}).next(function(){n._("quanTab").tab(2)})};var r=this.photoViewer=new m;r.$el.hide().appendTo("body").addClass("g_beforeshow").on(i.fx.transitionEnd,function(){r.$el.hasClass("g_show")||r.$el.hide()}).on("tap",function(){r.$el.removeClass("g_show")}),n.showImages=function(t,e){r.setImages(t.map(function(t){return{src:sl.resource(t)}})),r.index(e),r.$el.show()[0].clientHeight,r.$el.addClass("g_show")},n.hideTimeout=function(){i(n.refs.timeout).hide(),i(n.refs.timeoutMask).hide()},n.receiveYunmi=function(){var t=this.get("currentYunmi");return t&&t.yunmi_id?(e.showLoading(),void X.receiveYunmi(t.yunmi_id).then(function(e){d.showToast("恭喜你领取了"+t.amount+"云米"),n.set({currentYunmi:null})})["catch"](function(t){d.showToast(t.message)}).then(function(){e.hideLoading()})):void(this.get("next.yunmi_id")?(i(n.refs.timeout).show(),i(n.refs.timeoutMask).show()):d.showToast("暂无云米可以领取！"))},this.bindScrollTo(n.refs.life),i(n.refs.life).on("scroll",function(){var t=this.scroll.scrollTop();t>=116*window.innerWidth/320?n.set({headBg:!0}):n.set({headBg:!1})}),this.onResult("LOGOUT",this.bindOnceLogin),this.bindOnceLogin()},bindOnceLogin:function(){this.onceTrue("Show",function(){if(b.getAuthToken()&&y.getMe()){if(!this.banner){this.banner=!0;var t=this;w.getHomeBanner().then(function(e){t.slider=new h({loop:!0,container:t.model.refs.banner,autoLoop:3e3,data:r.map(e.data,["image","linkurl"])||[],dots:!0,itemTemplate:'<a href="javascript:;" data-url="<%=linkurl%>"><img src="<%=sl.resource(image)%>" /></a>'}),t.model.next(function(){t.slider.adjustWidth()})})}return J.friends(),M.on("NEW_NOTIFICATIONS_COMING",function(){D.getAllBusinessAndUnread()}),D.getAllBusinessAndUnread(),o.getDeviceToken(function(t){var e=t.token,n=r.store("device_token");"get_token_failure"!=e&&e!=n&&y.updateDeviceToken(e).then(function(){r.store("device_token",e)})}),!0}return!1})},getYunmi:function(){var t=this.model,e=this;X.getYunmi().then(function(n){var i=n.data,s=n.next;if(s){var o=s.create_date,a=Date.now();s.timeFix=a-o,s.timeLeft=r.timeLeft(s.start_date-o),e.timer=setInterval(function(){if("#/"==location.hash){var n=t.get("next"),i=n.start_date-(Date.now()-n.timeFix);if(0>=i)return e.timer&&(clearInterval(e.timer),e.timer=null),e.getYunmi(),void t.hideTimeout();i=r.timeLeft(i),t.set("next.timeLeft",i)}},1e3)}t.set({currentYunmi:i,next:s})})},openShop:function(){o.openInApp(C.get("shopUrl"))},toggleTabToHome:function(){this.showTab(1)&&this.model.set({tab:1,headBg:!1})},changeChannelCat:function(t){var e=this.model,n=e.attributes.video;n.selectedCat.id!=t.id&&e.set("video",{selectedCat:t})},changeChannel:function(t){var e=this.model,n=e.attributes.video,i=e.refs.video;n.selectedChannel.id!=t.id&&(e.set("video",{selectedChannel:t}),i.src=t.url,i.play())},tapVideo:function(t){var e=this.model,n=e.attributes.video;if(n.isFullscreen){if(t.pageY<window.innerHeight/2)return this.showVideoChannel(),void e.set("video.isShowControl",!1);e.set("video.isShowChannel",!1)}n.isShowControl?e.set("video.isShowControl",!1):this.showVideoControl()},showVideoControl:function(){var t=this,e=this.model;this.videoControlTimer&&(clearTimeout(this.videoControlTimer),this.videoControlTimer=null),e.set("video",{isShowControl:!0}),this.videoControlTimer=setTimeout(function(){e.set("video",{isShowControl:!1}),t.videoControlTimer=null},3e3)},playOrStop:function(){var t=this.model,e=t.attributes.video,n=t.refs.video;e.isPlaying?n.pause():n.play(),t.set("video",{isPlaying:!e.isPlaying})},clearVideoChannelTimer:function(){this.videoChannelTimer&&(clearTimeout(this.videoChannelTimer),this.videoChannelTimer=null)},showVideoChannel:function(){var t=this,e=this.model;this.clearVideoChannelTimer(),e.set("video",{isShowChannel:!0}),this.videoChannelTimer=setTimeout(function(){e.set("video",{isShowChannel:!1}),t.videoChannelTimer=null},1e4)},toggleVideoFullscreen:function(){var t=this.model,e=t.attributes.video;t.refs.video;e.isFullscreen?(this.clearVideoChannelTimer(),t.set("video",{isShowChannel:!0})):this.showVideoChannel(),t.set("video",{isFullscreen:!e.isFullscreen})},toggleAutoplay:function(){var t=localStorage.getItem("videoAutoPlay");"false"!=t?(localStorage.setItem("videoAutoPlay","false"),this.model.set("video.autoplay",!1)):(localStorage.setItem("videoAutoPlay","true"),this.model.set("video.autoplay",!0))},toggleTabToEnt:function(){if(this.showTab(2)){if(r.ios)return void this.model.then(function(){var t=this.refs.video,n=(this.refs.ent,this);D.getVideoList().then(function(e){var i=e.categories;i.forEach(function(t){t.children=[],e.data.forEach(function(e){t.id==e.category_id&&t.children.push(e)})});var r=localStorage.getItem("videoCatIndex"),s=localStorage.getItem("videoIndex"),o=localStorage.getItem("videoAutoPlay");o="false"!=o,r=r?parseInt(r):0,i[r].selected=!0;var a=i[r],c=i[r].children[s?parseInt(s):0];n.set("video",{isShowChannel:!0,list:i,selectedCat:a,selectedChannel:c,isFullscreen:!1,isPlaying:o?!0:!1,autoplay:o}).then(function(){n.bindScrollTo(n.refs.videoList,{hScroll:!0,vScroll:!0})}),n.delegate.showVideoControl(),t.controls=!1,t.src=c.url,o&&t.play()})});var t=this,e=b.getSign();o.rn({token:e._tk,sign:e._sign},function(e){switch(isOpenRn=!1,e.action){case"home":t.toggleTabToHome();break;case"quan":t.toggleTabToQuan();break;case"shop":t.openShop();break;case"uc":t.toggleTabToUC()}})}},toggleTabToQuan:function(){this.showTab(3)&&(this.isInitQuanTab?this.reloadSocialQuan():(this.initQuanTab(),this.isInitQuanTab=!0))},toggleTabToUC:function(){this.showTab(4)},showTab:function(t){var e=this.model;return e.get("tab")!=t?(e.set({tab:t,headBg:!1}),!0):!1},initQuanTab:function(){var t=this,e=this.model;e.next(function(){var n=t.quanTab=this.refs.quanTab,i={},r=1;i[0]=!0,e.set({quanTab:n}),t.loadPublicQuan(!0),n.onceTrue("tabChange",function(e,s){if(!i[s]){switch(i[s]=!0,r++,s){case 1:t.initSocialQuan(n);break;case 2:t.loadContacts()}return 3==r}})})},loadPublicQuan:function(t){var e=this.loader,n=this.model,i=this;if(t&&e.showLoading(),!this.quanSlider){this.quanSlider=!0;var i=this;w.getQuanBanner().then(function(t){i.quanSlider=new h({loop:!0,container:i.model.refs.quanBanner,autoLoop:3e3,data:r.map(t.data,["image","linkurl"])||[],dots:!0,itemTemplate:'<a href="javascript:;" data-url="<%=linkurl%>"><img src="<%=sl.resource(image)%>" /></a>'}),i.model.next(function(){i.quanSlider.adjustWidth()})})}v.all([S.recommend(),S.myfollow()]).then(function(t){t.forEach(function(t,e){t.data.forEach(function(t){if(t.pub_quan_msg){var e;t.pub_quan_msg.imgs&&(e=t.pub_quan_msg.imgs.split(",")),e&&e.length||!/<img\s+/.test(t.pub_quan_msg.content)||(e=[],t.pub_quan_msg.content.replace(/<img\s[^>]*?src=\"([^\"\>]+)\"/g,function(t,n){e.push(n)})),e&&e.length>3&&(e.length=3),t.pub_quan_msg.imgs=e}}),n.set(0==e?"recommendPubQuan":"myfollowPublicQuan",t.data)})})["catch"](function(t){"无权限"==t.message?i.forward("/login"):d.showToast(t.message)}).then(function(){e.hideLoading()})},initSocialQuan:function(t){var e=this,n=this.model;Z.on("sendComment",function(t,e){var r=n._("quanData").find("msg_id",e.msg_id),s=r._("comments");e=i.extend(e,_.data),s?s.add([e]):s.set([e])}),Z.on("publish",function(t,e){var i=n._("quanData");i.unshift(e)}),n.commentQuanMsg=function(t,n,i){e.forward("/quan/comment?msg_id="+t,i&&n!=_.data.user_id?{user_id:n,user_name:i}:void 0)},n.blackQuanMsg=function(t){var e=n._("quanData");Z.black(t).then(function(){d.showToast("屏蔽成功"),e.remove("msg_id",t)})["catch"](function(t){d.showToast(t.message)})},n.likeQuanMsg=function(t){var e=n._("quanData").find("msg_id",t),i=e._("quan_likes");return i&&i.find("user_id",_.data.user_id)?void d.showToast("你已点赞！"):void Z.like(t).then(function(){var t={user_id:_.get("user_id"),user_name:_.get("user_name")};i?i.add(t):e.set({quan_likes:[t]}),d.showToast("点赞成功")})["catch"](function(t){d.showToast(t.message)})},e.quanLoader=Z.createLoader({model:n,attribute:"quanData",scroll:t.refs.items[1]}),e.quanLoader.request()},reloadSocialQuan:function(){this.quanLoader&&this.quanLoader.reload()},showQuanControl:function(t,e){i(e.currentTarget).addClass("selected");var n=p.options({options:["P"==e.currentTarget.tagName?{text:"复制",click:function(){o.system.copyToClipboard(t.content),n.hide()}}:{text:"保存图片",click:function(){n.hide()}},{text:"收藏",click:function(){y.fav(t.msg_id,2).then(function(){d.showToast("收藏成功!"),n.hide()})["catch"](function(t){d.showToast(t.message)})}}],onHide:function(){i(e.currentTarget).removeClass("selected")}})},loadContacts:function(){},scan:function(){var t=this;this.model.hideQuanMenu(),o.qrcode.scan(function(e){var n=e.code;if(n){var i=n.match(/cmccfj\:\/\/user\/(\d+)/);if(i&&i[1]){var r=parseInt(i[1]);J.isFriend(r).then(function(e){e.data?t.forward("/contact/friend/"+r):t.forward("/contact/person/"+r)})}else(0==n.indexOf("http://")||0==n.indexOf("https://"))&&o.openInApp(n)}})},businessNotReady:function(){p.alert({content:'<p class="ta_c">暂未上线，敬请期待...</p>'})},onLoad:function(){},onShow:function(){var t=this;b.getAuthToken()?(seajs.use(["logical/chat"]),t.loadShopUrl||D.getThirdUrl().then(function(e){C.set(e.data),t.loadShopUrl=!0}),t.getYunmi(),t.quanTab&&(t.loadPublicQuan(),t.reloadSocialQuan())):t.forward("/login")},onHide:function(){},onDestroy:function(){this.model.destroy()}})});define("template/signup",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">注册</div> </header> <div ref="main" class="main"> <ul class="uc_signup__form bd_tb"> <li class="flex bd_b"> <div class="icon-person ml_s"></div> <input class="flexitem fs_m ml_s" placeholder="请输入您的邮箱" sn-model="email" type="email" /> </li> <li class="flex bd_b"> <div class="icon-msg ml_s"></div> <input class="flexitem ml_s fs_m" placeholder="请输入短信验证码" sn-model="password" type="password" /> <button class="btn_s ml_s mr_s">获取验证码</button> </li> <li class="flex"> <div class="icon-info ml_s"></div> <input class="flexitem fs_m ml_s" placeholder="请输入密码" sn-model="password" type="text" /> </li> </ul> <div class="mg_m fs_m"><span class="checkbox {agree?\'checked\':\'\'}" sn-tap="agree=!agree"></span><span class="va_m">我已阅读并同意<a href="/licence" class="cl_app">《和生活用户使用协议》</a></span></div> <div class="mg_m mt_xxl"><button class="btn_xl">立即注册</button> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/signup",["css/app.css","css/append.css"],function(t,e,n){var s=(t("$"),t("util"),t("activity")),a=(t("widget/loader"),t("core/model2").Model);t("animation");n.exports=s.extend({onCreate:function(){var t=this,e=this.model=new a(this.$el,{title:"标题"});e.back=function(){t.back(t.swipeRightBackAction)},this.bindScrollTo(e.refs.main),this.waitLoad(function(){})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/login",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<div ref="main" class="main uc_login"> <div class="uc_login__bg"> <div class="text-login ta_c pb_l"></div> </div> <ul class="uc_login__form bd_tb"> <li class="bd_b flex"> <div class="icon-person ml_s"></div> <input class="flexitem ml_s fs_s" placeholder="请输入您的手机号码（目前仅支持福建移动用户）" sn-model="phoneNo" type="tel" /> </li> <li class="flex"> <div class="icon-msg ml_s"></div> <input class="flexitem ml_s" placeholder="请输入短信验证码" sn-model="password" type="password" /> <button class="btn_s ml_s mr_s" sn-tap="this.sendSms()" disabled="{smsTime>0}">{smsTime<=0?\'获取验证码\':(smsTime+\'秒后重发\')}</button> </li> </ul> <div class="mg_m fs_m mb_xxl"><span class="checkbox {agree?\'checked\':\'\'}" sn-tap="agree=!agree"></span><span sn-tap="agree=!agree" class="va_m">我已阅读并同意<a href="/licence" class="cl_app">《八闽生活用户使用协议》</a></span></div> <div class="mg_m"><button class="btn_xl" sn-tap="this.login()">立即登录</button></div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/login",["css/app.css","css/append.css","logical/auth","logical/chat"],function(t,e,n){var s=(t("$"),t("util"),t("activity")),o=t("widget/loader"),a=t("core/model2").Model,u=(t("promise"),t("widget/toast")),h=(t("widget/popup"),t("bridge")),f=t("logical/auth"),d=t("logical/chat"),p=t("core/http");n.exports=s.extend({defBackUrl:null,autosetBackUrl:null,onCreate:function(){var t=this;t.swipeRightBackAction=null;var e=this.model=new a(this.$el,{smsTime:0,agree:!0});e.back=function(){t.back(t.swipeRightBackAction)},e.login=function(){if(!this.get("agree"))return void u.showToast("请先同意《八闽生活用户使用协议》！");var e=this.attributes.phoneNo,n=this.attributes.password;return e?/^1\d{10}$/.test(e)?n?(o.showLoading(),void h.cmcc.login(e,n,"sms",function(i){i.success?new p({url:"/user/login",params:f.encryptParams({account:e,password:f.md5(n),token:i.token})}).request().then(function(e){f.setAuthToken(e.data.tk),delete e.data.tk,f.setUser(e.data),t.back("/")})["catch"](function(t){u.showToast(t.message)}).then(function(){o.hideLoading()}):(u.showToast(i.message),o.hideLoading())})):void u.showToast("请填写验证码！"):void u.showToast("请输入正确的手机号！"):void u.showToast("请填写手机号！")},e.sendSms=function(){if(!(this.attributes.smsTime>0)){var t=this.attributes.phoneNo;if(!t)return void u.showToast("请填写手机号！");h.cmcc.sendSms(t,"smsLogin"),this.leftTime=Date.now()+6e4,this.timer=setInterval(function(){var t=Math.round((e.leftTime-Date.now())/1e3);0>=t?(clearInterval(e.timer),e.set({smsTime:0})):e.set({smsTime:t})},1e3),this.set({smsTime:59})}};this.loader=new o(this.$el);t.bindScrollTo(e.refs.main),this.onResult("agree_licence",function(){e.set("agree",!0)})},onShow:function(){d.setKeepStatus(d.KEEP_STATUS.LOGIN)},onDestroy:function(){this.model.destroy()}})});define("template/licence",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main uc_licence"> <p class="p1"> <span class="s1">欢迎你使用中国移动福建公司“八闽生活”软件及服务！</span> </p> <p class="p1"> <span class="s1">为使用“八闽生活”软件（以下简称“本软件”）及服务，你应当阅读并遵守《八闽生活用户使用协议》（以下简称“本协议”）。请你务必审慎阅读、充分理解各条款内容，特别是免除或者限制责任的条款，以及开通或使用某项服务的单独协议，并选择接受或不接受。限制、免责条款可能以加粗形式提示你注意。</span> </p> <p class="p1"> <span class="s1">除非你已阅读并接受本协议所有条款，否则你无权下载、安装或使用本软件及相关服务。你的下载、安装、使用、获取“八闽生活”帐号、登录等行为即视为你已阅读并同意上述协议的约束。</span> </p> <p class="p1"> <span class="s1">如果你未满18周岁，请在法定监护人的陪同下阅读本协议及其他上述协议，并特别注意未成年人使用条款。</span> </p> <p class="p2"> <span class="s1"><strong>一、协议的范围</strong></span> </p> <p class="p3"> <span class="s1"><strong>1.1&nbsp;协议适用主体范围</strong></span> </p> <p class="p1"> <span class="s1">本协议是你与中国移动福建公司关于你下载、安装、使用、复制本软件，以及使用中国移动相关服务所订立的协议。</span> </p> <p class="p1"> <span class="s1">本协议内容同时包括中国移动福建公司可能不断发布的关于本服务的相关协议、业务规则等内容。上述内容一经正式发布，即为本协议不可分割的组成部分，你同样应当遵守。</span> </p> <p class="p2"> <span class="s1"><strong>二、关于本服务</strong></span> </p> <p class="p3"> <span class="s1"><strong>2.1 本服务的内容</strong></span> </p> <p class="p1"> <span class="s1">本服务内容是指中国移动福建公司向用户提供的聚合本地各类生活服务的综合性门户应用工具（以下简称“八闽生活”），并支持单人、多人参与，在发送语音短信、视频、图片和文字等通讯服务的基础上，同时为用户提供包括但不限于关系链拓展、便捷工具、民生服务、开放平台等功能或内容的软件许可及服务（以下简称“本服务”）。</span> </p> <p class="p3"> <span class="s1"><strong>2.2 本服务的形式</strong></span> </p> <p class="p1"> <span class="s1"><strong>2.2.1 </strong>你使用本服务需要下载中国移动福建公司客户端软件，对于这些软件，中国移动福建公司给予你一项个人的、不可转让及非排他性的许可。你仅可为访问或使用本服务的目的而使用这些软件及服务。</span> </p> <p class="p1"> <span class="s1"><strong>2.2.2 </strong>本服务中“八闽生活”客户端软件提供包括但不限于iOS、Android等多个应用版本，用户必须选择与所安装终端设备相匹配的软件版本。</span> </p> <p class="p3"> <span class="s1"><strong>2.3 本服务许可的范围</strong></span> </p> <p class="p1"> <span class="s1"><strong>2.3.1 </strong>中国移动福建公司给予你一项个人的、不可转让及非排他性的许可，以使用本软件。你可以为非商业目的在单一台终端设备上安装、使用、显示、运行本软件。</span> </p> <p class="p1"> <span class="s1"><strong>2.3.2 </strong>你可以为使用本软件及服务的目的复制本软件的一个副本，仅用作备份。备份副本必须包含原软件中含有的所有著作权信息。</span> </p> <p class="p1"> <span class="s1"><strong>2.3.3 </strong>本条及本协议其他条款未明示授权的其他一切权利仍由中国移动福建公司保留，你在行使这些权利时须另外取得中国移动福建公司的书面许可。中国移动福建公司如果未行使前述任何权利，并不构成对该权利的放弃。</span> </p> <p class="p2"> <span class="s1"><strong>三、软件的获取</strong></span> </p> <p class="p1"> <span class="s1"><strong>3.1 </strong>你可以直接从中国移动福建公司的网站上获取本软件，也可以从得到中国移动福建公司的第三方获取。</span> </p> <p class="p1"> <span class="s1"><strong>3.2 </strong>如果你从未经中国移动福建公司授权的第三方获取本软件或与本软件名称相同的安装程序，中国移动福建公司无法保证该软件能够正常使用，并对因此给你造成的损失不予负责。</span> </p> <p class="p2"> <span class="s1"><strong>四、软件的安装与卸载</strong></span> </p> <p class="p1"> <span class="s1"><strong>4.1 </strong>中国移动福建公司可能为不同的终端设备开发了不同的软件版本，你应当根据实际情况选择下载合适的版本进行安装。</span> </p> <p class="p1"> <span class="s1"><strong>4.2 </strong>下载安装程序后，你需要按照该程序提示的步骤正确安装。</span> </p> <p class="p1"> <span class="s1"><strong>4.3 </strong>为提供更加优质、安全的服务，在本软件安装时中国移动福建公司可能推荐你安装其他软件，你可以选择安装或不安装。</span> </p> <p class="p1"> <span class="s1"><strong>4.4 </strong>如果你不再需要使用本软件或者需要安装新版软件，可以自行卸载。如果你愿意帮助中国移动福建公司改进产品服务，请告知卸载的原因。</span> </p> <p class="p2"> <span class="s1"><strong>五、软件的更新</strong></span> </p> <p class="p1"> <span class="s1"><strong>5.1 </strong>为了改善用户体验、完善服务内容，中国移动福建公司将不断努力开发新的服务，并为你不时提供软件更新（这些更新可能会采取软件替换、修改、功能强化、版本升级等形式）。</span> </p> <p class="p1"> <span class="s1"><strong>5.2 </strong>为了保证本软件及服务的安全性和功能的一致性，中国移动福建公司有权不经向你特别通知而对软件进行更新，或者对软件的部分功能效果进行改变或限制。</span> </p> <p class="p1"> <span class="s1"><strong>5.3 </strong>本软件新版本发布后，旧版本的软件可能无法使用。中国移动福建公司不保证旧版本软件继续可用及相应的客户服务，请你随时核对并下载最新版本。</span> </p> <p class="p4"> <span class="s1"><strong>六、用户个人信息保护</strong></span> </p> <p class="p1"> <span class="s1"><strong>6.1&nbsp;</strong>保护用户个人信息是中国移动福建公司的一项基本原则，中国移动福建公司将会采取合理的措施保护用户的个人信息。除法律法规规定的情形外，未经用户许可中国移动福建公司不会向第三方公开、透露用户个人信息。中国移动福建公司对相关信息采用专业加密存储与传输方式，保障用户个人信息的安全。</span> </p> <p class="p1"> <span class="s1"><strong>6.2&nbsp;</strong>你在注册帐号或使用本服务的过程中，需要提供一些必要的信息，例如：为向你提供帐号注册服务或进行用户身份识别，需要你填写手机号码；手机通讯录匹配功能需要你授权访问手机通讯录等。若国家法律法规或政策有特殊规定的，你需要提供真实的身份信息。若你提供的信息不完整，则无法使用本服务或在使用过程中受到限制。</span> </p> <p class="p1"> <span class="s1"><strong>6.3&nbsp;</strong>一般情况下，你可随时浏览、修改自己提交的信息，但出于安全性和身份识别的考虑，你可能无法修改注册时提供的初始注册信息及其他验证信息。</span> </p> <p class="p1"> <span class="s1"><strong>6.4&nbsp;</strong>中国移动福建公司将运用各种安全技术和程序建立完善的管理制度来保护你的个人信息，以免遭受未经授权的访问、使用或披露。</span> </p> <p class="p1"> <span class="s1"><strong>6.5&nbsp;</strong>未经你的同意，中国移动福建公司不会向其他任何公司、组织和个人披露你的个人信息，但法律法规另有规定的除外。</span> </p> <p class="p1"> <span class="s1"><strong>6.6&nbsp;</strong>中国移动福建公司非常重视对未成年人个人信息的保护。若你是18周岁以下的未成年人，在使用本服务前，应事先取得你家长或法定监护人的书面同意。</span> </p> <p class="p4"> <span class="s1"><strong>七、主权利义务条款</strong></span> </p> <p class="p3" sn-click="window.alert(1)"> <span class="s1"><strong>7.1 帐号使用规范</strong></span> </p> <p class="p1" sn-click="window.alert(1)"> <span class="s1"><strong>7.1.1</strong> 你在使用本服务前需要注册一个帐号。帐号只能通过手机号码进行注册。中国移动福建公司有权根据用户需求或产品需要对帐号注册和绑定的方式进行变更。</span> </p> <p class="p1" sn-click="window.alert(1)"> <span class="s1"><strong>7.1.2 </strong>“八闽生活”帐号的所有权归中国移动福建公司所有，用户完成申请注册手续后，仅获得该帐号的使用权，且该使用权仅属于初始申请注册人。同时，初始申请注册人不得赠与、借用、租用、转让或售卖该帐号或者以其他方式许可非初始申请注册人使用帐号。非初始申请注册人不得通过受赠、继承、承租、受让或者其他任何方式使用该帐号。</span> </p> <p class="p1" sn-click="window.alert(1)"> <span class="s1"><strong>7.1.3 </strong>用户有责任妥善保管注册帐户信息及帐户密码的安全，用户需要对注册帐户以及密码下的行为承担法律责任。用户同意在任何情况下不向他人透露帐户及密码信息。当在你怀疑他人在使用你的帐号时，你应立即通知中国移动福建公司。</span> </p> <p class="p3"> <span class="s1"><strong>7.2 用户注意事项</strong></span> </p> <p class="p1"> <span class="s1"><strong>7.2.1 </strong>你理解并同意：为了向你提供有效的服务，本软件会利用你终端设备的处理器和带宽等资源。</span> </p> <p class="p1"> <span class="s1"><strong>7.2.2 </strong>你理解并同意：本软件的某些功能可能会让第三方知晓用户的信息，例如：用户的好友、微信号或朋友圈、微博、QQ空间的内容等可公开的个人资料；使用手机号码注册“八闽生活”帐号或手机号码与“八闽生活”帐号关联的用户，“八闽生活”帐号可以被通讯录存有该号码的好友查询。</span> </p> <p class="p1"> <span class="s1"><strong>7.2.3 </strong>你理解并同意中国移动福建公司将会尽其努力保障你在本软件及服务中的数据存储安全，但是，中国移动福建公司并不能就此提供完全保证，包括但不限于以下情形：</span> </p> <p class="p1"> <span class="s1">7.2.3.1 中国移动福建公司不对你在本软件及服务中相关数据的删除或储存失败负责；</span> </p> <p class="p1"> <span class="s1">7.2.3.2 中国移动福建公司有权根据实际情况自行决定单个用户在本软件及服务中数据的最长储存期限，并在服务器上为其分配数据最大存储空间等。你可根据自己的需要自行备份本软件及服务中的相关数据；</span> </p> <p class="p1"> <span class="s1">7.2.3.3 如果你停止使用本软件及服务或服务被终止或取消，中国移动福建公司可以从服务器上永久地删除你的数据。服务停止、终止或取消后，中国移动福建公司没有义务向你返还任何数据。</span> </p> <p class="p1"> <span class="s1"><strong>7.2.4 </strong>用户在使用本软件及服务时，须自行承担如下来自中国移动福建公司不可掌控的风险内容，包括但不限于：</span> </p> <p class="p1"> <span class="s1">7.2.4.1 由于不可抗拒因素可能引起的个人信息丢失、泄漏等风险；</span> </p> <p class="p1"> <span class="s1">7.2.4.2 用户必须选择与所安装终端设备相匹配的软件版本，否则，由于软件与终端设备型号不相匹配所导致的任何问题或损害，均由用户自行承担；</span> </p> <p class="p1"> <span class="s1">7.2.4.3 用户在使用本软件访问第三方网站时，因第三方网站及相关内容所可能导致的风险，由用户自行承担；</span> </p> <p class="p1"> <span class="s1">7.2.4.4 用户发布的内容被他人转发、分享，因此等传播可能带来的风险和责任；</span> </p> <p class="p1"> <span class="s1">7.2.4.5 由于无线网络信号不稳定、无线网络带宽小等原因，所引起的“八闽生活”登录失败、资料同步不完整、页面打开速度慢等风险。</span> </p> <p class="p3"> <span class="s1"><strong>7.3 第三方产品和服务</strong></span> </p> <p class="p1"> <span class="s1"><strong>7.3.1 </strong>你在使用本软件第三方提供的产品或服务时，除遵守本协议约定外，还应遵守第三方的用户协议。中国移动福建公司和第三方对可能出现的纠纷在法律规定和约定的范围内各自承担责任。</span> </p> <p class="p1"> <span class="s1"><strong>7.3.2 </strong>因用户使用本软件或要求中国移动福建公司提供特定服务时，本软件可能会调用第三方系统或者通过第三方支持用户的使用或访问，使用或访问的结果由该第三方提供（包括但不限于第三方通过圈子公众号提供的服务，或通过开放平台接入的内容等），中国移动福建公司不保证通过第三方提供服务及内容的安全性、准确性、有效性及其他不确定的风险，由此若引发的任何争议及损害，与中国移动福建公司无关，中国移动福建公司不承担任何责任。</span> </p> <p class="p1"> <span class="s1"><strong>7.3.3 </strong>你理解并同意，中国移动福建公司有权决定将本软件作商业用途，包括但不限于开发、使用本软件的部分服务为第三方作推广等，中国移动福建公司承诺在推广过程中严格按照本协议约定保护你的个人信息，同时你亦可以根据系统设置选择屏蔽、拒绝接收相关推广信息。</span> </p> <p class="p4"> <span class="s1"><strong>八、用户行为规范</strong></span> </p> <p class="p3"> <span class="s1"><strong>8.1 信息内容规范</strong></span> </p> <p class="p1"> <span class="s1"><strong>8.1.1 </strong>本条所述信息内容是指用户使用本软件及服务过程中所制作、复制、发布、传播的任何内容，包括但不限于“八闽生活”帐号头像、名字、用户说明等注册信息，或文字、语音、图片等发送、回复、朋友圈图文和相关链接页面，以及其他使用“八闽生活”帐号或本软件及服务所产生的内容。</span> </p> <p class="p1"> <span class="s1"><strong>8.1.2 </strong>你理解并同意，“八闽生活”一直致力于为用户提供文明健康、规范有序的网络环境，你不得利用“八闽生活”帐号或本软件及服务制作、复制、发布、传播如下干扰“八闽生活”正常运营，以及侵犯其他用户或第三方合法权益的内容，包括但不限于：</span> </p> <p class="p1"> <span class="s1">8.1.2.1 发布、传送、传播、储存违反国家法律法规禁止的内容：</span> </p> <p class="p1"> <span class="s1">（1）违反宪法确定的基本原则的；</span> </p> <p class="p1"> <span class="s1">（2）危害国家安全，泄露国家秘密，颠覆国家政权，破坏国家统一的；</span> </p> <p class="p1"> <span class="s1">（3）损害国家荣誉和利益的；</span> </p> <p class="p1"> <span class="s1">（4）煽动民族仇恨、民族歧视，破坏民族团结的；</span> </p> <p class="p1"> <span class="s1">（5）破坏国家宗教政策，宣扬邪教和封建迷信的；</span> </p> <p class="p1"> <span class="s1">（6）散布谣言，扰乱社会秩序，破坏社会稳定的；</span> </p> <p class="p1"> <span class="s1">（7）散布淫秽、色情、赌博、暴力、恐怖或者教唆犯罪的；</span> </p> <p class="p1"> <span class="s1">（8）侮辱或者诽谤他人，侵害他人合法权益的；</span> </p> <p class="p1"> <span class="s1">（9）煽动非法集会、结社、游行、示威、聚众扰乱社会秩序；</span> </p> <p class="p1"> <span class="s1">（10）以非法民间组织名义活动的；</span> </p> <p class="p1"> <span class="s1">（11）不符合《即时通信工具公众信息服务发展管理暂行规定》及遵守法律法规、社会主义制度、国家利益、公民合法利益、公共秩序、社会道德风尚和信息真实性等“七条底线”要求的；</span> </p> <p class="p1"> <span class="s1">（12）含有法律、行政法规禁止的其他内容的。</span> </p> <p class="p1"> <span class="s1">8.1.2.2 发布、传送、传播、储存侵害他人名誉权、肖像权、知识产权、商业秘密等合法权利的内容；</span> </p> <p class="p1"> <span class="s1">8.1.2.3 涉及他人隐私、个人信息或资料的；</span> </p> <p class="p1"> <span class="s1">8.1.2.4 发表、传送、传播骚扰、广告信息、过度营销信息及垃圾信息或含有任何性或性暗示的；</span> </p> <p class="p1"> <span class="s1">8.1.2.5 其他违反法律法规、政策及公序良俗、社会公德或干扰“八闽生活”正常运营和侵犯其他用户或第三方合法权益内容的信息。</span> </p> <p class="p3"> <span class="s1"><strong>8.2 软件使用规范</strong></span> </p> <p class="p1"> <span class="s1"><strong>8.2.1 </strong>除非法律允许或中国移动福建公司书面许可，你使用本软件过程中不得从事下列行为：</span> </p> <p class="p1"> <span class="s1">8.2.1.1 删除本软件及其副本上关于著作权的信息；</span> </p> <p class="p1"> <span class="s1">8.2.1.2 对本软件进行反向工程、反向汇编、反向编译，或者以其他方式尝试发现本软件的源代码；</span> </p> <p class="p1"> <span class="s1">8.2.1.3 对中国移动福建公司拥有知识产权的内容进行使用、出租、出借、复制、修改、链接、转载、汇编、发表、出版、建立镜像站点等；</span> </p> <p class="p1"> <span class="s1">8.2.1.4 对本软件或者本软件运行过程中释放到任何终端内存中的数据、软件运行过程中客户端与服务器端的交互数据，以及本软件运行所必需的系统数据，进行复制、修改、增加、删除、挂接运行或创作任何衍生作品，形式包括但不限于使用插件、外挂或非中国移动福建公司经授权的第三方工具/服务接入本软件和相关系统；</span> </p> <p class="p1"> <span class="s1">8.2.1.5 通过修改或伪造软件运行中的指令、数据，增加、删减、变动软件的功能或运行效果，或者将用于上述用途的软件、方法进行运营或向公众传播，无论这些行为是否为商业目的；</span> </p> <p class="p1"> <span class="s1">8.2.1.6 通过非中国移动福建公司开发、授权的第三方软件、插件、外挂、系统，登录或使用中国移动福建公司软件及服务，或制作、发布、传播上述工具；</span> </p> <p class="p1"> <span class="s1">8.2.1.7 自行或者授权他人、第三方软件对本软件及其组件、模块、数据进行干扰；</span> </p> <p class="p1"> <span class="s1">8.2.1.8 其他未经中国移动福建公司明示授权的行为。</span> </p> <p class="p1"> <span class="s1"><strong>8.2.2 </strong>你理解并同意，基于用户体验、“八闽生活”或相关服务平台运营安全、平台规则要求及健康发展等综合因素，中国移动福建公司有权选择提供服务的对象，有权决定功能设置，有权决定功能开放、数据接口和相关数据披露的对象和范围。针对以下情形，有权视具体情况中止或终止提供本服务，包括但不限于：</span> </p> <p class="p1"> <span class="s1">8.2.2.1 违反法律法规或本协议规定的；</span> </p> <p class="p1"> <span class="s1">8.2.2.2 影响服务体验的；</span> </p> <p class="p1"> <span class="s1">8.2.2.3 存在安全隐患的；</span> </p> <p class="p1"> <span class="s1">8.2.2.4 与“八闽生活”或其服务平台已有主要功能或功能组件相似、相同，或可实现上述功能或功能组件的主要效用的；</span> </p> <p class="p1"> <span class="s1">8.2.2.5 界面、风格、功能、描述或使用者体验与“八闽生活”或其服务平台类似，可能造成“八闽生活”用户认为其所使用的功能或服务来源于中国移动福建公司或经中国移动福建公司授权的；</span> </p> <p class="p1"> <span class="s1">8.2.2.6 违背“八闽生活”或其服务平台运营原则，或不符合中国移动福建公司其他管理要求的。</span> </p> <p class="p3"> <span class="s1"><strong>8.3 服务运营规范</strong></span> </p> <p class="p1"> <span class="s1">除非法律允许或中国移动福建公司书面许可，你使用本服务过程中不得从事下列行为：</span> </p> <p class="p1"> <span class="s1"><strong>8.3.1 </strong>提交、发布虚假信息，或冒充、利用他人名义的；</span> </p> <p class="p1"> <span class="s1"><strong>8.3.2 </strong>诱导其他用户点击链接页面或分享信息的；</span> </p> <p class="p1"> <span class="s1"><strong>8.3.3 </strong>虚构事实、隐瞒真相以误导、欺骗他人的；</span> </p> <p class="p1"> <span class="s1"><strong>8.3.4 </strong>侵害他人名誉权、肖像权、知识产权、商业秘密等合法权利的；</span> </p> <p class="p1"> <span class="s1"><strong>8.3.5 </strong>未经中国移动福建公司书面许可利用“八闽生活”帐号和任何功能，以及第三方运营平台进行推广或互相推广的；</span> </p> <p class="p1"> <span class="s1"><strong>8.3.6 </strong>利用“八闽生活”帐号或本软件及服务从事任何违法犯罪活动的；</span> </p> <p class="p1"> <span class="s1"><strong>8.3.7 </strong>制作、发布与以上行为相关的方法、工具，或对此类方法、工具进行运营或传播，无论这些行为是否为商业目的；</span> </p> <p class="p1"> <span class="s1"><strong>8.3.8 </strong>其他违反法律法规规定、侵犯其他用户合法权益、干扰产品正常运营或中国移动福建公司未明示授权的行为。</span> </p> <p class="p3"> <span class="s1"><strong>8.4 对自己行为负责</strong></span> </p> <p class="p1"> <span class="s1">你充分了解并同意，你必须为自己注册帐号下的一切行为负责，包括你所发表的任何内容以及由此产生的任何后果。你应对本服务中的内容自行加以判断，并承担因使用内容而引起的所有风险，包括因对内容的正确性、完整性或实用性的依赖而产生的风险。中国移动福建公司无法且不会对因前述风险而导致的任何损失或损害承担责任。</span> </p> <p class="p3"> <span class="s1"><strong>8.5 违约处理</strong></span> </p> <p class="p1"> <span class="s1"><strong>8.5.1 </strong>如果中国移动福建公司发现或收到他人举报或投诉用户违反本协议约定的，中国移动福建公司有权不经通知随时对相关内容进行删除、屏蔽，并视行为情节对违规帐号处以包括但不限于警告、限制或禁止使用部分或全部功能、帐号封禁直至注销的处罚，并公告处理结果。</span> </p> <p class="p1"> <span class="s1"><strong>8.5.2 </strong>你理解并同意，中国移动福建公司有权依合理判断对违反有关法律法规或本协议规定的行为进行处罚，对违法违规的任何用户采取适当的法律行动，并依据法律法规保存有关信息向有关部门报告等，用户应独自承担由此而产生的一切法律责任。</span> </p> <p class="p1"> <span class="s1"><strong>8.5.3 </strong>你理解并同意，因你违反本协议或相关服务条款的规定，导致或产生第三方主张的任何索赔、要求或损失，你应当独立承担责任；中国移动福建公司因此遭受损失的，你也应当一并赔偿。</span> </p> <p class="p4"> <span class="s1"><strong>九、知识产权声明</strong></span> </p> <p class="p1"> <span class="s1"><strong>9.1 </strong>中国移动福建公司是本软件的知识产权权利人。本软件的一切著作权、商标权、专利权、商业秘密等知识产权，以及与本软件相关的所有信息内容（包括但不限于文字、图片、音频、视频、图表、界面设计、版面框架、有关数据或电子文档等）均受中华人民共和国法律法规和相应的国际条约保护，中国移动福建公司享有上述知识产权，但相关权利人依照法律规定应享有的权利除外。</span> </p> <p class="p1"> <span class="s1"><strong>9.2 </strong>未经中国移动福建公司或相关权利人书面同意，你不得为任何商业或非商业目的自行或许可任何第三方实施、利用、转让上述知识产权。</span> </p> <p class="p4"> <span class="s1"><strong>十、终端安全责任</strong></span> </p> <p class="p1"> <span class="s1"><strong>10.1 </strong>你理解并同意，本软件同大多数互联网软件一样，可能会受多种因素影响，包括但不限于用户原因、网络服务质量、社会环境等；也可能会受各种安全问题的侵扰，包括但不限于他人非法利用用户资料，进行现实中的骚扰；用户下载安装的其他软件或访问的其他网站中可能含有病毒、木马程序或其他恶意程序，威胁你的终端设备信息和数据安全，继而影响本软件的正常使用等。因此，你应加强信息安全及个人信息的保护意识，注意密码保护，以免遭受损失。</span> </p> <p class="p1"> <span class="s1"><strong>10.2 </strong>你不得制作、发布、使用、传播用于窃取“八闽生活”帐号及他人个人信息、财产的恶意程序。</span> </p> <p class="p1"> <span class="s1"><strong>10.3 </strong>维护软件安全与正常使用是中国移动福建公司和你的共同责任，中国移动福建公司将按照行业标准合理审慎地采取必要技术措施保护你的终端设备信息和数据安全，但是你承认和同意中国移动福建公司并不能就此提供完全保证。</span> </p> <p class="p1"> <span class="s1"><strong>10.4 </strong>在任何情况下，你不应轻信借款、索要密码或其他涉及财产的网络信息。涉及财产操作的，请一定先核实对方身份，并请经常留意中国移动福建公司有关防范诈骗犯罪的提示。</span> </p> <p class="p4"> <span class="s1"><strong>十一、第三方软件或技术</strong></span> </p> <p class="p1"> <span class="s1"><strong>11.1 </strong>本软件可能会使用第三方软件或技术（包括本软件可能使用的开源代码和公共领域代码等，下同），这种使用已经获得合法授权。</span> </p> <p class="p1"> <span class="s1"><strong>11.2 </strong>本软件如果使用了第三方的软件或技术，中国移动福建公司将按照相关法规或约定，对相关的协议或其他文件，可能通过本协议附件、在本软件安装包特定文件夹中打包、或通过开源软件页面等形式进行展示，它们可能会以“软件使用许可协议”、“授权协议”、“开源代码许可证”或其他形式来表达。前述通过各种形式展现的相关协议、其他文件及网页，均是本协议不可分割的组成部分，与本协议具有同等的法律效力，你应当遵守这些要求。如果你没有遵守这些要求，该第三方或者国家机关可能会对你提起诉讼、罚款或采取其他制裁措施，并要求中国移动福建公司给予协助，你应当自行承担法律责任。</span> </p> <p class="p1"> <span class="s1">11.3 如因本软件使用的第三方软件或技术引发的任何纠纷，应由该第三方负责解决，中国移动福建公司不承担任何责任。中国移动福建公司不对第三方软件或技术提供客服支持，若你需要获取支持，请与第三方联系。</span> </p> <p class="p4"> <span class="s1"><strong>十二、其他</strong></span> </p> <p class="p1"> <span class="s1">12.1 你使用本软件即视为你已阅读并同意受本协议的约束。中国移动福建公司有权在必要时修改本协议条款。你可以在本软件的最新版本中查阅相关协议条款。本协议条款变更后，如果你继续使用本软件，即视为你已接受修改后的协议。如果你不接受修改后的协议，应当停止使用本软件。</span> </p> <p class="p1"> <span class="s1">12.2 本协议签订地为中华人民共和国福建省福州市鼓楼区。</span> </p> <p class="p1"> <span class="s1">12.3 本协议的成立、生效、履行、解释及纠纷解决，适用中华人民共和国大陆地区法律（不包括冲突法）。</span> </p> <p class="p1"> <span class="s1">12.4 若你和中国移动福建公司之间发生任何纠纷或争议，首先应友好协商解决；协商不成的，你同意将纠纷或争议提交本协议签订地有管辖权的人民法院管辖。</span> </p> <p class="p1"> <span class="s1">12.5 本协议所有条款的标题仅为阅读方便，本身并无实际涵义，不能作为本协议涵义解释的依据。</span> </p> <p class="p1"> <span class="s1">12.6 本协议条款无论因何种原因部分无效或不可执行，其余条款仍有效，对双方具有约束力。</span> </p> <p> <br/> </p> </div> <div class="uc_licence__ft dock_blr mh_m"> <button class="btn_xl" sn-tap="this.agree()">我同意</button> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/licence",["css/app.css","css/append.css"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),o=t("core/model2").Model;t("animation");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"使用协议"});e.back=function(){t.back(t.swipeRightBackAction)},e.agree=function(){t.setResult("agree_licence"),this.back()},this.bindScrollTo(e.refs.main)},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/pubquan/item",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header class="header_trans"> <div class="head_back" sn-tap="this.back()"></div> </header> <div class="main pq_item" ref="main"> <div class="pq_item__info"> <div class="flex_t pt_l"> <div class="img ml_l"><img sn-src="{sl.resource(quanInfo.quan_pic)}" /></div> <div class="flexitem ml_l"> <div class="name fs_m">{quanInfo.quan_name}</div> <div class="follow fs_s mt_l">{util.cnNum(quanInfo.follow_num)}关注 | {newLength}新帖</div> </div> <button class="pq_item__header_btn" sn-tap="this.follow()">{quanInfo.is_follow?\'取消关注\':\'关注\'}</button> </div> <div class="cl_fff lh_xs fs_m pt_s ml_m mr_m to_e2">{quanInfo.summary}</div> </div> <div class="pq_item__articles"> <div class="hd">最新帖子</div> <div class="pq_item__articles_item bd_tb bg_fff mb_l" sn-repeat="item in newArticles|orderBy:add_date desc" data-forward="/pubquan/article/{item.msg_id}"> <div class="title fs_m h_m lh_m ml_m mr_m flex"> <p class="to_e flex_0">{item.title}</p> <p class="date pl_m fs_s">{util.formatDate(item.add_date,\'short\')}</p> </div> <ul class="imgs clearfix"> <li class="img fl_l ml_m" sn-repeat="img in item.imgs"><img sn-src="{sl.thumbnail(img)}" /></li> </ul> <div class="flex lh_s fs_s pb_m pt_s"> <img sn-src="{sl.resource(quanInfo.quan_pic)}" class="dp_b cir_s ml_m" /> <p class="ml_s">{quanInfo.quan_name}</p> <p class="flexitem ml_m"><span class="ml_s va_m fs_s">{util.cnNum(item.see)}看过</span></p> <p class="icon-good mr_m"><span class="ml_s va_m fs_s">{util.cnNum(item.likes)}</span></p> <p class="icon-comment mr_m"><span class="ml_s va_m fs_s">{util.cnNum(item.comments)}</span></p> </div> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/pubquan/item",["css/app.css","css/append.css","logical/publicquan"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=(t("widget/loader"),t("core/model2").Model),c=t("promise"),l=t("widget/toast"),u=t("widget/popup"),h=t("logical/publicquan");n.exports=r.extend({onCreate:function(){var t=this,e=this.route.params.id,n=this.model=new a(this.$el,{});n.back=function(){t.back(t.swipeRightBackAction)},n.follow=function(){var t=function(){h.follow(e).then(function(t){n._("quanInfo").set({is_follow:!n.get("quanInfo.is_follow")})})["catch"](function(t){l.showToast(t.message)})};n.get("quanInfo").is_follow?u.confirm({content:"确定不关注该圈了吗？",confirmAction:function(){t(),this.hide()}}):t()},c.all([h.item(e),h.newArticles(e),this.waitLoad()]).then(function(e){var i=e[0].data;i.summary&&(i.summary=i.summary.replace(/<(\/{0,1}[a-zA-Z]+)(?:\s+[a-zA-Z1-9_-]+="[^"]*"|\s+[^\s]+)*?\s*(\/){0,1}\s*>/gm,"")),i.is_follow=i.pub_quan_follow?i.pub_quan_follow.is_follow:!1;var s=e[1].data;s.forEach(function(t){var e;t.imgs&&(e=t.imgs.split(",")),e&&e.length||!/<img\s+/.test(t.content)||(e=[],t.content.replace(/<img\s[^>]*?src=\"([^\"\>]+)\"/g,function(t,n){e.push(n)})),e&&e.length>3&&(e.length=3),t.imgs=e}),n.set({quanInfo:i,newArticles:s,newLength:Math.min(20,e[1].total)}),t.mainScroll=t.bindScrollTo(n.refs.main)})["catch"](function(t){l.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/pubquan/article",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{data.title}</div> </header> <div class="main pq_article pt_1" ref="main"> <div class="pd_m bg_fff bd_b"> <p class="fs_l">{data.title}</p> <div class="flex mt_m"><img sn-src="{sl.resource(quan.quan_pic)}" alt="" class="cir_m sp_b"> <div class="flexitem ml_m"> <p class="fs_m">{quan.quan_name}</p> <p class="fs_s cl_999">{util.formatDate(data.add_date)}</p> </div> <button class="btn_bd_s dp_b" sn-tap="this.follow()"><i class="va_m">{follow.is_follow?\' \':\'＋\'}</i><span class="va_m">{follow.is_follow?\'取消关注\':\'关注\'}</span></button> </div> <div class="mt_l mb_l fs_m lh_xs of_h"> <div sn-html="data.content" class="pq_article__con"></div> <img sn-src="{sl.resource(img)}" sn-repeat="img in data.imgs" class="dp_b mg_a mw_app" /> </div> <div class="mt_xxl mb_l ta_c pq_article__action"> <div class="icon-newslike dp_ib cir_xl" sn-tap="this.likePubQuanMsg()"> <p class="fs_s">{util.cnNum(data.likes)||0}</p> </div> <div class="icon-newssee dp_ib cir_xl"> <p class="fs_s">{util.cnNum(data.see)||0}</p> </div> </div> </div> <div class="pq_article__comments bd_tb bg_fff mt_l" ref="comments"> <div class="lh_m pl_m bd_b fs_m flex"> <div class="flexitem">评论</div> <p class="icon-refresh sqr_d ta_r pr_m" sn-tap="this.reloadComments()"></p> <p class="sort" sn-tap="this.sortBy()"><span>倒序</span> <i class="icon-sort"></i></p> </div> <div class="pq_article__comments_item bd_b ml_m pb_m" sn-repeat="item in comments"> <div class="flex pt_m con"> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(item.avatars)}" class="cir_s" /> <div class="flexitem ml_m"> <p class="fs_m">{this.getUserShowName(item)}</p> <p class="fs_s cl_999">{util.formatDate(item.add_date)}</p> </div> <a sn-if="item.user_id!=user.user_id" class="icon-comment dp_b" href="javascript:;" sn-tap="this.comment(item.comment_id,item.user_id,this.getUserShowName(item))"></a> <a sn-if="item.user_id==user.user_id" sn-tap="this.delComment(item.comment_id)" class="icon-del2 dp_b" href="javascript:;"></a> </div> <div class="mt_s pb_m fs_m"> {item.content} </div> <ul class="fs_s pd_m bg_eee mr_m" sn-if="item.replys.length"> <li sn-repeat="reply in item.replys" class="h_xxs"><a sn-tap="this.comment(item.comment_id,reply.user_id,this.getUserShowName(reply))" href="javascript:;" class="flex"><i class="cl_dark">{this.getUserShowName(reply)}</i><em>：</em><span>{reply.content}</span></a></li> </ul> </div> </div> </div> <footer class="pq_article__chatbox bd_t flex"> <div class="text flexitem pt_s pl_m" sn-tap="this.comment()"> <span class="fs_m cl_ccc dp_b">说几句话吧...</span> </div> <!--<div class="icon-comment3 sqr_l" data-forward="/pubquan/myarticles"></div>--> <div class="{isFav?\'icon-heart2\':\'icon-heart3\'} sqr_l" sn-tap="this.fav()"></div> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/pubquan/article",["css/app.css","css/append.css","../../logical/publicquan","models/user","../../models/friends"],function(t,e,n){var i=t("$"),r=(t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),u=t("widget/popup"),h=t("../../logical/publicquan"),p=t("models/user"),f=t("../../models/friends");n.exports=r.extend({onCreate:function(){var t=this,e=this.route.params.id,n=this.model=new o(this.$el,{user:p}),i=!1;n.fav=function(){if(!i){i=!0;var t=this.get("isFav"),s=t?h.unfav(e):h.fav(e);s.then(function(e){l.showToast(t?"已取消收藏":"收藏成功"),n.set({isFav:!t}).model("data").set({likes:e.data})})["catch"](function(t){l.showToast(t.message)}).then(function(){i=!1})}},n.follow=function(){var t=function(){h.follow(n.get("quan.quan_id")).then(function(t){var e=n.attributes.follow?n.attributes.follow.is_follow:!1;n.set("follow.is_follow",!e)})["catch"](function(t){l.showToast(t.message)})};n.get("follow.is_follow")?u.confirm({content:"确定不关注该圈了吗？",confirmAction:function(){t(),this.hide()}}):t()},this.onSendComment=this.onSendComment.bind(this),h.on("sendComment:"+e,this.onSendComment),n.delComment=function(t){h.delComment(t).then(function(e){l.showToast("删除成功");var i=n.model("comments");i.remove("comment_id",t)})["catch"](function(t){l.showToast(t.message)})},n.getUserShowName=f.getUserShowName,n.likePubQuanMsg=function(){h.likePubQuanMsg(e).then(function(t){l.showToast("点赞成功"),n._("data").set({likes:t.data})})["catch"](function(t){l.showToast(t.message)})},n.back=function(){t.back(t.swipeRightBackAction)},n.comment=function(n,i,s){t.forward("/pubquan/comment?msg_id="+e,s&&i!=p.attributes.user_id?{user_id:i,user_name:s,comment_id:n}:void 0)};var s=this.loader=new a(this.$el);s.showLoading();var r=h.commentsLoader({msg_id:e,orderBy:"desc"},n);n.sortBy=function(){var t=r.getParam("orderBy");r.setParam("orderBy","asc"==t?"desc":"asc").reload()},n.reloadComments=function(){r.reload()},c.all([h.article(e),r.request()["catch"](function(){}),this.waitLoad()]).then(function(i){var s=i[0],r=s.data;r.see=(r.see||0)+1,/<img\s+/.test(r.content)?r.imgs=null:r.imgs&&(r.imgs=r.imgs.split(",")),n.set({isFav:s.isFav,data:r,quan:s.quan,follow:s.follow}),t.bindScrollTo(n.refs.main),h.seeArticle(e)})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},onDestroy:function(){h.off("sendComment:"+this.route.params.id),this.model.destroy()},onSendComment:function(t,e){var n=this.model,s=n.collection("comments");if(e=i.extend(e,p.data),e.rel_id){var r=s.find("comment_id",e.rel_id);r.collection("replys").unshift(e)}else s.unshift(e)}})});define("template/pubquan/myarticles",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main pt_l" ref="main"> <div class="bd_t pt_1 bg_fff"> <div class="flex_t pt_s pb_s bd_b" sn-repeat="item in data" data-forward="/pubquan/article/{item.msg_id}"> <p class="ta_c w_l"><span class="dp_b fs_l">{util.formatDate(item.date,\'dd\')}</span><em class="dp_b fs_xs">{util.formatDate(item.date,\'M月\')}</em></p> <div class="flexitem"> <p class="name to_e">{item.title}</p> <p class="con to_e3 pt_s pb_s fs_m">{item.content}</p> <ul class="imgs clearfix pb_s"> <li class="img fl_l pr_m" sn-repeat="img in item.imgs"><img sn-src="{sl.resource(img)}" /></li> </ul> <div class="flex pb_s fs_s"> <img sn-src="{sl.resource(item.quan_pic)}" class="dp_b mr_m cir_xs" data-forward="/pubquan/{item.quan_id}"> <p class="mr_m" data-forward="/pubquan/{item.quan_id}">{item.quan_name}</p> <p class="flexitem">{util.cnNum(item.see)}看过</p> <a class="icon-good mr_m" href="javascript:;"> <span class="va_m">{util.cnNum(item.likes)}</span> </a> <a class="icon-comment mr_m" href="javascript:;"> <span class="va_m">{util.cnNum(item.comments)}</span> </a> <a class="icon-del2 mr_m" href="javascript:;"> </a> </div> </div> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/pubquan/myarticles",["css/app.css","css/append.css","logical/publicquan"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),h=(t("widget/popup"),t("logical/publicquan"));n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"我的帖子"});e.back=function(){t.back(t.swipeRightBackAction)};var n=this.loader=new a(this.$el);n.showLoading(),c.all([h.myArticles(),this.waitLoad()]).then(function(n){e.set({data:n[0].data}),t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){n.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/pubquan/comment",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button sn-tap="this.sendComment()">发送</button></div> </header> <div class="main" ref="main"> <textarea sn-model="comment" value="{comment}" class="pq_comment" placeholder="说点什么吧..." ref="comment"></textarea> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/pubquan/comment",["css/app.css","css/append.css","logical/publicquan"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),o=(t("widget/loader"),t("core/model2").Model),l=(t("promise"),t("widget/toast")),h=(t("widget/popup"),t("logical/publicquan"));n.exports=r.extend({toggleAnim:"up",onCreate:function(){var t=this,e=this.route.data,n=this.model=new o(this.$el,{title:"评论"});e.user_id&&n.set({comment_id:e.comment_id,user_id:e.user_id,user_name:e.user_name,comment:"@"+e.user_name+" "}),n.sendComment=function(){var e=this.attributes.comment;return e?void h.sendComment(t.route.query.msg_id,this.attributes.comment_id||0,this.attributes.user_id||0,e).then(function(t){l.showToast("发送成功"),n.back()})["catch"](function(t){l.showToast(t.message)}):void l.showToast("请填写评论内容")},n.back=function(){t.back(t.swipeRightBackAction)}},onShow:function(){this.model.refs.comment.focus()},onDestroy:function(){this.model.destroy()}})});define("template/pubquan/publish",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">发帖</div> <div class="head_right"><button sn-tap="this.submit()">发送</button></div> </header> <div class="main pq_publish pr_m pl_m" ref="main"> <div class="h_m bd_b"> <input sn-model="title" type="text" class="pq_publish__title" placeholder="输入帖子标题" /> </div> <div class="pq_publish__con"> <textarea sn-model="content" placeholder="输入帖子正文" /></textarea> </div> <div class="pq_publish__img clearfix"> <button class="quan-addimage fl_l" sn-tap="this.selectImage()"></button> <img sn-src="{item.thumbnail}" class="fl_l" sn-repeat="item in images" /> </div> <div class="pq_publish__quan clearfix"> <p class="fs_m fl_l" sn-repeat="item in quan">{item.quan_name}</p> <button class="btn_add" sn-tap="this.addQuan()">添加圈子</button> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/pubquan/publish",["css/app.css","css/append.css","logical/publicquan","components/imagePicker"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,l=(t("promise"),t("widget/toast")),p=(t("widget/popup"),t("bridge"),t("logical/publicquan")),d=t("components/imagePicker");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{images:[]});e.back=function(){t.back()},e.selectImage=function(){d.show(function(t){e._("images").add(t)})};var n=this.loader=new a(this.$el);e.addQuan=function(){t.forward("/pubquan/select",{list:this.get("quan")})},e.submit=function(){var e=this.attributes.title;if(!e)return void l.showToast("请输入帖子标题");var i=this.attributes.content;if(!i)return void l.showToast("请输入帖子正文");var s=this.attributes.quan;if(!s||0===s.length)return void l.showToast("请添加圈子");var r=[];s.forEach(function(t){r.push(t.quan_id)});var a=this.attributes.images,o=null,c=[];a&&(o=[],a.forEach(function(t,e){o.push({name:"images",value:t.id}),c.push(t.thumbnail)})),n.showLoading(),p.publish({quan_ids:r,title:e,content:i,images:o,saveImages:c}).then(function(e){l.showToast("发布成功！"),t.back()})["catch"](function(t){l.showToast(t.message)}).then(function(){n.hideLoading()})},t.bindScrollTo(e.refs.main)},onAppear:function(){var e=this.route.data;this.model.set({quan:e.list})},onDestroy:function(){this.model.destroy()}})});define("template/pubquan/select",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button sn-tap="this.save()">确定</button></div> </header> <div class="main pt_m" ref="main"> <ul class="bd_t bg_fff"> <li class="bd_b h_l flex " sn-repeat="item in list" sn-tap="this.selectItem(item)"> <p class="radio{item.isSelected?\' checked\':\'\'}"></p> <img sn-src="{sl.resource(item.quan_pic)}" class="dp_b sqr_m"> <p class="name ml_m">{item.quan_name}</p> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/pubquan/select",["css/app.css","css/append.css","logical/publicquan"],function(t,e,n){var s=(t("$"),t("util")),r=t("activity"),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),h=(t("widget/popup"),t("logical/publicquan"));n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"选择公众圈"});e.back=function(){t.back(t.swipeRightBackAction)},e.selectItem=function(t){this._("list").each(function(e){e.get("quan_id")!=t.quan_id?e.set("isSelected",!1):e.set("isSelected",!0)})},e.save=function(){var e=this.data.list;t.back(t.swipeRightBackAction,{list:s.filter(e,"isSelected",!0).map(function(t){return t})})};var n=this.loader=new a(this.$el),i=this.route.data;n.showLoading(),c.all([h.myfollow(),this.waitLoad()]).then(function(n){var r=n[0].data;i.list&&r.forEach(function(t){t.isSelected=-1==s.indexOf(i.list,"quan_id",t.quan_id)}),e.set({list:r}),t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){n.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/pubquan/search",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header class="flex"> <form ref="searchform" class="ml_m flexitem flex hm_quan__search"> <div class="icon-search sqr_s"></div> <input type="search" sn-model="search" ref="search" class="flexitem fs_m" placeholder="搜索{quanTab.index==0?\'公众圈\':quanTab.index==1?\'朋友圈\':\'通讯录\'}" /> </form> <button class="h_bar pl_m pr_m bg_fff fs_m" sn-tap="this.back()">取消</button> </header> <div class="main pq_search" ref="main"> <div sn-repeat="item in searchResult" class="h_l flex pl_s bg_fff bd_b" data-forward="/pubquan/{item.quan_id}"> <img sn-src="{sl.resource(item.quan_pic)}" class="sqr_m mr_m"> <p class="fs_m">{item.quan_name}</p> </div> <div class="fs_m cl_999 ta_c lh_l" sn-if="isSearch&&!searchResult.length">未搜到结果</div> <div class="bd_b ml_m mr_m lh_m fs_m cl_666">热门圈子</div> <ul class="clearfix pl_m"> <li class="pq_search__hot" sn-repeat="item in recommend" data-forward="/pubquan/{item.quan_id}">{item.quan_name}</li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/pubquan/search",["css/app.css","css/append.css","logical/publicquan"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),h=(t("widget/popup"),t("logical/publicquan"));n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{});e.back=function(){t.back(t.swipeRightBackAction)},e.refs.searchform.onsubmit=function(){return e.attributes.search&&h.search(e.attributes.search).then(function(t){e.set({isSearch:!0,searchResult:t.data})})["catch"](function(t){l.showToast(t.message)}),!1};var n=this.loader=new a(this.$el);n.showLoading(),c.all([h.recommend(),this.waitLoad()]).then(function(n){e.set({recommend:n[0].data}),t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){n.hideLoading()})},onShow:function(){this.model.refs.search.focus()},onDestroy:function(){this.model.destroy()}})});define("template/quan/history",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main qn_history bg_fff"> <div class="qn_history__item flex_t mt_l" sn-repeat="item,j in data"> <p class="date" sn-html="{this.date(item.add_date,j)}"></p> <div class="con ml_m flexitem fw_s {item.imgs.length?\'\':\' ref\'}"> <p class="text">{item.content}</p> <ul class="clearfix" sn-if="item.imgs.length"> <li class="fl_l mr_m mt_m" sn-repeat="img,i in item.imgs" sn-tap="this.showImages(item.imgs,i)"><img sn-src="{sl.thumbnail(img)}" /></li> </ul> </div> <p class="icon-del" sn-tap="this.del(item.msg_id)"></p> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/quan/history",["css/app.css","css/append.css","logical/quan","models/user","widget/photoViewer"],function(t,e,n){var i=t("$"),s=t("util"),r=t("activity"),a=t("widget/loader"),o=t("widget/toast"),c=t("widget/popup"),l=t("core/model2").Model,u=t("promise"),h=t("logical/quan"),d=(t("models/user"),t("widget/photoViewer"));n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new l(this.$el,{title:"我的历史"});e.back=function(){t.back(t.swipeRightBackAction)},e.date=function(t,e){t=new Date(t);var n=s.formatDate(t,"yyyyMMdd");return 0!=e&&s.formatDate(new Date(this.attributes.data[e-1].add_date),"yyyyMMdd")==n?"":s.formatDate(new Date,"yyyyMMdd")==n?"<b>今天</b>":(t=s.formatDate(t,"MM-dd").split("-"),"<b>"+t[1]+'</b><i class="fs_xs">'+{"01":"一月","02":"二月","03":"三月","04":"四月","05":"五月","06":"六月","07":"七月","08":"八月","09":"九月",10:"十月",11:"十一月",12:"十二月"}[t[0]]+"</i>")},e.del=function(t){c.confirm({title:"温馨提醒",content:"您确定要删除吗",confirmText:"确定",confirmAction:function(){var n=this;a.showLoading(),h.deleteQuan(t).then(function(){n.hide(),e._("data").remove("msg_id",t)})["catch"](function(t){o.showToast(t.message)}).then(function(){a.hideLoading()})},cancelText:"取消",cancelAction:function(){}})};var n=this.photoViewer=new d;n.$el.hide().appendTo("body").addClass("g_beforeshow").on(i.fx.transitionEnd,function(){n.$el.hasClass("g_show")||n.$el.hide()}).on("tap",function(){n.$el.removeClass("g_show")}),e.showImages=function(t,e){n.setImages(t.map(function(t){return{src:sl.resource(t)}})),n.index(e),n.$el.show()[0].clientHeight,n.$el.addClass("g_show")},u.all([h.getHistory(),this.waitLoad()]).then(function(n){var i=n[0].data;i.sort(function(t,e){return t.add_date>e.add_date?-1:t.add_date<e.add_date?1:0}),i.forEach(function(t){t.imgs&&(t.imgs=t.imgs.split(","))}),e.set({data:i}),t.bindScrollTo(e.refs.main)})["catch"](function(t){o.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/quan/publish",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_left" sn-tap="this.back()"><button>取消</button></div> <div class="head_right"><button disabled="{!content && (!images || !images.length)}" sn-tap="this.submit()">发送</button></div> </header> <div class="main pt_m" ref="main"> <div class="qn_publish__con pr_m pl_m bd_tb mb_l"> <textarea sn-model="content" placeholder="说点什么吧" /></textarea> </div> <div class="qn_publish__img clearfix pr_m pl_m"> <button class="quan-addimage fl_l" sn-tap="this.selectImage()"></button> <img sn-src="{item.thumbnail}" class="fl_l" sn-repeat="item in images" /> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/quan/publish",["css/app.css","css/append.css","logical/quan","components/imagePicker"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,l=(t("promise"),t("widget/toast")),p=(t("widget/popup"),t("bridge"),t("logical/quan")),d=t("components/imagePicker");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{images:[]});e.back=function(){t.back()},e.selectImage=function(){d.show(function(t){e._("images").add(t)})};var n=this.loader=new a(this.$el);e.addQuan=function(){t.forward("/pubquan/select",{list:this.get("quan")})},alert(sl.isInApp),e.submit=function(){var e=this.attributes.content,i=this.attributes.images;if(e||i&&i.length){var s=null,r=[];i&&(s=[],i.forEach(function(t,e){s.push({name:"images",value:t.id}),r.push(t.thumbnail)})),n.showLoading(),p.publish({content:e,images:s,saveImages:r}).then(function(e){l.showToast("发布成功！"),t.back()})["catch"](function(t){l.showToast(t.message)}).then(function(){n.hideLoading()})}},t.bindScrollTo(e.refs.main)},onAppear:function(){var e=this.route.data;this.model.set({quan:e.list})},onDestroy:function(){this.model.destroy()}})});define("template/quan/comment",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button sn-tap="this.sendComment()">发送</button></div> </header> <div class="main" ref="main"> <textarea sn-model="comment" value="{comment}" class="pq_comment" placeholder="说点什么吧..." ref="comment"></textarea> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/quan/comment",["css/app.css","css/append.css","logical/quan"],function(t,n,i){var a=(t("$"),t("util"),t("activity")),c=(t("widget/loader"),t("core/model2").Model),u=(t("promise"),t("widget/toast")),p=(t("widget/popup"),t("logical/quan"));i.exports=a.extend({toggleAnim:"up",onCreate:function(){var t=this,n=this.route.data,i=this.model=new c(this.$el,{title:"评论"});n.user_id&&i.set({user_id:n.user_id,user_name:n.user_name,comment:"@"+n.user_name+" "}),i.sendComment=function(){var n=this.attributes.comment;return n?void p.sendComment(t.route.query.msg_id,n).then(function(t){u.showToast("发送成功"),i.back()})["catch"](function(){u.showToast(e.message)}):void u.showToast("请填写评论内容")},i.back=function(){t.back(t.swipeRightBackAction)}},onShow:function(){this.model.refs.comment.focus()},onDestroy:function(){this.model.destroy()}})});define("template/quan/select_user",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button sn-tap="this.save()">确定</button></div> </header> <div class="main ct_contactlist" ref="main"> <div class="ta_c pt_m fs_m cl_666">请选择要加入黑名单的用户</div> <div class="ct_contactlist__search"> <form class="ps_r zi_1 flex"> <p class="icon-search ml_m"></p> <input type="text" class="bd_n ml_s flexitem fs_m" placeholder="搜索好友" /> </form> </div> <div class="ct_contactlist__group" sn-repeat="group in groups"> <div class="hd fs_m pd_s ml_m">{group.letter}</div> <ul class="ct_contactlist__list bd_t bg_fff"> <li class="bd_b flex" sn-repeat="item in group.list" sn-tap="item.checked=!item.checked"> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(item.avatars)}" class="dp_b sqr_s" /> <div class="flexitem ml_m"> <p class="fs_l"> {this.getUserShowName(item)} </p> </div> <p class="{item.checked?\'icon-checked\':\'icon-check\'}"></p> </li> </ul> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/quan/select_user",["css/app.css","css/append.css","logical/contact","models/friends"],function(t,e,n){var s=(t("$"),t("util")),r=t("activity"),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),h=(t("widget/popup"),t("utils/firstLetter")),p=t("logical/contact"),d=t("models/friends");n.exports=r.extend({onCreate:function(){var t=this,e=this.route.data,n=this.model=new o(this.$el,{title:"我的好友",friends:e.friends||[],type:e.type});n.back=function(){t.back(t.swipeRightBackAction)},n.getUserShowName=d.getUserShowName,n.save=function(){var t=this.get("groups"),n=[];t.forEach(function(t){n=n.concat(s.filter(t.list,"checked",!0))}),e.onSelect(n),this.back()};var i=this.loader=new a(this.$el);i.showLoading(),c.all([p.friends(),this.waitLoad()]).then(function(e){var i=e[0].data,r=n.get("friends");i.forEach(function(t){-1!=s.indexOf(r,"user_id",t.user_id)&&(t.checked=!0)}),n.set({friendList:i,groups:t.groups(i)}),t.bindScrollTo(n.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){i.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()},groups:function(t){var e={};if(t)return t.forEach(function(t){var n=h(t.user_name).charAt(0).toUpperCase();e[n]||(e[n]=[]),e[n].push(t)}),e=Object.keys(e).map(function(t){return{letter:t,list:e[t]}})}})});define("template/contact/new",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main ct_new" ref="main"> <div class="ct_new__search" data-forward="/contact/search"> <div class="flex ps_r"> <p class="icon-search ml_m"></p> <input type="text" placeholder="手机号/昵称/我信ID" class="flexitem" disabled /> </div> </div> <div class="ml_m mt_m fs_m">新的朋友</div> <div class="mt_m bd_t bg_fff"> <div class="ta_c bd_b lh_m fs_s cl_ccc" sn-if="!newFriends.length">暂无新朋友</div> <div class="ct_new__item flex bd_b" sn-repeat="item in newFriends" data-forward="/contact/{item.status==1?\'friend\':\'person\'}/{item.user_id}?type=new"> <img onerror="this.src=\'images/default.jpg\'" src="{sl.resource(item.avatars)}" alt="" class="sqr_s dp_b ml_m"> <div class="flexitem ml_m"> <div class="fs_m">{this.getUserShowName(item)}</div> <div class="fs_s">{item.msg}</div> </div> <span sn-if="item.is_send==1&&item.status==-1" class="cl_ccc fs_s">等待接受</span> <button sn-else-if="!item.is_send&&item.status==-1" class="btn_xs" sn-tap="this.acceptFriend(item.user_id)">接受</button> <span sn-else-if="item.status==1" class="cl_ccc fs_s">已接受</span> <span sn-else-if="item.status==0" class="cl_ccc fs_s">已拒绝</span> <button class="icon-xx" sn-tap="this.del(item.fid)"></button> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/contact/new",["css/app.css","css/append.css","logical/contact","models/friends"],function(t,e,n){var s=(t("$"),t("util")),r=t("activity"),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),h=(t("widget/popup"),t("logical/contact")),p=t("models/friends");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"新的朋友"});p.set({newFriendsCount:0}),e.acceptFriend=function(n,i){return h.acceptFriend(n).then(function(){h.trigger("acceptFriend",n),e._("newFriends").updateBy("user_id",n,{status:1}),t.forward("/contact/memo/"+n)})["catch"](function(t){l.showToast(t.message)}),!1},e.getUserShowName=p.getUserShowName,e.del=function(t,n){return e._("newFriends").remove("fid",t),h.hideItem(t),!1},e.back=function(){t.back(t.swipeRightBackAction)},h.on("addFriend",function(){h.newFriends().then(function(t){e.set({newFriends:t.data})})});var n=this.loader=new a(this.$el);n.showLoading(),p.set({newFriendsCount:0}),c.all([h.newFriends(),this.waitLoad()]).then(function(n){var i=n[0].data;p.getFriends().update(s.map(i,["user_id","user_name"]),"user_id"),e.set({newFriends:i}),t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){n.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/contact/search",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header class="flex"> <form ref="searchform" class="ml_m flexitem flex hm_quan__search"> <div class="icon-search sqr_s"></div> <input type="search" sn-model="search" ref="search" class="flexitem fs_m" placeholder="手机号/昵称/我信ID" /> </form> <button class="h_bar pl_m pr_m bg_fff fs_m" sn-tap="this.back()">取消</button> </header> <div class="main pq_search" ref="main"> <div sn-repeat="item in searchResult" class="h_l flex pl_s bg_fff bd_b" data-forward="/contact/person/{item.user_id}"> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(item.avatars)}" class="sqr_m mr_m"> <p class="fs_m">{item.user_name}</p> </div> <div class="fs_m cl_999 ta_c lh_l" sn-if="isSearch&&!searchResult.length">未搜到结果</div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/contact/search",["css/app.css","css/append.css","logical/contact"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,l=(t("promise"),t("widget/toast")),h=(t("widget/popup"),t("logical/contact"));n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{});e.back=function(){t.back(t.swipeRightBackAction)};var n=h.pageLoaderForSearch(e);e.refs.searchform.onsubmit=function(){if(e.attributes.search){var t=e.attributes.search,i={};/^\d{11}$/.test(t)?i.account=t:/^\d{0,10}$/.test(t)?i.user_id=t:i.user_name=t,n.clearParams().setParam(i).reload()["catch"](function(t){l.showToast(t.message)})}return!1};this.loader=new a(this.$el);t.bindScrollTo(e.refs.main)},onShow:function(){this.model.refs.search.focus()},onDestroy:function(){this.model.destroy()}})});define("template/contact/person",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main" ref="main"> <div class="bd_tb mt_m pd_m flex_t bg_fff"> <img onerror="this.src=\'images/default.jpg\'" class="sqr_xl dp_b" sn-src="{sl.resource(person.avatars)}" /> <div class="ml_l flexitem"> <p class="name fs_l">{person.user_name}</p> <p class="fs_s mt_m">我信ID:{person.user_id}</p> </div> </div> <ul class="mt_l bd_t fs_m bg_fff"> <li class="bd_b lh_l pl_m"> 地区：{person.country_name}-{person.province_name}-{person.city_name} </li> <li class="bd_b lh_l pl_m"> 个性签名：{person.sign_text} </li> <li class="bd_b lh_l pl_m" sn-if="person.status==-1"> 验证消息：{person.tag} </li> </ul> <div class="ct_person__actions" sn-if="person.status==-1"> <div class="btn_xl" sn-tap="this.acceptFriend()">接受</div> <div class="btn_xl btn_reject" sn-tap="this.rejectFriend()">拒绝</div> </div> <div class="ct_person__actions ta_c" sn-else-if="person.status==-2"> <button class="quan-add_friend bg_0000 mr_m" sn-tap="delegate.addFriend()"></button> <button class="quan-call2 bg_0000 ml_m" sn-tap="this.openPhoneCall()"></button> </div> <div class="ct_person__actions ta_c" sn-else-if="person.status==-11"> <button class="quan-add_friend bg_0000 mr_m" sn-tap="delegate.addFriend()"></button> <button class="quan-call2 bg_0000 ml_m" sn-tap="this.openPhoneCall()"></button> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/contact/person",["css/app.css","css/append.css","logical/contact","models/user"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("bridge"),o=t("widget/loader"),c=t("core/model2").Model,l=t("promise"),u=t("widget/toast"),d=(t("widget/popup"),t("logical/contact")),p=t("models/user");n.exports=r.extend({onCreate:function(){var t=this,n=(this.route.query.type,this.route.params.id),i=this.model=new c(this.$el,{title:"详细资料",user:p});i.delegate=this,i.back=function(){t.back(t.swipeRightBackAction)},i.acceptFriend=function(){d.acceptFriend(n).then(function(){d.trigger("acceptFriend",n),t.replaceWith("/contact/friend/"+n).forward("/contact/memo/"+n)})["catch"](function(t){u.showToast(t.message)})},i.rejectFriend=function(){d.rejectFriend(n).then(function(){d.trigger("rejectFriend",n),t.back()})["catch"](function(t){u.showToast(t.message)})},i.openPhoneCall=function(){1==this.get("canCallMe")?a.system.openPhoneCall(this.get("person.account")):u.showToast("对方未允许陌生人拨号，请先加好友")};var s=this.loader=new o(this.$el);s.showLoading(),l.all([d.person(n),this.waitLoad()]).then(function(e){var n=e[0];i.set({person:n.data,canCallMe:n.can_call_me,validNewFriend:n.valid_new_friend}),t.bindScrollTo(i.refs.main)})["catch"](function(t){u.showToast(t.message)}).then(function(){s.hideLoading()})},addFriend:function(){var t=this,e=this.model,n=this.route.params.id;2!=e.get("validNewFriend")?t.forward("/friend/valid/"+n):d.addFriend(n).then(function(){u.showToast("添加好友成功"),d.trigger("addFriend"),t.replaceWith("/contact/friend/"+n).forward("/contact/memo/"+n)})["catch"](function(t){u.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/contact/contactlist",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main ct_contactlist" ref="main"> <div class="ct_contactlist__search"> <form class="ps_r zi_1 flex"> <p class="icon-search ml_m"></p> <input type="text" sn-model="searchText" class="bd_n ml_s flexitem fs_m" placeholder="搜索手机通讯录" /> </form> </div> <div class="bd_tb bg_fff pl_m lh_l mt_l g_arrow" data-forward="/contact/backup">手机通讯录备份</div> <div class="ct_contactlist__group" sn-repeat="group in groups"> <div class="hd fs_m pd_s ml_m">{group.letter}</div> <ul class="ct_contactlist__list bd_t bg_fff"> <li class="bd_b flex" sn-repeat="item in group.list|filter:like(item.contactName+item.user_name+item.phoneNumber,searchText)" data-forward="{item.user_id&&item.isFriend?\'/contact/friend/\'+item.user_id:item.user_id?(\'/contact/person/\'+item.user_id):null}"> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(item.contactImage||item.avatars)}" class="dp_b sqr_s" /> <div class="flexitem ml_m"> <p class="fs_l"> {item.contactName} <span class="cl_999 fs_s pl_m">{item.phoneNumber}</span> </p> <p class="fs_s" sn-if="item.user_id">和生活昵称：{this.getUserShowName(item)}</p> </div> <button class="btn_xs" sn-if="item.user_id&&!item.isFriend" data-forward="/contact/person/{item.user_id}">添加</button> <button class="btn_xs" sn-if="!item.user_id" sn-tap="this.inviteFriend(item.phoneNumber)">邀请</button> <span class="cl_app fs_m mr_m" sn-if="item.user_id&&item.isFriend" data-forward="/contact/friend/{item.user_id}">好友</span> </li> </ul> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/contact/contactlist",["css/app.css","css/append.css","logical/contact","models/friends"],function(t,e,n){var s=(t("$"),t("util")),r=t("activity"),a=t("widget/loader"),o=t("core/model2").Model,h=(t("promise"),t("widget/toast"),t("widget/popup"),t("utils/firstLetter")),d=t("logical/contact"),p=t("models/friends");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"手机通讯录查询"});e.back=function(){t.back(t.swipeRightBackAction)},e.getUserShowName=p.getUserShowName,e.inviteFriend=function(t){d.inviteFriend(t)};this.loader=new a(this.$el),this.contactList=p.getContacts();this.setGroups=this.setGroups.bind(this),p.observe("contacts",this.setGroups),d.getContactList({},function(t){d.getContactsUser(s.map(s.filter(t,"user_id",void 0),"phoneNumber"))}),t.bindScrollTo(e.refs.main)},onShow:function(){},setGroups:function(){var t={},e=this.contactList.get();e.forEach(function(e){var n=h(e.contactName).charAt(0).toUpperCase();t[n]||(t[n]=[]),t[n].push(e)}),t=Object.keys(t).map(function(e){return{letter:e,list:t[e]}}),t.sort(function(t,e){return t.letter==e.letter?0:t.letter>e.letter?1:-1}),this.model.set({groups:t})},onDestroy:function(){p.removeObserve("contacts",this.setGroups),this.model.destroy()}})});define("template/contact/backup",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main ct_backup" ref="main"> <div class="g_center ct_backup__con"> <div class="ct_backup__bu flex fw_s" sn-tap="this.backup()"> <p class="quan-upload ml_m"></p> <div class="flexitem ml_m"> <p class="fs_m">备份通讯录</p> <p class="fs_s mt_m">上传手机通讯录到我的空间</p> </div> </div> <div class="ct_backup__recover flex fw_s" sn-tap="this.download()"> <p class="quan-upload ml_m"></p> <div class="flexitem ml_m"> <p class="fs_m">恢复通讯录</p> <p class="fs_s mt_m">下载我的空间通讯录到手机</p> </div> </div> </div> <div class="ct_backup__footer flex dock_blr h_l bg_fff fs_m"> <p class="icon-contact ml_l"></p> <div class="flexitem ml_m">通讯录 本地：{locCount||0}</div> <p class="icon-query"></p> <div class="flexitem ml_m">我的空间：{netCount||0}</div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/contact/backup",["css/app.css","css/append.css","logical/contact"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,l=(t("promise"),t("widget/toast")),u=t("widget/popup"),d=(t("logical/contact"),t("bridge"));n.exports=r.extend({onCreate:function(){var t=this,e=this.loader=new a(this.$el),n=this.model=new o(this.$el,{title:"手机通讯录查询"});n.back=function(){t.back(t.swipeRightBackAction)},n.backup=function(){e.showLoading(),d.cmcc.syncContact(0,function(t){t.success?l.showToast("备份成功！"):l.showToast(t.message),e.hideLoading()})},n.download=function(){var t=u.confirm({content:"确定恢复？",confirmAction:function(){e.showLoading(),d.cmcc.syncContact(1,function(n){n.success?l.showToast("恢复成功！"):l.showToast(n.message),e.hideLoading(),t.hide()})}})},e.showLoading(),d.cmcc.contactCount(function(t){t.success&&n.set(t),e.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/contact/friends",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main ct_contactlist" ref="main"> <div class="ct_contactlist__search"> <form class="ps_r zi_1 flex"> <p class="icon-search ml_m"></p> <input type="text" class="bd_n ml_s flexitem fs_m" placeholder="搜索好友" /> </form> </div> <div class="ct_contactlist__group" sn-repeat="group in this.groups()"> <div class="hd fs_m pd_s ml_m">{group.letter}</div> <ul class="ct_contactlist__list bd_t bg_fff"> <li class="bd_b flex" sn-repeat="item in group.list" data-forward="/contact/friend/{item.user_id}"> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(item.avatars)}" class="dp_b sqr_s" /> <div class="flexitem ml_m"> <p class="fs_l"> {item.name_for_show} </p> </div> <button class="quan-call3" sn-tap="delegate.phoneCall(item.account)"></button> <button class="quan-sms" sn-tap="delegate.sendSms(item.account)"></button> </li> </ul> </div> </div> <ul class="ct_friends__letters"> <li class="icon-search2"></li> <li sn-repeat="item in letters"><a href="javascript:;">{item}</a></li> <li>#</li> </ul>';return __},helpers:{}});return T.template=T.html,T});define("views/contact/friends",["css/app.css","css/append.css","logical/contact","models/friends"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("bridge"),o=t("widget/loader"),c=t("core/model2").Model,l=t("promise"),u=t("widget/toast"),d=(t("widget/popup"),t("utils/firstLetter")),p=t("logical/contact"),f=t("models/friends");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new c(this.$el,{title:"我的好友",letters:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),friendList:f._("friends")});e.delegate=this,e.groups=this.groups.bind(this),e.back=function(){t.back(t.swipeRightBackAction)};var n=this.loader=new o(this.$el);n.showLoading(),l.all([p.friends(),this.waitLoad()]).then(function(n){t.bindScrollTo(e.refs.main)})["catch"](function(t){u.showToast(t.message)}).then(function(){n.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()},phoneCall:function(t){return a.system.phoneCall(t),!1},sendSms:function(t){return a.system.sendSMS(t,""),!1},groups:function(){var t=this.model,e={},n=t.attributes.friendList;return n&&n.length?(n.forEach(function(t){var n=d(t.user_name).charAt(0).toUpperCase();e[n]||(e[n]=[]),e[n].push(t)}),e=Object.keys(e).map(function(t){return{letter:t,list:e[t]}}),e.sort(function(t,e){return t.letter==e.letter?0:t.letter>e.letter?1:-1}),e):[]}})});define("template/contact/friend",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main" ref="main"> <div class="bd_tb mt_m pd_m flex_t bg_fff ps_r"> <img onerror="this.src=\'images/default.jpg\'" class="sqr_xl dp_b" sn-src="{sl.resource(person.avatars)}" /> <div class="ml_l flexitem"> <p class="name fs_l">{person.user_name}</p> <p class="fs_s mt_xs">我信ID:{person.user_id}</p> <p class="fs_s mt_xs">个性签名：{person.sign_text}</p> </div> <p class="dock_tr fs_s mr_s mt_xs pt_s">{person.address}</p> </div> <ul class="mt_l bd_t fs_m bg_fff"> <li class="bd_b lh_l pl_m g_arrow" sn-tap="this.toMemo()"> 备注：{person.friends_ext.memo} </li> </ul> <div class="mt_l bd_tb fs_m bg_fff lh_l pl_m flex"> <p class="flexitem">好友留言信息</p> <p class="mr_m cp_switch{person.friends_ext.enable_leave_msg!=2?\' cp_switch_on\':\'\'}" sn-tap="delegate.setLeaveMsgSwitch(person.friends_ext.enable_leave_msg===2?1:2)"></p> </div> <div class="mt_l bd_tb fs_m bg_fff lh_l pl_m flex"> <p class="flexitem">推送到生活首页</p> <p class="mr_m cp_switch{person.friends_ext.enable_push!=2?\' cp_switch_on\':\'\'}" sn-tap="delegate.setPushSwitch(person.friends_ext.enable_push===2?1:2)"></p> </div> <div class="mt_l bd_tb fs_m bg_fff lh_l pl_m" sn-tap="delegate.clearHistory()"> 清空聊天记录 </div> <div class="mt_l bd_tb fs_m bg_fff lh_l pl_m" sn-tap="delegate.deleteFriend()"> 删除联系人 </div> <div class="mg_m mb_l ta_c pt_m"> <button class="quan-call2 bg_0000 mr_m" sn-tap="this.openPhoneCall()"></button> <button class="quan-message bg_0000 ml_m" data-forward="/contact/chat/{person.user_id}"></button> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/contact/friend",["css/app.css","css/append.css","logical/contact","models/friends"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("bridge"),o=t("widget/loader"),c=t("core/model2").Model,l=t("promise"),u=t("widget/toast"),h=t("widget/popup"),d=t("logical/contact"),p=t("models/friends");n.exports=r.extend({onCreate:function(){var t=this,n=(this.route.query.type,this.route.params.id),i=p.getFriend(n),s=this.model=new c(this.$el,{title:"详细资料",personId:n,person:i});s.delegate=this,s.back=function(){t.back(t.swipeRightBackAction)},s.toMemo=function(){t.forward("/contact/memo/"+n)},s.openPhoneCall=function(){a.system.openPhoneCall(this.get("person.account"))};var r=this.loader=new o(this.$el);r.showLoading(),l.all([d.friend(n),this.waitLoad()]).then(function(e){e[0];t.bindScrollTo(s.refs.main)})["catch"](function(t){u.showToast(t.message)}).then(function(){r.hideLoading()})},deleteFriend:function(){var t=this,e=this.route.params.id;h.confirm({title:"温馨提示",content:"删除好友，同时删除与该好友的聊天记录？",confirmText:"删除",confirmAction:function(){this.hide(),d.deleteFriend(e).then(function(){t.replaceWith("/contact/person/"+e)})}})},clearHistory:function(){var t=this.route.params.id;h.confirm({title:"温馨提示",content:"确定删除与该好友的聊天记录？",confirmText:"删除",confirmAction:function(){this.hide(),d.clearFriendMessages(t)}})},setPushSwitch:function(t){var e=this.route.params.id;d.setPushSwitch(e,t)},setLeaveMsgSwitch:function(t){var e=this.route.params.id;d.setLeaveMsgSwitch(e,t)},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/contact/memo",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button class="btn_xs" disabled=\'{text==origin||!text}\' sn-tap="this.save()">保存</button></div> </header> <div class="main" ref="main"> <div class="ct_memo__input bd_tb"> <input type="text" sn-model="text" value="{text}" ref="text" /> <div class="icon-reset" sn-tap="text=\'\'"></div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/contact/memo",["css/app.css","css/append.css","logical/contact","models/friends"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,l=(t("promise"),t("widget/toast")),h=(t("widget/popup"),t("logical/contact")),d=t("models/friends").getFriends();n.exports=r.extend({onCreate:function(){var t=this,e=this.route.params.id,n=this.loader=new a(this.$el),i=d.find("user_id",e),s=i.get("friends_ext.memo"),r=this.model=new o(this.$el,{title:"备注",text:s,origin:s});r.save=function(){n.showLoading();var t=this.get("text");h.setFriendMemo(e,t).then(function(){l.showToast("修改成功！"),r.back()})["catch"](function(t){l.showToast(t.message)}).then(function(){n.hideLoading()})},r.back=function(){t.back(t.swipeRightBackAction)}},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/contact/chat",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <button class="head_back" sn-tap="this.back()"></button> <div class="head_title">{friend.name_for_show}</div> </header> <div class="main ct_chat" ref="main"> <div class="refreshing" sn-if="showMore"> <p class="loading" sn-if="showMoreLoading"></p> <p class="msg">{moreMsg}</p> </div> <div class="ct_chat__item flex_t {item.from_id==user.user_id?\'curr flex_re\':\'\'} {item.type==5||item.type==4||item.type==3?\'ct_chat__redbag\':\'\'}" sn-repeat="item in messages"> <div class="date" sn-if="item.isShowTime">{util.formatDate(item.add_date,\'minutes\')}</div> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(item.from_id==user.user_id?user.avatars:friend.avatars)}" class="sqr_d"> <div class="con"> <div sn-if="item.type==1" class="fs_m">{item.content}</div> <img sn-else-if="item.type==2" sn-src="{sl.resource(item.content)}" /> <div sn-else-if="item.type==3" class="fs_m" data-forward="/yunmi/trade/{item.content.trade_id}"> <div class="ym-send2-rem cl_fff of_h"> <p class="fl_r pl_s ym_redbag__amount">{Math.abs(item.content.amount)}云米 <span class="dp_b fs_s">{item.content.memo||\'恭喜发财，大吉大利！\'}</span></p> </div> <p class="ct_chat__redbag_ft">云米转赠</p> </div> <div sn-else-if="item.type==4" class="fs_m" data-forward="/yunmi/trade/{item.content.trade_id}"> <div class="ym-receive-rem cl_fff of_h"> <p class="fl_r pl_s ym_redbag__amount">已收钱 <span class="dp_b fs_s">{Math.abs(item.content.amount)}云米</span></p> </div> <p class="ct_chat__redbag_ft">云米转赠</p> </div> <div sn-else-if="item.type==5" class="fs_m" data-forward="/yunmi/trade/{item.content.trade_id}"> <div class="ym-redbag3-rem cl_fff of_h"> <p class="fl_r pl_s">{item.content.memo||\'恭喜发财，大吉大利！\'} <span class="dp_b fs_s">领取红包</span></p> </div> <p class="ct_chat__redbag_ft">云米红包</p> </div> <div sn-else-if="item.type==6" class="fs_m">已领取红包</div> </div> </div> <div class="pt_l"></div> </div> <div class="ct_chat__footer dock_blr flex bd_t h_l"> <button class="icon-face"></button> <form class="ct_chat__textbox flexitem ml_m" ref="send"><input sn-model="content" value="{content}" type="text" ref="text" sn-focus="this.scrollToEnd()" /></form> <button class="send pd_m bg_trans fs_m cl_333" disabled="{!content}" sn-tap="this.send()">发送</button> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/contact/chat",["css/app.css","css/append.css","logical/chat","models/user","models/friends"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/chat")),h=t("models/user"),p=t("models/friends");n.exports=r.extend({onCreate:function(){var t=this,e=this.route.params.id,n=p.getFriend(e),s=this.model=new o(this.$el,{messages:[],friend:n});this.sendResult=this.sendResult.bind(this),this.newMessage=this.newMessage.bind(this),d.on("sendresult"+e,this.sendResult).on("message:"+e,this.newMessage),s.back=function(){t.back(t.swipeRightBackAction)},s.send=function(){var n=this.data.content;if(n){var i=s._("messages"),r={gid:d.getGid(),type:d.MESSAGETYPE.TEXT,content:n,to_id:e,from_id:h.get("user_id"),is_show_time:!1};i.add(r),s.set({content:""}).next(function(){t.scroll&&t.scroll.scrollToEnd()}),d.send(r)["catch"](function(t){i.remove("gid",r.gid),l.showToast(t.message)})}};var i=this.loader=new a(this.$el);i.showLoading(),s.refs.send.onsubmit=function(){s.send()},c.all([d.getMessages(e),this.waitLoad()]).then(function(i){var r=i[0];if(!r.user)return void t.replaceWith("/contact/person/"+e);var a=d.formatMessages(r.data),o=t.scroll=t.bindScrollTo(s.refs.main).eq(0),c=function(t,n){if(0==o.scrollTop()){var i=n.scrollHeight-n.y;s.set({showMore:!0,showMoreLoading:!0,moreMsg:"正在加载..."}),d.getMessages(e,s.get("messages")[0].msg_id).then(function(t){t.data&&t.data.length?(s._("messages").insert(0,d.formatMessages(t.data)),s.next(function(){o.scrollTop(o.scrollHeight()-i)})):(o.$el.off("scrollStop",c),s.set({showMoreLoading:!1,moreMsg:"没有更多消息了"}))})}};o.$el.on("scrollStop",c),delete r.user.friends_ext,n.set(r.user),s.set({user:h,messages:a}).next(function(){o.scrollToEnd()}),s.scrollToEnd=function(){t.scroll.scrollToEnd()}})["catch"](function(t){l.showToast(t.message)}).then(function(){i.hideLoading()})},onShow:function(){d.readMessage(this.route.params.id)},onDestroy:function(){var t=this.route.params.id;d.off("sendresult:"+t,this.sendResult).off("message:"+t,this.newMessage),this.model.destroy()},sendResult:function(t,e){this.model._("messages").find("gid",e.gid).set({msg_id:msg_id})},newMessage:function(t,e){var n=this;this.model._("messages").add(e),this.model.next(function(){n.scroll.scrollToEnd()}),"Pause"!=this.status&&d.readMessage(this.route.params.id)}})});define("template/contact/friend_valid",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button class="btn_xs" sn-tap="this.addFriend()">发送</button></div> </header> <div class="main" ref="main"> <div class="fs_m pt_m pl_m">你需要发送验证申请，等对方通过</div> <div class="ct_memo__input bd_tb"> <input type="text" sn-model="msg" ref="text" value="{msg}" /> <div class="icon-reset" sn-tap="msg=\'\'"></div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/contact/friend_valid",["css/app.css","css/append.css","logical/contact","models/user"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/contact")),h=t("models/user");n.exports=r.extend({onCreate:function(){var t=this,e=this.route.params.friend_id,n=this.model=new o(this.$el,{title:"朋友验证",msg:"我是"+(h.get("user_name")||"")});n.back=function(){t.back(t.swipeRightBackAction)},n.addFriend=function(){d.addFriend(e).then(function(){l.showToast("发送成功"),d.trigger("addFriend"),n.back()})["catch"](function(t){l.showToast(t.message)})};var s=this.loader=new a(this.$el);s.showLoading(),c.all([this.waitLoad()]).then(function(e){t.bindScrollTo(n.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/person",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main fs_m"> <div class="bd_tb flex mt_l bg_fff pt_m pb_m" sn-tap="this.changeAvatars()"> <p class="flexitem ml_m">头像</p> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(user.avatars)}" class="g_avatars dp_b mr_m"> </div> <ul class="mt_l bg_fff pt_1"> <li class="bd_b lh_bar h_bar pl_m pr_m g_arrow" data-forward="/user/qrcode"> 二维码名片 </li> <li class="bd_b lh_bar h_bar pl_m pr_m flex" data-forward="/user/set/user_name"> <p class="flexitem">昵称</p> <p class="ta_r">{user.user_name}</p> </li> </ul> <ul class="mt_l bg_fff pt_1"> <li class="bd_b lh_bar h_bar pl_m pr_m flex" data-forward="/user/set/sign_text"> <p class="flexitem">个性签名</p> <p class="ta_r">{user.sign_text}</p> </li> <li class="bd_b lh_bar h_bar pl_m pr_m flex" data-forward="/user/set/gender"> <p class="flexitem">性别</p> <p class="ta_r">{user.gender==1?\'男\':\'女\'}</p> </li> </ul> <ul class="mt_l bg_fff pt_1"> <li class="bd_b lh_bar h_bar pl_m pr_m flex" data-forward="/user/set/hometown"> <p class="flexitem">家乡</p> <p class="ta_r">{user.home_country_name}{user.home_province_name}{user.home_city_name}</p> </li> <li class="bd_b lh_bar h_bar pl_m pr_m flex" data-forward="/user/set/address"> <p class="flexitem">地区</p> <p class="ta_r">{user.country_name}{user.province_name}{user.city_name}</p> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/person",["css/app.css","css/append.css","models/user","components/imagePicker","logical/user"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),o=(t("widget/loader"),t("core/model2").Model),c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("models/user")),h=t("components/imagePicker"),p=t("logical/user");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"个人资料",user:d});e.back=function(){t.back(t.swipeRightBackAction)},e.changeAvatars=function(){h.show("更换头像",function(t){p.setAvatars(t.id),d.set({avatars:t.thumbnail})})},c.all([this.waitLoad()]).then(function(n){t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/qrcode",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main"> <div class="uc_qrcode ta_c" sn-html="qrcode"></div> <div class="mt_l ta_c fs_m">用八闽生活扫一扫二维码，加我好友</div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/qrcode",["css/app.css","css/append.css","models/user"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),o=(t("widget/loader"),t("core/model2").Model),c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("models/user")),h=t("utils/qrcode");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"我的二维码",qrcode:h.create_qrcode("cmccfj://user/"+d.get("user_id"),{width:4,margin:1})});e.back=function(){t.back(t.swipeRightBackAction)},c.all([this.waitLoad()]).then(function(n){t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/fav",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main"> <ul class="bd_t uc_fav mt_l"> <li class="bd_b flex_t bg_fff uc_fav__item" sn-repeat="item in data" data-forward="{item.fav_type==1?\'/pubquan/article/\'+item.pub_quan_msg.msg_id:null}"> <p class="img avatars"><img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(item.fav_type==2?item.quan_msgs.avatars:item.pub_quan_msg.quan_pic)}" class="dp_b" /></p> <div class="con flexitem mt_m fs_m"> <p class="name">{item.fav_type==2?item.quan_msgs.user_name:item.pub_quan_msg.quan_name}</p> <div class="summary" sn-html="{item.fav_type==2?item.quan_msgs.content:item.pub_quan_msg.title}"></div> <ul class="clearfix" sn-if="item.pub_quan_msg.imgs.length"> <li class="fl_l mr_m mt_m thumb" sn-repeat="img in item.pub_quan_msg.imgs"><img sn-src="{sl.thumbnail(img)}" class="g_img" /></li> </ul> <ul class="clearfix" sn-else-if="item.quan_msgs.imgs.length"> <li class="fl_l mr_m mt_m" sn-repeat="img,i in item.quan_msgs.imgs" sn-tap="this.showImages(item.quan_msgs.imgs,i)"><img sn-src="{sl.thumbnail(img)}" class="g_img" /></li> </ul> </div> <p class="date">{util.formatDate(item.pub_quan_msg?item.pub_quan_msg.add_date:item.quan_msgs.add_date,\'short\')}</p> <p class="icon-del" sn-tap="this.del(item.fav_id)"></p> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/fav",["css/app.css","css/append.css","widget/photoViewer","logical/user"],function(t,e,n){var s=t("$"),r=(t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("widget/photoViewer")),h=t("logical/user");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"我的收藏"});e.back=function(){t.back(t.swipeRightBackAction)},e.del=function(t){return h.delFav(t).then(function(){e._("data").remove("fav_id",t)})["catch"](function(t){l.showToast(t.message)}),!1};var n=this.photoViewer=new d;n.$el.hide().appendTo("body").addClass("g_beforeshow").on(s.fx.transitionEnd,function(){n.$el.hasClass("g_show")||n.$el.hide()}).on("tap",function(){n.$el.removeClass("g_show")}),e.showImages=function(t,e){n.setImages(t.map(function(t){return{src:sl.resource(t)}})),n.index(e),n.$el.show()[0].clientHeight,n.$el.addClass("g_show")},a.showLoading(),c.all([h.getFav(),this.waitLoad()]).then(function(n){var s=n[0].data;s.forEach(function(t){if(t.pub_quan_msg){var e;t.pub_quan_msg.imgs&&(e=t.pub_quan_msg.imgs.split(",")),e&&e.length||!/<img\s+/.test(t.pub_quan_msg.content)||(e=[],t.pub_quan_msg.content.replace(/<img\s[^>]*?src=\"([^\"\>]+)\"/g,function(t,n){e.push(n)})),e&&e.length>3&&(e.length=3),t.pub_quan_msg.imgs=e}else t.quan_msgs&&t.quan_msgs.imgs&&(t.quan_msgs.imgs=t.quan_msgs.imgs.split(","))}),e.set({data:s}),t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){a.hideLoading()})},onShow:function(){},onDestroy:function(){this.photoViewer.$el.remove(),this.photoViewer.destroy(),this.model.destroy()}})});define("template/user/like",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main"> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/like",["css/app.css","css/append.css"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),o=(t("widget/loader"),t("core/model2").Model),c=t("promise"),l=t("widget/toast");t("widget/popup");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"我的喜好"});e.back=function(){t.back(t.swipeRightBackAction)},c.all([this.waitLoad()]).then(function(n){t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/messages",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button sn-tap="this.clear()">清除</button></div> </header> <div ref="main" class="main bg_fff"> <ul class="uc_messages__head flex fs_m"> <li class="{type==0?\'curr new\':\'\'} flexitem" sn-tap="type=0"><span class="va_m">活动消息</span></li> <li class="{type==1?\'curr\':\'\'} flexitem" sn-tap="type=1"><span class="va_m">系统消息</span></li> </ul> <div class="mt_l bd_t fs_m uc_messages__bd dock_blr" sn-display="type==0" ref="messages"> <ul> <li sn-repeat="item in messages" class="uc_messages__item bd_b"> <p class="title unread mt_s">{item.title}</p> <p class="summary cl_999 fs_s to_e mr_l">{item.summary}</p> <p class="date cl_999 fs_s">{util.formatDate(item.date,\'yyyy-MM-dd\')}</p> </li> </ul> </div> <div class="mt_l bd_t fs_m uc_messages__bd dock_blr" sn-display="type==1" style="display:none" ref="system"> <ul> <li sn-repeat="item in sysmessages" class="uc_messages__item bd_b"> <p class="title unread mt_s">{item.title}</p> <p class="summary cl_999 fs_s to_e mr_l">{item.summary}</p> <p class="date cl_999 fs_s">{util.formatDate(item.date,\'yyyy-MM-dd\')}</p> </li> </ul> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/messages",["css/app.css","css/append.css","logical/user"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),o=(t("widget/loader"),t("core/model2").Model),c=t("promise"),l=t("widget/toast"),u=t("widget/popup"),d=t("logical/user");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"我的消息"});e.back=function(){t.back(t.swipeRightBackAction)},e.clear=function(){u.confirm({title:"温馨提示",content:"确认清除消息？",confirmText:"确定删除",confirmAction:function(){this.hide(),e.set({messages:[],sysmessages:[]})},cancelText:"取消",cancelAction:function(){}})},e.on("viewDidUpdate",function(){1!=this.attributes.type||e.refs.system.scroll||t.bindScrollTo(e.refs.system)}),c.all([d.getMessages(),d.getMessages("system"),this.waitLoad()]).then(function(n){e.set({messages:n[0].data,sysmessages:n[1].data}),t.bindScrollTo(e.refs.messages)})["catch"](function(t){l.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/settings",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main pt_l"> <ul class="fs_m uc_settings__items"> <li class="bd_tb g_arrow bg_fff" data-forward="/user/fav"> 我的收藏 </li> <li class="bd_b g_arrow bg_fff" data-forward="/user/messages"> 我的消息 </li> <li class="bd_b g_arrow bg_fff" data-forward="/user/qa"> 常见问题 </li> <li class="bd_b g_arrow bg_fff" data-forward="/user/remind"> 提醒设置 </li> <li class="bd_b g_arrow bg_fff" data-forward="/user/privacy"> 隐私设置 </li> <li class="bd_b bg_fff" sn-tap="this.clearCache()"> <span class="va_m">清除缓存</span> </li> <li class="bd_b mb_l bg_fff" sn-tap="this.update()"> <span class="va_m">检测更新</span> </li> <li class="bd_tb g_arrow bg_fff" data-forward="/user/about"> <span class="va_m">关于</span> </li> <li class="bd_b bg_fff" sn-tap="this.logout()"> <span class="va_m">退出登录</span> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/settings",["css/app.css","css/append.css","models/user","logical/auth","logical/user"],function(t,e,n){var i=(t("$"),t("util")),r=t("activity"),a=t("bridge"),c=(t("widget/loader"),t("core/model2").Model),l=t("promise"),u=t("widget/toast"),d=t("widget/popup"),h=t("models/user"),p=t("logical/auth"),f=t("logical/user");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new c(this.$el,{title:"设 置"});e.back=function(){t.back(t.swipeRightBackAction)},Object.assign(e,{clearCache:function(){u.showToast("清除成功")},update:function(){f.getLatestVersion().then(function(t){t&&t.data||d.alert({content:'<p class="ta_c">已经是最新版本，无需更新</p>'})})},logout:function(){d.confirm({content:'<p class="ta_c">确定退出当前帐号吗</p>',confirmAction:function(){this.hide(),t.setResult("LOGOUT"),h.set(null),p.clearAuth(),i.store("friends",null),i.store("user",null),i.store("business_model",null),i.store("messagesList",null),i.store("device_token",null),a.cmcc.logout(),application.back("/login")}})}}),l.all([this.waitLoad()]).then(function(n){t.bindScrollTo(e.refs.main)})["catch"](function(t){u.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/mybusiness",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main pt_m" ref="main"> <ul class="bd_t pt_1"> <li sn-repeat="item in list" sn-tap="item.onClick()" class="flex h_bar bg_fff bd_b pl_m"><p class="{item.icon}"></p> <p class="flex_1 pl_l">{item.text}</p></li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/mybusiness",["css/app.css","css/append.css","logical/business"],function(t,e,n){var s=t("$"),r=(t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),u=t("widget/popup"),d=t("logical/business");n.exports=r.extend({onCreate:function(){var t=this,e=this.route.params.type,n={};switch(e){case"space":n.title="我的空间",n.list=[{icon:"user-backup",text:"联系人备份",onClick:function(){t.forward("/contact/backup")}},{icon:"user-hdh",text:"一卡多号",onClick:function(){t.forward("/hdh/call")}},{icon:"user-139",text:"我的邮箱",onClick:function(){d.redirect.enterMail139()}},{icon:"user-hly",text:"语音信箱",onClick:function(){d.redirect.enterHLY()}}];break;case"family":n.title="我的家庭",n.list=[{icon:"user-tv",text:"电视直播",onClick:function(){s(window).trigger("tabchange_to_2"),i.back()}}];break;case"wallet":n.title="我的钱包",n.list=[{icon:"user-hjb",text:"理财",onClick:function(){d.redirect.enterHjb()}},{icon:"user-shopping",text:"购物",onClick:function(){d.redirect.enterSc()}}];break;case"life":n.title="我的钱包",n.list=[{icon:"user-jiaofei",text:"水电查询",onClick:function(){t.forward("/life/bill/100005")}},{icon:"user-job2",text:"求职招聘",onClick:function(){d.redirect.enterQz()}},{icon:"user-mobile",text:"话费充值",onClick:function(){u.alert({content:"暂未开通"})}}]}var i=this.model=new o(this.$el,n);i.delegate=this,i.back=function(){t.back(t.swipeRightBackAction)};var r=this.loader=new a(this.$el);r.showLoading(),c.all([this.waitLoad()]).then(function(e){t.bindScrollTo(i.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){r.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/set",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button sn-tap="this.save()">保存</button></div> </header> <div ref="main" class="main"> <div class="mt_l bd_tb bg_fff flex h_bar" sn-if="type==\'user_name\'"> <input type="text" sn-model="user_name" value="{user_name}" class="flexitem ml_m fs_m" /> <div class="icon-x dock_r pd_m" sn-if="user_name" sn-tap="user_name=\'\'"></div> </div> <div class="mt_l flex uc_set__sign" sn-if="type==\'sign_text\'"> <textarea class="bg_fff flexitem" rows="7" value="{sign_text}" sn-model="sign_text"></textarea> </div> <ul class="mt_l bd_tb bg_fff uc_set__gender" sn-if="type==\'gender\'"> <li class="h_bar lh_bar pl_m bd_b" sn-tap="gender=1"> <i class="icon-right fl_r mr_m" sn-if="gender==1"></i> 男 </li> <li class="h_bar lh_bar pl_m" sn-tap="gender=2"> <i class="icon-right fl_r mr_m" sn-if="gender==2"></i> 女 </li> </ul> <ul class="mt_l bd_tb bg_fff uc_set__gender" sn-if="type==\'hometown\'" sn-tap="this.selectCity()"> <li class="h_bar lh_bar pl_m bd_b"> <i class="fl_r mr_m">{country_name}</i> 国家 </li> <li class="h_bar lh_bar pl_m"> <i class="fl_r mr_m">{province_name}—{city_name}</i> 省市 </li> </ul> <ul class="mt_l bd_tb bg_fff uc_set__gender" sn-if="type==\'address\'" sn-tap="this.selectCity()"> <li class="h_bar lh_bar pl_m bd_b"> <i class="fl_r mr_m">{country_name}</i> 国家 </li> <li class="h_bar lh_bar pl_m"> <i class="fl_r mr_m">{province_name}—{city_name}</i> 省市 </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/set",["css/app.css","css/append.css","models/user","logical/user","logical/district"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),o=(t("widget/loader"),t("core/model2").Model),c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("models/user")),h=t("logical/user"),p=t("logical/district"),f=t("widget/selector");n.exports=r.extend({onCreate:function(){var t=this,e=this.route.params.type,n=this.model=new o(this.$el,{user:d,type:e});switch(e){case"user_name":n.set("user_name",d.get("user_name"));break;case"sign_text":n.set({title:"个人签名",sign_text:d.get("sign_text")});break;case"gender":n.set({title:"性别",gender:d.get("gender")});break;case"hometown":n.set({title:"故乡",country_name:d.get("home_country_name"),province_name:d.get("home_province_name"),city_name:d.get("home_city_name")});var s=t.selector=new f({options:[{template:"<li><%=country_name%></li>",onChange:function(t,e){p.getProvinces(e.country_id).then(function(t){s.eq(1).set(t.data),d.get("province_id")&&sel.val("province_id",d.get("province_id"))})}},{template:"<li><%=province_name%></li>",onChange:function(t,e){p.getCities(e.province_id).then(function(t){var e=s.eq(2).set(t.data);d.get("city_id")&&e.val("city_id",d.get("city_id"))})}},{template:"<li><%=city_name%></li>",onChange:function(t,e){}}],complete:function(t){n.set({country_id:t[0].country_id,country_name:t[0].country_name,province_id:t[1].province_id,province_name:t[1].province_name,city_id:t[2].city_id,city_name:t[2].city_name})}});p.getCountries().then(function(t){var e=s.eq(0).set(t.data);d.get("country_id")&&e.val("country_id",d.get("country_id"))}),n.selectCity=function(){s.show()};break;case"address":n.set({title:"所在地",country_name:d.get("country_name"),province_name:d.get("province_name"),city_name:d.get("city_name")});var s=t.selector=new f({options:[{template:"<li><%=country_name%></li>",onChange:function(t,e){p.getProvinces(e.country_id).then(function(t){s.eq(1).set(t.data),d.get("province_id")&&sel.val("province_id",d.get("province_id"))})}},{template:"<li><%=province_name%></li>",onChange:function(t,e){p.getCities(e.province_id).then(function(t){var e=s.eq(2).set(t.data);d.get("city_id")&&e.val("city_id",d.get("city_id"))})}},{template:"<li><%=city_name%></li>",onChange:function(t,e){}}],complete:function(t){n.set({country_id:t[0].country_id,country_name:t[0].country_name,province_id:t[1].province_id,province_name:t[1].province_name,city_id:t[2].city_id,city_name:t[2].city_name})}});p.getCountries().then(function(t){var e=s.eq(0).set(t.data);d.get("country_id")&&e.val("country_id",d.get("country_id"))}),n.selectCity=function(){s.show()}}n.back=function(){t.back(t.swipeRightBackAction)},n.save=function(){var t;switch(e){case"user_name":t=h.set("user_name",this.get("user_name"));break;case"sign_text":t=h.set("sign_text",this.get("sign_text"));break;case"gender":t=h.set("gender",this.get("gender"));break;case"hometown":if(!this.get("city_id"))return void l.showToast("未做修改");t=h.set("home_city_id",this.get("city_id")).then(function(){d.set({home_city_name:n.get("city_name"),home_province_id:n.get("province_id"),home_province_name:n.get("province_name"),home_country_id:n.get("country_id"),home_country_name:n.get("country_name")})});break;case"address":if(!this.get("city_id"))return void l.showToast("未做修改");t=h.set("city_id",this.get("city_id")).then(function(){d.set({city_name:n.get("city_name"),province_id:n.get("province_id"),province_name:n.get("province_name"),country_id:n.get("country_id"),country_name:n.get("country_name")})})}t.then(function(){n.back()})["catch"](function(t){l.showToast(t.message)})},c.all([this.waitLoad()]).then(function(e){t.bindScrollTo(n.refs.main)})["catch"](function(t){l.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/remind",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main uc_remind"> <div sn-repeat="service in data"> <div class="mt_l ml_l">{service.name}</div> <ul class="mt_m bg_fff pt_1 fs_m"> <li sn-repeat="item in service.group" class="bd_b h_l flex pl_m pr_m g_arrow" data-forward="/user/remind/{item.business_id}"> <img class="w_s" sn-src="{sl.thumbnail(item.business_pic)}" /> <div class="con ml_l"> <p class="name">{item.business_name}</p> <p class="state cl_999 fs_s mt_s">{!item.switcher||item.switcher.charAt(0)==\'1\'?\'开\':\'关\'}</p> </div> </li> </ul> </div> <div class="pd_m"></div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/remind",["css/app.css","css/append.css","logical/business"],function(t,e,n){var i=(t("$"),t("util")),r=t("activity"),o=(t("widget/loader"),t("core/model2").Model),l=(t("promise"),t("widget/toast")),d=(t("widget/popup"),t("logical/business"));n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"提醒设置"});e.back=function(){t.back(t.swipeRightBackAction)},t.bindScrollTo(e.refs.main)},onShow:function(){var e=this.model;d.getBusinessWithSettings().then(function(t){var n=i.groupBy("type",t.data),s={1:"移动提醒",2:"生活提醒",3:"娱乐提醒",4:"社交提醒"};n.forEach(function(t){t.name=s[t.key.type]}),e.set({data:n})})["catch"](function(t){l.showToast(t.message)})},onDestroy:function(){this.model.destroy()}})});define("template/user/remind_one",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main pt_l"> <ul class="fs_m bg_fff mb_l"> <li class="flex bd_tb lh_bar h_bar pl_m pr_m"> <p class="flexitem">允许通知</p> <p class="mr_m cp_switch{switcher.charAt(0) === \'1\'?\' cp_switch_on\':\'\'}" sn-tap="delegate.setSwitcher(0)"></p> </li> </ul> <ul class="pt_1 fs_m bg_fff bd_t" sn-if="switcher.charAt(0) === \'1\'"> <li class="flex bd_tb lh_bar h_bar pl_m pr_m"> <p class="flexitem">在“提醒”中显示</p> <p class="mr_m cp_switch{switcher.charAt(0) === \'1\'&&switcher.charAt(1) === \'1\'?\' cp_switch_on\':\'\'}" sn-tap="delegate.setSwitcher(1)"></p> </li> <li class="flex bd_tb lh_bar h_bar pl_m pr_m"> <p class="flexitem">在“通知中心”中显示</p> <p class="mr_m cp_switch{switcher.charAt(0) === \'1\'&&switcher.charAt(2) === \'1\'?\' cp_switch_on\':\'\'}" sn-tap="delegate.setSwitcher(2)"></p> </li> <li class="flex bd_tb lh_bar h_bar pl_m pr_m"> <p class="flexitem">在“手机短信”中显示</p> <p class="mr_m cp_switch{switcher.charAt(0) === \'1\'&&switcher.charAt(3) === \'1\'?\' cp_switch_on\':\'\'}" sn-tap="delegate.setSwitcher(3)"></p> </li> <li class="flex bd_tb lh_bar h_bar pl_m pr_m"> <p class="flexitem">声音</p> <p class="mr_m cp_switch{switcher.charAt(0) === \'1\'&&switcher.charAt(4) === \'1\'?\' cp_switch_on\':\'\'}" sn-tap="delegate.setSwitcher(4)"></p> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/remind_one",["css/app.css","css/append.css","../../logical/business","../../models/business"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),o=(t("widget/loader"),t("core/model2").Model),d=(t("promise"),t("widget/toast"),t("widget/popup"),t("../../logical/business")),h=t("../../models/business");n.exports=r.extend({onCreate:function(){var t=this,e=this.route.params.business_id,n=h.find(e),s=n.get(),i=s.switcher||"1111100000";this.business_id=e,this.businessItem=n;var r=this.model=new o(this.$el,{switcher:i,title:s.business_name+"设置"});r.delegate=this,r.back=function(){t.back(t.swipeRightBackAction)}},onShow:function(){},setSwitcher:function(t){var e=this,n=this.model,s=n.get("switcher"),i=s.charAt(t),r=s.substr(0,t),a=s.substr(t+1);s=r+("1"===i?"0":"1")+a,d.setBussnessSetting(this.business_id,s).then(function(){e.businessItem.set({switcher:s}),n.set({switcher:s})})},onDestroy:function(){this.model.destroy()}})});define("template/user/privacy",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main"> <div class="mt_m ml_m fs_m cl_999">通讯录</div> <ul class="mt_s bd_t bg_fff pt_1 fs_m"> <li class="bd_b lh_bar h_bar pl_m pr_m flex"> <p class="flexitem">加我为好友时需要验证</p> <div class="cp_switch{valid_new_friend==1?\' cp_switch_on\':\'\'}" sn-tap="this.update(\'valid_new_friend\')"></div> </li> </ul> <div class="mt_s ml_m mr_m fs_m cl_999">开启后，别人加我为朋友时需进行验证，通过才能成为好友</div> <ul class="mt_l bd_t bg_fff pt_1 fs_m"> <li class="bd_b lh_bar h_bar pl_m pr_m flex"> <p class="flexitem">通过昵称、和生活ID搜索到我</p> <div class="cp_switch{can_search_me==1?\' cp_switch_on\':\'\'}" sn-tap="this.update(\'can_search_me\')"></div> </li> </ul> <div class="mt_s ml_m mr_m fs_m cl_999">关闭后，别人将不能通过手机号搜索到你</div> <ul class="mt_l bd_t bg_fff pt_1 fs_m"> <li class="bd_b lh_bar h_bar pl_m pr_m flex"> <p class="flexitem">不让他（她）通过和生活拨号给我</p> <div class="cp_switch{can_someone_call_me==1?\' cp_switch_on\':\'\'}" sn-tap="this.update(\'can_someone_call_me\')"></div> </li> <li class="bd_b lh_bar h_bar pl_m pr_m flex"> <p class="flexitem">允许陌生人拨号给我</p> <div class="cp_switch{can_call_me==1?\' cp_switch_on\':\'\'}" sn-tap="this.update(\'can_call_me\')"></div> </li> </ul> <div class="mt_m ml_m fs_m cl_999">朋友圈</div> <ul class="mt_s bg_fff pt_1 fs_m"> <li class="bd_b lh_bar h_bar pl_m pr_m g_arrow" data-forward="/user/quan_privacy/1"> 不让他（她）看我的朋友圈 </li> <li class="bd_b lh_bar h_bar pl_m pr_m g_arrow" data-forward="/user/quan_privacy/2"> 不看他（她）的朋友圈 </li> </ul> <ul class="mt_l bd_t bg_fff pt_1 fs_m"> <li class="bd_b lh_bar h_bar pl_m pr_m flex"> <p class="flexitem">允许陌生人查看十张照片</p> <div class="cp_switch{can_see_some==1?\' cp_switch_on\':\'\'}" sn-tap="this.update(\'can_see_some\')"></div> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/privacy",["css/app.css","css/append.css","logical/user"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/user"));n.exports=r.extend({onCreate:function(){var t=this,e=this.loader=new a(this.$el);e.showLoading();var n=this.model=new o(this.$el,{title:"隐私设置"});n.back=function(){t.back(t.swipeRightBackAction)},n.update=function(t){var n=this.get(t);n=1==n?2:1,e.showLoading(),this.set(t,n),d.updateExt(t,n)["catch"](function(t){l.showToast(t.message)}).then(function(){e.hideLoading()})},c.all([d.getPrivacy(),this.waitLoad()]).then(function(e){var s=e[0];n.set(s.data),t.bindScrollTo(n.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){e.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/quan_privacy",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main" ref="main"> <ul class="of_h"> <li class="fl_l ml_m mt_m ps_r" sn-repeat="item in data"> <img onerror="this.src=\'images/default.jpg\'" class="sqr_l dp_b" sn-src="sl.thumbnail(item.avatars)" /> <p class="name ta_c to_e fs_m">{item.user_name}</p> <div class="del_icon" sn-tap="this.del(item)"></div> </li> <li class="sqr_l bd_ddd icon-add2 fl_l flex jc_c br_4 ml_m mt_m" sn-tap="this.selectUser()"></li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/quan_privacy",["css/app.css","css/append.css","logical/quan","models/friends"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/quan")),h=t("models/friends");n.exports=r.extend({onCreate:function(){var t=this,e=this.type=this.route.params.type,n=this.model=new o(this.$el,{title:2==e?"不看他（她）的朋友圈":"不让他（她）看我的朋友圈"});n.back=function(){t.back(t.swipeRightBackAction)},n.del=function(t){n._("data").remove("user_id",t.user_id),d.deleteQuanBlack(t.black_id)},n.selectUser=function(){t.forward("/quan/select_user",{type:e,friends:n.get("data"),onSelect:function(t){var s=n.get("data"),i=[];t.forEach(function(t){for(var n=!1,r=0,a=s.length;a>r;r++){var o=s[r];if(o.user_id==t.user_id){n=!0;break}}n||(d.addQuanBlack(t.user_id,e),i.push({user_id:t.user_id,user_name:h.getUserShowName(t),avatars:t.avatars}))}),n._("data").add(i)}})};var s=this.loader=new a(this.$el);s.showLoading(),c.all([d.getQuanBlack(e),this.waitLoad()]).then(function(e){var s=e[0],i=s.data||[];i.forEach(function(t){t.user_id=t.friend_id}),n.set("data",i),s.friends&&s.friends.forEach(function(t){n._("data").update({user_id:t.user_id,avatars:t.avatars,user_name:h.getUserShowName(t)},"user_id")}),t.bindScrollTo(n.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()},add:function(){this.loader}})});define("template/user/wallet",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main" ref="main"> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/wallet",["css/app.css","css/append.css"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast");t("widget/popup");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"我的钱包"});e.delegate=this,e.back=function(){t.back(t.swipeRightBackAction)};var n=this.loader=new a(this.$el);n.showLoading(),c.all([this.waitLoad()]).then(function(n){t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){n.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/qa",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main"> <div class="ml_m mr_m mt_l flexitem flex uc_qa__search"> <div class="icon-search sqr_s"></div> <input sn-model="keywords" type="text" class="flexitem fs_m" placeholder="搜索常见问题"> </div> <ul class="mt_s pt_1 fs_m"> <li class="bd_b mt_m bg_fff" sn-repeat="item in data|filter:contains(item.title,keywords)"> <div class="bd_t pl_m pr_m lh_bar h_bar fs_l">{item.title}</div> <div class="pl_m pr_m lh_xs pb_m" sn-html={item.content}></div> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/qa",["css/app.css","css/append.css","logical/news"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),o=(t("widget/loader"),t("core/model2").Model),c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/news"));n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"常见问题"});e.back=function(){t.back(t.swipeRightBackAction)},c.all([d.getCategoryAllNews(10002),this.waitLoad()]).then(function(n){var s=n[0];e.set({data:s.data}),t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/user/about",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div ref="main" class="main pd_m" sn-html="{data.content}"> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/user/about",["css/app.css","css/append.css","logical/news"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),o=(t("widget/loader"),t("core/model2").Model),c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/news"));n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"关于"});e.back=function(){t.back(t.swipeRightBackAction)},c.all([d.getCategoryAllNews(5),this.waitLoad()]).then(function(n){var s=n[0];e.set({data:s.data[0]}),t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/life/notice",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header class="flex"> <div class="head_back ps_r" sn-tap="this.back()"></div> <div class="flexitem flex lf_notice__search" data-forward="/life/search_notice"> <div class="icon-search sqr_s"></div> <p class="fs_m pt_1 dp_b cl_ccc">搜索：活动、业务、生活</p> </div> <div class="sqr_44 icon-edit"> </div> </header> <div class="main" ref="main"> <div class="bg_fff pb_m bd_b"> <div class="lh_bar fs_m ml_m mr_m bd_b cl_666 mb_m">提醒标签</div> <ul class="lf_notice__tags of_h"> <li class="fl_l mb_m ml_m g_tag" sn-repeat="tag in tags">{tag.tag_name}</li> </ul> </div> <div class="pt_m flex ta_c lf_notice__tab"> <p class="lf_notice__tab_title flex_0{tab==0?\' curr\':\'\'}">移动业务提醒</p> <p class="lf_notice__tab_title flex_0{tab==1?\' curr\':\'\'}">生活服务提醒</p> </div> <ul class="lf_notice__tab_con bg_fff bd_t" sn-if="tab==0"> <li class="flex lh_m h_m bd_b" sn-repeat="item in bisNoticeList"> <a href="javascript:;" class="flex_0 pl_m">{item.title}</a> <i class="icon-tag"></i> </li> </ul> <ul class="lf_notice__tab_con bg_fff bd_t" sn-if="tab==1"> <li class="flex lh_m h_m bd_b" sn-repeat="item in bisNoticeList"> <a href="javascript:;" class="flex_0 pl_m">{item.title}</a> <i class="icon-tag"></i> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/life/notice",["css/app.css","css/append.css"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast");t("widget/popup");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"标题",tags:[{tag_id:1,tag_name:"asdf"},{tag_id:2,tag_name:"asdasf"}],bisNoticeList:[{title:"fasdfasf"}]});e.back=function(){t.back(t.swipeRightBackAction)};var n=this.loader=new a(this.$el);n.showLoading(),c.all([this.waitLoad()]).then(function(n){t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){n.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/life/search_notice",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header class="flex"> <form ref="searchform" class="ml_m flexitem flex hm_quan__search"> <div class="icon-search sqr_s"></div> <input type="search" sn-model="search" ref="search" class="flexitem fs_m" placeholder="搜索：活动、业务、生活" /> </form> <button class="h_bar pl_m pr_m bg_fff fs_m" sn-tap="this.back()">取消</button> </header> <div class="main" ref="main"> <ul class="lf_notice__tab_con bg_fff bd_t"> <li class="flex lh_m h_m bd_b" sn-repeat="item in searchResult"> <a href="javascript:;" class="flex_0 pl_m">{item.title}</a> <i class="icon-tag"></i> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/life/search_notice",["css/app.css","css/append.css"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast");t("widget/popup");n.exports=r.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{searchResult:[{title:"fasdfasf"}]});e.back=function(){t.back(t.swipeRightBackAction)};var n=this.loader=new a(this.$el);n.showLoading(),c.all([this.waitLoad()]).then(function(n){t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){n.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/life/life_bill",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main" ref="main"> <div class="h_m flex bg_fff pl_m pr_m fs_s fw_s bd_b"> <div class="flexitem cl_999">缴费账户</div> <a href="javascript:;" class="cl_999" sn-tap="edit=!edit">{edit?\'取消\':\'\'}编辑</a> </div> <div class="bg_fff"> <div class="flex h_l ml_m pl_m bd_b icon-water" sn-repeat="item,i in waterData" data-forward="{item.ubid?\'/life/seebill/\'+item.ubid+\'?bid=\'+item.business_id:(\'/life/addbill/\'+item.business_id)}"> <div class="ml_m fs_m flexitem"> <p>水费</p> <p class="cl_999 fs_s">{item.user_code}</p> </div> <div class="cl_ccc g_arrow_s pr_xl fs_s fw_s" sn-if="!edit"><span sn-if="!item.ubid">可添加</span></div> <div class="pr_m fs_s fw_s" sn-else-if="item.ubid&&edit"> <a href="javascript:;" class="cl_app mr_m" sn-tap="this.delete(item)">删除</a> <a href="javascript:;" class="cl_app mr_m" sn-tap="this.modify(item)">修改</a> </div> </div> <div class="flex h_l ml_m pl_m bd_b icon-elec" sn-repeat="item,i in elecData" data-forward="{item.ubid?\'/life/seebill/\'+item.ubid+\'?bid=\'+item.business_id:(\'/life/addbill/\'+item.business_id)}"> <div class="ml_m fs_m flexitem"> <p>电费</p> <p class="cl_999 fs_s">{item.user_code}</p> </div> <div class="cl_ccc g_arrow_s pr_xl fs_s fw_s" sn-if="!edit"><span sn-if="!item.ubid">可添加</span></div> <div class="pr_m fs_s fw_s" sn-else-if="item.ubid&&edit"> <a href="javascript:;" class="cl_app mr_m" sn-tap="this.delete(item)">删除</a> <a href="javascript:;" class="cl_app mr_m" sn-tap="this.modify(item)">修改</a></div> </div> </div> <div class="pt_l ta_c"> <a class="cl_app fs_m" sn-tap="this.more()">更多缴费</a> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/life/life_bill",["css/app.css","css/append.css","logical/business"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),u=t("widget/popup"),d=t("logical/business");n.exports=r.extend({onCreate:function(){function r(){e=[{business_id:100004}],n=[{business_id:100005}],c.all([d.getUserBusiness(0),t.waitLoad()]).then(function(t){t[0].data.forEach(function(t){switch(t.business_id){case 100004:e[0].ubid?e.push(t):Object.assign(e[0],t);break;case 100005:n[0].ubid?n.push(t):Object.assign(n[0],t)}}),s.set({waterData:e,elecData:n})})["catch"](function(t){l.showToast(t.message)}).then(function(){i.hideLoading()})}var t=this,e=[{business_id:100004}],n=[{business_id:100005}],s=this.model=new o(this.$el,{title:"缴费账户",waterData:e,elecData:n});s.back=function(){t.back(t.swipeRightBackAction)},s.modify=function(e){return t.forward("/life/addbill/"+e.business_id+"?modify=true",{data:e}),!1},s.more=function(){u.options({options:[{text:"水费",click:function(){this.hide(),t.forward("/life/addbill/100004")}},{text:"电费",click:function(){this.hide(),t.forward("/life/addbill/100005")}},{text:"取消",click:function(){this.hide()}}]})},s["delete"]=function(t){return u.confirm({title:"温馨提醒",content:"确定要删除该帐号吗",confirmText:"确定删除",confirmAction:function(){if(!i.isLoading){i.showLoading();var e=this;d.deleteUserBusiness(t.ubid).then(function(t){r()})["catch"](function(t){l.showToast(t.message)}).then(function(){i.hideLoading(),e.hide()})}},cancelText:"取消",cancelAction:function(){}}),!1};var i=this.loader=new a(this.$el);i.showLoading(),r(),t.onResult("LIFE_BILL_CHANGE",r),t.bindScrollTo(s.refs.main)},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/life/add_bill",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main fs_m" ref="main"> <div class="flex icon-{business_id==100004?\'water2\':\'elec2\'} pt_l pl_m pb_m bg_fff bd_b"> <p class="pl_s">{business_id==100004?\'水费\':\'电费\'}</p> </div> <div class="flex h_m bg_fff bd_b pl_m"> <p class="flexitem">家庭</p> <div class="g_arrow_s pr_xl fs_s fw_s">我家</div> </div> <div class="flex h_m bg_fff bd_b pl_m" sn-tap="this.selectUnit()"> <p class="flexitem">缴费单位</p> <div class="g_arrow_s pr_xl fs_s fw_s cl_999">{unit.name?unit.name:\'选择缴费单位\'}</div> </div> <div class="flex h_m bg_fff bd_b pl_m"> <p class="flex pr_xl">户号 </p> <input class="flexitem pr_xl fs_s fw_s cl_999" sn-model="user_code" value="{user_code}" placeholder="查看纸质账单" /> </div> <div class="mg_m fs_m mb_xxl" sn-if="!isModify"><span class="checkbox {agree?\'checked\':\'\'}" sn-tap="agree=!agree"></span><span sn-tap="agree=!agree" class="va_m">同意<a href="/licence" class="cl_app">《自助缴费服务协议》</a></span></div> <div class="pt_xxl pl_m pr_m"> <button class="btn_l fs_l br_4" sn-tap="this.save()">{isModify?\'修改缴费账户\':\'新增缴费账户\'}</button> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/life/add_bill",["css/app.css","css/append.css","logical/business"],function(t,e,n){var r=(t("$"),t("util"),t("activity")),a=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("widget/selector")),h=t("logical/business");n.exports=r.extend({onCreate:function(){var t=this,e=this.business_id=this.route.params.id,n=this.route.query.modify&&this.route.data.data,s=this.model=new o(this.$el,{title:n?"修改缴费账户":"新增缴费账户",business_id:e,isModify:n});s.back=function(){t.back(t.swipeRightBackAction)};var i=new d({options:[{template:"<li><%=name%></li>",data:"100004"==e?[{name:"福州自来水有限公司",value:"1020"},{name:"泉州自来水有限公司",value:"3326"},{name:"石狮自来水有限公司",value:"3329"},{name:"晋江自来水有限公司",value:"3330"}]:"100005"==e?[{name:"福建省电力",value:"1008"}]:[{name:"龙岩数字广电",value:"5058"}],onChange:function(t,e){}}],complete:function(t){s.set("unit",t[0])}});s.selectUnit=function(){i.show()};var r;if(n){var u=this.route.data.data;r=u.ubid,i.eq(0).val("value",u.unitno),s.set({data:u,unit:i.data()[0],user_code:u.user_code})}s.save=function(){var i=this.get("unit.value");if(!i)return void l.showToast("请选择缴费单位");var a=this.get("user_code");if(!a)return void l.showToast("请填写户号");if(!n&&!this.get("agree"))return void l.showToast("请先同意《自助缴费服务协议》");if(!p.isLoading){p.showLoading();var o=n?h.updateBill(r,e,i,a,"我家"):h.addBill(e,i,a,"我家");o.then(function(e){l.showToast(n?"修改成功":"添加成功！"),t.setResult("LIFE_BILL_CHANGE"),s.back()})["catch"](function(t){l.showToast(t.message)}).then(function(){p.hideLoading()})}};var p=this.loader=new a(this.$el);p.showLoading(),c.all([this.waitLoad()]).then(function(e){t.bindScrollTo(s.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){p.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/life/see_bill",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main" ref="main"> <div class="flex icon-{business_id==100004?\'water2\':\'elec2\'} pt_l pl_m pb_m bg_fff bd_b"> <p class="pl_s">{business_id==100004?\'水费\':\'电费\'}</p> </div> <div sn-if="data&&data.PAYAMT" class="flex_t pd_m bg_fff"> <p class="fs_m flexitem">上月欠费</p> <p class="fs_xxl">{parseInt(data.PAYAMT)/100}</p> </div> <div class="pt_m pr_m pl_m bg_fff flex"> <p class="fs_m flexitem cl_999">缴费单位</p> <p class="fs_m cl_999">{unit}</p> </div> <div class="pt_s pr_m pl_m bg_fff flex"> <p class="fs_m flexitem cl_999">缴费户号</p> <p class="fs_m cl_999">{account.user_code}</p> </div> <div class="pt_s pr_m pl_m pb_m bg_fff flex"> <p class="fs_m flexitem cl_999">家庭</p> <p class="fs_m cl_999">{account.memo}</p> </div> <div class="ta_c pt_xxl cl_999 fs_m" sn-if="!data&&!data.PAYAMT">暂无欠费</div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/life/see_bill",["css/app.css","css/append.css","logical/business"],function(t,e,n){var i=(t("$"),t("util")),a=t("activity"),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/business"));n.exports=a.extend({onCreate:function(){var t=this,e=this.id=this.route.params.id,n=this.business_id=this.route.query.bid,s=this.model=new o(this.$el,{title:"生活缴费",ubid:e,business_id:n}),a="100004"==n?[{name:"福州自来水有限公司",value:"1020"},{name:"泉州自来水有限公司",value:"3326"},{name:"石狮自来水有限公司",value:"3329"},{name:"晋江自来水有限公司",value:"3330"}]:"100005"==n?[{name:"福建省电力",value:"1008"}]:[{name:"龙岩数字广电",value:"5058"}];s.back=function(){t.back(t.swipeRightBackAction)};var u=this.loader=new r(this.$el);u.showLoading(),c.all([d.queryBusiness(e),this.waitLoad()]).then(function(e){var n=e[0];s.set({account:n.account,data:n.data,unit:i.first(a,"value",n.account.unitno).name}),n.result||l.showToast(n.message),t.bindScrollTo(s.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){u.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/yunmi/yunmi",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main ym_idx" ref="main"> <div class="ym_idx__bg cl_fff ta_c bd_b"> <div class="flex"> <dl class="flex_0"> <dt class="pt_m_rem">云米总额</dt> <dd class="pt_l_rem fs_xl fw_b">{Math.round((yunmiData.amount||0)*100)/100}</dd> </dl> <dl class="flex_0" sn-tap="this.receiveYunmi()"> <dt class="ym-point-rem pt_s_rem"> <i class="num" sn-if="current.amount">+{current.amount||0}</i> </dt> <dd class="pt_s_rem fs_m ym_idx__timeout" sn-if="false">{current.amount||(next.timeLeft?"倒计时:"+next.timeLeft:\'\')}</dd> </dl> <dl class="flex_0"> <dt class="pt_m_rem">当日获得</dt> <dd class="pt_l_rem fs_xl fw_b">{Math.round((today_get_amount||0)*100)/100}</dd> </dl> </div> <div class="ta_c fs_s pb_m_rem" data-forward="/yunmi/detail">点击查看收支明细</div> </div> <ul class="ym_idx__tab flex ta_c fs_m bd_b bg_fff"> <li class="flex_0 br_a {tab==0?\'curr\':\'\'}" sn-tap="tab=0">摇云米</li> <li class="flex_0 br_a {tab==1?\'curr\':\'\'}" sn-tap="tab=1">用云米</li> <li class="flex_0 {tab==2?\'curr\':\'\'}" sn-tap="tab=2">赚云米</li> </ul> <div class="ym_idx__shake pt_1" sn-if="{tab==0}"> <div sn-if="!shakeResult||!shakeResult.length" class="mt_xxl ym-shake ta_c pt_xxl pb_xxl" sn-tap="this.motion()"> <p class="ta_c pt_xl">摇一摇</p> </div> <ul class="ym_idx__bags of_h pb_xl" sn-if="shakeResult&&shakeResult.length"> <li class="fl_l" sn-repeat="item in shakeResult" sn-tap="this.getShakeYunmi(item)"> <p class="name to_e">{item.name_for_show||item.contactName} <span sn-if="{!item.isFriend||!item.user_id}" class="dp_b fs_s">（{item.user_id?\'非好友\':\'未注册\'}）</span></p> <div sn-if="{item.isFriend}" class="ym-bag-rem ym_idx__bag"> <p class="ym_idx__num">+{item.amount/2||0}</p> </div> <div sn-else class="ym-bag_empty-rem ym_idx__bag"> <p class="ym_idx__bag_lab">{item.user_id?\'添加好友\':\'邀请\'}</p> <p class="ym_idx__num">+{item.user_id?item.amount/2:50}</p> </div> </li> </ul> <div class="ta_c dock_blr pb_m"> <a href="javascript:;" class="cl_app td_u" sn-tap="isShowRule=true">云米规则</a> </div> </div> <div class="ym_idx__use pt_m" sn-if="{tab==1}"> <ul class="bg_fff bd_tb"> <li class="ym-transfer flex h_bar pl_m bd_b" data-forward="/yunmi/exchange"> <p class="fs_m pl_m flex_0">云米兑换流量</p> <p class="icon-arrow mr_s"></p> </li> <li class="ym-send flex h_bar pl_m bd_b" data-forward="/yunmi/send_yunmi"> <p class="fs_m pl_m flex_0">云米转赠</p> <p class="icon-arrow mr_s"></p> </li> <li class="ym-redbag flex h_bar pl_m" data-forward="/yunmi/redbag"> <p class="fs_m pl_m flex_0">云米红包</p> <p class="icon-arrow mr_s"></p> </li> </ul> </div> <div class="ym_idx__use pt_m" sn-if="{tab==2}"> <div class="ym-task2 h_bar bd_tb flex bg_fff pl_m" sn-tap="delegate.taskNotReady()" delaydata-forward="/yunmi/invite"> <div class="flex_0 ml_m"> <p class="fs_m cl_999">新人推荐有礼</p> </div> <p class="icon-arrow mr_s"></p> </div> <div class="lh_l fs_m pl_m">新手任务</div> <ul class="bg_fff bd_tb"> <li class="ym-new flex h_l pl_m bd_b"> <p class="fs_m pl_m flex_0">新人首登福利 <span class="dp_b fs_s">+50云米 <i class="cl_999">{loginTask.status==2?loginTask.days+\'天后过期\':\'\'}</i></span> </p> <button class="ym_task__btn{loginTask.status!=2?\' disabled\':\'\'}" sn-tap="delegate.doLoginTask(loginTask)">{loginTask.status==2?\'未完成\':loginTask.status==3?\'已过期\':\'已领取\'}</button> </li> <li class="icon-info flex h_bar pl_m bd_b"> <input class="fs_m pl_m flex_0" placeholder="请输入您的邀请码（选填）" /> </li> <li class="ym-timeout flex h_l pl_m bd_b" sn-tap="delegate.taskNotReady()"> <p class="fs_m pl_m flex_0 cl_999">收云米任务 <i class="dp_b fs_s">+10云米</i> </p> <button class="ym_task__btn disabled">未领取</button> </li> <li class="ym-shaketask flex h_l pl_m" sn-tap="delegate.taskNotReady()"> <p class="fs_m pl_m flex_0 cl_999">摇云米任务 <i class="dp_b fs_s">+40云米</i></p> <button class="ym_task__btn disabled">未完成</button> </li> </ul> </div> </div> <footer class="h_l bg_fff bd_t pt_1 flex ta_c ym_idx__foot" sn-if="{tab==0}"> <div class="flex_0 br_aaa" sn-tap="this.findRich()"> <i class="icon-money mr_m"></i> <span class="va_m">找土豪</span> </div> <div class="flex_0" sn-tap="this.motion()"> <i class="icon-refresh2 mr_m"></i> <span class="va_m">换一批</span> </div> </footer> <div class="hm_idx__to_mask dock" style="display:none" ref="timeoutMask"> </div> <div class="hm-timeout g_center" ref="timeout" style="display:none"> <div class="close" sn-tap="this.hideTimeout()"></div> <div class="ft">还有{next.timeLeft}秒后才能收获</div> </div> <div class="ym_idx__rule" sn-display="isShowRule" sn-tap="isShowRule=false" style="display: none"> <div class="img"></div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/yunmi/yunmi",["css/app.css","css/append.css","components/yunMiRules","logical/yunmi","models/yunmi","logical/contact","models/friends"],function(t,e,s){var n=t("$"),i=t("util"),a=t("bridge"),r=t("activity"),o=t("widget/loader"),c=t("core/model2").Model,l=t("promise"),u=t("widget/toast"),d=t("widget/popup"),h=t("components/yunMiRules"),p=t("logical/yunmi"),f=t("models/yunmi"),m=t("logical/contact"),_=t("models/friends");s.exports=r.extend({onCreate:function(){var t=this,e=this.model=new c(this.$el,{title:"云米账户",yunmiData:f});e.delegate=this,e.back=function(){t.back(t.swipeRightBackAction)},e.seeRules=function(){d.alert({className:"ym_rules__popup",title:"云米规则",content:h.rule,btn:"关闭",action:function(){}})},e.getShakeYunmi=function(n){if(n.isFriend&&n.user_id){if(!n.amount||!n.yunmi_id)return void u.showToast("该好友暂时没有云米可收！");d.popup({className:"bg_0000",tapMaskToHide:!0,content:'<div class="ym-redbag2 ps_r"><div click="getYunmi" class="ps_a ta_c cl_fff ym_idx__receive"><i>+</i><em>'+n.amount/2+"</em><span>云米</span></div></div>",getYunmi:function(){var i=this;s.showLoading(),p.receiveShakeYunmi(n.yunmi_id).then(function(s){u.showToast("收取成功！"),i.hide(),t.getYunmi(),e._("shakeResult").find("yunmi_id",n.yunmi_id).set({amount:0})})["catch"](function(t){u.showToast(t.message)}).then(function(){s.hideLoading()})}})}else n.user_id?t.forward("/contact/person/"+n.user_id):m.inviteFriend(n.phoneNumber)},t.onResult("select_rich_user",function(t,s){var n=i.map(s,"user_id");return p.getUsersYunmi(n.join(",")).then(function(t){t.data&&t.data.forEach(function(t){var e=i.first(s,"user_id",t.user_id);e.amount=t.amount,e.yunmi_id=t.yunmi_id}),e.set({shakeResult:s})})}),e.findRich=function(){t.forward("/yunmi/select_user",{type:2})},e.hideTimeout=function(){n(e.refs.timeout).hide(),n(e.refs.timeoutMask).hide()},e.receiveYunmi=function(){var t=this.get("current");return t?(s.showLoading(),void p.receiveYunmi(t.yunmi_id).then(function(s){f.set({amount:f.get("amount")+t.amount}),e.set({current:null,today_get_amount:e.get("today_get_amount")+t.amount})})["catch"](function(t){u.showToast(t.message)}).then(function(){s.hideLoading()})):void(this.get("next.yunmi_id")?(n(e.refs.timeout).show(),n(e.refs.timeoutMask).show()):u.showToast("暂无云米可以领取！"))};var s=this.loader=new o(n("body"));this.getYunmi(),this.onResult("refresh_yunmi",function(){this.getYunmi()}),t.bindScrollTo(e.refs.main),a.motion.start(),this.motion=this.motion.bind(this),e.motion=this.motion,n(window).on("motion",this.motion)},onShow:function(){},doLoginTask:function(t){2==t.status&&p.doLoginTask().then(function(t){1==t.data&&d.popup({className:"ym_task__warp bg_0000",content:'<div class="ym_task__prize_bg ta_c">                <p class="ta_c">恭喜你！<br />                    成功领取50云米</p>                <button click="hide"></button>            </div>',hide:function(){this.hide()}})})},taskNotReady:function(){d.alert({content:'<p class="ta_c">暂未上线，敬请期待...</p>'})},getYunmi:function(){var t=this,e=this.loader,s=this.model;e.showLoading(),l.all([p.getYunmi(),p.getYunmiTask(),this.waitLoad()]).then(function(e){var n=e[0].data,a=e[0].next;if(a){var r=a.create_date,o=Date.now();a.timeFix=o-r,a.timeLeft=i.timeLeft(a.start_date-r),t.timer=setInterval(function(){var e=s.get("next"),n=e.start_date-(Date.now()-e.timeFix);return 0>=n?(t.timer&&(clearInterval(t.timer),t.timer=null),t.getYunmi(),void s.hideTimeout()):(n=i.timeLeft(n),void s.set("next.timeLeft",n))},1e3)}f.set({amount:e[0].amount}),s.set({loginTask:e[1].loginTask,today_get_amount:e[0].today_get_amount,current:n,next:a})})["catch"](function(t){u.showToast(t.message)}).then(function(){e.hideLoading()})},motion:function(){var e=this.loader,s=this.model;if(!e.isLoading){e.showLoading();for(var n=_.getFriends(),a=Math.min(i.random(3,6),n.size()),r=[],o=[],c=n.size()-1;c>=0;c--)r.push(c);for(var c=a;c>0;c--){var d=i.random(r.length-1);d=r.splice(d,1)[0],o.push(n._(d).set({isFriend:!0}))}s.set({shakeResult:o}),o=s._("shakeResult");var h=function(t){t.length?p.getUsersYunmi(t.filter(function(t){return t}).join(",")).then(function(t){o.update(t.data.map(function(t){return{user_id:t.user_id,amount:t.amount,yunmi_id:t.yunmi_id}}),"user_id")})["catch"](function(t){u.showToast(t.message)}).then(function(){e.hideLoading()}):e.hideLoading()},f=6-a;if(f>0){var g=function(){for(var t=[],e=_.getContacts(),s=[],a=e.size()-1;a>=0;a--)t.push(a);for(var a=f;a>0&&t.length;){var r=i.random(t.length-1);r=t.splice(r,1)[0];var c=e._(r);c&&-1==n.indexOf("account",c.get("phoneNumber"))&&(s.push(c.get("phoneNumber")),o.add(c),a--)}var u=l.resolve();s.length&&(u=u.then(function(){return m.getContactsUser(s)})),u.then(function(){h(o.map("user_id"))})};0==_.getContacts().size()?m.getContactList({size:50}).then(function(){g()},function(){h(o.map("user_id"))}):g()}else h(o.map("user_id"))}},onDestroy:function(){this.timer&&clearInterval(this.timer),this.model.destroy(),n(window).off("motion",this.motion),a.motion.stop()}})});define("template/yunmi/yunmi_detail",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main ym_detail" ref="main"> <div class="ym_detail__bg cl_fff"> <dl class="pt_m"> <dt class="pl_xxl fs_m">当前可用云米</dt> <dd class="ta_c fs_xxl">{util.fixFloat(amount)}</dd> </dl> </div> <div class="fs_m lh_m ta_c cl_666">&lt;{util.formatDate(new Date(),\'yyyy年MM月\')}&gt;</div> <div class="lh_m bg_fff ym_detail__overview"><span>收入：</span><b>+{util.fixFloat(ym_get)}</b> <span>支出：</span><em>{util.fixFloat(ym_use)}</em> <span>结余：</span><i>{util.fixFloat(ym_get+ym_use)}</i> </div> <div class="ym_detail__list bg_fff" sn-repeat="item in data"> <div class="hd flex fs_s"> <p class="flex_0">{item.key.day}</p> <p>{item.sum.amount>0?\'收\':\'支\'}：{util.fixFloat(item.sum.amount)}</p> </div> <dl class="bd_b" sn-repeat="detail in item.group"> <dt class="flex fs_l pl_m pr_m pt_m"> <p class="flex_0">{detail.trade_type==1?\'捡云米\': detail.trade_type==2?\'摇一摇\': detail.trade_type==3?\'赠送\': detail.trade_type==4?\'赠送\': detail.trade_type==5?\'赠送退回\': detail.trade_type==6?\'发红包\': detail.trade_type==7?\'收红包\': detail.trade_type==8?\'红包退回\': detail.trade_type==9?\'新人任务\': detail.trade_type==10?\'摇一摇\': detail.trade_type==11?\'兑换流量\':\'未知类型\'}</p> <p>{detail.amount>=0?\'+\'+util.fixFloat(detail.amount):util.fixFloat(detail.amount)}</p> </dt> <dd class="flex fs_m pl_m pr_m pb_m cl_666"> <p class="flex_0">无备注</p> <p>{util.formatDate(detail.trade_date,\'HH:mm\')}</p> </dd> </dl> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/yunmi/yunmi_detail",["css/app.css","css/append.css","logical/yunmi"],function(t,e,s){var n=(t("$"),t("util")),a=t("activity"),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/yunmi"));s.exports=a.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"云米交易明细"});e.back=function(){t.back(t.swipeRightBackAction)};var s=this.loader=new r(this.$el);s.showLoading(),c.all([d.getYunmiDetails(),this.waitLoad()]).then(function(s){var i=s[0],a=n.groupBy("day,sum(amount)",i.data.map(function(t){return t.day=n.formatDate(t.trade_date,"yy-M-d W"),t}));e.set({amount:i.amount,data:a,ym_get:n.sum(i.data,function(t){return t.amount>0?t.amount:0}),ym_use:n.sum(i.data,function(t){return t.amount<0?t.amount:0})}),t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/yunmi/exchange_yunmi",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main" ref="main"> <div class="ym_exchange__bg cl_fff mb_l"> <div class="fs_s ml_l pt_s">当前可兑换云米总额</div> <div class="ta_c ym_exchange__total">{Math.round(yunmiData.amount*100)/100}</div> </div> <ul class="of_h ym_exchange__list flex ta_c"> <li class="g_tag flex_0{type==1?\' curr\':\'\'}" sn-tap="type=1">50MB</li> <li class="g_tag flex_0{type==2?\' curr\':\'\'}" sn-tap="type=2">100MB</li> <li class="g_tag flex_0{type==3?\' curr\':\'\'}" sn-tap="type=3">200MB</li> </ul> <ul class="of_h ym_exchange__list flex ta_c pt_m"> <li class="g_tag flex_0{type==4?\' curr\':\'\'}" sn-tap="type=4">300MB</li> <li class="g_tag flex_0{type==5?\' curr\':\'\'}" sn-tap="type=5">500MB</li> <li class="g_tag flex_0{type==6?\' curr\':\'\'}" sn-tap="type=6">1G</li> </ul> <div class="pt_m fs_s ml_m cl_666"> 兑换规则：1云米=1MB，套餐包有效期为当月<br /> 注：1云米可兑换1M省内通用流量，50云米起兑。当月可以多次兑换，但兑换流量总额不超过5G，兑换流量生效后不可结转至下月，当月未用完自动清零。 </div> <div class="ym_exchange__btn pl_l pr_l"> <button class="btn_l fs_l br_4" sn-tap="delegate.exchange()">兑换</button> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/yunmi/exchange_yunmi",["css/app.css","css/append.css","models/yunmi"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),u=t("widget/popup"),d=t("models/yunmi");s.exports=a.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"云米兑换流量",type:1,yunmiData:d});e.delegate=this,e.back=function(){t.back(t.swipeRightBackAction)};var s=this.loader=new r(this.$el);s.showLoading(),c.all([this.waitLoad()]).then(function(s){t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},exchange:function(){u.alert({content:"暂无法兑换"})},onDestroy:function(){this.model.destroy()}})});define("template/yunmi/invite",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main pt_l" ref="main"> <div class="bd_tb bg_fff pt_1 mb_m pb_l"> <div class="cl_app fs_m pt_s pl_m mb_l">分享推荐规则</div> <div class="ym_invite__prize ta_c"> <p class="hd">已邀请人数</p> <p class="num">0/20</p> </div> <div class="ta_c lh_xxs fs_s mb_m"> 真可惜，您还没有邀请小伙伴，<br /> 赶快点击下方分享按钮，邀请小伙伴吧！ </div> <div class="fs_l cl_app ta_c">邀请码</div> <div class="ym_invite__code ta_c">256889555</div> <div class="ym_invite__share bd_t pt_s"> <div class="cl_app fs_m pl_s ta_l mb_m">分享至</div> <ul class="ym_invite__share flex pb_m"> <li class="share-quan"> <p class="fs_s">朋友圈</p> </li> <li class="share-wx flex_0"> <p class="fs_s">微信好友</p> </li> <li class="share-wxquan"> <p class="fs_s">微信朋友圈</p> </li> </ul> <ul class="ym_invite__share flex"> <li class="share-weibo"> <p class="fs_s">微博</p> </li> <li class="share-qq flex_0"> <p class="fs_s">QQ好友</p> </li> <li class="share-qqspace"> <p class="fs_s">QQ空间</p> </li> </ul> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/yunmi/invite",["css/app.css","css/append.css"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast");t("widget/popup");s.exports=a.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"新人推荐有礼"});e.back=function(){t.back(t.swipeRightBackAction)};var s=this.loader=new r(this.$el);s.showLoading(),c.all([this.waitLoad()]).then(function(s){t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/yunmi/send_yunmi",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main" ref="main"> <div class="ym_exchange__bg cl_fff mb_l"> <div class="fs_s ml_l pt_s">当前可赠送云米总额</div> <div class="ta_c ym_exchange__total">{amount}</div> </div> <div class="fs_m pl_m mb_s"> 仅移动和生活APP支持赠云米功能 </div> <div class="fs_m pl_l of_h"> <em class="ym__redbag__friends mr_m bg_app va_m" sn-if="friend.user_id">{friend.user_name}</em> <a href="javascript:;" sn-tap="this.selectFriends()" class="cl_app td_u pb_l va_m">添加好友</a> </div> <div class="fs_m pl_m mb_s pt_m"> 云米赠送数量 </div> <form class="flex bg_fff h_m bd_tb mb_m"> <input class="flexitem h_m fs_m pl_m" sn-model="send_amount" type="tel" placeholder="请输入云米数量" /> </form> <div class="ym_send__say flex bg_fff h_m bd_tb pd_1"> <textarea class="flexitem fs_m pl_m bd_0" sn-model="memo" placeholder="对好友说点什么吧?" /> </div> </div> <footer class="h_xl flex ta_c pd_m"> <button class="btn_l fs_l br_4 dp_b" sn-tap="this.sendYunmi()">立即赠送</button> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/yunmi/send_yunmi",["css/app.css","css/append.css","logical/yunmi","logical/chat"],function(t,e,s){var n=(t("$"),t("util")),a=t("activity"),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/yunmi")),h=t("logical/chat");s.exports=a.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"赠云米"});e.back=function(){t.back(t.swipeRightBackAction)},this.onResult("select_single_user",function(t,s){e.set({friend:s,mobile:s?s.account:null})}),e.selectFriends=function(){t.forward("/yunmi/select_single_user",{friend:e.get("friend")})},e.sendYunmi=function(){var i=this.get("memo"),a=this.get("send_amount"),r=this.get("mobile");return n.validateMobile(r)?a?/^\d+$/.test(a)?(s.showLoading(),void d.sendYunmi(r,a,i).then(function(s){h.record(!0,s.friend_id,{type:h.MESSAGETYPE.SEND_YUNMI,content:i}),t.setResult("refresh_yunmi"),e.back()})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})):void l.showToast("请填写正确的赠送数量"):void l.showToast("请填写赠送数量"):void l.showToast("请填写选择好友")};var s=this.loader=new r(this.$el);s.showLoading(),c.all([d.getTotalYunmi(),this.waitLoad()]).then(function(s){e.set({amount:s[0].amount}),t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/yunmi/redbag",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main pt_m" ref="main"> <form class="ml_m mr_m mb_s h_l bg_fff flex"> <p class="pl_m"><span class="va_m">{type==1?\'单个\':\'总\'}金额</span> <i class="ym_redbag__pin_icon" sn-if="type==2">拼</i></p> <p class="fs_s">(可用云米:{amount})</p> <input sn-model="send_amount" type="tel" class="flex_0 ta_r fs_m pr_s" placeholder="填写金额" /> <p class="pr_s">云米</p> </form> <div class="fs_m pl_l mb_l">当前为{type==1?\'普通红包\':\'拼手气红包\'}，<a href="javascript:;" class="cl_dark" sn-tap="type=type==1?2:1">改为{type==2?\'普通红包\':\'拼手气红包\'}</a></div> <form class="ml_m mr_m mb_m h_l bg_fff flex"> <p class="pl_m">红包个数</p> <input type="number" sn-model="qty" class="flexitem ta_r fs_m pr_s" placeholder="填写个数" /> <p class="pr_s">个</p> </form> <div class="ml_m mr_m mb_s bg_fff"> <textarea sn-model="memo" class="ym_redbag__msg" placeholder="恭喜发财，大吉大利！"></textarea> </div> <div class="fs_m pl_l of_h"> <em class="ym__redbag__friends mr_m bg_app va_m" sn-repeat="friend in friends">{friend.user_name}</em> <a href="javascript:;" sn-tap="this.selectFriends()" class="cl_app td_u pb_l va_m">添加好友</a> </div> <div class="ta_c pt_xxl flex jc_c"> <p class="ym-point2"></p> <p class="ym_redbag__point">{util.fixFloat((parseFloat(send_amount)||0)*(type==1?parseFloat(qty)||0:1))}</p> </div> <div class="ml_m mr_m pt_xxl flex jc_c"> <button class="btn_xl" sn-tap="this.sendRedbag()">塞钱进红包</button> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/yunmi/redbag",["css/app.css","css/append.css","logical/yunmi","logical/chat"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/yunmi")),h=t("logical/chat");s.exports=a.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"云米红包",type:1,friends:[]});this.onResult("select_redbag_user",function(t,s){e._("friends").set(s)}),e.back=function(){t.back(t.swipeRightBackAction)},e.selectFriends=function(){t.forward("/yunmi/select_user",{type:1,friends:e._("friends")})},e.sendRedbag=function(){var i=this.get("memo")||"恭喜发财，大吉大利！",n=this.get("send_amount"),a=this.get("qty"),r=this.get("friends");return n?/^\d+(\.\d+)?$/.test(n)?a?/^\d+$/.test(a)?parseInt(a)>100?void l.showToast("红包数量上限100个"):r.length?(s.showLoading(),void d.sendRedbag({quantity:a,amount:n,type:e.get("type"),friends:r.map(function(t){return t.user_id}).join(",")}).then(function(s){r.forEach(function(t){h.record(!0,t.friend_id,{type:h.MESSAGETYPE.YUNMI_REDBAG,content:i})}),t.setResult("refresh_yunmi"),e.back()})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})):void l.showToast("请选择接收红包的好友！"):void l.showToast("请填写正确的云米数量"):void l.showToast("请填写云米数量"):void l.showToast("请填写正确的云米金额"):void l.showToast("请填写云米金额")};var s=this.loader=new r(this.$el);s.showLoading(),c.all([d.getTotalYunmi(),this.waitLoad()]).then(function(s){e.set({amount:s[0].amount}),t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/yunmi/select_user",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button sn-tap="this.save()">确定</button></div> </header> <div class="main ct_contactlist" ref="main"> <div class="ta_c pt_m fs_m cl_666">{type==2?\'找土豪\':\'请选择要收红包用户\'}</div> <div class="ct_contactlist__search"> <form class="ps_r zi_1 flex"> <p class="icon-search ml_m"></p> <input type="text" class="bd_n ml_s flexitem fs_m" placeholder="搜索好友" /> </form> </div> <div class="ct_contactlist__group" sn-repeat="group in groups"> <div class="hd fs_m pd_s ml_m">{group.letter}</div> <ul class="ct_contactlist__list bd_t bg_fff"> <li class="bd_b flex" sn-repeat="item in group.list" sn-tap="item.checked=!item.checked"> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(item.avatars)}" class="dp_b sqr_s" /> <div class="flexitem ml_m"> <p class="fs_l"> {item.user_name} </p> </div> <p class="{item.checked?\'icon-checked\':\'icon-check\'}"></p> </li> </ul> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/yunmi/select_user",["css/app.css","css/append.css","logical/contact"],function(t,e,s){var n=(t("$"),t("util")),a=t("activity"),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("utils/firstLetter")),h=t("logical/contact");s.exports=a.extend({onCreate:function(){var t=this,e=this.route.data,s=this.model=new o(this.$el,{title:"我的好友",friends:e.friends||[],type:e.type});s.back=function(){t.back(t.swipeRightBackAction)},s.save=function(){var s=this.get("groups"),i=[];s.forEach(function(t){i=i.concat(n.filter(t.list,"checked",!0))}),t.setResult(2==e.type?"select_rich_user":"select_redbag_user",i),this.back()};var i=this.loader=new r(this.$el);i.showLoading(),c.all([h.friends(),this.waitLoad()]).then(function(e){var i=e[0].data,a=s.get("friends");i.forEach(function(t){t.isFriend=!0,-1!=n.indexOf(a,"user_id",t.user_id)&&(t.checked=!0)}),s.set({friendList:i,groups:t.groups(i)}),t.bindScrollTo(s.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){i.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()},groups:function(t){var e={};if(t)return t.forEach(function(t){var s=d(t.user_name).charAt(0).toUpperCase();e[s]||(e[s]=[]),e[s].push(t)}),e=Object.keys(e).map(function(t){return{letter:t,list:e[t]}})}})});define("template/yunmi/select_single_user",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button sn-tap="this.save()">确定</button></div> </header> <div class="main ct_contactlist" ref="main"> <div class="ta_c pt_m fs_m cl_666">请选择要赠送的用户</div> <div class="ct_contactlist__search"> <form class="ps_r zi_1 flex"> <p class="icon-search ml_m"></p> <input type="text" class="bd_n ml_s flexitem fs_m" placeholder="搜索好友" /> </form> </div> <div class="ct_contactlist__group" sn-repeat="group in groups"> <div class="hd fs_m pd_s ml_m">{group.letter}</div> <ul class="ct_contactlist__list bd_t bg_fff"> <li class="bd_b flex" sn-repeat="item in group.list" sn-tap="friend=item"> <img onerror="this.src=\'images/default.jpg\'" sn-src="{sl.resource(item.avatars)}" class="dp_b sqr_s" /> <div class="flexitem ml_m"> <p class="fs_l"> {item.user_name} </p> </div> <p class="{friend.user_id==item.user_id?\'icon-checked\':\'icon-check\'}"></p> </li> </ul> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/yunmi/select_single_user",["css/app.css","css/append.css","logical/contact"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("utils/firstLetter")),h=t("logical/contact");s.exports=a.extend({onCreate:function(){var t=this,e=this.route.data,s=this.model=new o(this.$el,{title:"我的好友",friend:e.friend||{},type:e.type});s.back=function(){t.back(t.swipeRightBackAction)},s.save=function(){t.setResult("select_single_user",s.get("friend")),this.back()};var i=this.loader=new r(this.$el);i.showLoading(),c.all([h.friends(),this.waitLoad()]).then(function(e){var i=e[0].data;s.set({friendList:i,groups:t.groups(i)}),t.bindScrollTo(s.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){i.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()},groups:function(t){var e={};if(t)return t.forEach(function(t){var s=d(t.user_name).charAt(0).toUpperCase();e[s]||(e[s]=[]),e[s].push(t)}),e=Object.keys(e).map(function(t){return{letter:t,list:e[t]}})}})});define("template/yunmi/trade",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main" ref="main"> <div class="{icon} ta_c pt_xxl"></div> <div class="ta_c pt_l" sn-if="type==2">{status==0?\'待领取\':\'已领取\'}</div> <div class="ta_c pt_l">{status==-1?\'红包已被领完\':status==0&&type==1?\'待领取\':Math.abs(amount)}<span sn-if="status>0||type==2" class="fs_s">云米</span></div> <div class="ta_c pt_s cl_999">{memo}</div> <div class="mg_m mb_l pt_l" sn-if="status==0"> <div class="btn_xl" sn-tap="this.receive()">{type==1?\'立即领取\':\'确认收款\'}</div> </div> <div class="mg_m mb_l pt_xxl fs_m ta_c"> 交易时间：{util.formatDate(date)} </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/yunmi/trade",["css/app.css","css/append.css","logical/yunmi","models/user"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/yunmi")),h=t("models/user");s.exports=a.extend({onCreate:function(){var t=this,e=this.route.params.id,i=(h.get("user_id"),this.loader=new r(this.$el)),n=this.model=new o(this.$el,{title:""});n.back=function(){t.back(t.swipeRightBackAction)},n.receive=function(){i.showLoading(),1==this.get("type")?d.receiveRedbag(this.get("redbag_id")).then(function(){l.showToast("领取成功！"),t.load()})["catch"](function(t){l.showToast(t.message)}).then(function(){i.hideLoading()}):d.receiveSend(e).then(function(){l.showToast("领取成功！"),t.load()})["catch"](function(t){l.showToast(t.message)}).then(function(){i.hideLoading()})},t.bindScrollTo(n.refs.main),this.load()},load:function(){var e=this.model,s=this.loader,i=this.route.params.id,n=h.get("user_id");s.showLoading(),c.all([d.getTrade(i),this.waitLoad()]).then(function(t){var s=t[0].data;switch(s.trade_type){case 6:var i=t[0].redbag_details,a=-1,r=0;i.forEach(function(t){t.friend_id==n?a=t.amount:r||2!=t.status||(r=t.receive_id)}),-1==a&&r&&(a=0),e.set({status:a>0?1:a,title:"和生活红包",icon:"ym-redbag3",type:1,redbag_id:t[0].redbag.redbag_id,amount:a,date:s.trade_date,memo:s.memo||"恭喜发财，大吉大利！"});break;case 4:var o=t[0].receive_yunmi;o?e.set({status:1}):e.set({status:0}),e.set({amount:s.amount,title:"转账",date:s.trade_date,type:2,icon:"ym-wait"})}})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/business/notifications",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title" sn-tap="desc=!desc">{title}</div> </header> <div class="main bs_notify{hasFooter?\' has_footer\':\'\'}" ref="main"> <div class="bs_notify__item" sn-repeat="item in data|orderBy:send_date {desc}" sn-tap="this.goToDetail(item)"> <div class="con"> <div sn-if="item.type==-1"> <div class="flex"> <img class="dp_b sqr_m mr_m" sn-src="{sl.thumbnail(business.business_pic)}" /> <div class="flexitem"> <p class="name">{title}</p> <p class="date">{util.formatDate(item.send_date,\'short\')}</p> </div> </div> <p class="pt_m" sn-if="item.image"><img sn-src="item.image" class="dp_b w_x1 mh_90"></p> <p class="pt_s">{item.content}</p> </div> <div sn-else-if="business_id==100001"> <p class="name">{item.title}</p> <p class="date lh_xs">{util.formatDate(item.send_date,\'short\')}</p> <p class="item fs_m{item.value==\'-\'?\' sp\':\'\'}" sn-repeat="item in item.details"> <span>{item.text}{item.value==\'-\'?\'\':\'：\'}</span> <em sn-if="item.value!=\'-\'">{item.value}</em> </p> </div> <div sn-else-if="business_id==100026"> <div class="flex mb_m"> <img class="dp_b sqr_m mr_m" sn-src="{sl.thumbnail(business.business_pic)}" /> <div class="flexitem"> <p class="name">{title}</p> <p class="date">{util.formatDate(item.send_date,\'short\')}</p> </div> </div> <div class="bs_jubao__con ta_c"> <p class="fs_s cl_fff pt_xs">{item.feature.product_name}</p> <p class="fs_xs cl_fff">募集期:{util.formatDate(util.parseDate(item.feature.start_date),\'yyyy年MM月dd日HH:mm\')}-{util.formatDate(util.parseDate(item.feature.end_date),\'yyyy年MM月dd日HH:mm\')}</p> </div> <ul class="bs_jubao__info flex ta_c pt_s"> <li class="flexitem"> <p class="days">{item.feature.days}</p> <p class="note">期限（天）</p> </li> <li class="flexitem"> <p class="days rate"><em>{item.feature.rate}</em>%</p> <p class="note">预计年化收益率</p> </li> <li class="flexitem"> <p class="days">{item.feature.risk}%</p> <p class="note">风险等级</p> </li> </ul> <div class="fs_xs cl_bbb ta_c pt_m">起息日：{util.formatDate(util.parseDate(item.feature.interest_start_date),\'yyyy.MM.dd\')}（周五）—结息日：{util.formatDate(util.parseDate(item.feature.interest_end_date),\'yyyy.MM.dd\')}（周五）</div> </div> <div sn-else> <div class="flex"> <img class="dp_b sqr_m mr_m" sn-src="{sl.thumbnail(business.business_pic)}" /> <div class="flexitem"> <p class="name">{title}</p> <p class="date">{util.formatDate(item.send_date,\'short\')}</p> </div> </div> <p class="pt_m" sn-if="item.image"><img sn-src="item.image" class="dp_b w_x1 mh_90"></p> <p class="pt_s">{item.content}</p> </div> <div class="bd_t pt_m mt_m fs_m flex"> <p class="flexitem">{business_id==100001?\'详情\':\'立即查看\'}</p> <p class="g_arrow_s"></p> </div> </div> </div> </div> <footer class="bs_notify__footer" sn-if="hasFooter"> <button sn-if="business_id==100001" class="btn_l fs_l" sn-tap="this.enterShop()">进入福建移动营业厅</button> <button sn-else-if="business_id==100026" class="btn_l fs_l" sn-tap="this.enterHjb()">进入和聚宝</button> <button sn-else-if="business_id==100022" class="btn_l fs_l" sn-tap="this.enterEnt()">咪咕娱乐</button> <button sn-else-if="business_id==100002" class="btn_l fs_l" sn-tap="this.enterQz()">进入12580海西求职平台</button> <button sn-else-if="business_id==100003" class="btn_l fs_l" sn-tap="this.enterSc()">进入12580商城</button> <button sn-else-if="business_id==100004" class="btn_l fs_l" sn-tap="this.enterWaterBill()">进入应用</button> <button sn-else-if="business_id==100005" class="btn_l fs_l" sn-tap="this.enterElecBill()">进入应用</button> <button sn-else-if="business_id==100043" class="btn_l fs_l" sn-tap="this.enterMail139()">进入139邮箱</button> <button sn-else-if="business_id==100045" class="btn_l fs_l" sn-tap="this.enterHLY()">进入和留言</button> <button sn-else-if="business_id==100046" class="btn_l fs_l" sn-tap="this.enterHDH()">进入和多号</button> <button sn-else-if="business_id==100044" class="btn_l fs_l" sn-tap="this.enterBackup()">进入和通讯录</button> </footer>';return __},helpers:{}});return T.template=T.html,T});define("views/business/notifications",["css/app.css","css/append.css","../../logical/business","models/business","models/user","models/appconfig"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),o=(t("widget/loader"),t("core/model2").Model),l=(t("promise"),t("widget/toast")),h=(t("widget/popup"),t("bridge"),t("../../logical/business")),p=t("models/business"),f=t("models/user");t("models/appconfig");s.exports=a.extend({onCreate:function(){var t=this,e=this.business_id=this.route.params.id,s=p._("list").find("business_id",e),i=this.model=new o(this.$el,{business_id:e,title:s.get("business_name"),business:s,hasFooter:-1!=[100001,100003,100002,100004,100005,100026,100022,100043,100045,100046,100044].indexOf(parseInt(e))});i.back=function(){t.back(t.swipeRightBackAction)},Object.assign(i,h.redirect),i.goToDetail=function(t){this.jump(t.linkurl)},i.enterDetail=function(){switch(e){case"100001":this.enterShop()}},i.enterBackup=function(){t.forward("/contact/backup")},i.enterWaterBill=function(){t.forward("/life/bill/"+e)},i.enterHDH=function(){t.forward("/hdh/call")},i.enterElecBill=function(){t.forward("/life/bill/"+e)};var n=this.loader=h.notificationsLoader(i,function(t){switch(e){case"100001":t.data.forEach(function(t){if(-1!=t.type){var e=t.details=[],s=JSON.parse(t.feature);if(s.dun_type){switch(s.dun_type){case"1":case"2":case"5":case"20":case"21":}var i=0==s.useble_balance;t.title=i?"话费欠费提醒":"话费不足提醒",e.push({text:i?"您的手机已欠费":"您的话费剩余已不多",value:"-"},{text:"手机号码",value:f.get("account")},{text:i?"话费超出":"话费剩余",value:parseInt(i?s.this_month_owing:s.useble_balance)/1e3},{text:"点击详情立即续费",value:"-"})}else{var n,i=0==s.product_remain,a=parseInt(s.product_use);a=1==s.product_unit?Math.round(a/1024)+"M":a/100+"元",i?(n=parseInt(s.product_over),n=1==s.product_over_unit?Math.round(n/1024)+"M":n/100+"元"):n=Math.round(s.product_remain/1024)+"M",t.title=i?"流量超出提醒":"流量不足提醒",e.push({text:i?"您的套餐内流量已用完":"您的套餐内流量剩余已不多",value:"-"},{text:"本月已用",value:a},{text:i?"本月超出":"本月剩余",value:n},{text:"点击详情立即续费",value:"-"})}}});break;case"100022":break;case"100026":t.data.forEach(function(t){-1!=t.type&&(t.feature=JSON.parse(t.feature))})}});n.setParam({business_id:e}),t.bindScrollTo(i.refs.main),this.waitLoad().then(function(){return p.getNotifications().each(function(t){t.get("business_id")==e&&t.set({unread:0,isRead:!0})}),n.request()})["catch"](function(t){l.showToast(t.message)})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/business/service",["util","widget/tab"],function(require){var T=(require("util"),require("widget/tab"),{html:function($data){var __="";with($data||{})__+=' <header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main bs_service" ref="main"> <div sn-require="widget/tab" sn-data="{{items:[\'生活服务\',\'通信服务\']}}"> <div class="pt_1"> <ul class="bs_service__list bd_t"> <li class="bs_service__item bd_br flex jc_c fd_c" sn-repeat="item in lifes" sn-tap="delegate.openUrl(item.linkurl)"> <i class="unread" sn-if="item.unread">+{item.unread}</i> <img sn-src="{sl.thumbnail(item.image)}" class="cir_m" /> <div class="mt_s fs_m">{item.title}</div> </li> </ul> </div> <div class="pt_1"> <ul class="bs_service__list bd_t"> <li class="bs_service__item bd_br flex jc_c fd_c" sn-repeat="item in services" sn-tap="delegate.openUrl(item.linkurl)"> <i class="unread" sn-if="item.unread">+{item.unread}</i> <img sn-src="{sl.thumbnail(item.image)}" class="cir_m" /> <div class="mt_s fs_m">{item.title}</div> </li> </ul> </div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/business/service",["css/app.css","css/append.css","models/business","logical/business","logical/news","models/news"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("models/business")),h=t("logical/business"),p=t("logical/news"),f=t("models/news");s.exports=a.extend({onCreate:function(){var t=this,e=f.getLifes(),s=f.getServices(),i=d.getGroups();this.groups=i;var n=this.model=new o(this.$el,{title:"服务大厅",lifes:e,services:s});n.delegate=this,n.back=function(){t.back(t.swipeRightBackAction)},this.syncUnread=this.syncUnread.bind(this),i.observe(this.syncUnread);var a=this.loader=new r(this.$el);a.showLoading(),c.all([p.getLifes(),p.getServices()]).then(function(e){t.syncUnread()})["catch"](function(t){l.showToast(t.message)}).then(function(){a.hideLoading()})},onShow:function(){},openUrl:function(t){/^\d+$/.test(t)&&(t="b"+t),h.redirect.jump(t)},syncUnread:function(){var t=this.groups.get("type1data.list").concat(this.groups.get("type2data.list")),e=function(t,e){return t.summary==e.business_id?{unread:e.unread}:null};this.model._("lifes").update(!1,t,e),this.model._("services").update(!1,t,e)},onDestroy:function(){this.groups.removeObserve(this.syncUnread),this.model.destroy()}})});define("template/hdh/hdh_index",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="hdh_index main bg_fff" ref="main"> <div class="hdh_index__banner"> <img src="images/hdh_banner.png" class="w_x1" /> </div> <div class="pt_xl pl_m"> 请选择号码 </div> <ul class="pt_l mb_m"> <li class="mb_l bd_app hdh_index__num {selected==i?\'bg_app cl_fff\':\'\'}" sn-tap="selected=i" sn-repeat="phone,i in poollist">{phone}</li> </ul> <div class="ta_c fs_m">号码所在地：{locationname}</div> <div class="pt_m pl_m"> 副号别名： </div> <div class="flex h_m pl_m bd_b ml_m mr_m"> <input class="flex_0 h_m" type="text" placeholder="请输入开通副号的别名，如未输入，默认副号1" /> </div> <div class="pl_m mb_xl fs_m"><span class="checkbox {agree?\'checked\':\'\'}" sn-tap="agree=!agree"></span><span class="va_m">我已阅读，<a href="/hdh/licence" class="cl_app">同意业务条款</a>，确认开通</span></div> <div class="pl_l pr_l mb_l"><button class="btn_xl" sn-tap="this.bindsub()">立即办理</button></div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/hdh/hdh_index",["css/app.css","css/append.css","logical/hdh"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),u=t("widget/popup"),d=t("logical/hdh");s.exports=a.extend({onCreate:function(){var t=this,e=this.loader=new r(this.$el),s=this.model=new o(this.$el,{title:"和多号",selected:0});s.back=function(){t.back(t.swipeRightBackAction)},s.sendSms=function(){if(!(this.attributes.smsTime>0)){var t=this.attributes.poollist[this.get("selected")];if(!t)return void l.showToast("请选择副号！");d.bindEntitySms(t)["catch"](function(t){l.showToast(t.message)}),this.leftTime=Date.now()+6e4,this.timer=setInterval(function(){var t=Math.round((s.leftTime-Date.now())/1e3);0>=t?(clearInterval(s.timer),s.set({smsTime:0})):s.set({smsTime:t})},1e3),this.set({smsTime:59})}},s.bindsub=function(){if(!e.isLoading&&this.attributes.poollist){if(!this.get("agree"))return void l.showToast("请先阅读并同意业务条款！");var t=this.attributes.poollist[this.get("selected")];if(!t)return void l.showToast("请选择副号！");e.showLoading(),d.bindsub(t).then(function(t){u.alert({content:"开通短信已发送，请按照短信操作开通副号",action:function(){d.getInfo(),s.back()}})})["catch"](function(t){l.showToast(t.message)}).then(function(){e.hideLoading()})}},s.bindEntityConfirm=function(){if(!e.isLoading&&this.attributes.poollist){var t=this.attributes.poollist[this.get("selected")];if(!t)return void l.showToast("请选择副号！");var s=this.get("sms");if(!s)return void l.showToast("请输入验证码！");e.showLoading(),d.bindEntityConfirm(t,s).then(function(t){})["catch"](function(t){l.showToast(t.message)}).then(function(){e.hideLoading()})}},e.showLoading(),c.all([d.getPoolsub(),this.waitLoad()]).then(function(e){var i=e[0];s.set(i.data),t.bindScrollTo(s.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){e.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/hdh/hdh_call",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button class="btn_xs cl_333" sn-tap="this.showMenu()">设置</button></div> </header> <div class="main g_has_footer" ref="main"> <ul> <li sn-repeat="item in callHistory" class="flex bg_fff h_bar bd_b hdh_call__history"> <div class="flex_1 pl_l"> <p class="name" sn-if="item.name">{item.name}</p> <p class="number">{item.phoneNumber}</p> </div> <button class="quan-call3 bg_fff w_bar" sn-tap="this.bridge.system.phoneCall(item.phoneNumber)"></button> <button class="quan-sms bg_fff w_bar" sn-tap="this.bridge.system.sendSMS(item.phoneNumber,\'\')"></button> </li> </ul> </div> <div class="hm_quan__menu_mask" style="display:none" ref="menuMask" sn-tap="this.hideMenu()"> </div> <div class="hm_quan__menu hdh_call__menu" ref="menu" style="display:none"> <ul> <li class="pl_m icon-add" sn-tap="this.add()"> <span class="va_m ml_s">新增副号</span> </li> <li class="pl_m icon-phone" sn-repeat="item,j in subPhoneList" sn-tap="this.setSubphone(item.subphone)"> <span class="va_m ml_s">{item.alias||(\'副号\'+item.order)}</span> </li> </ul> </div> <footer class="g_footer bd_t pt_xs"> <div class="hdh-phone ta_c" sn-tap="isShowKeybord=true"> <p class="fs_xs">拨号</p> </div> </footer> <div class="hdh_keyboard" sn-if="isShowKeybord"> <div class="input bd_t flex h_m pl_m"> <p class="fs_l flexitem"><span sn-if="!number" class="fs_m">请输入号码或拼音</span>{number}</p> <button class="hdh-del h_m w_m bg_0000" sn-tap="number=number.substr(0,number.length-1)"></button> <button class="quan-person h_m w_m bg_0000" data-forward="/hdh/contacts"></button> </div> <div class="bd_t h_bar flex"> <button class="bg_fff flexitem fs_xl" sn-click="this.number(1)">1 <i>&nbsp;</i></button> <button class="bg_fff flexitem fs_xl" sn-click="this.number(2)">2 <i>ABC</i></button> <button class="bg_fff flexitem fs_xl" sn-click="this.number(3)">3 <i>DEF</i></button> </div> <div class="h_bar flex"> <button class="bg_fff flexitem fs_xl" sn-click="this.number(4)">4 <i>GHI</i></button> <button class="bg_fff flexitem fs_xl" sn-click="this.number(5)">5 <i>JKL</i></button> <button class="bg_fff flexitem fs_xl" sn-click="this.number(6)">6 <i>MNO</i></button> </div> <div class="h_bar flex"> <button class="bg_fff flexitem fs_xl" sn-click="this.number(7)">7 <i>PQRS</i></button> <button class="bg_fff flexitem fs_xl" sn-click="this.number(8)">8 <i>TUV</i></button> <button class="bg_fff flexitem fs_xl" sn-click="this.number(9)">9 <i>WXYZ</i></button> </div> <div class="h_bar flex"> <button class="bg_fff flexitem fs_xxl fw_b" sn-click="this.number(\'*\')">*</button> <button class="bg_fff flexitem fs_xl" sn-click="this.number(0)">0</button> <button class="bg_fff flexitem fs_xl fw_b" sn-click="this.number(\'#\')">#</button> </div> <div class="flex hdh_keyboard__ft"> <button class="hdh-phone ta_c flex_1 bg_fff" sn-tap="isShowKeybord=false"> <p class="fs_xs">拨号</p> </button> <button class="hdh-call ta_c flex_1 bg_fff" sn-tap="this.call()"> </button> <button class="quan-sms2 ta_c flex_1 bg_fff" sn-tap="this.sendSMS()"> </button> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/hdh/hdh_call",["css/app.css","css/append.css","logical/hdh","models/hdh","models/user","models/friends"],function(t,e,s){var i=t("$"),n=t("util"),a=t("activity"),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),u=t("widget/popup"),d=t("bridge"),h=t("logical/hdh"),p=t("models/hdh"),f=t("models/user"),m=t("models/friends");s.exports=a.extend({onCreate:function(){var t=this,e=p.getSubPhoneList(),s=p.getHistory(),a=m.getFriends(),_=[];t.onResult("SELECT_CONTACT",function(t,e){_.push(e),g.set({number:e.phoneNumber})});var g=this.model=new o(this.$el,{title:"和多号",subPhoneList:e,number:"",isShowKeybord:!0,callHistory:s});g.back=function(){t.back(t.swipeRightBackAction)},g.add=function(){g.hideMenu(),t.forward("/hdh/index")},g.setSubphone=function(e){g.hideMenu(),t.forward("/hdh/subphone/"+e)},g.showMenu=function(){i(this.refs.menuMask).show(),i(this.refs.menu).show()},g.hideMenu=function(t,e){i(this.refs.menuMask).hide(),i(this.refs.menu).hide()},g.number=function(t){this.set({number:this.get("number")+t})},g.sendSMS=function(){this.callOrSendSMS("sendSMS")},g.call=function(){this.callOrSendSMS("call")};var v=function(t){var e=a.find("account",t);if(e)return m.getUserShowName(e.data);var s=n.first(_,"phoneNumber",t);return s?s.contactName:void 0};g.bridge=d,g.callOrSendSMS=function(t,i){var r,n=[],a=i||this.get("number");return e.each(function(e,i){e=e.data,n.push({text:"副号"+e.order+":"+e.subphone+(1==e.state.charAt(0)?"(关机)":""),click:function(){if(1==e.state.charAt(0))l.showToast("该副号已关机");else{if(!a)return void l.showToast("请拨号");var i="12583"+e.order+a;"call"===t?(s.add({phoneNumber:i,name:v(a)}),d.system.phoneCall(i)):d.system.sendSMS(i,""),r.hide()}}})}),r=u.options({options:[{text:"主号:"+f.get("account"),click:function(){return a?("call"===t?(s.add({phoneNumber:a,name:v(a)}),d.system.phoneCall(a)):d.system.sendSMS(a,""),void r.hide()):void l.showToast("请拨号")}}].concat(n)}),!1};var b=this.loader=new r(this.$el);b.showLoading(),c.all([h.getInfo(),this.waitLoad()]).then(function(e){var s=e[0].data,i=s?s.subphonelist:null;i&&i.length||t.forward("/hdh/index"),t.bindScrollTo(g.refs.main)})["catch"](function(e){8401==e.retCode?t.forward("/hdh/index"):l.showToast(e.message)}).then(function(){b.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/hdh/hdh_licence",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main" ref="main"> <div class="pd_l bg_fff"> <div class="pb_m"><strong>使用说明：</strong></div> <p class="pb_m fs_m">1、业务功能费5元/月/号码，每位客户最多可注册3个副号。</p> <p class="pb_m fs_m">2、使用副号所产生的通话费用，均从主号余额中扣除。</p> <p class="pb_m fs_m">3、副号短信功能默认关闭，进入副号设置可自主开启，该功能无需额外资费。</p> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/hdh/hdh_licence",["css/app.css","css/append.css"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast");t("widget/popup");s.exports=a.extend({onCreate:function(){var t=this,e=this.model=new o(this.$el,{title:"业务条款"});e.back=function(){t.back(t.swipeRightBackAction)};var s=this.loader=new r(this.$el);s.showLoading(),c.all([this.waitLoad()]).then(function(s){t.bindScrollTo(e.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/hdh/hdh_contacts",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main ct_contactlist" ref="main"> <div class="ct_contactlist__search"> <form class="ps_r zi_1 flex"> <p class="icon-search ml_m"></p> <input type="text" class="bd_n ml_s flexitem fs_m" placeholder="搜索好友" /> </form> </div> <div class="ct_contactlist__group" sn-repeat="group in groups"> <div class="hd fs_m pd_s ml_m">{group.letter}</div> <ul class="ct_contactlist__list bd_t bg_fff"> <li class="bd_b flex" sn-repeat="item in group.list" sn-tap="delegate.selectContact(item)"> <p class="{phoneNumber==item.phoneNumber?\'icon-checked\':\'icon-check\'}"></p> <div class="flexitem ml_m"> <p class="fs_l">{item.contactName}</p> <p class="fs_s cl_666">{item.phoneNumber}</p> </div> </li> </ul> </div> </div> <ul class="ct_friends__letters"> <li class="icon-search2"></li> <li sn-repeat="item in letters"><a href="javascript:;">{item}</a></li> <li>#</li> </ul>';return __},helpers:{}});return T.template=T.html,T});define("views/hdh/hdh_contacts",["css/app.css","css/append.css","logical/contact","models/friends"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),o=(t("bridge"),t("widget/loader")),c=t("core/model2").Model,l=t("promise"),u=t("widget/toast"),h=(t("widget/popup"),t("utils/firstLetter")),p=t("logical/contact");t("models/friends");s.exports=a.extend({onCreate:function(){var t=this,e=this.model=new c(this.$el,{title:"选择联系人",letters:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")});e.delegate=this,e.back=function(){t.back(t.swipeRightBackAction)};var s=this.loader=new o(this.$el);s.showLoading();var i=[];l.all([p.getAllContacts({},function(s){i=i.concat(s),e.set("groups",t.groups(i))}),this.waitLoad()]).then(function(s){t.bindScrollTo(e.refs.main)})["catch"](function(t){u.showToast(t.message)}).then(function(){s.hideLoading()})},onShow:function(){},groups:function(t){var s=(this.model,{});return t&&t.length?(t.forEach(function(t){var e=h(t.contactName).charAt(0).toUpperCase();s[e]||(s[e]=[]),s[e].push(t)}),s=Object.keys(s).map(function(t){return{letter:t,list:s[t]}}),s.sort(function(t,e){return t.letter==e.letter?0:t.letter>e.letter?1:-1}),s):[]},selectContact:function(t){this.setResult("SELECT_CONTACT",t),this.model.back()},onDestroy:function(){this.model.destroy()}})});define("template/hdh/subphone",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> </header> <div class="main pt_m" ref="main"> <div class="flex h_bar bg_fff bd_tb pr_m"> <div class="flexitem pl_m"> <p class="mobi cl_app">{info.subphone}</p> <p class="fs_xs">副号关机并不影响主号使用</p> </div> <div class="cp_switch{info.state.charAt(0)!=1?\'\':\' cp_switch_on\'}" sn-tap="delegate.setPower(info.state.charAt(0)!=1)"></div> </div> <div class="flex h_bar bg_fff bd_b pr_m"> <div class="flexitem pl_m"> 默认拨号 </div> <div class="cp_switch{info.isDefault?\' cp_switch_on\':\'\'}" sn-tap="info.isDefault=!info.isDefault"></div> </div> <div class="flex h_bar bg_fff bd_b mb_m" sn-tap="delegate.setMemo()"> <div class="flexitem pl_m"> 副号别名 </div> <p class="g_arrow pr_xl">{info.alias||defAlias}</p> </div> <!--<div class="flex h_bar bg_fff bd_tb mb_m"> <div class="flexitem pl_m"> 定时开关 </div> <p class="g_arrow pr_xl"></p> </div>--> <div class="flex h_bar bg_fff bd_tb pr_m"> <div class="flexitem pl_m"> 不接电话 </div> <div class="cp_switch{(info.state.charAt(0)==2||info.state.charAt(0)==4)?\' cp_switch_on\':\'\'}" sn-tap="delegate.interceptCall(info.state.charAt(0)==2||info.state.charAt(0)==4)"></div> </div> <div class="h_m fs_m pr_m pl_m pt_s"> 开启后，该副号所有来电将被拦截。 </div> <div class="flex h_bar bg_fff bd_tb pr_m"> <div class="flexitem pl_m"> 不收短信 </div> <div class="cp_switch{(info.state.charAt(0)==3||info.state.charAt(0)==4)?\' cp_switch_on\':\'\'}" sn-tap="delegate.interceptSms(info.state.charAt(0)==3||info.state.charAt(0)==4)"></div> </div> <div class="h_m fs_m pr_m pl_m pt_s"> 开启后，该副号所有短彩信将被拦截。 </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/hdh/subphone",["css/app.css","css/append.css","logical/hdh","models/hdh"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),o=t("core/model2").Model,c=t("promise"),l=t("widget/toast"),d=(t("widget/popup"),t("logical/hdh")),h=t("models/hdh");s.exports=a.extend({onCreate:function(){var t=this,e=this.subphone=this.route.params.subphone,s=h.getSubPhoneList(s),i=h.getSubInfo(e),n=this.model=new o(this.$el,{title:"副号配置",info:i,defAlias:"副号"+(1+s.indexOf(i))});n.delegate=this,n.back=function(){t.back(t.swipeRightBackAction)};var a=this.loader=new r(this.$el);a.showLoading(),c.all([d.subinfo(e),this.waitLoad()]).then(function(e){t.bindScrollTo(n.refs.main)})["catch"](function(t){l.showToast(t.message)}).then(function(){a.hideLoading()})},setPower:function(t){var e=this.loader;this.subphone;e.showLoading(),d.setPower(this.subphone,t).then(function(){})["catch"](function(t){l.showToast(t.message)}).then(function(){e.hideLoading()})},interceptSms:function(t){var e=this.loader;this.subphone;e.showLoading(),d.interceptSms(this.subphone,t).then(function(){})["catch"](function(t){l.showToast(t.message)}).then(function(){e.hideLoading()})},interceptCall:function(t){var e=this.loader;this.subphone;e.showLoading(),d.interceptCall(this.subphone,t).then(function(){})["catch"](function(t){l.showToast(t.message)}).then(function(){e.hideLoading()})},setDefaultCall:function(){},setMemo:function(){this.forward("/hdh/memo/"+this.subphone+"?alias="+(this.model.get("info.alias")||this.model.get("defAlias")))},onShow:function(){},onDestroy:function(){this.model.destroy()}})});define("template/hdh/hdh_memo",["util"],function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-tap="this.back()"></div> <div class="head_title">{title}</div> <div class="head_right"><button class="btn_xs" disabled=\'{text==origin||!text}\' sn-tap="this.save()">保存</button></div> </header> <div class="main" ref="main"> <div class="ct_memo__input bd_tb"> <input type="text" sn-model="text" value="{text}" ref="text" /> <div class="icon-reset" sn-tap="text=\'\'"></div> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/hdh/hdh_memo",["css/app.css","css/append.css","logical/hdh","models/hdh"],function(t,e,s){var a=(t("$"),t("util"),t("activity")),r=t("widget/loader"),o=t("core/model2").Model,l=(t("promise"),t("widget/toast")),d=(t("widget/popup"),t("logical/hdh"));t("models/hdh");s.exports=a.extend({onCreate:function(){var t=this,e=this.route.params.subphone,s=this.loader=new r(this.$el),i=this.route.query.alias,n=this.model=new o(this.$el,{title:"副号别名",text:i,origin:i});n.save=function(){s.showLoading();var t=this.get("text");d.setAlias(e,t).then(function(){l.showToast("修改成功！"),n.back()})["catch"](function(t){l.showToast(t.message)}).then(function(){s.hideLoading()})},n.back=function(){t.back(t.swipeRightBackAction)}},onShow:function(){},onDestroy:function(){this.model.destroy()}})});