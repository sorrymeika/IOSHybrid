define("template/about",function(require){var util=require("util"),T={html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main"> <div class="aboutus"> 邻师是一个针对0～18岁学生（家长）和教师的教育资源整合平台，我们专门帮助小微培训机构，教师工作室及教师个人进行品牌塑造和市场推广，我们希望让老师能够招到更多的优质学生，让学生找到更合适自己的老师。 <img src="'+util.encodeHTML(webresource("images/aboutus.jpg"))+'" /> <div class="aboutus_ver">发现身边好老师</div> </div> </div> ';return __},helpers:{}};return T.template=T.html,T});define("views/menu",["images/style.css"],function(e,t,i){{var o=(e("$"),e("util")),r=e("activity"),a=e("bridge"),l=e("core/model");e("../widget/scroll"),e("../widget/loading")}return r.extend({toggleAnim:"menu",className:"menu",events:{tap:function(e){},"tap [data-logout]":function(e){}},swipeLeftBackAction:"/",onCreate:function(){var e=this;a.hasStatusBar&&this.$el.find(".menu_bd").addClass("fix_statusbar"),this.model=new l.ViewModel(this.$el,{memberUrl:"/member",logout:function(){o.store("user",null),e.back("/")}})},onShow:function(){var e=this,t=o.store("user");t?e.isLoad||(e.isLoad=!0,e.user=t,e.model.set({user:t})):this.model.set({user:null})},onDestory:function(){}})});define("template/menu",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<div class="menu_bd"> <div class="menu_user" sn-binding="data-back:memberUrl"> <img class="menu_avatars" sn-binding="src:user.Avatars" /> <div class="menu_username"> <h1 sn-binding="html:user|equal:null:\'未登录\':user.NickName"></h1> <h2 sn-binding="html:user.Mobile"></h2> </div> </div> <ul class="menu_list"> <li class="menu_activity" data-back="/myactivity">我的活动</li> <li class="menu_comments" data-back="/mycomments">我的评论</li> </ul> <ul class="menu_list"> <li class="menu_pwd" data-back="/modifypwd">修改密码</li> <li class="menu_settings" data-back="/member">设置</li> <li class="menu_logout" sn-binding="display:user" sn-on="click:logout">退出</li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("template/index",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div sn-binding="class:menu"></div> <div sn-binding="html:title,class:titleClass"></div> <div class="head_city"><text sn-binding="html:city"></text><span sn-binding="html:weather"></span><i></i></div> <div class="head_search_btn"><b class="btn_small js_comment" style="display:none">发表评论</b></div> </header> <div class="main" data-index="0"> <ul class="recommend_list js_comment_list"> <li class="recommend_item" sn-repeat="item in data0"> <a sn-binding="href:item|format:\'/recommend/{ID}\'" forward> <img sn-binding="src:item.Pic" /> <div class="recommend_name" sn-binding="html:item.Name"></div> <div class="recommend_fav" sn-binding="html:item.Favorite"></div> </a> </li> </ul> </div> <div class="citylistwrap"> <div class="city_list"> <h1>选择城市</h1> <ul> <li sn-repeat="item in city_list" sn-binding="data-id:item.city_id"> <span sn-binding="html:item.city_name" sn-on="tap:cityTip"></span> </li> </ul> </div> </div> <div class="main js_destination" style="display:none" data-index="1"> </div> <div class="main" style="display:none" data-index="2"> <ul class="recommend_list activity_list"> <li class="recommend_item" sn-repeat="item in data2" sn-binding="data-id:item.ID"> <a sn-binding="href:item.ID|format:\'/activity/{0}\'" forward> <img sn-binding="src:item.Pic" /> <div class="recommend_name" sn-binding="html:item.Name"></div> <div class="recommend_fav" sn-binding="html:item.Favorite"></div> </a> </li> </ul> </div> <div class="main" style="display:none" data-index="3"> <ul class="quan_list"> <li class="quan_item" sn-repeat="item in data3" sn-binding="data-id:item.ID"> <div class="quan_user"> <img sn-binding="src:item.Avatars" /> <div class="bd"> <h2 sn-binding="html:item.NickName|or:item.Mobile"></h2> <div class="time" sn-binding="html:item.InsertTime|date:\'MM-dd hh:ss\'"></div> </div> <div class="ft"> <span class="quanli_reply" sn-binding="html:item.Reply|length"></span> <span class="quanli_up" sn-binding="html:item.Up"></span> </div> </div> <div class="quan_con" sn-binding="html:item.Content"></div> <ul class="quan_images"> <li sn-repeat="pic,i in item.Pictures" sn-binding="class:item.Pictures|length|format:\'quan_images_{0}\'"> <img sn-binding="src:pic.Src" sn-on="tap:showPic:item.Pictures:i" /> </li> </ul> <div class="quan_item quan_reply" sn-repeat="reply in item.Reply" sn-binding="data-id:item.ID,data-at:reply.NickName|or:reply.Mobile"> <div class="quan_user"> <img sn-binding="src:reply.Avatars" /> <div class="bd"> <h2 sn-binding="html:reply.NickName|or:reply.Mobile"></h2> <div class="time" sn-binding="html:reply.InsertTime|date:\'MM-dd hh:ss\'"></div> </div> <div class="ft"> <span class="quanli_reply"></span> </div> </div> <div class="quan_con" sn-binding="html:reply.Content"></div> </div> </li> </ul> </div> <div class="picviewer js_picviewer" style="display:none"> </div> <ul class="footer"> <li class="curr">推荐</li> <li>目的地</li> <li>活动</li> <li>驴友圈</li> </ul>';return __},helpers:{}});return T.template=T.html,T});define("template/member",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main scrollview"> <div class="member"> <iframe style="top:-999px;left:-999px;position:absolute;display:none;" frameborder="0" width="0" height="0" name="__upload"></iframe> <form sn-binding="action:upload" method="post" class="member_avatars" enctype="multipart/form-data"> <input type="file" name="Avatars" /> <input type="hidden" name="userId" sn-binding="value:user.ID" /> <input type="hidden" name="auth" sn-binding="value:user.Auth" /> <img sn-binding="src:user.Avatars" /> </form> <ul class="member_info"> <li> <div>昵称</div> <div><input sn-binding="value:user.NickName,readonly:NickName.readonly" sn-model="NickName.input" /></div> <b sn-binding="class:NickName.edit,html:NickName.value" sn-on="click:NickName.click"></b> </li> <li class="member_one"> <div>性别：</div> <div> <span class="radio" member="gender" value="1" sn-binding="class:user.Gender|equal:1:\'checked radio\':\'radio\'">男</span> <span class="radio" member="gender" value="0" sn-binding="class:user.Gender|equal:0:\'checked radio\':\'radio\'">女</span> </div> </li> <li> <div>地址</div> <div><input sn-binding="value:user.Address,readonly:Address.readonly" sn-model="Address.input" /></div> <b sn-binding="class:Address.edit,html:Address.value" sn-on="click:Address.click"></b> </li> </ul> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/about",["images/style.css"],function(e,i,t){{var a=(e("$"),e("util"),e("activity")),d=(e("../widget/extend/loading"),e("../core/model")),r=e("../widget/scroll");e("animation")}return a.extend({events:{},swipeRightBackAction:"/settings",onCreate:function(){var i=this.$(".main");r.bind(i),this.model=new d.ViewModel(this.$el,{back:"/settings",title:"关于我们"})},onShow:function(){},onDestory:function(){}})});define("template/myactivity",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main"> <ul class="myactivity"> <li sn-repeat="item in data" sn-binding="data-id:item.ID"> <div> <b sn-binding="html:item.Name"></b> <span sn-binding="html:item.JoinTime|date:\'MM-dd hh:mm\'"></span> </div> <em sn-binding="class:item.StatusID|format:\'myact_status{0}\',html:item.Status"></em> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/member",["images/style.css"],function(e,i,t){var s=e("$"),n=(e("util"),e("activity")),l=e("core/model"),r=(e("../widget/scroll"),e("bridge")),m=e("../widget/loading"),c=0;return n.extend({events:{'tap [member="gender"]':function(e){var i=e.currentTarget.getAttribute("value");this.model.get("user.Gender")!=i&&this.setMemberInfo({userid:this.user.ID,auth:this.user.Auth,Gender:i})},'change form input[type="file"]':function(e){c++;{var n,i=this,t=e.target.parentNode,a="_submit_iframe"+c;s('<iframe style="top:-999px;left:-999px;position:absolute;display:none;" frameborder="0" width="0" height="0" name="'+a+'"></iframe>').appendTo(document.body).on("load",function(){var e;try{e=s.trim(this.contentWindow.document.body.innerHTML)}catch(t){return void i.loading.load()}if(!n||e!=n){n=e;try{if(e=JSON.parse(n),e.success){var a=Date.now();localStorage.setItem("photo_ver",a),i.loading.load(),sl.tip("您的头像已生效")}else sl.tip(e.msg)}catch(t){sl.tip(t.message)}}})}t.target=a,t.submit()}},swipeRightBackAction:"/",setMemberInfo:function(e){var i=this;this.loading.showLoading(),s.post(r.url("/api/user/update"),e,function(t){t.success?i.model.set("user",e):sl.tip(t.msg),i.loading.hideLoading()},"json")},onCreate:function(){var e=this;this.model=new l.ViewModel(this.$el,{title:"个人信息",back:"/",upload:r.url("/api/user/update")}),["NickName","Address"].forEach(function(i){e.model.set(i,{edit:"edit",value:"",readonly:!0,click:function(t){if("edit"==this.data.edit)e.model.set(i,{value:"确定",readonly:null,edit:"editing"}),e["$"+i].focus();else{if(e.model.data.user[i]!=this.data.input){var s={userid:e.user.ID,Auth:e.user.Auth};s[i]=this.data.input,e.setMemberInfo(s)}e.model.set(i,{readonly:!0,value:"",edit:"edit"})}}}),e["$"+i]=e.model.$el.find('[sn-model="'+i+'.input"]')})},onShow:function(){var e=this,i=localStorage.getItem("user");i?(e.user=i=JSON.parse(i),""===i.Avatars&&(i.Avatars=null),this.loading=new m({url:"/api/user/get",check:!1,checkData:!1,params:{userid:i.ID,auth:i.Auth},$el:this.$el,success:function(t){e.user=i=s.extend(i,t.data),""===i.Avatars?i.Avatars=null:i.Avatars=i.Avatars+"?v="+localStorage.getItem("photo_ver"),localStorage.setItem("user",JSON.stringify(i)),e.model.set({user:i,"NickName.input":i.NickName,"Address.input":i.Address})}}),this.loading.load()):this.forward("/login")},onDestory:function(){}})});define("template/settings",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main"> <div class="settings"> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/settings",["images/style.css"],function(e,i,t){{var n=(e("$"),e("util"),e("activity")),d=(e("../widget/loading"),e("../core/model")),r=e("../widget/scroll");e("animation")}return n.extend({events:{"tap .js_bind:not(.disabled)":function(){},"tap .logout":function(){localStorage.getItem("member")?(localStorage.removeItem("member"),this.back("/")):this.forward("/login")}},swipeRightBackAction:"/",onCreate:function(){var i=this.$(".main");r.bind(i),this.model=new d.ViewModel(this.$el,{back:"/",title:"设置",settings:[{title:"关于我们",href:"/about"}]});var t=localStorage.getItem("member");t?(t=JSON.stringify(t),this.model.set("logout","退出当前账号")):this.model.set("logout","立即登录")},onShow:function(){},onDestory:function(){}})});define("template/login",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div sn-binding="html:title" class="head_title"></div> <div class="head_back" sn-binding="data-back:back"></div> </header> <div class="main"> <div class="login_form"> <ul class="form"> <li><input placeholder="输入手机号" sn-model="mobile" /></li> <li><input placeholder="输入密码" sn-model="password" type="password" /></li> </ul> <div class="login_btn"><b class="btn_large js_login">登录</b> </div> <div class="login_notice"><a href="/register" forward>我要注册</a> | <a href="/forget" forward>忘记密码？</a></div> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("template/mycomments",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main"> <ul class="quan_list"> <li class="quan_item" sn-repeat="item in comments" sn-binding="data-id:item.ID,data-type:item.Type"> <div class="quan_user"> <img sn-binding="src:item.Avatars" /> <div class="bd"> <h2 sn-binding="html:item.NickName|or:item.Mobile"></h2> <div class="time" sn-binding="html:item.InsertTime|date:\'MM-dd hh:ss\'"></div> </div> <div class="ft"> <span class="quanli_reply" sn-binding="html:item.Reply|length"></span> </div> </div> <div class="quan_con" sn-binding="html:item.Content"></div> <div class="quan_item quan_reply" sn-repeat="reply in item.Reply" sn-binding="data-id:item.ID,data-type:item.Type,data-at:reply.NickName|or:reply.Mobile"> <div class="quan_user"> <img sn-binding="src:reply.Avatars" /> <div class="bd"> <h2 sn-binding="html:reply.NickName|or:reply.Mobile"></h2> <div class="time" sn-binding="html:reply.InsertTime|date:\'MM-dd hh:ss\'"></div> </div> <div class="ft"> <span class="quanli_reply"></span> </div> </div> <div class="quan_con" sn-binding="html:reply.Content"></div> </div> </li> </ul> </div>';return __},helpers:{}});return T.template=T.html,T});define("template/search",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" data-back="/"></div> <div class="head_search"><input placeholder="输入姓名或手机号搜索老师" sn-model="keywords" /></div> <div class="head_search_btn"><b class="btn_small js_search">搜索</b></div> </header> <div class="main"> <ul class="search_list"> <li class="search_item" sn-repeat="item in data" sn-binding="data-id:item.teacher_id"> <div class="s_teacher"><img class="search_photo" sn-binding="src:item.head_photo" /> <ul class="s_teacher_basic"> <li><strong class="s_name" sn-binding="html:item.teacher_name"></strong><em sn-binding="html:item.discipline"></em><i sn-binding="html:item.price|round|concat:\'元/小时\'"></i></li> <li><span class="s_area" sn-binding="html:item.area"></span><span class="s_age" sn-binding="html:item.teaching_age|concat:\'教龄\'"></span></li> <li class="s_data"><span sn-binding="html:item.class_hours_number|concat:\'小时\'"></span><span sn-binding="html:item.students_number|concat:\'个\'"></span><span sn-binding="html:item.praise_rate"></span><span sn-binding="html:item.continue_rate"></span></li> </ul> </div> <!--<div class="s_honor" sn-binding="html:item.honor|format:\'获得荣誉：{0}\'"></div>--> <ul class="s_cert"> <li class="cert" sn-binding="display:item.certification_flag">身份认证</li> <li class="t_cert" sn-binding="display:item.teacher_certification_flag">教师资格认证</li> <li class="education" sn-binding="display:item.education_flag">学历认证</li> </ul> </li> </ul> </div> ';return __},helpers:{}});return T.template=T.html,T});define("views/myactivity",["images/style.css"],function(i,e,t){{var s=i("$"),a=i("util"),n=i("activity"),l=i("../widget/loading"),d=i("../core/model"),r=i("../widget/scroll");i("animation")}return n.extend({events:{"tap .myactivity > li[data-id]":function(i){var e=s(i.currentTarget);this.forward("/activity/"+e.data("id")+"?from="+this.route.url)}},swipeRightBackAction:"/",onCreate:function(){var i=this,e=this.$(".main");r.bind(e),this.model=new d.ViewModel(this.$el,{back:"/",title:"我的活动"});var t=new l({url:"/api/user/activity_list",$el:this.$el,success:function(e){i.model.set("data",e.data)},append:function(e){i.model.get("data").append(e.data)}});i.user=a.store("user"),i.user&&t.setParam({UserID:i.user.ID,Auth:i.user.Auth}).load()},onShow:function(){var i=this;i.user=a.store("user"),i.user||i.forward("/login?success="+this.route.url+"&from="+this.route.url)},onDestory:function(){}})});define("views/mycomments",["images/style.css"],function(i,e,t){{var s=i("$"),a=i("util"),n=i("activity"),l=i("../widget/loading"),d=i("../core/model"),r=i("../widget/scroll");i("animation")}return n.extend({events:{"tap .quanli_reply":function(i){var e=s(i.currentTarget),t=e.closest("[data-id]"),n=t.data("id"),l=t.data("type"),d=t.data("at");a.store("replyAt",d?"@"+d:null),this.forward("/reply/"+n+"?type="+l+"&from="+this.route.url)}},swipeRightBackAction:"/",onCreate:function(){var i=this,e=this.$(".main");r.bind(e),this.model=new d.ViewModel(this.$el,{back:"/",title:"我的评论"});var t=new l({url:"/api/user/comment_list?status=1",$el:this.$el,success:function(e){i.model.set("comments",e.data)},append:function(e){i.model.get("comments").append(e.data)}});i.user=a.store("user"),i.user&&t.setParam({UserID:i.user.ID,Auth:i.user.Auth}).load(),i.onResult("comment_success",function(){t.reload()})},onShow:function(){var i=this;i.user=a.store("user"),i.user||i.forward("/login?success="+this.route.url+"&from="+this.route.url)},onDestory:function(){}})});define("views/search",["images/style.css"],function(e,i,t){{var n=(e("$"),e("util"),e("activity")),l=e("../widget/extend/loading"),d=e("../core/model"),r=e("../widget/scroll");e("animation")}return n.extend({events:{'tap [sn-repeat-name="data"][data-id]':function(e){this.forward("/teacher/"+e.currentTarget.getAttribute("data-id")+"?from="+this.route.url)},"tap .js_search":function(e){var i=this.getParam(this.model.data.keywords);this.loading.setParam(i).reload()}},getParam:function(e){var i={compare_field:"q"==e?"":e};return this.route.queries.course_category&&(i.course_category=this.route.queries.course_category),i},onCreate:function(){var e=this,i=this.$(".main");r.bind(i,{refresh:function(i,t){e.loading.reload({showLoading:!1},function(e,s){e?t(e):i(s)})}}),this.loading=new l({url:"/teacher/teacher_list",check:!1,checkData:!1,params:this.getParam(this.route.data.keywords),$el:this.$el,$content:i.children(":first-child"),$scroll:i,success:function(i){i.data.length>=10?i.total=(this.pageIndex+1)*this.pageSize:i.data&&i.data.length||this.showError({showReload:!1,msg:"搜索不到您要找的老师"}),console.log(e.model),e.model.set(i)},append:function(i){i.data.length>=10&&(i.total=(this.pageIndex+1)*this.pageSize),e.model.get("data").append(i.data)}}),this.model=new d.ViewModel(this.$el,{}),this.loading.load()},onShow:function(){},onDestory:function(){}})});define("views/login",["images/style.css"],function(e,i,t){var a=(e("$"),e("util")),n=e("activity"),l=e("../widget/loading"),d=e("../core/model"),r=e("../widget/scroll"),m=(e("animation"),e("util/md5"));return n.extend({events:{"tap .js_login:not(.disabled)":function(){var e=this.model.get("mobile"),i=this.model.get("password");return e&&a.validateMobile(e)?i?void this.loading.setParam({mobile:e,password:m.md5(i)}).load():void sl.tip("请输入密码"):void sl.tip("请输入正确的手机")}},swipeRightBackAction:"/",onCreate:function(){var e=this,i=this.$(".main");r.bind(i),this.model=new d.ViewModel(this.$el,{title:"登录",back:this.route.queries.from||"/"}),this.loading=new l({url:"/api/user/login",method:"POST",check:!1,checkData:!1,$el:this.$el,xhrFields:{withCredentials:!0},success:function(i){i.success?(a.store("user",i.data),e.back(e.route.queries.success||"/")):sl.tip(i.msg)},error:function(e){sl.tip(e.msg)}})},onShow:function(){},onDestory:function(){}})});define("views/destination",["images/style.css"],function(e,i,t){var a=(e("$"),e("util")),n=e("activity"),l=e("../widget/loading"),d=e("../core/model"),r=e("../core/promise"),c=e("../widget/scroll"),m=(e("animation"),e("common"));return n.extend({events:{"tap .js_comment":function(){this.forward("/destcomment/"+this.route.data.id)},"tap .destfav":function(){a.store("user")?(this.model.set("isFavorite",!this.model.data.isFavorite),this.model.set("data.Favorite",(this.model.data.data.Favorite||0)+(this.model.data.isFavorite?1:-1)),m.favorite("destination",this.route.data.id,this.model.data.isFavorite)):sl.tip("请先登录")}},onCreate:function(){var e=this;this.promise=new r,this.$main=this.$(".main"),c.bind(this.$main),d.Filter.precent=function(e){return parseFloat(e)+"%"},this.model=new d.ViewModel(this.$el,{title:"目的地详情",back:this.route.queries.from||"/",isFavorite:m.isFavorite("destination",this.route.data.id)});var i=a.store("user");this.loading=new l({url:"/api/destination/get",params:{id:this.route.data.id,member_id:i?i.ID:0},check:!1,checkData:!1,$el:this.$el,$content:this.$main.children(":first-child"),$scroll:this.$main,success:function(i){e.promise.then(function(){e.model.set(i)}),localStorage.setItem("destination",JSON.stringify(i.data))}}),this.loading.load(),this.comments=new l({url:"/api/destination/comment_list",params:{id:this.route.data.id},$el:e.$(".quan_list"),success:function(i){e.model.set("comments",i.data)},append:function(i){e.model.get("comments").append(i.data)}}),this.comments.load(),e.onResult("comment_success",function(){e.comments.reload()})},onLoad:function(){this.promise.resolve()},onDestory:function(){}})});define("views/recommend",["images/style.css"],function(e,i,t){var a=(e("$"),e("util")),n=e("activity"),l=e("../widget/loading"),d=e("../core/model"),r=e("../core/promise"),o=e("../widget/scroll"),m=(e("animation"),e("common"));return n.extend({events:{"tap .js_comment":function(){this.forward("/reccomment/"+this.route.data.id)},"tap .destfav":function(){a.store("user")?(this.model.set("isFavorite",!this.model.data.isFavorite),this.model.set("data.Favorite",(this.model.data.data.Favorite||0)+(this.model.data.isFavorite?1:-1)),m.favorite("recommend",this.route.data.id,this.model.data.isFavorite)):sl.tip("请先登录")}},onCreate:function(){var e=this;this.promise=new r,this.$main=this.$(".main"),o.bind(this.$main),d.Filter.precent=function(e){return parseFloat(e)+"%"},this.model=new d.ViewModel(this.$el,{title:"推荐详情",back:this.route.queries.from||"/",isFavorite:m.isFavorite("recommend",this.route.data.id)});a.store("user");this.loading=new l({url:"/api/recommend/get",params:{id:this.route.data.id},check:!1,checkData:!1,$el:this.$el,$content:this.$main.children(":first-child"),$scroll:this.$main,success:function(i){e.promise.then(function(){e.model.set(i)}),localStorage.setItem("recommend",JSON.stringify(i.data))}}),this.loading.load(),this.comments=new l({url:"/api/recommend/comment_list",params:{id:this.route.data.id},$el:e.$(".quan_list"),success:function(i){e.model.set("comments",i.data)},append:function(i){e.model.get("comments").append(i.data)}}),this.comments.load(),e.onResult("comment_success",function(){e.comments.reload()})},onLoad:function(){this.promise.resolve()},onDestory:function(){}})});define("template/register",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div sn-binding="html:title" class="head_title"></div> <div class="head_back" sn-binding="data-back:back"></div> </header> <div class="main"> <div class="login_form"> <ul class="form"> <li><input placeholder="输入手机号" sn-model="mobile" /></li> <li><input placeholder="验证码" sn-model="smsCode" type="text" /> <b class="js_valid btn_middle" sn-binding="html:valid"></b></li> <li><input placeholder="设置密码" sn-model="password" type="password" /></li> <li><input placeholder="再次输入确认密码" sn-model="password1" type="password" /></li> </ul> <div class="login_btn"><b class="btn_large js_bind">确定注册</b> </div> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("template/destination",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main destwrap"> <div class="destimg"> <img sn-binding="src:data.MiddlePic" /> <div class="destfav" sn-binding="html:data.Favorite,class:isFavorite|equal:true:\'destfav fav_current\':\'destfav\'"></div> <h1 sn-binding="html:data.Name"></h1> </div> <div class="destinfo"> <h2>详情</h2> <div class="destcontent" sn-binding="html:data.Content"></div> </div> <div class="destinfo"> <h2><span class="destcomment js_comment">发表评论</span>评论</h2> <div class="destcontent"> <ul class="quan_list"> <li class="quan_item" sn-repeat="item in comments" sn-binding="data-id:item.ID"> <div class="quan_user"> <img sn-binding="src:item.Avatars" /> <div class="bd"> <h2 sn-binding="html:item.NickName|or:item.Mobile"></h2> <div class="time" sn-binding="html:item.CommentTime|date:\'MM-dd hh:ss\'"></div> </div> </div> <div class="quan_con" sn-binding="html:item.Content"></div> </li> </ul> </div> </div> </div> ';return __},helpers:{}});return T.template=T.html,T});define("template/activity",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> </header> <div class="main destwrap actwrap"> <div class="destimg"> <img sn-binding="src:data.Pic" /> <div class="destfav" sn-binding="html:data.Favorite,class:isFavorite|equal:true:\'destfav fav_current\':\'destfav\'"></div> <h1 sn-binding="html:data.Name"></h1> </div> <div class="activity_info"> <div class="act_signup"><b class="act_signup_num" sn-binding="html:data.SignUpQty"></b>报名</div> <div class="act_time"><text sn-binding="html:data.StartTime|date:\'yyyy年MM月dd日 hh:mm\'"></text>~<text sn-binding="html:data.FinishTime|date:\'yyyy年MM月dd日 hh:mm\'"></text></div> <div class="act_address" sn-binding="html:data.Address"></div> </div> <div class="destinfo"> <h2>详情</h2> <div class="destcontent" sn-binding="html:data.Content"></div> </div> <div class="destinfo"> <h2><span class="destcomment js_comment">发表评论</span>评论</h2> <div class="destcontent"> <ul class="quan_list"> <li class="quan_item" sn-repeat="item in comments" sn-binding="data-id:item.ID"> <div class="quan_user"> <img sn-binding="src:item.Avatars" /> <div class="bd"> <h2 sn-binding="html:item.NickName|or:item.Mobile"></h2> <div class="time" sn-binding="html:item.CommentTime|date:\'MM-dd hh:ss\'"></div> </div> </div> <div class="quan_con" sn-binding="html:item.Content"></div> </li> </ul> </div> </div> </div> <footer class="signup_bar"> <b class="btn_signup js_submit">我要报名</b> </footer> ';return __},helpers:{}});return T.template=T.html,T});define("template/comment",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<header> <div class="head_back" sn-binding="data-back:back"></div> <div sn-binding="html:title" class="head_title"></div> <div class="head_search_btn"><b class="btn_small js_submit">提交</b></div> </header> <div class="main"> <textarea class="txt_comment" sn-model="content" placeholder="写评论..."></textarea> <div class="comment_pic" sn-binding="display:showPic" style="display:none"> <ul> <li sn-repeat="item in images"> <img sn-binding="src:item.Src" /> </li> <li><input type="file" /></li> </ul> </div> </div>';return __},helpers:{}});return T.template=T.html,T});define("template/reply",function(require){var T=(require("util"),{html:function($data){var __="";with($data||{})__+='<div class="reply"> <input type="text" sn-model="content" sn-binding="value:content" /> <b class="btn_small js_reply">回复评论</b> </div>';return __},helpers:{}});return T.template=T.html,T});define("views/register",["images/style.css"],function(i,e,t){var a=(i("$"),i("util")),n=i("activity"),d=i("../widget/loading"),l=i("../core/model"),r=i("../widget/scroll"),m=(i("animation"),i("util/md5"));return n.extend({events:{"tap .js_bind:not(.disabled)":function(){var i=this.model.data.mobile,e=this.model.data.password,t=this.model.data.password1,s=this.model.data.smsCode;return i&&a.validateMobile(i)?e!=t?void sl.tip("两次密码输入不一致"):s?void this.loading.setParam({mobile:i,password:m.md5(e),smsCode:s}).load():void sl.tip("请输入验证码"):void sl.tip("请输入正确的手机")},"tap .js_valid:not(.disabled)":function(i){var e=this.model.get("mobile");return e&&a.validateMobile(e)?(this.$valid.addClass("disabled"),this.valid.setParam({mobile:this.model.data.mobile}),void this.valid.load()):void sl.tip("请输入正确的手机")}},validTimeout:function(){var i=this,e=localStorage.getItem("valid_time");if(e&&parseInt(e)>60){if(e=Math.round((new Date(parseInt(e)).getTime()-Date.now())/1e3),0>=e)return;i.$valid.addClass("disabled"),setTimeout(function(){0>=e?(i.$valid.removeClass("disabled"),i.model.set("valid","获取验证码"),localStorage.removeItem("valid_time")):(i.model.set("valid",e+"秒"),e--,setTimeout(arguments.callee,1e3))},1e3)}},onCreate:function(){var i=this,e=this.$(".main");r.bind(e),this.model=new l.ViewModel(this.$el,{title:"注册",valid:"获取验证码",back:this.route.queries.from||"/login"}),this.loading=new d({url:"/api/user/register",method:"POST",check:!1,checkData:!1,$el:this.$el,success:function(e){e.success?(localStorage.setItem("user",JSON.stringify(e.data)),i.back(i.route.queries.success||"/")):sl.tip(e.msg)},error:function(i){sl.tip(i.msg)}}),this.valid=new d({url:"/api/user/send_sms",method:"POST",params:{mobile:i.model.data.mobile},check:!1,checkData:!1,$el:this.$el,success:function(e){e.success?(localStorage.setItem("valid_time",Date.now()+6e4),i.validTimeout()):sl.tip(e.msg)}}),i.$valid=this.$(".js_valid"),i.validTimeout()},onShow:function(){},onDestory:function(){}})});define("views/destcomment",["images/style.css"],function(i,e,t){{var a=(i("$"),i("util")),n=i("activity"),d=i("../widget/loading"),l=i("../core/model"),r=i("../widget/scroll");i("animation")}return n.extend({events:{"tap .js_submit:not(.disabled)":function(){var i=this;i.model.data.content?i.loading.setParam({DestID:i.route.data.id,UserID:i.user.ID,Auth:i.user.Auth,Content:i.model.data.content}).load():sl.tip("请填写评论")}},swipeRightBackAction:"/",onCreate:function(){var i=this,e=this.$(".main");r.bind(e),this.model=new l.ViewModel(this.$el,{back:"/",title:"评论"}),this.loading=new d({url:"/api/destination/add_comment",$el:this.$el,checkData:!1,success:function(e){e.success&&(sl.tip("评论成功"),i.setResult("comment_success"),i.back("/destination/"+i.route.data.id))}})},onShow:function(){var i=this;i.user=a.store("user"),i.user||i.forward("/login?success="+this.route.url+"&from="+this.route.url)},onDestory:function(){}})});define("views/actcomment",["images/style.css"],function(i,e,t){{var a=(i("$"),i("util")),n=i("activity"),d=i("../widget/loading"),l=i("../core/model"),r=i("../widget/scroll");i("animation")}return n.extend({events:{"tap .js_submit:not(.disabled)":function(){var i=this;i.model.data.content?i.loading.setParam({ActivityID:i.route.data.id,UserID:i.user.ID,Auth:i.user.Auth,Content:i.model.data.content}).load():sl.tip("请填写评论")}},onCreate:function(){var i=this,e=this.$(".main");r.bind(e),this.model=new l.ViewModel(this.$el,{back:"/",title:"评论"}),this.loading=new d({url:"/api/activity/add_comment",$el:this.$el,checkData:!1,success:function(e){e.success&&(sl.tip("评论成功"),i.setResult("comment_success"),i.back("/activity/"+i.route.data.id))}})},onShow:function(){var i=this;i.user=a.store("user"),i.user||i.forward("/login?success="+this.route.url+"&from="+this.route.url)},onDestory:function(){}})});define("views/reccomment",["images/style.css"],function(i,e,t){{var a=(i("$"),i("util")),n=i("activity"),d=i("../widget/loading"),l=i("../core/model"),r=i("../widget/scroll");i("animation")}return n.extend({events:{"tap .js_submit:not(.disabled)":function(){var i=this;i.model.data.content?i.loading.setParam({DestID:i.route.data.id,UserID:i.user.ID,Auth:i.user.Auth,Content:i.model.data.content}).load():sl.tip("请填写评论")}},swipeRightBackAction:"/",onCreate:function(){var i=this,e=this.$(".main");r.bind(e),this.model=new l.ViewModel(this.$el,{back:"/",title:"评论"}),this.loading=new d({url:"/api/recommend/add_comment",$el:this.$el,checkData:!1,success:function(e){e.success&&(sl.tip("评论成功"),i.setResult("comment_success"),i.back("/recommend/"+i.route.data.id))}})},onShow:function(){var i=this;i.user=a.store("user"),i.user||i.forward("/login?success="+this.route.url+"&from="+this.route.url)},onDestory:function(){}})});define("views/comment",["images/style.css"],function(i,e,t){{var a=(i("$"),i("util")),n=i("activity"),d=i("../widget/loading"),l=i("../core/model"),r=i("../widget/scroll");i("animation")}return n.extend({events:{"tap .js_submit:not(.disabled)":function(){var i=this;if(i.model.data.content){var e=i.model.get("images").data;i.loading.setParam({UserID:i.user.ID,Auth:i.user.Auth,Content:i.model.data.content,Pictures:e&&JSON.stringify(e)}).load()}else sl.tip("请填写评论")},'change input[type="file"]':function(i){var e=this,t=document.createElement("canvas"),s=t.getContext("2d"),a=new FileReader;a.onload=function(i){var a=new Image;a.onload=function(){t.width=a.width,t.height=a.height,s.drawImage(a,0,0,a.width,a.height);t.toDataURL("image/jpeg")},e.model.get("images").add({Src:i.target.result})},a.readAsDataURL(i.target.files[0])}},swipeRightBackAction:"/",onCreate:function(){var i=this,e=this.$(".main");r.bind(e),this.model=new l.ViewModel(this.$el,{back:"/",title:"评论",showPic:!0,images:[]}),this.loading=new d({url:"/api/quan/add_comment?areaid="+a.store("global_area"),$el:this.$el,checkData:!1,success:function(e){e.success&&(sl.tip("评论成功"),i.setResult("comment_success"),i.back("/"))}})},onShow:function(){var i=this;i.user=a.store("user"),i.user||i.forward("/login?success="+this.route.url+"&from="+this.route.url)},onDestory:function(){}})});define("views/index",["images/style.css"],function(i,e,t){{var s=i("$"),a=i("util"),n=i("activity"),d=i("../widget/loading"),l=i("../widget/slider"),r=i("../core/model"),o=i("../widget/scroll");i("animation")}return n.extend({events:{tap:function(i){i.target==this.el&&this.back("/")},"tap .head_menu":function(i){this.forward("/menu")},"tap .js_comment_list [data-id]":function(i){var e=s(i.currentTarget);this.forward((1==e.data("type")?"/activity/":"/destination/")+e.data("id"))},"tap .js_comment":function(i){this.forward(this.user?"/comment":"/login")},"tap .footer li":function(i){var e=s(i.currentTarget);if(!e.hasClass("curr")){var t=e.index();e.addClass("curr").siblings(".curr").removeClass("curr"),this.$main.eq(t).show().siblings(".main").hide(),this.model.set("title",this.titles[t]),this.$el.find(".js_comment").css({display:3==t?"block":"none"}),this.$el.find(".head_city").css({display:3==t?"none":"block"}),this.loading[t].isDataLoaded||this.loading[t].load()}},"tap .quanli_reply":function(i){var e=s(i.currentTarget),t=e.closest("[data-id]"),n=t.data("id");a.store("replyAt","@"+t.data("at")),this.forward("/reply/"+n)},"tap .citylistwrap":function(i){s(i.target).hasClass("citylistwrap")&&(this.$citylist.removeClass("show"),this.$(".head_city").removeClass("select_city"),this.$(".head_menu").css({visibility:""}))},"tap .head_city":function(i){var e=s(i.currentTarget).toggleClass("select_city");e.hasClass("select_city")?(this.$citylist.show()[0].clientHeight,this.$citylist.addClass("show"),this.$(".head_menu").css({visibility:"hidden"})):(this.$citylist.removeClass("show"),this.$(".head_menu").css({visibility:""}))},"tap .city_list li[data-id]":function(i){var e=s(i.currentTarget),t=e.data("id");a.store("global_area",t),this.$(".citylistwrap").trigger("tap"),this.setResult("global_area_change",t)},"tap .js_picviewer":function(i){s(i.currentTarget).hide()}},swipeRightForwardAction:"/menu",className:"home",titles:["来次go","目的地","活动","驴友圈"],onCreate:function(){var i=this,e=a.store("global_area"),t=[{city_id:1,city_name:"北京",code:"101010100"},{city_id:2,city_name:"厦门",code:"101230201"},{city_id:3,city_name:"江门",code:"101281101"}];a.style(".js_destination .slider img{max-height:"+(window.innerHeight-64-47)+"px}"),i.picView=new l(this.$(".js_picviewer"),{itemTemplate:'<img src="<%=Src%>">',data:[]});var n=a.first(t,function(i){return i.city_id==e});this.model=new r.ViewModel(this.$el,{menu:"head_menu",titleClass:"head_title",title:"来次go",city:n.city_name,city_list:t,showPic:function(e,t,s){i.$(".js_picviewer").show(),i.picView.set(t.data),i.picView.index(s)}}),i.getWeather(n.code),this.$citylist=this.$(".citylistwrap"),this.listenTo(this.$citylist,s.fx.transitionEnd,function(){this.$citylist.hasClass("show")||this.$citylist.hide()});var c=this.$main=this.$(".main");o.bind(c,{refresh:function(e,t){var s=this.parentNode.getAttribute("data-index");1==s?e():i.loading[s].reload({showLoading:!1},function(i,s){i?t(i):e(s)})}}),this.loading=[],["/api/recommend/list","/api/destination/list?getall=1","/api/activity/list","/api/quan/list"].forEach(function(t,s){var a=new d({url:t,params:{areaid:e},$el:c.eq(s),$content:c.eq(s).children(":first-child"),$scroll:c.eq(s),checkData:!1,success:function(e){this.isDataLoaded=!0,1==s?(this.$content.html(""),i.slider=new l(this.$content,{arrow:!0,itemTemplate:'<a href="/destination/<%=ID%>" forward><img src="<%=LargePic%>"><div class="recommend_name"><%=Name%></div><div class="recommend_fav"><%=Favorite%></div></a>',data:e.data})):i.model.set("data"+s,e.data),e.data||this.showError("暂无数据")},append:1==s?null:function(e){i.model.get("data"+s).append(e.data)}});i.loading.push(a)}),this.loading[0].load(),i.onResult("comment_success",function(){i.loading[3].reload()}),i.onResult("global_area_change",function(e,s){var n=a.first(t,function(i){return i.city_id==s});i.model.set("city",n.city_name),i.loading.forEach(function(i){i.setParam({areaid:s}).reload()}),i.getWeather(n.code)})},getWeather:function(i){var e=this;s.get((sl.isDebug?"":"http://m.weather.com.cn")+"/mweather/"+i+".shtml",function(i){var t=i.match(/<table width="98%" border="0">\s*<tr>\s*<td width="20%"><img src="(.+?)" width="70" alt=".*?"><\/td>\s*<td width="50%" class="wd">(.+?)<\/td>/m);t&&e.model.set("weather",' <img src="'+t[1]+'" style=" width: 30px; height: 30px; background: none; vertical-align: -10px;"/> '+t[2])})},onShow:function(){var i=this;i.user=a.store("user")},onDestory:function(){}})});define("views/reply",["images/style.css"],function(i,e,t){{var a=(i("$"),i("util")),n=i("activity"),d=i("../widget/loading"),l=i("../core/model");i("../widget/scroll"),i("animation")}return n.extend({events:{tap:function(i){i.target==this.el&&this.back(this.route.queries.from||"/")},"tap .js_reply:not(.disabled)":function(){var i=this;i.model.data.content?i.loading.setParam({ID:this.route.data.id,UserID:i.user.ID,Auth:i.user.Auth,Content:i.model.data.content}).load():sl.tip("请填写评论")}},swipeRightBackAction:"/",toggleAnim:"fade",className:"transparent",onCreate:function(){var i=this;this.swipeRightBackAction=i.route.queries.from||"/",this.model=new l.ViewModel(this.$el,{content:a.store("replyAt")?a.store("replyAt")+" ":""}),this.loading=new d({url:"/api/"+(0==i.route.query.type?"quan":1==i.route.query.type?"recommend":2==i.route.query.type?"destination":"activity")+"/reply_comment",$el:this.$el,checkData:!1,success:function(e){e.success&&(sl.tip("评论成功"),i.setResult("comment_success"),i.back(i.route.queries.from||"/"))}})},onShow:function(){var i=this;i.user=a.store("user"),i.user||i.forward("/login?success="+this.route.url+"&from="+this.route.url),i.$el.find("input").focus()},onDestory:function(){}})});define("views/activity",["images/style.css"],function(i,e,t){var a=(i("$"),i("util")),n=i("activity"),d=i("../widget/loading"),l=i("../core/model"),r=i("../core/promise"),o=i("../widget/scroll"),m=(i("animation"),i("common"));return n.extend({events:{"tap .js_submit:not(.disabled)":function(i){this.user?(this.$submit.addClass("disabled"),this.submit.setParam({UserID:this.user.ID,Auth:this.user.Auth}).load()):this.forward("/login?success="+this.route.url+"&from="+this.route.url)},"tap .js_comment":function(){this.forward("/actcomment/"+this.route.data.id)},"tap .destfav":function(){a.store("user")?(this.model.set("isFavorite",!this.model.data.isFavorite),this.model.set("data.Favorite",(this.model.data.data.Favorite||0)+(this.model.data.isFavorite?1:-1)),m.favorite("activity",this.route.data.id,this.model.data.isFavorite)):sl.tip("请先登录")}},onCreate:function(){var i=this;this.promise=new r,this.$main=this.$(".main"),o.bind(this.$main),l.Filter.precent=function(i){return parseFloat(i)+"%"};a.store("user");this.model=new l.ViewModel(this.$el,{title:"活动详情",back:this.route.queries.from||"/",isFavorite:m.isFavorite("activity",this.route.data.id)}),this.loading=new d({url:"/api/activity/get",params:{id:this.route.data.id},check:!1,checkData:!1,$el:this.$el,$content:this.$main.children(":first-child"),$scroll:this.$main,success:function(e){i.promise.then(function(){i.model.set(e)}),localStorage.setItem("activity",JSON.stringify(e.data))}}),this.loading.load(),this.$submit=this.$el.find(".js_submit"),this.submit=new d({url:"/api/activity/signup",params:{id:this.route.data.id},check:!1,checkData:!1,$el:this.$el,success:function(e){e.success?(sl.tip("报名成功！"),i.model.set("data.SignUpQty",i.model.data.data.SignUpQty+1)):sl.tip(e.msg),i.$submit.removeClass("disabled")}}),this.comments=new d({url:"/api/activity/comment_list",params:{id:this.route.data.id},$el:i.$(".quan_list"),success:function(e){i.model.set("comments",e.data)},append:function(e){i.model.get("comments").append(e.data)}}),this.comments.load(),i.onResult("comment_success",function(){i.comments.reload()})},onLoad:function(){this.promise.resolve()},onShow:function(){this.user=a.store("user")},onDestory:function(){}})});